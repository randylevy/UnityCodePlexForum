

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="" prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile#">
    
    
    
    

    
    <head>
        <meta id="CompatabilityMode" http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../assets/StyleSheet.css" id="MasterCss" rel="stylesheet" type="text/css" />
        <link rel="SHORTCUT ICON" href="../assets/favicon.ico" />
        <title>patterns &#38; practices - Unity - Proposed container API change, opinions wanted</title>
        
       
                    <script src="../assets/mscc-0.3.6.min.js"></script>
        
                    <link rel="stylesheet" type="text/css" href="../assets/mscc-0.3.6.min.css" />
        
            <script type="text/javascript">
                var msccHadCookieBannerAtPageStart = true;
            </script>
        

        <!--
        Third party scripts and code linked to or referenced from this website are licensed to you by the parties that own such code,
        not by Microsoft.  See ASP.NET Ajax CDN Terms of Use â€“ http://www.asp.net/ajaxlibrary/CDN.ashx.
        -->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.4.4.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.6/jquery-ui.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery.ui === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        
    <style type="text/css">.SideBar, .SideBarPadding{display:none;}.MainContent{width:auto;}.SiteContentTable{width:100%;}</style>
    <style id="ProjectStyles" type="text/css">
        .SiteHeader, .SiteHeaderLeft {
            height:45px !important;
            overflow:hidden;
        }
        .SiteContent 
        {
            padding: 0 0 1em 0;
            margin-top:0;
            min-height:225px;
            border-right: 1px solid lightgrey;
            border-left: 1px solid lightgrey;
            border-bottom: 1px solid lightgrey;
        }
        .IE table.MinWidthContent
        {
	        table-layout: auto !important;	
        }
    </style>
    
    
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">

    
    
    <meta id="WTProjectName" name="WT.pi" content="unity"/>
    

    <link rel="EditURI" type="application/rsd+xml" title="RSD" href='http://unity.codeplex.com/rsd' />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href='/wlwmanifest.xml' />
    
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity" url="http://unity.codeplex.com/project/feeds/rss"/>
    
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Discussions" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Issues" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Downloads" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Reviews" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity"/>
        
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Source&#32;code" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Wiki" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity"/>
    
        
    
        <meta content="summary" name="twitter:card" /><meta content="@CodePlex" name="twitter:site" /><meta content="http://unity.codeplex.com/discussions/22696?ProjectName=unity" name="twitter:url" /><meta content="patterns &amp;#38; practices - Unity" name="twitter:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" name="twitter:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" name="twitter:image" /><meta content="CodePlex" property="og:site_name" /><meta content="http://unity.codeplex.com/discussions/22696?ProjectName=unity" property="og:url" /><meta content="object" property="og:type" /><meta content="patterns &amp;#38; practices - Unity" property="og:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" property="og:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" property="og:image" />
        

    </head>
    
    <body>
         
            
        <script src="../assets/ScriptLoader.js" type="text/javascript"></script>
        <form id="aspnetForm" autocomplete="off" method="POST" enctype="multipart/form-data">
            <input name="__RequestVerificationToken" type="hidden" value="-CqWrFx0bCLg9vXeWq6HJ8zHQg28eZbyJKh3AZ9MiKxcHe9xZD-_UoCiH2TIujvrH60teQ5ZABbG8v0Xh1syX55fzIg8xZxcMbojYZNIZ5x_Xu2wKAcJbdJMbeJnSchH1uo7CQ2" /><input name="__RequestVerificationToken2" type="hidden" value="__RequestVerificationToken205fcae70-413c-4c1a-9d60-20fa91ebb33f" />
            
            <div id="UpdateProgressPanel" class="loading_animation" style="display:none;">
                <div class="row">
                    <h2 class="anim_h2">
                        <span id="UpdateProgressText">Updating...</span>
                        <span id="animatedLoadingIconContainer">
                            <img id="animatedLoadingIcon" src="../assets/loading_animation.gif" class="anim_img"/>
                        </span>
                    </h2>
                </div>
            </div>
            
            <div style="display:none;">
                
                <img id="BlankImage" style="width:0;height:0;" src="../assets/blank.png" onload="self.logoImageLoaded=true;"/>

                <script language="javascript" type="text/javascript">
                    var date = new Date();
                    var timezoneOffset = date.getTimezoneOffset() / 60 * -1;
                    var timezoneOffsetCookie = getCookie("TimezoneOffset");
                    var firstTimeSetTimezoneCookie = false;

                    if (timezoneOffsetCookie == null || timezoneOffsetCookie != timezoneOffset) {
                        firstTimeSetTimezoneCookie = true;
                        document.cookie = "TimezoneOffset=" + timezoneOffset + '; domain=.codeplex.com;expires=Wed, 10 Oct 2018 05:29:23 UTC';
                    }
                </script>
            </div>
            
            
            <div id="banner">
                <div id="message"><strong>This is an archived copy of the original CodePlex Unity Discussion Forum.</strong> <a href="https://github.com/unitycontainer/">Unity is now on GitHub</a>
                    
                </div>
            </div>
            

            <div id="header">
                <div id="header_wrap" class="row">
                    <p id="logo"><a href="http://www.codeplex.com">Code<span class="semi">Plex</span></a><span id="tagline">Project Hosting for Open Source Software</span></p>
                    

<ul id="nav">

    <li><a href="/site/register/new" id="registerLink" class="ZoomFix">Register</a></li>
    <li ><a class="SignInLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f22696" id="signInLink">Sign In</a></li>
  
    <li class="last"><a class="rss_site_icon" href="http://www.codeplex.com/site/feeds/rss" type="application/rss+xml" rel="Alternate" title="CodePlex Site Activity"></a></li>
</ul>
                    <input id="searchsite" name="searchsite" maxlength="500" type="text" value="" /><span id="search_mag"><a id="submitSearch" name="submitSearch" class="magnify" title="Search" href="#"></a></span>
                    <script>
	$(document).ready(function() {
    var searchButton = $('#submitSearch'),
        searchBar = $('#searchsite');

    // Register our own handler for the search event while we wait for the SearchBox script to load.
    searchButton.bind('click.backupSearchBox', doProjectSearch);
    searchBar.bind('keypress.backupSearchBox', function(e) { if ($keyCode(e) === 13) { doProjectSearch(); return false; } });

    function cleanupSearchEvents() {
        // If the SearchBox was loaded, unregister our handlers.
        if (epx_loaded) {
            searchButton.unbind('.backupSearchBox');
            searchBar.unbind('.backupSearchBox');
        }
    }

    $loadScript('https://i4.services.social.microsoft.com/search/Widgets/SearchBox.jss?appid=1000&scopeid=1&boxId=searchsite&btnId=submitSearch&watermark=Search%20all%20projects&overrideWatermark=true&searchLocation=https%3A%2F%2Fwww.codeplex.com%2Fsite%2Fsearch&allowEmptySearch=true&focusOnInit=False&minimumTermLength=3', cleanupSearchEvents);
})
function doProjectSearch() {
    
    var url = 'https://www.codeplex.com/site/search';

    //If search term is not same as watermark
    if($('#searchsite').val() != 'Search all projects')    
    {        
        url = url + '?query=' + encodeURIComponent($('#searchsite').val());
    }

    
    var callback = '';
    if (callback.length > 0 && eval('typeof ' + callback) != 'undefined')
        url += eval(callback + '()');

    window.location.href = url;
    return false;
}
</script>
                </div>
            </div>
            
            <div id="wrap">
                
    <div id="sub_heading" class="row">
        
        <div id="ProjectHeader">
            <div id="project_title_row" class="row">
                <div id="project_logo">
                    
<a id="AffiliateLink" href="http://msdn.microsoft.com/practices">
    <img id="AffiliateImage" src="../assets/pnp_logo.png" title="patterns&#32;&#38;&#32;practices" />
</a>

    
    <h1 class="text_only"><a href="http://unity.codeplex.com/" id="ProjectTitle1"><div>patterns &#38; practices - Unity</div></a></h1>

                </div>
            </div>
        </div>
        
        <div id="ProjectDetailsDiv">
            
        </div>
		<div class="clear"></div>
        

<ul id="page_box_links">
	<li id="homeTabCell" style="width: 63px;"><a id="homeTab" href="http://unity.codeplex.com/" class="box_home">home</a><div></div></li>
    
	<li id="sourceTabCell" style="width:113px;"><a id="sourceTab" href="http://unity.codeplex.com/SourceControl/latest" class="box_source">source code</a><div></div></li>
    
	<li id="releasesTabCell" style="width:105px;"><a id="releasesTab" href="http://unity.codeplex.com/releases" class="box_downloads">downloads</a><div></div></li>
    
    <li id="documentationTabCell" style="width:143px;"><a id="documentationTab" href="http://unity.codeplex.com/documentation" class="box_documentation">documentation</a><div></div></li>
    
	<li id="discussionTabCell" style="width:112px;"><a id="discussionTab" href="../index.html" class="discussions_active">discussions</a><div></div></li>
    
	<li id="workItemsTabCell" style="width:70px;"><a id="workItemsTab" href="http://unity.codeplex.com/workitem/list/basic" class="box_issue">issues</a><div></div></li>
    
	<li id="peopleTabCell" style="width:70px;"><a id="peopleTab" href="http://unity.codeplex.com/team/view" class="box_people">people</a><div></div></li>
	<li id="licenseTabCell" style="width:70px;"><a id="licenseTab" href="http://unity.codeplex.com/license" class="box_license">license</a><div></div></li>
    
    <span class="stretch"></span>
</ul>

<script type="text/javascript">
    $(document).ready(function () {
        $('#page_box_links').applyLastClassToList();
    });
</script>
		    <div class="clear"></div>
            
     <td>
       

<div>
    
    <div id="actionBar" class="action_bar">
        <ul id="actionBar_ul" class="actionBar_sublinks subtab_right" style="vertical-align: middle;">

            

                <li id="li_actionbar_creatediscussion" data-action-id="actionbar_creatediscussion" data-action-type="Navigate" class="actionBar_sublinks" data-options-id="1e79b231-e12b-4577-bcc0-e168e2506bc8">
                
                    <script class="options" defer="defer" id="1e79b231-e12b-4577-bcc0-e168e2506bc8" type="application/json">{"navigate-url":"http://unity.codeplex.com/discussions/create"}</script> 
                    
                    <div class="actionBar_custom_content"></div>

                    <a href="#" id="actionbar_creatediscussion" title="Start a New Thread" class="action_bar_item_link">
                        <img id="img_actionbar_creatediscussion" class="action_bar_item_image" src="../assets/actionbar_newitem.png" style="vertical-align: middle" />
                        New Thread
                    </a>

                </li>

            

                <li id="li_actionbar_subscribe" data-action-id="actionbar_subscribe" data-action-type="PopUp" class="actionBar_sublinks" data-options-id="32747ef8-3a4c-46e3-8e5f-56b1c9429c46">
                
                    <script class="options" defer="defer" id="32747ef8-3a4c-46e3-8e5f-56b1c9429c46" type="application/json">{}</script> 
                    
                    <div class="actionBar_custom_content">

<div id="rssHoverDiv" class="HoverPanel LeftHoverWidth" style="display: none">
        <ul id="3_FeedsPanel" class="RssFeedsPanel">
            <li>
                <a id="ProjectRssLink" href="http://unity.codeplex.com/project/feeds/rss" class="ArrowSmall NoUnderline">All Project Updates</a>
            </li>
            
            <li>
                <a id="DiscussionRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity" class="ArrowSmall NoUnderline">Discussions</a>
            </li>
            
            <li>
                <a id="IssueTrackerRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity" class="ArrowSmall NoUnderline">Issue Tracker</a>
            </li>
            
            <li>
                <a id="ReleasesRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity" class="ArrowSmall NoUnderline">Downloads</a>
            </li>
            <li>
                <a id="ReviewsRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity" class="ArrowSmall NoUnderline">Reviews</a>
            </li>
            
            <li>
                <a id="SourceControlRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity" class="ArrowSmall NoUnderline">Source Code</a>
            </li>
            <li>
                <a id="WikiRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity" class="ArrowSmall NoUnderline">Wiki &amp; Documentation</a>
            </li>
        </ul>
</div></div>

                    <a href="#" id="actionbar_subscribe" title="Subscribe to project updates in RSS feeds." class="action_bar_item_link">
                        <img id="img_actionbar_subscribe" class="action_bar_item_image" src="../assets/actionbar_subscribe.png" style="vertical-align: middle" />
                        Subscribe
                    </a>

                </li>

            
        </ul>
    </div>
</div>
     </td>

        

    </div>
    
    
<div class="Threads">
    <div class="ViewThread">
        
        
        
            <h1 class="page_title WordWrapBreakWord">
                Proposed container API change, opinions wanted
            </h1>

            <!-- Private Discussion header -->
            

            <!-- Posts List Header: Topics and Wiki Link -->
            <table class="PostsListHeader">
                <tr>
                    <td>
                     
                    </td>
                    <td>
                        <div class="WikiLink">
                            <span title="Paste this into a wiki page to link to this discussion">
                                Wiki Link: [discussion:22696]
                            </span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- The list of posts -->
            

<div id="discussionsPostList" data-options-id="d0bf4958-c3f2-48d1-b1c7-32e812a8fe5b">
    <script class="options" defer="defer" id="d0bf4958-c3f2-48d1-b1c7-32e812a8fe5b" type="application/json">{"threadUrl":"http://unity.codeplex.com/discussions/22696","showEditor":false,"checkImageUrl":"../assets/check_answer.png"}</script>

    <div class="Posts" style="margin-top: 10px;">
    

<table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 0px; table-layout:fixed">
    

<tr id="PostPanel" class="Post" d:forid="75836">
    <td id="PostDetailsCell_75836" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75836"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/22/2008 8:49:02 PM" LocalTimeTicks="1203742142">Feb 22, 2008 at 8:49 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75836" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#39;m&#32;currently&#32;looking&#32;at&#32;implementing&#32;more&#32;general&#32;purpose&#32;lifetime&#32;management&#59;&#32;enough&#32;people&#32;have&#32;asked&#32;about&#32;it&#32;or&#32;complained&#32;about&#32;the&#32;lack&#32;of&#32;it.Currently,&#32;I&#39;m&#32;thinking&#32;that&#32;we&#32;could&#32;replace&#32;both&#32;SetSingleton&#32;and&#32;RegisterInstance&#32;with&#32;this&#32;method&#58;interface&#32;IUnityContainer&#123;&#32;IUnityContainer&#32;SetLifetime&#40;Type&#32;t,&#32;string&#32;name,&#32;ILifetimeManager&#32;lifetime&#41;&#59;&#125;Where&#32;we&#32;would&#32;supply&#32;the&#32;following&#32;lifetime&#32;managers&#58;TransientLifetimeManager&#58;&#32;Always&#32;create&#32;a&#32;new&#32;one&#59;&#32;this&#32;is&#32;the&#32;default&#32;unless&#32;otherwise&#32;specifiedSingletonLifetimeManager&#58;&#32;Per-container&#32;singleton,&#32;what&#32;SetSingleton&#32;does&#32;nowSpecificInstanceLifetimeManager&#58;&#32;Stores&#32;and&#32;returns&#32;a&#32;specific&#32;instance&#32;&#40;and&#32;optionally&#32;does&#32;a&#32;weak&#32;reference&#32;to&#32;the&#32;instance&#41;,&#32;what&#32;RegisterInstance&#32;does&#32;now.The&#32;interface&#32;for&#32;the&#32;lifetime&#32;manager&#32;looks&#32;like&#32;this&#58;interface&#32;ILifetimeManager&#32;&#58;&#32;ILifetimePolicy&#123;&#32;&#47;&#47;&#32;Called&#32;when&#32;the&#32;lifetime&#32;manager&#32;is&#32;added&#32;to&#32;the&#32;container&#32;void&#32;Initialize&#40;ExtensionContext&#32;context&#41;&#59;&#125;ILifetimePolicy&#32;is&#32;defined&#32;in&#32;OB,&#32;and&#32;looks&#32;like&#32;this&#58;interface&#32;ILifetimePolicy&#32;&#58;&#32;IBuilderPolicy&#123;&#32;&#47;&#47;&#32;Retrieve&#32;the&#32;item&#32;from&#32;backing&#32;store,&#32;or&#32;null&#32;if&#32;not&#32;there&#32;object&#32;GetValue&#40;IBuilderContext&#32;context&#41;&#59;&#32;&#47;&#47;&#32;Store&#32;the&#32;given&#32;object&#32;into&#32;the&#32;backing&#32;store&#32;void&#32;SetValue&#40;IBuilderContext&#32;context,&#32;object&#32;value&#41;&#59;&#32;&#47;&#47;&#32;Remove&#32;the&#32;given&#32;object&#32;from&#32;backing&#32;store&#32;void&#32;RemoveValue&#40;IBuilderContext&#32;context,&#32;object&#32;value&#41;&#59;&#125;I&#39;d&#32;like&#32;to&#32;know&#32;what&#32;you&#32;folks&#32;think&#32;of&#32;this&#32;interface&#32;for&#32;lifetime&#32;management,&#32;and&#32;to&#32;the&#32;proposed&#32;change&#32;in&#32;the&#32;container.&#32;Should&#32;we&#32;remove&#32;lifetime&#32;management&#32;completely&#32;to&#32;an&#32;extension&#63;&#32;Is&#32;this&#32;as&#32;usable&#32;as&#32;the&#32;simple&#32;SetSingleton&#47;RegisterInstance&#32;methods&#63;&#32;And&#32;are&#32;there&#32;any&#32;lifetimes&#32;that&#32;you&#32;can&#39;t&#32;implement&#32;using&#32;this&#32;API&#63;Thanks,-Chris">
        I'm currently looking at implementing more general purpose lifetime management; enough people have asked about it or complained about the lack of it.<br>
<br>
Currently, I'm thinking that we could replace both SetSingleton and RegisterInstance with this method:<br>
<br>
interface IUnityContainer<br>
{<br>
IUnityContainer SetLifetime(Type t, string name, ILifetimeManager lifetime);<br>
}<br>
<br>
Where we would supply the following lifetime managers:<br>
<br>
TransientLifetimeManager: Always create a new one; this is the default unless otherwise specified<br>
SingletonLifetimeManager: Per-container singleton, what SetSingleton does now<br>
SpecificInstanceLifetimeManager: Stores and returns a specific instance (and optionally does a weak reference to the instance), what RegisterInstance does now.<br>
<br>
The interface for the lifetime manager looks like this:<br>
<br>
interface ILifetimeManager : ILifetimePolicy<br>
{<br>
// Called when the lifetime manager is added to the container<br>
void Initialize(ExtensionContext context);<br>
}<br>
<br>
ILifetimePolicy is defined in OB, and looks like this:<br>
<br>
interface ILifetimePolicy : IBuilderPolicy<br>
{<br>
// Retrieve the item from backing store, or null if not there<br>
object GetValue(IBuilderContext context);<br>
<br>
// Store the given object into the backing store<br>
void SetValue(IBuilderContext context, object value);<br>
<br>
// Remove the given object from backing store<br>
void RemoveValue(IBuilderContext context, object value);<br>
}<br>
<br>
I'd like to know what you folks think of this interface for lifetime management, and to the proposed change in the container. Should we remove lifetime management completely to an extension? Is this as usable as the simple SetSingleton/RegisterInstance methods?
 And are there any lifetimes that you can't implement using this API?<br>
<br>
Thanks,<br>
<br>
-Chris<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75836" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75948">
    <td id="PostDetailsCell_75948" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75948"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/francois_tanguay">francois_tanguay</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/23/2008 4:07:59 PM" LocalTimeTicks="1203811679">Feb 23, 2008 at 4:07 PM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="2/23/2008 4:09:03 PM" LocalTimeTicks="1203811743">Feb 23, 2008 at 4:09 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75948" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;As&#32;you&#32;know,&#32;I&#32;think&#32;it&#32;is&#32;a&#32;great&#32;idea&#32;to&#32;abstract&#32;lifetime&#32;management&#32;so&#32;there&#32;isn&#96;t&#32;only&#32;the&#32;Singleton&#32;model&#32;that&#32;is&#32;available.With&#32;what&#32;you&#96;re&#32;proposing,&#32;I&#32;have&#32;a&#32;few&#32;questions&#47;comments&#58;Are&#32;you&#32;planning&#32;on&#32;encapsulating&#32;the&#32;ILocator&#32;into&#32;the&#32;ILifetimeManager&#63;&#32;Otherwise,&#32;why&#32;would&#32;need&#32;to&#32;have&#32;GetValue&#40;context&#41;&#32;and&#32;SetValue&#40;context,&#32;value&#41;&#32;on&#32;ILifetimeManager&#63;&#32;Before,&#32;ILifetimeContainer&#32;was&#32;uniquely&#32;there&#32;to&#32;root&#32;the&#32;created&#32;instances.&#32;There&#32;was&#32;no&#32;notion&#32;of&#32;a&#32;builder&#32;context&#32;nor&#32;a&#32;buildKey.&#32;Responsability&#32;wise,&#32;isn&#39;t&#32;it&#32;the&#32;Locator&#39;s&#32;job&#32;to&#32;find&#32;existing&#32;instances&#63;So&#32;I&#32;say&#32;GetValue&#32;shouldn&#39;t&#32;exist&#32;and&#32;SetValue&#32;shouldn&#39;t&#32;know&#32;about&#32;the&#32;context.&#32;I&#32;see&#32;both&#32;ILocator&#32;and&#32;ILifetimeManager&#32;acting&#32;in&#32;pair,&#32;not&#32;the&#32;latter&#32;facading&#32;the&#32;former.&#32;Here&#32;again,&#32;RegisterInstance&#32;was&#32;meant&#32;to&#32;publish&#32;external&#47;existing&#32;instances&#32;into&#32;the&#32;container.&#32;So&#32;I&#32;don&#39;t&#32;see&#32;the&#32;need&#32;for&#32;SpecificInstanceLifetimeManager.However,&#32;I&#32;think&#32;RegisterInstance&#32;should&#32;optionally&#32;accept&#32;an&#32;ILifetimeManager&#32;as&#32;its&#32;last&#32;parameter&#32;instead&#32;of&#32;a&#32;&#34;containerControlsLifetime&#34;&#32;boolean&#32;that&#32;forced&#32;it&#32;to&#32;being&#32;singleton.I&#39;d&#32;rename&#32;SingletonLifeTimeManager&#32;to&#32;something&#32;that&#32;expresses&#32;the&#32;fact&#32;that&#32;it&#32;is&#32;not&#32;a&#32;real&#32;singleton&#32;but&#32;local&#32;to&#32;the&#32;container&#32;as&#32;your&#32;comment&#32;describes.&#32;PerContainerLifetimeManager&#32;sounds&#32;good&#32;to&#32;me.&#32;">
        As you know, I think it is a great idea to abstract lifetime management so there isn`t only the Singleton model that is available.<br>
<br>
With what you`re proposing, I have a few questions/comments:<br>
<br>
<ul>
<li>Are you planning on encapsulating the ILocator into the ILifetimeManager?
<ul>
<li>Otherwise, why would need to have GetValue(context) and SetValue(context, value) on ILifetimeManager?
</li><li>Before, ILifetimeContainer was uniquely there to root the created instances. </li><li>There was no notion of a builder context nor a buildKey. </li><li>Responsability wise, isn't it the Locator's job to find existing instances?</li><li>So I say GetValue shouldn't exist and SetValue shouldn't know about the context. I see both ILocator and ILifetimeManager acting in pair, not the latter facading the former.
</li></ul>
</li></ul>
<br>
<ul>
<li>Here again, RegisterInstance was meant to publish external/existing instances into the container. So I don't see the need for SpecificInstanceLifetimeManager.
<ul>
<li>However, I think RegisterInstance should optionally accept an ILifetimeManager as its last parameter instead of a &quot;containerControlsLifetime&quot; boolean that forced it to being singleton.</li></ul>
</li></ul>
<br>
<ul>
<li>I'd rename SingletonLifeTimeManager to something that expresses the fact that it is not a real singleton but local to the container as your comment describes. PerContainerLifetimeManager sounds good to me.
</li></ul>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75948" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75955">
    <td id="PostDetailsCell_75955" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75955"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/23/2008 5:45:21 PM" LocalTimeTicks="1203817521">Feb 23, 2008 at 5:45 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75955" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Using&#32;the&#32;locator&#32;won&#39;t&#32;work&#32;in&#32;general.&#32;The&#32;problem&#32;is&#32;there&#39;s&#32;one&#32;locator&#32;per&#32;container.&#32;So&#32;what&#32;happens&#32;in&#32;multi-threaded&#32;situations&#63;&#32;Thread&#32;A&#32;sticks&#32;it&#39;s&#32;per&#32;thread&#32;object&#32;into&#32;the&#32;locator.&#32;Thread&#32;B&#32;looks&#32;in&#32;the&#32;locator,&#32;finds&#32;an&#32;object,&#32;and&#32;boom&#33;&#32;You&#39;ve&#32;got&#32;the&#32;wrong&#32;one.The&#32;locator&#32;and&#32;lifetime&#32;container&#32;are&#32;available&#32;to&#32;lifetime&#32;managers&#32;if&#32;they&#32;want&#32;it,&#32;but&#32;in&#32;general&#32;each&#32;one&#32;will&#32;need&#32;to&#32;implement&#32;some&#32;sort&#32;of&#32;backing&#32;store,&#32;thus&#32;the&#32;GetValue&#32;method.RegisterInstance&#32;-&#32;the&#32;containerControlsLifetime&#32;didn&#39;t&#32;force&#32;singleton,&#32;the&#32;mere&#32;act&#32;of&#32;registering&#32;an&#32;instance&#32;did.&#32;The&#32;containerControlsLifetime&#32;flag&#32;simply&#32;made&#32;the&#32;container&#32;hold&#32;onto&#32;a&#32;strong&#32;reference&#32;to&#32;the&#32;instance.&#32;RegisterInstance&#32;&#40;and&#32;SpecificInstanceLifetimeManager&#41;&#32;says&#32;&#34;If&#32;somebody&#32;asks&#32;for&#32;this&#32;type,&#32;give&#32;them&#32;this&#32;object&#34;.&#32;It&#32;sounded&#32;like&#32;a&#32;lifetime&#32;to&#32;me.">
        Using the locator won't work in general. The problem is there's one locator per container. So what happens in multi-threaded situations? Thread A sticks it's per thread object into the locator. Thread B looks in the locator, finds an object, and boom!
 You've got the wrong one.<br>
<br>
The locator and lifetime container are available to lifetime managers if they want it, but in general each one will need to implement some sort of backing store, thus the GetValue method.<br>
<br>
RegisterInstance - the containerControlsLifetime didn't force singleton, the mere act of registering an instance did. The containerControlsLifetime flag simply made the container hold onto a strong reference to the instance. RegisterInstance (and SpecificInstanceLifetimeManager)
 says &quot;If somebody asks for this type, give them this object&quot;. It sounded like a lifetime to me.<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75955" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75960">
    <td id="PostDetailsCell_75960" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75960"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/23/2008 6:17:23 PM" LocalTimeTicks="1203819443">Feb 23, 2008 at 6:17 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75960" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;just&#32;did&#32;a&#32;quick&#32;survey&#32;of&#32;the&#32;code,&#32;and&#32;it&#32;turns&#32;out&#32;that&#32;the&#32;locator&#32;is&#32;passed&#32;around&#32;a&#32;lot,&#32;but&#32;isn&#39;t&#32;actually&#32;used&#32;very&#32;often.&#32;It&#39;s&#32;used&#32;by&#32;the&#32;DependencyResolver,&#32;the&#32;SingletonStrategy,&#32;and&#32;the&#32;LookupParameter.&#32;None&#32;of&#32;those&#32;things&#32;are&#32;critical,&#32;and&#32;in&#32;the&#32;current&#32;Unity&#32;codebase&#32;anyway&#32;LookupParameter&#32;isn&#39;t&#32;used&#32;at&#32;all,&#32;and&#32;with&#32;this&#32;proposal&#32;SingletonStrategy&#32;is&#32;replaced&#32;by&#32;LifetimeStrategy&#32;which&#32;uses&#32;the&#32;LifetimePolicy.&#32;The&#32;DependencyResolver&#32;could&#32;easily&#32;not&#32;check&#32;the&#32;locator.So&#32;I&#39;m&#32;beginning&#32;to&#32;wonder&#32;if&#32;the&#32;Locator&#32;has&#32;outlived&#32;its&#32;usefulness&#63;">
        I just did a quick survey of the code, and it turns out that the locator is passed around a lot, but isn't actually
<i>used</i> very often. It's used by the DependencyResolver, the SingletonStrategy, and the LookupParameter. None of those things are critical, and in the current Unity codebase anyway LookupParameter isn't used at all, and with this proposal SingletonStrategy
 is replaced by LifetimeStrategy which uses the LifetimePolicy. The DependencyResolver could easily not check the locator.<br>
<br>
So I'm beginning to wonder if the Locator has outlived its usefulness?<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75960" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75962">
    <td id="PostDetailsCell_75962" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75962"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/francois_tanguay">francois_tanguay</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/23/2008 6:41:58 PM" LocalTimeTicks="1203820918">Feb 23, 2008 at 6:41 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75962" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Ok&#32;I&#32;think&#32;I&#32;see&#32;where&#32;you&#39;re&#32;heading.However,&#32;I&#39;m&#32;not&#32;sure&#32;I&#32;can&#32;clearly&#32;identify&#32;the&#32;responsabilities&#32;of&#32;each&#32;interface.What&#32;will&#32;be&#32;the&#32;entry&#32;point&#32;to&#32;get&#32;access&#32;to&#32;an&#32;instance&#63;&#32;Will&#32;it&#32;still&#32;be&#32;the&#32;ILocator&#63;Will&#32;Locator&#32;have&#32;access&#32;to&#32;the&#32;IPolicyList,&#32;fetch&#32;the&#32;ILifetimeManager&#32;policy&#32;given&#32;a&#32;key&#32;and&#32;delegate&#32;Add,&#32;Remove&#32;and&#32;Contains&#32;calls&#32;to&#32;GetValue,&#32;SetValue&#32;and&#32;RemoveValue&#63;That&#32;implies&#32;that&#32;the&#32;Locator&#39;s&#32;WeakRef&#32;Dictionary&#32;would&#32;be&#32;removed&#32;and&#32;replaced&#32;with&#32;the&#32;ILifetimeManager&#32;that&#32;acts&#32;as&#32;a&#32;backing&#32;store.Is&#32;it&#32;worth&#32;keeping&#32;ILifetimeContainer&#32;&#63;">
        Ok I think I see where you're heading.<br>
<br>
However, I'm not sure I can clearly identify the responsabilities of each interface.<br>
<br>
<ul>
<li>What will be the entry point to get access to an instance? </li><li>Will it still be the ILocator?</li><li>Will Locator have access to the IPolicyList, fetch the ILifetimeManager policy given a key and delegate Add, Remove and Contains calls to GetValue, SetValue and RemoveValue?
<ul>
<li>That implies that the Locator's WeakRef Dictionary would be removed and replaced with the ILifetimeManager that acts as a backing store.</li></ul>
</li><li>Is it worth keeping ILifetimeContainer ?</li></ul>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75962" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75985">
    <td id="PostDetailsCell_75985" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75985"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/23/2008 9:26:35 PM" LocalTimeTicks="1203830795">Feb 23, 2008 at 9:26 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75985" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="What&#32;will&#32;be&#32;the&#32;entry&#32;point&#32;to&#32;get&#32;access&#32;to&#32;an&#32;instance&#63;Will&#32;it&#32;still&#32;be&#32;the&#32;ILocator&#63;It&#32;would&#32;be&#32;the&#32;ILifetimePolicy.&#32;The&#32;locator&#32;could&#32;quite&#32;possibly&#32;go&#32;away.&#32;Appropriate&#32;lifetime&#32;policies&#32;would&#32;replace&#32;everything&#32;the&#32;locator&#32;does&#32;with&#32;a&#32;more&#32;flexible&#32;approach.Will&#32;Locator&#32;have&#32;access&#32;to&#32;the&#32;IPolicyList,&#32;fetch&#32;the&#32;ILifetimeManager&#32;policy&#32;given&#32;a&#32;key&#32;and&#32;delegate&#32;Add,&#32;Remove&#32;and&#32;Contains&#32;calls&#32;to&#32;GetValue,&#32;SetValue&#32;and&#32;RemoveValue&#63;&#32;&#42;&#32;That&#32;implies&#32;that&#32;the&#32;Locator&#39;s&#32;WeakRef&#32;Dictionary&#32;would&#32;be&#32;removed&#32;and&#32;replaced&#32;with&#32;the&#32;ILifetimeManager&#32;that&#32;acts&#32;as&#32;a&#32;backing&#32;storeI&#32;think&#32;if&#32;we&#32;keep&#32;Locator&#32;at&#32;all,&#32;it&#39;s&#32;only&#32;purpose&#32;would&#32;be&#32;to&#32;be&#32;that&#32;weak&#32;reference&#32;dictionary&#32;that&#32;various&#32;Lifetime&#32;policies&#32;could&#32;stick&#32;stuff&#32;in&#32;if&#32;they&#32;wanted.Is&#32;it&#32;worth&#32;keeping&#32;ILifetimeContainer&#32;&#63;I&#32;think&#32;so,&#32;but&#32;perhaps&#32;it&#32;doesn&#39;t&#32;need&#32;to&#32;be&#32;directly&#32;on&#32;the&#32;context&#32;anymore.&#32;It&#32;would&#32;be&#32;used&#32;by&#32;container-scoped&#32;lifetimes&#32;to&#32;do&#32;what&#32;it&#32;does&#32;now&#32;-&#32;dispose&#32;objects&#32;that&#32;need&#32;it&#32;when&#32;the&#32;container&#32;goes&#32;away.">
        
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<ol>
<li>What will be the entry point to get access to an instance?</li><li>Will it still be the ILocator?</li></ol>
<br>
</div>
<br>
It would be the ILifetimePolicy. The locator could quite possibly go away. Appropriate lifetime policies would replace everything the locator does with a more flexible approach.<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<ol>
<li>Will Locator have access to the IPolicyList, fetch the ILifetimeManager policy given a key and delegate Add, Remove and Contains calls to GetValue, SetValue and RemoveValue?</li></ol>
<br>
* That implies that the Locator's WeakRef Dictionary would be removed and replaced with the ILifetimeManager that acts as a backing store<br>
<br>
</div>
<br>
I think if we keep Locator at all, it's only purpose would be to be that weak reference dictionary that various Lifetime policies could stick stuff in if they wanted.<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
Is it worth keeping ILifetimeContainer ?<br>
<br>
</div>
<br>
I think so, but perhaps it doesn't need to be directly on the context anymore. It would be used by container-scoped lifetimes to do what it does now - dispose objects that need it when the container goes away.<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75985" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75988">
    <td id="PostDetailsCell_75988" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75988"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/francois_tanguay">francois_tanguay</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/23/2008 9:42:24 PM" LocalTimeTicks="1203831744">Feb 23, 2008 at 9:42 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75988" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;If&#32;locator&#32;goes&#32;away,&#32;who&#32;will&#32;be&#32;responsible&#32;to&#32;chain&#32;&#34;containers&#34;&#32;together&#32;so&#32;that&#32;when&#32;you&#32;look&#32;for&#32;a&#32;service&#32;instance&#32;registered&#32;in&#32;a&#32;parent&#32;container&#32;and&#32;look&#32;for&#32;it&#32;in&#32;a&#32;child,&#32;it&#32;will&#32;walk&#32;the&#32;parent&#32;chain&#32;in&#32;order&#32;to&#32;find&#32;it&#63;Different&#32;life&#32;time&#32;managers&#32;shouldn&#39;t&#32;have&#32;to&#32;deal&#32;with&#32;hierarchies&#32;as&#32;implementation&#32;will&#32;be&#32;the&#32;same&#32;for&#32;all&#32;of&#32;them,&#32;it&#32;should&#32;only&#32;care&#32;about&#32;being&#32;a&#32;backing&#32;store.&#32;That&#39;s&#32;why&#32;I&#32;thought&#32;Locator&#32;would&#32;still&#32;have&#32;its&#32;place&#32;and&#32;only&#32;use&#32;life&#32;time&#32;managers&#32;as&#32;a&#32;store.">
        If locator goes away, who will be responsible to chain &quot;containers&quot; together so that when you look for a service instance registered in a parent container and look for it in a child, it will walk the parent chain in order to find it?<br>
<br>
Different life time managers shouldn't have to deal with hierarchies as implementation will be the same for all of them, it should only care about being a backing store. That's why I thought Locator would still have its place and only use life time managers
 as a store.<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75988" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="75994">
    <td id="PostDetailsCell_75994" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post75994"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/24/2008 12:48:16 AM" LocalTimeTicks="1203842896">Feb 24, 2008 at 12:48 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_75994" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="francois_tanguay&#32;wrote&#58;If&#32;locator&#32;goes&#32;away,&#32;who&#32;will&#32;be&#32;responsible&#32;to&#32;chain&#32;&#34;containers&#34;&#32;together&#32;so&#32;that&#32;when&#32;you&#32;look&#32;for&#32;a&#32;service&#32;instance&#32;registered&#32;in&#32;a&#32;parent&#32;container&#32;and&#32;look&#32;for&#32;it&#32;in&#32;a&#32;child,&#32;it&#32;will&#32;walk&#32;the&#32;parent&#32;chain&#32;in&#32;order&#32;to&#32;find&#32;it&#63;Different&#32;life&#32;time&#32;managers&#32;shouldn&#39;t&#32;have&#32;to&#32;deal&#32;with&#32;hierarchies&#32;as&#32;implementation&#32;will&#32;be&#32;the&#32;same&#32;for&#32;all&#32;of&#32;them,&#32;it&#32;should&#32;only&#32;care&#32;about&#32;being&#32;a&#32;backing&#32;store.&#32;That&#39;s&#32;why&#32;I&#32;thought&#32;Locator&#32;would&#32;still&#32;have&#32;its&#32;place&#32;and&#32;only&#32;use&#32;life&#32;time&#32;managers&#32;as&#32;a&#32;store.I&#32;anticipate&#32;that&#32;each&#32;instance&#32;that&#32;needs&#32;one&#32;will&#32;have&#32;its&#32;own&#32;Lifetime&#32;manager&#32;&#40;indexed&#32;by&#32;build&#32;key&#32;as&#32;usual&#41;.&#32;Don&#39;t&#32;forget&#32;that&#32;lifetime&#32;managers&#32;are&#32;builder&#32;policies,&#32;so&#32;the&#32;act&#32;of&#32;looking&#32;up&#32;the&#32;lifetime&#32;manager&#32;will&#32;take&#32;care&#32;of&#32;the&#32;hierarchy&#32;part&#32;automatically.">
        
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
francois_tanguay wrote:<br>
If locator goes away, who will be responsible to chain &quot;containers&quot; together so that when you look for a service instance registered in a parent container and look for it in a child, it will walk the parent chain in order to find it?<br>
<br>
Different life time managers shouldn't have to deal with hierarchies as implementation will be the same for all of them, it should only care about being a backing store. That's why I thought Locator would still have its place and only use life time managers
 as a store.<br>
<br>
</div>
<br>
I anticipate that each instance that needs one will have its own Lifetime manager (indexed by build key as usual). Don't forget that lifetime managers are builder policies, so the act of looking up the lifetime manager will take care of the hierarchy part automatically.<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_75994" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="76046">
    <td id="PostDetailsCell_76046" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post76046"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/derekgreer">derekgreer</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/24/2008 1:17:18 PM" LocalTimeTicks="1203887838">Feb 24, 2008 at 1:17 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_76046" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="ctavares&#32;wrote&#58;I&#39;m&#32;currently&#32;looking&#32;at&#32;implementing&#32;more&#32;general&#32;purpose&#32;lifetime&#32;management&#59;&#32;enough&#32;people&#32;have&#32;asked&#32;about&#32;it&#32;or&#32;complained&#32;about&#32;the&#32;lack&#32;of&#32;it.Currently,&#32;I&#39;m&#32;thinking&#32;that&#32;we&#32;could&#32;replace&#32;both&#32;SetSingleton&#32;and&#32;RegisterInstance&#32;with&#32;this&#32;method&#58;interface&#32;IUnityContainer&#123;&#32;IUnityContainer&#32;SetLifetime&#40;Type&#32;t,&#32;string&#32;name,&#32;ILifetimeManager&#32;lifetime&#41;&#59;&#125;...I&#39;d&#32;like&#32;to&#32;know&#32;what&#32;you&#32;folks&#32;think&#32;of&#32;this&#32;interface&#32;for&#32;lifetime&#32;management,&#32;and&#32;to&#32;the&#32;proposed&#32;change&#32;in&#32;the&#32;container.&#32;Should&#32;we&#32;remove&#32;lifetime&#32;management&#32;completely&#32;to&#32;an&#32;extension&#63;&#32;Is&#32;this&#32;as&#32;usable&#32;as&#32;the&#32;simple&#32;SetSingleton&#47;RegisterInstance&#32;methods&#63;&#32;And&#32;are&#32;there&#32;any&#32;lifetimes&#32;that&#32;you&#32;can&#39;t&#32;implement&#32;using&#32;this&#32;API&#63;Thanks,-ChrisI&#32;like&#32;the&#32;general&#32;suggestion&#32;of&#32;using&#32;an&#32;ILifetimeManager&#32;to&#32;provide&#32;a&#32;more&#32;consistent&#32;approach.&#32;Concerning&#32;whether&#32;this&#32;should&#32;be&#32;altogether&#32;handled&#32;through&#32;extensions,&#32;this&#32;would&#32;be&#32;my&#32;recommendation.For&#32;both&#32;issues,&#32;I&#32;see&#32;the&#32;question&#32;coming&#32;down&#32;to&#32;convenience&#32;vs.&#32;SoC&#32;and&#32;consistency.&#32;Just&#32;as&#32;I&#32;don&#39;t&#32;believe&#32;singleton&#32;instances&#32;should&#32;be&#32;handled&#32;in&#32;a&#32;different&#32;way&#32;than&#32;sliding-cached&#32;instances,&#32;I&#32;also&#32;don&#39;t&#32;believe&#32;that&#32;lifetime&#32;management&#32;in&#32;general&#32;should&#32;be&#32;handled&#32;differently&#32;than&#32;other&#32;pre-creation&#47;creation&#32;concerns.As&#32;far&#32;as&#32;usability&#32;is&#32;concerned,&#32;if&#32;a&#32;LifetimeManagementExtension&#32;is&#32;registered&#32;by&#32;default&#32;then&#32;all&#32;we&#32;are&#32;really&#32;talking&#32;about&#32;is&#32;one&#32;extra&#32;method&#32;in&#32;the&#32;fluent&#32;chain&#32;each&#32;time&#32;the&#32;user&#32;needs&#32;to&#32;configure&#32;the&#32;lifetime&#32;of&#32;an&#32;object.&#32;container.SetLifetime&#40;...&#41;&#32;vs.&#32;container.Configure&#38;lt&#59;Lifetime&#38;gt&#59;&#40;&#41;.SetLifetime&#40;...&#41;&#32;That&#32;said,&#32;I&#32;think&#32;either&#32;way&#32;is&#32;an&#32;improvement&#32;over&#32;the&#32;existing&#32;SetSingleton&#40;&#41;&#32;approach.Derek">
        
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
ctavares wrote:<br>
I'm currently looking at implementing more general purpose lifetime management; enough people have asked about it or complained about the lack of it.<br>
<br>
Currently, I'm thinking that we could replace both SetSingleton and RegisterInstance with this method:<br>
<br>
interface IUnityContainer<br>
{<br>
IUnityContainer SetLifetime(Type t, string name, ILifetimeManager lifetime);<br>
}<br>
<br>
...<br>
<br>
I'd like to know what you folks think of this interface for lifetime management, and to the proposed change in the container. Should we remove lifetime management completely to an extension? Is this as usable as the simple SetSingleton/RegisterInstance methods?
 And are there any lifetimes that you can't implement using this API?<br>
<br>
Thanks,<br>
<br>
-Chris<br>
<br>
<br>
</div>
<br>
<br>
I like the general suggestion of using an ILifetimeManager to provide a more consistent approach. Concerning whether this should be altogether handled through extensions, this would be my recommendation.<br>
<br>
For both issues, I see the question coming down to convenience vs. SoC and consistency. Just as I don't believe singleton instances should be handled in a different way than sliding-cached instances, I also don't believe that lifetime management in general
 should be handled differently than other pre-creation/creation concerns.<br>
<br>
As far as usability is concerned, if a LifetimeManagementExtension is registered by default then all we are really talking about is one extra method in the fluent chain each time the user needs to configure the lifetime of an object.<br>
<br>
<pre style="background-color:#ECECEC; border:dashed .1em #3E62A6; font-family:Consolas,Courier New,Courier,Monospace; font-size:1em; margin-top:0; padding:.5em; height:auto; overflow:auto; overflow-x:auto; overflow-y:auto">
 
container.SetLifetime(...)
 
vs.
 
container.Configure&lt;Lifetime&gt;().SetLifetime(...)
 
</pre>
<br>
<br>
That said, I think either way is an improvement over the existing SetSingleton() approach.<br>
<br>
Derek<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_76046" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="76092">
    <td id="PostDetailsCell_76092" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post76092"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/24/2008 9:53:09 PM" LocalTimeTicks="1203918789">Feb 24, 2008 at 9:53 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_76092" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="derekgreer&#32;wrote&#58;I&#32;like&#32;the&#32;general&#32;suggestion&#32;of&#32;using&#32;an&#32;ILifetimeManager&#32;to&#32;provide&#32;a&#32;more&#32;consistent&#32;approach.&#32;Concerning&#32;whether&#32;this&#32;should&#32;be&#32;altogether&#32;handled&#32;through&#32;extensions,&#32;this&#32;would&#32;be&#32;my&#32;recommendation.For&#32;both&#32;issues,&#32;I&#32;see&#32;the&#32;question&#32;coming&#32;down&#32;to&#32;convenience&#32;vs.&#32;SoC&#32;and&#32;consistency.&#32;Just&#32;as&#32;I&#32;don&#39;t&#32;believe&#32;singleton&#32;instances&#32;should&#32;be&#32;handled&#32;in&#32;a&#32;different&#32;way&#32;than&#32;sliding-cached&#32;instances,&#32;I&#32;also&#32;don&#39;t&#32;believe&#32;that&#32;lifetime&#32;management&#32;in&#32;general&#32;should&#32;be&#32;handled&#32;differently&#32;than&#32;other&#32;pre-creation&#47;creation&#32;concerns.As&#32;far&#32;as&#32;usability&#32;is&#32;concerned,&#32;if&#32;a&#32;LifetimeManagementExtension&#32;is&#32;registered&#32;by&#32;default&#32;then&#32;all&#32;we&#32;are&#32;really&#32;talking&#32;about&#32;is&#32;one&#32;extra&#32;method&#32;in&#32;the&#32;fluent&#32;chain&#32;each&#32;time&#32;the&#32;user&#32;needs&#32;to&#32;configure&#32;the&#32;lifetime&#32;of&#32;an&#32;object.&#32;container.SetLifetime&#40;...&#41;&#32;vs.&#32;container.Configure&#38;lt&#59;Lifetime&#38;gt&#59;&#40;&#41;.SetLifetime&#40;...&#41;&#32;That&#32;said,&#32;I&#32;think&#32;either&#32;way&#32;is&#32;an&#32;improvement&#32;over&#32;the&#32;existing&#32;SetSingleton&#40;&#41;&#32;approach.DerekI&#32;see&#32;where&#32;you&#39;re&#32;coming&#32;from,&#32;but&#32;my&#32;recent&#32;thinking&#32;is&#32;leaning&#32;towards&#32;having&#32;them&#32;all.&#32;Here&#39;s&#32;why&#58;&#32;they&#39;re&#32;more&#32;convenient,&#32;and&#32;less&#32;confusing.As&#32;far&#32;as&#32;separations&#32;of&#32;concerns&#32;goes,&#32;I&#32;understand&#32;the,&#32;well,&#32;concerns&#32;&#59;-&#41;,&#32;but&#32;I&#39;m&#32;not&#32;sure&#32;they&#32;apply.&#32;Looking&#32;at&#32;what&#32;UnityContainer&#32;actually&#32;is,&#32;it&#39;s&#32;a&#32;facade&#32;over&#32;ObjectBuilder.&#32;Actually,&#32;looking&#32;at&#32;the&#32;code,&#32;UnityContainer&#32;doesn&#39;t&#32;actually&#32;DO&#32;anything&#32;but&#32;hold&#32;onto&#32;the&#32;objects&#32;that&#32;OB&#32;needs&#32;and&#32;fire&#32;events.&#32;Looking&#32;at&#32;the&#32;GoF&#32;book&#58;Use&#32;the&#32;Facade&#32;pattern&#32;whenyou&#32;want&#32;to&#32;provide&#32;a&#32;simple&#32;interface&#32;to&#32;a&#32;complex&#32;subsystem.&#32;Subsystems&#32;often&#32;get&#32;more&#32;complex&#32;as&#32;they&#32;evolve.&#32;Most&#32;patterns,&#32;when&#32;applied,&#32;result&#32;in&#32;more&#32;and&#32;smaller&#32;classes.&#32;This&#32;makes&#32;the&#32;subsystem&#32;more&#32;reusable&#32;and&#32;easier&#32;to&#32;customize,&#32;but&#32;it&#32;also&#32;becomes&#32;harder&#32;to&#32;use&#32;for&#32;clients&#32;that&#32;don&#39;t&#32;need&#32;to&#32;customize&#32;it.&#32;A&#32;facade&#32;can&#32;provide&#32;a&#32;simple&#32;default&#32;view&#32;of&#32;the&#32;subsystem&#32;that&#32;is&#32;good&#32;enough&#32;for&#32;most&#32;clients.&#32;Only&#32;clients&#32;needing&#32;more&#32;customizability&#32;will&#32;need&#32;to&#32;look&#32;beyond&#32;the&#32;facade.&#32;there&#32;are&#32;many&#32;dependencies&#32;between&#32;clients&#32;and&#32;the&#32;implementation&#32;classes&#32;of&#32;an&#32;abstraction.&#32;Introduce&#32;a&#32;facade&#32;to&#32;decouple&#32;the&#32;subsystem&#32;from&#32;clients&#32;and&#32;other&#32;subsystems,&#32;thereby&#32;promoting&#32;subsystem&#32;independence&#32;and&#32;portability.&#32;you&#32;want&#32;to&#32;layer&#32;your&#32;subsystems.&#32;Use&#32;a&#32;facade&#32;to&#32;define&#32;an&#32;entry&#32;point&#32;to&#32;each&#32;subsystem&#32;level.&#32;If&#32;subsystems&#32;are&#32;dependent,&#32;then&#32;you&#32;can&#32;simplify&#32;the&#32;dependencies&#32;between&#32;them&#32;by&#32;making&#32;them&#32;communicate&#32;with&#32;each&#32;other&#32;solely&#32;through&#32;their&#32;facades.&#32;When&#32;building&#32;a&#32;Facade,&#32;convenience&#32;is&#32;more&#32;important&#32;than&#32;underlying&#32;structure,&#32;since&#32;the&#32;underlying&#32;subsystem&#32;&#40;ObjectBuilder,&#32;in&#32;this&#32;case&#41;&#32;does&#32;have&#32;good&#32;Separation&#32;of&#32;Concerns&#32;under&#32;the&#32;hood&#32;&#40;at&#32;least,&#32;I&#32;hope&#32;it&#32;does&#41;.&#32;Since&#32;one&#32;of&#32;our&#32;goals&#32;is&#32;to&#32;introduce&#32;IoC&#32;to&#32;the&#32;non-Alt.NET&#32;elite,&#32;having&#32;a&#32;simpler&#32;to&#32;use&#32;front&#32;end&#32;seems&#32;to&#32;me&#32;to&#32;be&#32;a&#32;better&#32;approach.Thoughts&#63;-Chris">
        
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
derekgreer wrote:<br>
<br>
I like the general suggestion of using an ILifetimeManager to provide a more consistent approach. Concerning whether this should be altogether handled through extensions, this would be my recommendation.<br>
<br>
For both issues, I see the question coming down to convenience vs. SoC and consistency. Just as I don't believe singleton instances should be handled in a different way than sliding-cached instances, I also don't believe that lifetime management in general
 should be handled differently than other pre-creation/creation concerns.<br>
<br>
As far as usability is concerned, if a LifetimeManagementExtension is registered by default then all we are really talking about is one extra method in the fluent chain each time the user needs to configure the lifetime of an object.<br>
<br>
<pre style="background-color:#ECECEC; border:dashed .1em #3E62A6; font-family:Consolas,Courier New,Courier,Monospace; font-size:1em; margin-top:0; padding:.5em; height:auto; overflow:auto; overflow-x:auto; overflow-y:auto">
 
container.SetLifetime(...)
 
vs.
 
container.Configure&lt;Lifetime&gt;().SetLifetime(...)
 
</pre>
<br>
<br>
That said, I think either way is an improvement over the existing SetSingleton() approach.<br>
<br>
Derek<br>
<br>
</div>
<br>
I see where you're coming from, but my recent thinking is leaning towards having them all. Here's why: they're more convenient, and less confusing.<br>
<br>
As far as separations of concerns goes, I understand the, well, concerns ;-), but I'm not sure they apply. Looking at what UnityContainer actually is, it's a facade over ObjectBuilder. Actually, looking at the code, UnityContainer doesn't actually DO anything
 but hold onto the objects that OB needs and fire events. Looking at the GoF book:<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
Use the Facade pattern when<br>
<br>
<ul>
<li>you want to provide a simple interface to a complex subsystem. Subsystems often get more complex as they evolve. Most patterns, when applied, result in more and smaller classes. This makes the subsystem more reusable and easier to customize, but it also
 becomes harder to use for clients that don't need to customize it. A facade can provide a simple default view of the subsystem that is good enough for most clients. Only clients needing more customizability will need to look beyond the facade.
</li></ul>
<br>
<ul>
<li>there are many dependencies between clients and the implementation classes of an abstraction. Introduce a facade to decouple the subsystem from clients and other subsystems, thereby promoting subsystem independence and portability.
</li></ul>
<br>
<ul>
<li>you want to layer your subsystems. Use a facade to define an entry point to each subsystem level. If subsystems are dependent, then you can simplify the dependencies between them by making them communicate with each other solely through their facades.
</li></ul>
<br>
<br>
</div>
<br>
When building a Facade, convenience is more important than underlying structure, since the underlying subsystem (ObjectBuilder, in this case) does have good Separation of Concerns under the hood (at least, I hope it does). Since one of our goals is to introduce
 IoC to the non-Alt.NET elite, having a simpler to use front end seems to me to be a better approach.<br>
<br>
Thoughts?<br>
<br>
-Chris<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_76092" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="76098">
    <td id="PostDetailsCell_76098" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post76098"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/derekgreer">derekgreer</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/24/2008 11:37:08 PM" LocalTimeTicks="1203925028">Feb 24, 2008 at 11:37 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_76098" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="ctavares&#32;wrote&#58;I&#32;see&#32;where&#32;you&#39;re&#32;coming&#32;from,&#32;but&#32;my&#32;recent&#32;thinking&#32;is&#32;leaning&#32;towards&#32;having&#32;them&#32;all.&#32;Here&#39;s&#32;why&#58;&#32;they&#39;re&#32;more&#32;convenient,&#32;and&#32;less&#32;confusing.I&#39;m&#32;not&#32;sure&#32;I&#32;follow.&#32;Do&#32;you&#32;mean&#32;to&#32;say&#32;that&#32;you&#32;intend&#32;to&#32;include&#32;both&#32;a&#32;SetSingleton&#40;&#41;&#32;and&#32;a&#32;SetLifetime&#40;&#41;&#63;ctavares&#32;wrote&#58;As&#32;far&#32;as&#32;separations&#32;of&#32;concerns&#32;goes,&#32;I&#32;understand&#32;the,&#32;well,&#32;concerns&#32;&#59;-&#41;,&#32;but&#32;I&#39;m&#32;not&#32;sure&#32;they&#32;apply.&#32;Looking&#32;at&#32;what&#32;UnityContainer&#32;actually&#32;is,&#32;it&#39;s&#32;a&#32;facade&#32;over&#32;ObjectBuilder.&#32;I&#32;agree&#32;that&#32;Unity&#32;is&#32;a&#32;facade,&#32;but&#32;I&#32;still&#32;think&#32;that&#32;it&#32;should&#32;take&#32;a&#32;consistent&#32;approach&#32;to&#32;how&#32;it&#32;exposes&#32;the&#32;capabilities&#32;of&#32;Object&#32;Builder.&#32;For&#32;this&#32;particular&#32;issue,&#32;I&#32;don&#39;t&#32;think&#32;the&#32;issues&#32;of&#32;usability&#32;and&#32;consistency&#32;are&#32;at&#32;odds.&#32;As&#32;a&#32;supporter&#32;of&#32;the&#32;P&#38;amp&#59;P&#32;team,&#32;and&#32;as&#32;an&#32;architect&#32;who&#32;plans&#32;to&#32;incorporate&#32;Unity&#32;into&#32;my&#32;team&#39;s&#32;project&#32;&#58;&#41;&#32;,&#32;I&#32;would&#32;personally&#32;rather&#32;see&#32;all&#32;configuration&#32;such&#32;as&#32;this&#32;done&#32;through&#32;the&#32;use&#32;of&#32;Extensions.&#32;I&#32;don&#39;t&#32;see&#32;the&#32;extra&#32;step&#32;of&#32;using&#32;the&#32;Configure&#32;method&#32;as&#32;being&#32;significantly&#32;less&#32;usable,&#32;so&#32;my&#32;vote&#32;here&#32;would&#32;be&#32;for&#32;consistency&#32;to&#32;win&#32;out.Additionally,&#32;when&#32;we&#32;are&#32;talking&#32;about&#32;usability&#32;there&#32;is&#32;something&#32;to&#32;be&#32;said&#32;for&#32;consistency.&#32;Consistency&#32;leads&#32;to&#32;assumptions.&#32;The&#32;more&#32;assumptions&#32;that&#32;can&#32;be&#32;made&#32;about&#32;an&#32;API,&#32;the&#32;more&#32;usable&#32;it&#32;becomes.&#32;Given&#32;that&#32;lifetime&#32;management&#32;is&#32;just&#32;another&#32;type&#32;of&#32;variability&#32;applied&#32;to&#32;the&#32;build&#32;up&#47;resolution&#32;life&#32;cycle&#32;of&#32;an&#32;object,&#32;accomplishing&#32;this&#32;using&#32;the&#32;same&#32;mechanism&#32;you&#32;would&#32;accomplish&#32;other&#32;forms&#32;of&#32;variability&#32;in&#32;a&#32;way&#32;would&#32;increase&#32;usability.Derek">
        
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<br>
ctavares wrote:<br>
<br>
I see where you're coming from, but my recent thinking is leaning towards having them all. Here's why: they're more convenient, and less confusing.<br>
<br>
<br>
</div>
<br>
I'm not sure I follow. Do you mean to say that you intend to include both a SetSingleton() and a SetLifetime()?<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<br>
ctavares wrote:<br>
<br>
As far as separations of concerns goes, I understand the, well, concerns ;-), but I'm not sure they apply. Looking at what UnityContainer actually is, it's a facade over ObjectBuilder.
<br>
<br>
<br>
</div>
<br>
I agree that Unity is a facade, but I still think that it should take a consistent approach to how it exposes the capabilities of Object Builder. For this particular issue, I don't think the issues of usability and consistency are at odds.
<br>
<br>
As a supporter of the P&amp;P team, and as an architect who plans to incorporate Unity into
<a href="http://www.microsoft.com/casestudies/casestudy.aspx?casestudyid=4000000046" rel="nofollow">
my team's project<span style="font-family:Consolas,Courier New,Courier,Monospace"></span></a> :) , I would personally rather see all configuration such as this done through the use of Extensions. I don't see the extra step of using the Configure method as being
 significantly less usable, so my vote here would be for consistency to win out.<br>
<br>
Additionally, when we are talking about usability there is something to be said for consistency. Consistency leads to assumptions. The more assumptions that can be made about an API, the more usable it becomes. Given that lifetime management is just another
 type of variability applied to the build up/resolution life cycle of an object, accomplishing this using the same mechanism you would accomplish other forms of variability in a way would increase usability.<br>
<br>
Derek<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_76098" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="76205">
    <td id="PostDetailsCell_76205" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post76205"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/francois_tanguay">francois_tanguay</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/25/2008 1:49:59 PM" LocalTimeTicks="1203976199">Feb 25, 2008 at 1:49 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_76205" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;&#64;Chris&#58;Thanks&#32;for&#32;pointing&#32;out&#32;about&#32;being&#32;a&#32;policy,&#32;hence&#32;supporting&#32;hierarchies&#59;&#32;I&#32;totally&#32;missed&#32;this&#32;one&#33;&#32;It&#32;makes&#32;a&#32;lot&#32;more&#32;sense&#32;to&#32;me&#32;now&#33;&#64;Derek&#58;I&#32;agree&#32;with&#32;Chris&#32;that&#32;being&#32;a&#32;facade,&#32;it&#32;has&#32;to&#32;offer&#32;some&#32;simplification&#32;over&#32;OB.&#32;If&#32;all&#32;services&#32;were&#32;to&#32;be&#32;offered&#32;through&#32;Configure,&#32;then&#32;arguably&#32;you&#39;d&#32;prefer&#32;to&#32;see&#32;Register&#38;lt&#59;TFrom,&#32;To&#38;gt&#59;&#32;and&#32;Get&#38;lt&#59;T&#38;gt&#59;&#40;&#41;&#32;as&#32;methods&#32;part&#32;of&#32;their&#32;underlying&#32;extensions&#32;&#40;DefaultBehaviors&#32;and&#32;Strategies&#32;extensions&#41;.All&#32;the&#32;container&#32;offer&#32;is&#32;holding&#32;references&#32;to&#32;the&#32;different&#32;OB&#32;objects&#32;&#40;PolicyList,&#32;Strategy&#32;Chain,&#32;...&#41;&#32;and&#32;a&#32;facade&#32;for&#32;type&#32;mapping&#32;and&#32;buildKey&#32;creation&#32;and&#32;now&#32;life&#32;time&#32;management.&#32;So&#32;I&#32;think&#32;the&#32;interface&#32;is&#32;pretty&#32;cohesive.If&#32;they&#32;were&#32;to&#32;target&#32;3.5,&#32;i&#39;d&#32;offer&#32;those&#32;wrappers&#32;through&#32;extension&#32;methods&#32;but&#32;they&#39;re&#32;not.">
        @Chris:<br>
<br>
Thanks for pointing out about being a policy, hence supporting hierarchies; I totally missed this one! It makes a lot more sense to me now!<br>
<br>
@Derek:<br>
<br>
I agree with Chris that being a facade, it has to offer some simplification over OB. If all services were to be offered through Configure, then arguably you'd prefer to see Register&lt;TFrom, To&gt; and Get&lt;T&gt;() as methods part of their underlying extensions
 (DefaultBehaviors and Strategies extensions).<br>
<br>
All the container offer is holding references to the different OB objects (PolicyList, Strategy Chain, ...) and a facade for type mapping and buildKey creation and now life time management. So I think the interface is pretty cohesive.<br>
<br>
If they were to target 3.5, i'd offer those wrappers through extension methods but they're not.<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_76205" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="76230">
    <td id="PostDetailsCell_76230" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post76230"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/derekgreer">derekgreer</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/25/2008 2:58:21 PM" LocalTimeTicks="1203980301">Feb 25, 2008 at 2:58 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_76230" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;While&#32;I&#32;agree&#32;that&#32;Unity&#32;is&#32;a&#32;facade&#32;in&#32;pattern,&#32;it&#32;is&#32;a&#32;container&#32;in&#32;function.&#32;As&#32;a&#32;container,&#32;it&#32;would&#32;be&#32;expected&#32;to&#32;provide&#32;basic&#32;register&#32;and&#32;get&#32;functionality.&#32;I&#39;m&#32;certainly&#32;not&#32;arguing&#32;the&#32;interface&#32;should&#32;be&#32;completely&#32;reduced&#32;down&#32;to&#32;Configure&#38;lt&#59;T&#38;gt&#59;&#40;&#41;.&#32;I&#39;m&#32;only&#32;suggesting&#32;that&#32;lifetime&#32;management&#32;in&#32;particular&#32;falls&#32;into&#32;the&#32;same&#32;category&#32;as&#32;other&#32;variant&#32;behaviors&#32;that&#32;occur&#32;beyond&#32;the&#32;basic&#32;registration&#32;and&#32;retrieval&#32;of&#32;objects.Derek">
        While I agree that Unity is a facade in pattern, it is a container in function. As a container, it would be expected to provide basic register and get functionality. I'm certainly not arguing the interface should be completely reduced down to Configure&lt;T&gt;().
 I'm only suggesting that lifetime management in particular falls into the same category as other variant behaviors that occur beyond the basic registration and retrieval of objects.<br>
<br>
<br>
Derek<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_76230" class="Options" >
            
        </div>
        
    </td>
</tr>

</table>
    </div>

    
        <div class="StandardMarginTop">
            <a id="SignInToAddCommentLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f22696">
                Sign in to post message or set email notifications
            </a>
        </div>
    


    <div id="PostEditorContainer">
        <a name="editor"></a>
        <div id="Editor" style="display: none;">
            

<div class="MarkdownEditor" data-options-id="365e3082-e0ca-4188-9671-54b2774cc58f">
    <script class="options" defer="defer" id="365e3082-e0ca-4188-9671-54b2774cc58f" type="application/json">{"maxLength":10000,"styleSheetLocation":""}</script>

    <div class="MarkdownEditorControls">
        <a href="#" tabindex="-1" class="control md_help" title="Markdown Syntax Guide"></a>
        <div class="control md_divider"></div>
        <a href="#" tabindex="-1" class="control md_header" title="Insert Header (CTRL + H)"></a>
        <a href="#" tabindex="-1" class="control md_code" title="Insert Code (CTRL + K)"></a>
        <a href="#" tabindex="-1" class="control md_quote" title="Insert Quote (CTRL + Q)"></a>
        <a href="#" tabindex="-1" class="control md_img" title="Insert Img (CTRL + G)"></a>
        <a href="#" tabindex="-1" class="control md_link" title="Insert Link (CTRL + L)"></a>
        <a href="#" tabindex="-1" class="control md_ulist" title="Unordered List (CTRL + U)"></a>
        <a href="#" tabindex="-1" class="control md_olist" title="Ordered List (CTRL + O)"></a>
        <a href="#" tabindex="-1" class="control md_italics" title="Italic Text (CTRL + I)"></a>
        <a href="#" tabindex="-1" class="control md_bold" title="Bold Text (CTRL + B)"></a>
    </div>

    

<div class="tab_control">
    <!-- Generate the basic HTML for the tabs. -->
    
        <div id="Compose"
              class="tab selected"
              data-custom-header-id=""
              data-tab-contents-id="compose_contents_94c1e9cb-c48c-424d-92d1-3374a9ee2060">
            Compose
        </div>
    
        <div id="Preview"
              class="tab "
              data-custom-header-id=""
              data-tab-contents-id="preview_contents_536b5d65-8ba9-40d3-b5f7-2436433acbe2">
            Preview
        </div>
    
    <div class="clear"></div>
</div>


    <div id="compose_contents_94c1e9cb-c48c-424d-92d1-3374a9ee2060" class="compose_tab_content">
        <textarea class=" MarkdownEditorDimensions" cols="20" id="MarkdownEditor" name="content" rows="2">
</textarea>
        <div class="ClearBoth"></div>

        <div class="markdownGuide" style="display: none">
            <table>
                <tr>
                    <td class="markdownGuideColumn">
                        <h1>Text Formatting</h1>
                        <div># Header 1</div>
                        <div>## Header 2</div>
                        <br />
                        <div>*italics* (or _italics_)</div>
                        <div>**bold** (or __bold__)</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Lists</h1>
                        <div>* Unordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp * SubItem</div>
                        <br />
                        <div>1. Ordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1. SubItem</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Quotes</h1>
                        <div>> Lorem ipsum</div>
                        <div>dolor sitamet </div>
                        <div>non. Lectus at</div>
                        <div>nam nunc...</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Code</h1>
                        <div>`Inline Code`</div>
                        <br />
                        <div>``` C#</div>
                        <div>if (foo==bar)</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbar++</div>
                        <div>```</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>References</h1>
                        <div>[Link Text](URL)</div>
                        <br />
                        <div>![Image](URL)</div>
                        <br />
                        <a class="Reference" target="_blank" href="http://codeplex.codeplex.com/wikipage?title=Markdown&referringTitle=Documentation">Markdown Reference</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="preview_contents_536b5d65-8ba9-40d3-b5f7-2436433acbe2" class="preview_tab_content markDownOutput">
        
            <div></div>
        
    </div>
    <div class="clear"></div>
</div>

            
            <div class="row" id="recaptcha_row">
                
<script type="text/javascript">
    $(document).ready(function () {
        $('#recaptcha_reload').attr('src', '../assets/recaptcha_refresh.png');
        $('#recaptcha_switch_audio').attr('src', '../assets/recaptcha_audio.png');
        $('#recaptcha_switch_img').attr('src', '../assets/recaptcha_text.png');
        $('#recaptcha_whatsthis').attr('src', '../assets/recaptcha_help.png');
        $('#recaptcha_area tr:first').attr('height', '35');
    });
</script>

                <div class="clear"></div>
                <span id="ReCaptchaError"></span>
            </div>
            <div style="padding-top: 6px;">
                <input type="button" id="SaveButton" value="Save" class="ok" />
                <input type="button" id="CancelButton" value="Cancel" class="cancel" />
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div id="DeletePostPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Post <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this post? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="ClosePostCancel" value="Cancel" class="cancel" />
            <input type="button" id="ClosePostOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>
        
            <!-- Email notification / Subscription details -->
            
    </div>
</div>
    
<div id="DeleteThreadPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Thread <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this thread? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="CloseThreadCancel" value="Cancel" class="cancel" />
            <input type="button" id="CloseThreadOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(function () {

        $('#recaptcha_response_field')
            .bind('keypress', function (event) { return $submitKeyPressElement(this, event); });


        if ($('#DeleteThreadLink')) {
            $('#DeleteThreadLink').click(function () {
                OpenDialog('#DeleteThreadPanel', true, '41em');
            });
        }
        
        $('#DeleteThreadPanel #CloseThreadOk').click(function () {
            var url = 'http://unity.codeplex.com/discussions/22696';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (x) {
                    location.href = x.RedirectUrl;
                }
            });
        });
    });

    workItemMention = new codeplex.ui.WorkItemMention();
    workItemMention.addLinks(".discussionPost");
</script>


        
        
                
                <div class="clear"></div>
                
                <div id="footer">
                    <div class="row">
                        <hr />
                        <ul>
                            <li>Â© 2006-2017 Microsoft</li>
                            <li><a href="http://www.codeplex.com/site/help">Get Help</a></li>
                            <li><a href="/site/legal/privacy">Privacy Statement</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/terms">Terms of Use</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/conduct">Code of Conduct</a></li>
                            <li><a href="http://developermedia.com/" target="_blank">Advertise With Us</a></li>
                            <li>Version 2017.10.3.21062</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </body>

</html>