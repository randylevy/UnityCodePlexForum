

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="" prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile#">
    
    
    
    

    
    <head>
        <meta id="CompatabilityMode" http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../assets/StyleSheet.css" id="MasterCss" rel="stylesheet" type="text/css" />
        <link rel="SHORTCUT ICON" href="../assets/favicon.ico" />
        <title>patterns &#38; practices - Unity - How do you Mock IUnityContainer</title>
        
       
                    <script src="../assets/mscc-0.3.6.min.js"></script>
        
                    <link rel="stylesheet" type="text/css" href="../assets/mscc-0.3.6.min.css" />
        
            <script type="text/javascript">
                var msccHadCookieBannerAtPageStart = true;
            </script>
        

        <!--
        Third party scripts and code linked to or referenced from this website are licensed to you by the parties that own such code,
        not by Microsoft.  See ASP.NET Ajax CDN Terms of Use â€“ http://www.asp.net/ajaxlibrary/CDN.ashx.
        -->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.4.4.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.6/jquery-ui.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery.ui === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        
    <style type="text/css">.SideBar, .SideBarPadding{display:none;}.MainContent{width:auto;}.SiteContentTable{width:100%;}</style>
    <style id="ProjectStyles" type="text/css">
        .SiteHeader, .SiteHeaderLeft {
            height:45px !important;
            overflow:hidden;
        }
        .SiteContent 
        {
            padding: 0 0 1em 0;
            margin-top:0;
            min-height:225px;
            border-right: 1px solid lightgrey;
            border-left: 1px solid lightgrey;
            border-bottom: 1px solid lightgrey;
        }
        .IE table.MinWidthContent
        {
	        table-layout: auto !important;	
        }
    </style>
    
    
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">

    
    
    <meta id="WTProjectName" name="WT.pi" content="unity"/>
    

    <link rel="EditURI" type="application/rsd+xml" title="RSD" href='http://unity.codeplex.com/rsd' />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href='/wlwmanifest.xml' />
    
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity" url="http://unity.codeplex.com/project/feeds/rss"/>
    
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Discussions" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Issues" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Downloads" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Reviews" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity"/>
        
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Source&#32;code" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Wiki" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity"/>
    
        
    
        <meta content="summary" name="twitter:card" /><meta content="@CodePlex" name="twitter:site" /><meta content="http://unity.codeplex.com/discussions/50341?ProjectName=unity" name="twitter:url" /><meta content="patterns &amp;#38; practices - Unity" name="twitter:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" name="twitter:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" name="twitter:image" /><meta content="CodePlex" property="og:site_name" /><meta content="http://unity.codeplex.com/discussions/50341?ProjectName=unity" property="og:url" /><meta content="object" property="og:type" /><meta content="patterns &amp;#38; practices - Unity" property="og:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" property="og:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" property="og:image" />
        

    </head>
    
    <body>
         
            
        <script src="../assets/ScriptLoader.js" type="text/javascript"></script>
        <form id="aspnetForm" autocomplete="off" method="POST" enctype="multipart/form-data">
            <input name="__RequestVerificationToken" type="hidden" value="3fHxUNF_o8jJT4_-UXrjT-8ha4boKQJ3Z6QT8F4ACAyy2myBuNmM-sDNSH_07twm_He1vxiZfiKoCyKeCf4gOY2L4WuLz_8S_rzHJD2N5Uo26KaSDLOhd7AMlRoURgSSpny-iA2" /><input name="__RequestVerificationToken2" type="hidden" value="__RequestVerificationToken20e0186df-fa55-464c-964f-b3853da938a1" />
            
            <div id="UpdateProgressPanel" class="loading_animation" style="display:none;">
                <div class="row">
                    <h2 class="anim_h2">
                        <span id="UpdateProgressText">Updating...</span>
                        <span id="animatedLoadingIconContainer">
                            <img id="animatedLoadingIcon" src="../assets/loading_animation.gif" class="anim_img"/>
                        </span>
                    </h2>
                </div>
            </div>
            
            <div style="display:none;">
                
                <img id="BlankImage" style="width:0;height:0;" src="../assets/blank.png" onload="self.logoImageLoaded=true;"/>

                <script language="javascript" type="text/javascript">
                    var date = new Date();
                    var timezoneOffset = date.getTimezoneOffset() / 60 * -1;
                    var timezoneOffsetCookie = getCookie("TimezoneOffset");
                    var firstTimeSetTimezoneCookie = false;

                    if (timezoneOffsetCookie == null || timezoneOffsetCookie != timezoneOffset) {
                        firstTimeSetTimezoneCookie = true;
                        document.cookie = "TimezoneOffset=" + timezoneOffset + '; domain=.codeplex.com;expires=Wed, 10 Oct 2018 05:28:17 UTC';
                    }
                </script>
            </div>
            
            
            <div id="banner">
                <div id="message"><strong>This is an archived copy of the original CodePlex Unity Discussion Forum</strong><br />Unity is now on <a href="https://github.com/unitycontainer/">GitHub</a>
                    
                </div>
            </div>
            

            <div id="header">
                <div id="header_wrap" class="row">
                    <p id="logo"><a href="http://www.codeplex.com">Code<span class="semi">Plex</span></a><span id="tagline">Project Hosting for Open Source Software</span></p>
                    

<ul id="nav">

    <li><a href="/site/register/new" id="registerLink" class="ZoomFix">Register</a></li>
    <li ><a class="SignInLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f50341" id="signInLink">Sign In</a></li>
  
    <li class="last"><a class="rss_site_icon" href="http://www.codeplex.com/site/feeds/rss" type="application/rss+xml" rel="Alternate" title="CodePlex Site Activity"></a></li>
</ul>
                    <input id="searchsite" name="searchsite" maxlength="500" type="text" value="" /><span id="search_mag"><a id="submitSearch" name="submitSearch" class="magnify" title="Search" href="#"></a></span>
                    <script>
	$(document).ready(function() {
    var searchButton = $('#submitSearch'),
        searchBar = $('#searchsite');

    // Register our own handler for the search event while we wait for the SearchBox script to load.
    searchButton.bind('click.backupSearchBox', doProjectSearch);
    searchBar.bind('keypress.backupSearchBox', function(e) { if ($keyCode(e) === 13) { doProjectSearch(); return false; } });

    function cleanupSearchEvents() {
        // If the SearchBox was loaded, unregister our handlers.
        if (epx_loaded) {
            searchButton.unbind('.backupSearchBox');
            searchBar.unbind('.backupSearchBox');
        }
    }

    $loadScript('https://i4.services.social.microsoft.com/search/Widgets/SearchBox.jss?appid=1000&scopeid=1&boxId=searchsite&btnId=submitSearch&watermark=Search%20all%20projects&overrideWatermark=true&searchLocation=https%3A%2F%2Fwww.codeplex.com%2Fsite%2Fsearch&allowEmptySearch=true&focusOnInit=False&minimumTermLength=3', cleanupSearchEvents);
})
function doProjectSearch() {
    
    var url = 'https://www.codeplex.com/site/search';

    //If search term is not same as watermark
    if($('#searchsite').val() != 'Search all projects')    
    {        
        url = url + '?query=' + encodeURIComponent($('#searchsite').val());
    }

    
    var callback = '';
    if (callback.length > 0 && eval('typeof ' + callback) != 'undefined')
        url += eval(callback + '()');

    window.location.href = url;
    return false;
}
</script>
                </div>
            </div>
            
            <div id="wrap">
                
    <div id="sub_heading" class="row">
        
        <div id="ProjectHeader">
            <div id="project_title_row" class="row">
                <div id="project_logo">
                    
<a id="AffiliateLink" href="http://msdn.microsoft.com/practices">
    <img id="AffiliateImage" src="../assets/pnp_logo.png" title="patterns&#32;&#38;&#32;practices" />
</a>

    
    <h1 class="text_only"><a href="http://unity.codeplex.com/" id="ProjectTitle1"><div>patterns &#38; practices - Unity</div></a></h1>

                </div>
            </div>
        </div>
        
        <div id="ProjectDetailsDiv">
            
        </div>
		<div class="clear"></div>
        

<ul id="page_box_links">
	<li id="homeTabCell" style="width: 63px;"><a id="homeTab" href="http://unity.codeplex.com/" class="box_home">home</a><div></div></li>
    
	<li id="sourceTabCell" style="width:113px;"><a id="sourceTab" href="http://unity.codeplex.com/SourceControl/latest" class="box_source">source code</a><div></div></li>
    
	<li id="releasesTabCell" style="width:105px;"><a id="releasesTab" href="http://unity.codeplex.com/releases" class="box_downloads">downloads</a><div></div></li>
    
    <li id="documentationTabCell" style="width:143px;"><a id="documentationTab" href="http://unity.codeplex.com/documentation" class="box_documentation">documentation</a><div></div></li>
    
	<li id="discussionTabCell" style="width:112px;"><a id="discussionTab" href="../index.html" class="discussions_active">discussions</a><div></div></li>
    
	<li id="workItemsTabCell" style="width:70px;"><a id="workItemsTab" href="http://unity.codeplex.com/workitem/list/basic" class="box_issue">issues</a><div></div></li>
    
	<li id="peopleTabCell" style="width:70px;"><a id="peopleTab" href="http://unity.codeplex.com/team/view" class="box_people">people</a><div></div></li>
	<li id="licenseTabCell" style="width:70px;"><a id="licenseTab" href="http://unity.codeplex.com/license" class="box_license">license</a><div></div></li>
    
    <span class="stretch"></span>
</ul>

<script type="text/javascript">
    $(document).ready(function () {
        $('#page_box_links').applyLastClassToList();
    });
</script>
		    <div class="clear"></div>
            
     <td>
       

<div>
    
    <div id="actionBar" class="action_bar">
        <ul id="actionBar_ul" class="actionBar_sublinks subtab_right" style="vertical-align: middle;">

            

                <li id="li_actionbar_creatediscussion" data-action-id="actionbar_creatediscussion" data-action-type="Navigate" class="actionBar_sublinks" data-options-id="3cb964df-a5c4-4806-a3b9-bb58280f87b3">
                
                    <script class="options" defer="defer" id="3cb964df-a5c4-4806-a3b9-bb58280f87b3" type="application/json">{"navigate-url":"http://unity.codeplex.com/discussions/create"}</script> 
                    
                    <div class="actionBar_custom_content"></div>

                    <a href="#" id="actionbar_creatediscussion" title="Start a New Thread" class="action_bar_item_link">
                        <img id="img_actionbar_creatediscussion" class="action_bar_item_image" src="../assets/actionbar_newitem.png" style="vertical-align: middle" />
                        New Thread
                    </a>

                </li>

            

                <li id="li_actionbar_subscribe" data-action-id="actionbar_subscribe" data-action-type="PopUp" class="actionBar_sublinks" data-options-id="8cd5dc4f-e54b-47d6-a52d-635c1a200e23">
                
                    <script class="options" defer="defer" id="8cd5dc4f-e54b-47d6-a52d-635c1a200e23" type="application/json">{}</script> 
                    
                    <div class="actionBar_custom_content">

<div id="rssHoverDiv" class="HoverPanel LeftHoverWidth" style="display: none">
        <ul id="3_FeedsPanel" class="RssFeedsPanel">
            <li>
                <a id="ProjectRssLink" href="http://unity.codeplex.com/project/feeds/rss" class="ArrowSmall NoUnderline">All Project Updates</a>
            </li>
            
            <li>
                <a id="DiscussionRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity" class="ArrowSmall NoUnderline">Discussions</a>
            </li>
            
            <li>
                <a id="IssueTrackerRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity" class="ArrowSmall NoUnderline">Issue Tracker</a>
            </li>
            
            <li>
                <a id="ReleasesRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity" class="ArrowSmall NoUnderline">Downloads</a>
            </li>
            <li>
                <a id="ReviewsRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity" class="ArrowSmall NoUnderline">Reviews</a>
            </li>
            
            <li>
                <a id="SourceControlRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity" class="ArrowSmall NoUnderline">Source Code</a>
            </li>
            <li>
                <a id="WikiRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity" class="ArrowSmall NoUnderline">Wiki &amp; Documentation</a>
            </li>
        </ul>
</div></div>

                    <a href="#" id="actionbar_subscribe" title="Subscribe to project updates in RSS feeds." class="action_bar_item_link">
                        <img id="img_actionbar_subscribe" class="action_bar_item_image" src="../assets/actionbar_subscribe.png" style="vertical-align: middle" />
                        Subscribe
                    </a>

                </li>

            
        </ul>
    </div>
</div>
     </td>

        

    </div>
    
    
<div class="Threads">
    <div class="ViewThread">
        
        
        
            <h1 class="page_title WordWrapBreakWord">
                How do you Mock IUnityContainer
            </h1>

            <!-- Private Discussion header -->
            

            <!-- Posts List Header: Topics and Wiki Link -->
            <table class="PostsListHeader">
                <tr>
                    <td>
                     
                    </td>
                    <td>
                        <div class="WikiLink">
                            <span title="Paste this into a wiki page to link to this discussion">
                                Wiki Link: [discussion:50341]
                            </span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- The list of posts -->
            

<div id="discussionsPostList" data-options-id="6b4f7b2f-5e57-4d6d-aae1-372920f8078a">
    <script class="options" defer="defer" id="6b4f7b2f-5e57-4d6d-aae1-372920f8078a" type="application/json">{"threadUrl":"http://unity.codeplex.com/discussions/50341","showEditor":false,"checkImageUrl":"../assets/check_answer.png"}</script>

    <div class="Posts" style="margin-top: 10px;">
    

<table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 0px; table-layout:fixed">
    

<tr id="PostPanel" class="Post" d:forid="168595">
    <td id="PostDetailsCell_168595" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post168595"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rauh_ryan">rauh_ryan</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/16/2009 4:22:44 PM" LocalTimeTicks="1237245764">Mar 16, 2009 at 4:22 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_168595" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#39;m&#32;trying&#32;to&#32;Mock&#32;the&#32;IUnityContainer&#32;using&#32;Moq&#32;3.0&#32;&#32;I&#39;m&#32;getting&#32;a&#32;BadImageFormatException,&#32;but&#32;not&#32;when&#32;debugging.&#32;From&#32;the&#32;looks&#32;of&#32;it&#32;I&#39;m&#32;not&#32;the&#32;only&#32;one&#32;that&#39;s&#32;ran&#32;into&#32;this&#32;problem.&#32;&#32;here&#32;&#32;And&#32;its&#32;a&#32;registered&#32;issue&#32;for&#32;Moq&#32;&#32;here&#32;&#32;I&#39;m&#32;just&#32;curious&#32;if&#32;anyone&#32;has&#32;found&#32;a&#32;solution...&#32;closest&#32;I&#39;ve&#32;found&#32;is&#32;a&#32;nice&#32;solution&#32;that&#32;uses&#32;RhinoMock&#32;by&#32;Roy&#32;Osherove&#32;&#32;&#32;here&#32;&#32;but&#32;I&#32;really&#32;like&#32;Moq&#33;&#32;So&#32;I&#32;don&#39;t&#32;really&#32;want&#32;to&#32;have&#32;to&#32;switch&#32;to&#32;Rhino&#32;Mock&#32;but&#32;I&#32;will&#32;if&#32;I&#32;must&#32;&#32;Thanks&#32;in&#32;advance&#33;&#32;&#32;">
        I'm trying to Mock the IUnityContainer using Moq 3.0<br>
<br>
I'm getting a BadImageFormatException, but not when debugging. From the looks of it I'm not the only one that's ran into this problem.<br>
<br>
<a href="http://www.nabble.com/BadImageFormatException,-but-not-when-debugging-td18742529.html" rel="nofollow">here</a><br>
<br>
And its a registered issue for Moq<br>
<br>
<a href="http://code.google.com/p/moq/issues/detail?id=87" rel="nofollow">here</a><br>
<br>
I'm just curious if anyone has found a solution... closest I've found is a nice solution that uses RhinoMock by Roy Osherove
<br>
<br>
<a href="http://weblogs.asp.net/rosherove/archive/2008/04/14/creating-a-automockingcontainer-with-microsoft-unity-pretty-darn-simple.aspx" rel="nofollow">here</a><br>
<br>
but I really like Moq! So I don't really want to have to switch to Rhino Mock but I will if I must<br>
<br>
Thanks in advance!<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_168595" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="168635">
    <td id="PostDetailsCell_168635" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post168635"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/dpiessens">dpiessens</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/16/2009 5:44:34 PM" LocalTimeTicks="1237250674">Mar 16, 2009 at 5:44 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_168635" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#39;ve&#32;played&#32;around&#32;with&#32;this&#32;a&#32;bit&#32;and&#32;I&#32;think&#32;it&#32;revolves&#32;around&#32;the&#32;fluent&#32;interface&#32;pattern&#32;used&#32;in&#32;Unity.&#32;I&#32;personally&#32;am&#32;a&#32;huge&#32;fan,&#32;but&#32;whenever&#32;I&#32;use&#32;it&#32;with&#32;Moq&#32;it&#32;seems&#32;to&#32;break.&#32;My&#32;guess&#32;is&#32;it&#39;s&#32;an&#32;IL&#32;generation&#32;issue&#32;with&#32;the&#32;return&#32;type,&#32;but&#32;I&#39;ve&#32;never&#32;tried&#32;to&#32;save&#32;off&#32;a&#32;Moq&#32;dynamic&#32;proxy&#32;to&#32;check.&#32;Our&#32;solution&#32;so&#32;far&#32;was&#32;to&#32;either&#32;use&#32;a&#32;real&#32;unity&#32;container&#32;in&#32;testing&#32;or&#32;create&#32;a&#32;full&#32;mock&#32;class&#32;for&#32;it.&#32;Not&#32;pretty,&#32;but&#32;it&#32;works,&#32;and&#32;we&#32;as&#32;a&#32;practice&#32;tend&#32;to&#32;limit&#32;the&#32;number&#32;of&#32;points&#32;where&#32;we&#32;inject&#32;the&#32;actual&#32;IoC&#32;container.&#32;">
        I've played around with this a bit and I think it revolves around the fluent interface pattern used in Unity. I personally am a huge fan, but whenever I use it with Moq it seems to break. My guess is it's an IL generation issue with the return type, but
 I've never tried to save off a Moq dynamic proxy to check. Our solution so far was to either use a real unity container in testing or create a full mock class for it. Not pretty, but it works, and we as a practice tend to limit the number of points where we
 inject the actual IoC container. 
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_168635" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="168650">
    <td id="PostDetailsCell_168650" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post168650"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rauh_ryan">rauh_ryan</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/16/2009 6:01:52 PM" LocalTimeTicks="1237251712">Mar 16, 2009 at 6:01 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_168650" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#64;dpiessens&#32;&#91;quote&#93;&#32;Our&#32;solution&#32;so&#32;far&#32;was&#32;to&#32;either&#32;use&#32;a&#32;real&#32;unity&#32;container&#32;in&#32;testing&#32;or&#32;create&#32;a&#32;full&#32;mock&#32;class&#32;for&#32;it.&#32;Not&#32;pretty,&#32;but&#32;it&#32;works&#32;&#91;&#47;quote&#93;&#32;&#32;I&#39;ve&#32;had&#32;to&#32;do&#32;this&#32;as&#32;well&#32;it&#32;just&#32;really&#32;sucks&#32;to&#32;have&#32;to&#32;do&#32;that.&#32;I&#32;just&#32;don&#39;t&#32;understand...&#32;its&#32;just&#32;an&#32;interface,&#32;you&#39;d&#32;think&#32;it&#39;d&#32;be&#32;simply&#32;to&#32;Mock&#32;it&#32;">
        @dpiessens [quote] Our solution so far was to either use a real unity container in testing or create a full mock class for it. Not pretty, but it works [/quote]<br>
<br>
I've had to do this as well it just really sucks to have to do that. I just don't understand... its just an interface, you'd think it'd be simply to Mock it<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_168650" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="168696">
    <td id="PostDetailsCell_168696" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post168696"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/dpiessens">dpiessens</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/16/2009 7:43:10 PM" LocalTimeTicks="1237257790">Mar 16, 2009 at 7:43 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_168696" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Ah&#32;but&#32;it&#32;not&#32;just&#32;an&#32;interface...&#32;most&#32;interfaces&#32;don&#39;t&#32;return&#32;themselves&#32;as&#32;the&#32;return&#32;type&#32;of&#32;a&#32;method.&#32;Not&#32;that&#32;this&#32;shouldn&#39;t&#32;be&#32;supported&#32;but&#32;it&#39;s&#32;a&#32;design&#32;pattern&#32;that&#32;most&#32;likely&#32;wasn&#39;t&#32;tested&#32;for.&#32;I&#39;d&#32;guess&#32;that&#32;there&#39;s&#32;a&#32;boxing&#32;issue&#32;on&#32;the&#32;return&#32;type&#32;of&#32;the&#32;dynamic&#32;method&#32;that&#39;s&#32;causing&#32;the&#32;issue.&#32;Dynamic&#32;IL&#32;is&#32;not&#32;easy&#32;to&#32;write&#32;&#40;I&#39;ve&#32;done&#32;it&#32;a&#32;few&#32;times&#41;&#32;and&#32;can&#32;be&#32;even&#32;more&#32;difficult&#32;to&#32;debug.&#32;">
        Ah but it not just an interface... most interfaces don't return themselves as the return type of a method. Not that this shouldn't be supported but it's a design pattern that most likely wasn't tested for. I'd guess that there's a boxing issue on the return
 type of the dynamic method that's causing the issue. Dynamic IL is not easy to write (I've done it a few times) and can be even more difficult to debug.

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_168696" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="168738">
    <td id="PostDetailsCell_168738" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post168738"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/16/2009 9:02:53 PM" LocalTimeTicks="1237262573">Mar 16, 2009 at 9:02 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_168738" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="My&#32;understanding&#32;is&#32;that&#32;it&#39;s&#32;an&#32;issue&#32;with&#32;the&#32;underlying&#32;Castle&#32;DynamicProxy&#32;code&#32;that&#39;s&#32;used&#32;by&#32;both&#32;Moq&#32;and&#32;Rhino.&#32;So&#32;you&#32;won&#39;t&#32;have&#32;any&#32;more&#32;luck&#32;using&#32;Rhinomocks,&#32;I&#39;m&#32;afraid.&#32;&#32;I&#39;m&#32;really&#32;curious&#32;why&#32;you&#32;feel&#32;the&#32;need&#32;to&#32;mock&#32;IUnityContainer&#63;&#32;You&#39;re&#32;not&#32;testing&#32;the&#32;container,&#32;are&#32;you&#63;&#32;Why&#63;&#32;We&#32;used&#32;hand-written&#32;mocks&#32;&#40;derive&#32;from&#32;UnityContainerBase,&#32;btw,&#32;not&#32;IUnityContainer&#32;directly.&#32;You&#32;get&#32;the&#32;brainless&#32;overloads&#32;implemented&#32;for&#32;free&#32;that&#32;way&#41;&#32;inside&#32;the&#32;Unity&#32;unit&#32;test&#32;suite.&#32;It&#32;was&#32;sufficient&#32;for&#32;what&#32;we&#32;needed&#32;and&#32;wasn&#39;t&#32;that&#32;hard&#32;to&#32;do.&#32;&#32;-Chris&#32;&#32;&#32;">
        My understanding is that it's an issue with the underlying Castle DynamicProxy code that's used by both Moq and Rhino. So you won't have any more luck using Rhinomocks, I'm afraid.<br>
<br>
I'm really curious why you feel the need to mock IUnityContainer? You're not testing the container, are you? Why? We used hand-written mocks (derive from UnityContainerBase, btw, not IUnityContainer directly. You get the brainless overloads implemented for
 free that way) inside the Unity unit test suite. It was sufficient for what we needed and wasn't that hard to do.<br>
<br>
-Chris<br>
<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_168738" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="168761">
    <td id="PostDetailsCell_168761" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post168761"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rauh_ryan">rauh_ryan</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/16/2009 10:03:08 PM" LocalTimeTicks="1237266188">Mar 16, 2009 at 10:03 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_168761" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Thanks&#32;for&#32;replying&#32;Chris...&#32;&#32;The&#32;reason&#32;I&#32;want&#32;to&#32;Mock&#32;the&#32;unity&#32;container&#32;is&#32;so&#32;that&#32;I&#32;can&#32;mock&#32;its&#32;behavior&#32;without&#32;having&#32;to&#32;configure&#32;it&#32;and&#32;create&#32;a&#32;mock&#32;implementation...&#32;for&#32;example.&#32;&#32;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;14&#38;nbsp&#59;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;15&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#47;&#32;Summary&#32;description&#32;for&#32;SampleForTavaras&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;16&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;17&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestClass&#93;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;18&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;SampleForTavares&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;19&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;20&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Mock&#38;lt&#59;IUnityContainer&#38;gt&#59;&#32;mockUnityContainer&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;21&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Mock&#38;lt&#59;ILogger&#38;gt&#59;&#32;mockLogger&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;22&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Mock&#38;lt&#59;IValidate&#38;gt&#59;&#32;mockValidator&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;23&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;24&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestMethod&#93;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;25&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;Can_Mock_Unity&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;26&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;27&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockUnityContainer&#32;&#61;&#32;new&#32;Mock&#38;lt&#59;IUnityContainer&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;28&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockLogger&#32;&#61;&#32;new&#32;Mock&#38;lt&#59;ILogger&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;29&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockValidator&#32;&#61;&#32;new&#32;Mock&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;30&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;31&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;set&#32;up&#32;validator&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;32&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockValidator.Setup&#40;mv&#32;&#61;&#38;gt&#59;&#32;mv.Validate&#40;It.IsAny&#38;lt&#59;Address&#38;gt&#59;&#40;&#41;&#41;&#41;.Returns&#40;true&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;33&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;34&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;set&#32;up&#32;container&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;35&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockUnityContainer&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;36&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;.Setup&#40;mc&#32;&#61;&#38;gt&#59;&#32;mc.Resolve&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;AddressValidator&#38;quot&#59;&#41;&#41;.Returns&#40;mockValidator.Object&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;37&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;38&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;myClass&#32;&#61;&#32;new&#32;MyClass&#40;mockUnityContainer.Object,&#32;mockLogger.Object&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;39&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;40&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;result&#32;&#61;&#32;myClass.GetAddress&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;41&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;42&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;assert&#32;something&#32;was&#32;returned&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;43&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.IsNotNull&#40;result&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;44&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;45&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;verify&#32;expected&#32;calls&#32;were&#32;made&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;46&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockUnityContainer.VerifyAll&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;47&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockValidator.VerifyAll&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;48&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;49&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;verify&#32;logger&#32;never&#32;called&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;50&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;mockLogger.Verify&#40;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;51&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;l&#32;&#61;&#38;gt&#59;&#32;l.Write&#40;It.IsAny&#38;lt&#59;string&#38;gt&#59;&#40;&#41;,&#32;It.IsAny&#38;lt&#59;CategoryType&#38;gt&#59;&#40;&#41;,&#32;It.IsAny&#38;lt&#59;PriorityType&#38;gt&#59;&#40;&#41;&#41;,&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;52&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Times.Never&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;53&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;54&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;55&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;56&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;57&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;58&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;MyClass&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;59&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;60&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;IUnityContainer&#32;container&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;61&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;ILogger&#32;logger&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;62&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;MyClass&#40;IUnityContainer&#32;container,&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;63&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;ILogger&#32;logger&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;64&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;65&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;this.container&#32;&#61;&#32;container&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;66&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;this.logger&#32;&#61;&#32;logger&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;67&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;68&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;69&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;Address&#32;GetAddress&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;70&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;71&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#32;Do&#32;some&#32;stuff...&#32;this&#32;would&#32;call&#32;IRepository&#32;or&#32;something&#32;like&#32;that&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;72&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Address&#32;address&#32;&#61;&#32;GetSomeData&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;73&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;74&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;Validate&#32;it&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;75&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;IValidate&#32;validator&#32;&#61;&#32;container.Resolve&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;AddressValidator&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;76&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;if&#40;validator.Validate&#40;address&#41;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;77&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;return&#32;address&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;78&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;79&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#32;If&#32;it&#32;fails&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;80&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;logger.Write&#40;&#38;quot&#59;Hey&#32;it&#39;s&#32;not&#32;valid&#38;quot&#59;,&#32;CategoryType.Validation,&#32;PriorityType.Medium&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;81&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;82&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;throw&#32;new&#32;InvalidOperationException&#40;&#38;quot&#59;Address&#32;invalid&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;83&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;84&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;85&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;used&#32;to&#32;show&#32;quickly,&#32;don&#39;t&#32;flame&#32;me&#32;&#58;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;86&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Address&#32;GetSomeData&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;87&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;88&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;return&#32;new&#32;Address&#32;&#123;&#32;Id&#32;&#61;&#32;0,&#32;Street&#32;&#61;&#32;&#38;quot&#59;test&#38;quot&#59;&#32;&#125;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;89&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;90&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#32;&#32;&#32;Maybe&#32;you&#32;can&#32;suggest&#32;a&#32;better&#32;way&#32;or&#32;am&#32;I&#32;just&#32;totally&#32;complicating&#32;things...&#32;&#32;&#32;Thanks&#32;a&#32;lot..&#32;&#32;Whats&#32;really&#32;odd&#32;is,&#32;this&#32;code&#32;works&#32;perfect&#32;if&#32;you&#32;run&#32;the&#32;test&#32;in&#32;Debug&#32;mode...&#32;Fails&#32;if&#32;you&#32;run&#32;it&#32;without&#32;debug&#32;with&#32;the&#32;following&#32;message&#32;&#32;Test&#32;method&#32;BLLTests.SampleForTavares.Can_Mock_Unity&#32;threw&#32;exception&#58;&#38;nbsp&#59;&#32;System.BadImageFormatException&#58;&#32;An&#32;attempt&#32;was&#32;made&#32;to&#32;load&#32;a&#32;program&#32;with&#32;an&#32;incorrect&#32;format.&#32;&#40;Exception&#32;from&#32;HRESULT&#58;&#32;0x8007000B&#41;.&#32;&#32;&#32;&#32;&#32;&#32;">
        Thanks for replying Chris...<br>
<br>
The reason I want to Mock the unity container is so that I can mock its behavior without having to configure it and create a mock implementation... for example.<br>
<br>
<br>
<div style="background:rgb(32,32,32) none repeat scroll 0% 0%; font-family:consolas; font-size:10pt; color:rgb(255,245,213)">
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;14</span>&nbsp;<span style="color:rgb(144,144,144)">///</span><span style="color:rgb(255,255,128)">
</span><span style="color:rgb(144,144,144)">&lt;summary&gt;</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;15</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:rgb(144,144,144)">///</span><span style="color:rgb(255,255,128)"> Summary description for SampleForTavaras</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;16</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:rgb(144,144,144)">///</span><span style="color:rgb(255,255,128)">
</span><span style="color:rgb(144,144,144)">&lt;/summary&gt;</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;17</span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:rgb(0,210,210)">TestClass</span>]</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;18</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">public</span> <span style="color:rgb(250,128,114)">
class</span> <span style="color:rgb(0,210,210)">SampleForTavares</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;19</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;20</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">private</span> <span style="color:rgb(0,210,210)">
Mock</span><span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">IUnityContainer</span><span style="color:silver">&gt;</span> mockUnityContainer;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;21</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">private</span> <span style="color:rgb(0,210,210)">
Mock</span><span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">ILogger</span><span style="color:silver">&gt;</span> mockLogger;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;22</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">private</span> <span style="color:rgb(0,210,210)">
Mock</span><span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">IValidate</span><span style="color:silver">&gt;</span> mockValidator;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;23</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;24</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span style="color:rgb(0,210,210)">TestMethod</span>]</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;25</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">public</span> <span style="color:rgb(250,128,114)">
void</span> Can_Mock_Unity()</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;26</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;27</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockUnityContainer
<span style="color:silver">=</span> <span style="color:rgb(250,128,114)">new</span>
<span style="color:rgb(0,210,210)">Mock</span><span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">IUnityContainer</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;28</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockLogger
<span style="color:silver">=</span> <span style="color:rgb(250,128,114)">new</span>
<span style="color:rgb(0,210,210)">Mock</span><span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">ILogger</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;29</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockValidator
<span style="color:silver">=</span> <span style="color:rgb(250,128,114)">new</span>
<span style="color:rgb(0,210,210)">Mock</span><span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">IValidate</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;30</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;31</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//set up validator</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;32</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockValidator<span style="color:silver">.</span>Setup(mv
<span style="color:silver">=&gt;</span> mv<span style="color:silver">.</span>Validate(<span style="color:rgb(0,210,210)">It</span><span style="color:silver">.</span>IsAny<span style="color:silver">&lt;</span><span style="color:rgb(0,210,210)">Address</span><span style="color:silver">&gt;</span>()))<span style="color:silver">.</span>Returns(<span style="color:rgb(250,128,114)">true</span>);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;33</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;34</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//set up container</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;35</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockUnityContainer</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;36</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:silver">.</span>Setup(mc <span style="color:silver">=&gt;</span> mc<span style="color:silver">.</span>Resolve<span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">IValidate</span><span style="color:silver">&gt;</span>(<span style="color:rgb(225,220,111)">&quot;AddressValidator&quot;</span>))<span style="color:silver">.</span>Returns(mockValidator<span style="color:silver">.</span>Object);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;37</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;38</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">var</span> myClass <span style="color:silver">
=</span> <span style="color:rgb(250,128,114)">new</span> <span style="color:rgb(0,210,210)">
MyClass</span>(mockUnityContainer<span style="color:silver">.</span>Object, mockLogger<span style="color:silver">.</span>Object);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;39</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;40</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">var</span> result <span style="color:silver">
=</span> myClass<span style="color:silver">.</span>GetAddress();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;41</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;42</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//assert something was returned</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;43</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(0,210,210)">Assert</span><span style="color:silver">.</span>IsNotNull(result);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;44</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;45</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//verify expected calls were made</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;46</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockUnityContainer<span style="color:silver">.</span>VerifyAll();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;47</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockValidator<span style="color:silver">.</span>VerifyAll();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;48</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;49</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//verify logger never called</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;50</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mockLogger<span style="color:silver">.</span>Verify(</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;51</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; l
<span style="color:silver">=&gt;</span> l<span style="color:silver">.</span>Write(<span style="color:rgb(0,210,210)">It</span><span style="color:silver">.</span>IsAny<span style="color:silver">&lt;</span><span style="color:rgb(250,128,114)">string</span><span style="color:silver">&gt;</span>(),
<span style="color:rgb(0,210,210)">It</span><span style="color:silver">.</span>IsAny<span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">CategoryType</span><span style="color:silver">&gt;</span>(),
<span style="color:rgb(0,210,210)">It</span><span style="color:silver">.</span>IsAny<span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">PriorityType</span><span style="color:silver">&gt;</span>()),
</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;52</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(0,210,210)">Times</span><span style="color:silver">.</span>Never());</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;53</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;54</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;55</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;56</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;57</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;58</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">public</span> <span style="color:rgb(250,128,114)">
class</span> <span style="color:rgb(0,210,210)">MyClass</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;59</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;60</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">private</span> <span style="color:rgb(43,145,175)">
IUnityContainer</span> container;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;61</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">private</span> <span style="color:rgb(43,145,175)">
ILogger</span> logger;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;62</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">public</span> MyClass(<span style="color:rgb(43,145,175)">IUnityContainer</span> container,</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;63</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(43,145,175)">ILogger</span> logger)</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;64</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;65</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">this</span><span style="color:silver">.</span>container
<span style="color:silver">=</span> container;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;66</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">this</span><span style="color:silver">.</span>logger
<span style="color:silver">=</span> logger;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;67</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;68</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;69</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">public</span> <span style="color:rgb(0,210,210)">
Address</span> GetAddress()</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;70</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;71</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">// Do some stuff... this would call IRepository or something like that</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;72</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(0,210,210)">Address</span> address <span style="color:silver">
=</span> GetSomeData();</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;73</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;74</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//Validate it</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;75</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(43,145,175)">IValidate</span> validator <span style="color:silver">
=</span> container<span style="color:silver">.</span>Resolve<span style="color:silver">&lt;</span><span style="color:rgb(43,145,175)">IValidate</span><span style="color:silver">&gt;</span>(<span style="color:rgb(225,220,111)">&quot;AddressValidator&quot;</span>);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;76</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">if</span>(validator<span style="color:silver">.</span>Validate(address))</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;77</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">return</span> address;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;78</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;79</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">// If it fails</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;80</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; logger<span style="color:silver">.</span>Write(<span style="color:rgb(225,220,111)">&quot;Hey
 it's not valid&quot;</span>, <span style="color:rgb(43,145,175)">CategoryType</span><span style="color:silver">.</span>Validation,
<span style="color:rgb(43,145,175)">PriorityType</span><span style="color:silver">.</span>Medium);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;81</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;82</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">throw</span> <span style="color:rgb(250,128,114)">
new</span> <span style="color:rgb(0,210,210)">InvalidOperationException</span>(<span style="color:rgb(225,220,111)">&quot;Address invalid&quot;</span>);</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;83</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;84</span>&nbsp;</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;85</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(179,255,255)">//used to show quickly, don't flame me :)</span></p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;86</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">private</span> <span style="color:rgb(0,210,210)">
Address</span> GetSomeData()</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;87</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;88</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:rgb(250,128,114)">return</span> <span style="color:rgb(250,128,114)">
new</span> <span style="color:rgb(0,210,210)">Address</span> { Id <span style="color:silver">
=</span> <span style="color:rgb(135,223,113)">0</span>, Street <span style="color:silver">
=</span> <span style="color:rgb(225,220,111)">&quot;test&quot;</span> };</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;89</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:rgb(40,40,40) none repeat scroll 0% 0%; color:rgb(83,199,255)">&nbsp;&nbsp;&nbsp;90</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"></p>
</div>
<br>
Maybe you can suggest a better way or am I just totally complicating things... <br>
<br>
Thanks a lot..<br>
<br>
Whats really odd is, this code works perfect if you run the test in Debug mode...<br>
Fails if you run it without debug with the following message<br>
<br>
Test method BLLTests.SampleForTavares.Can_Mock_Unity threw exception:&nbsp; System.BadImageFormatException: An attempt was made to load a program with an incorrect format. (Exception from HRESULT: 0x8007000B).<br>
<br>
<br>
<br>
<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_168761" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="191663">
    <td id="PostDetailsCell_191663" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post191663"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/derekgreer">derekgreer</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="5/18/2009 10:37:39 PM" LocalTimeTicks="1242711459">May 18, 2009 at 10:37 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_191663" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="The&#32;reason&#32;you&#32;would&#32;want&#32;to&#32;mock&#32;the&#32;IUnityContainer&#32;is&#32;to&#32;avoid&#32;testing&#32;it.&#38;nbsp&#59;&#32;Otherwise,&#32;not&#32;mocking&#32;it&#32;includes&#32;execution&#32;of&#32;the&#32;actual&#32;unity&#32;bits&#32;alongside&#32;the&#32;SUT&#32;you&#32;are&#32;trying&#32;to&#32;isolate.&#32;I&#32;ran&#32;into&#32;this&#32;same&#32;issue&#32;today&#32;as&#32;well.&#38;nbsp&#59;&#32;According&#32;to&#32;a&#32;few&#32;sources&#32;I&#39;ve&#32;read,&#32;it&#32;seems&#32;this&#32;is&#32;actually&#32;an&#32;issue&#32;with&#32;the&#32;.Net&#32;framework&#32;itself,&#32;and&#32;is&#32;only&#32;being&#32;revealed&#32;through&#32;Castle.DynamicProxy&#32;code.&#38;nbsp&#59;&#32;It&#32;appears&#32;to&#32;me&#32;to&#32;be&#32;the&#32;same&#32;issue&#32;reported&#32;over&#32;3&#32;years&#32;ago&#32;&#40;https&#58;&#47;&#47;connect.microsoft.com&#47;VisualStudio&#47;feedback&#47;ViewFeedback.aspx&#63;FeedbackID&#61;93389&#41;.">
        
<p>The reason you would want to mock the IUnityContainer is to avoid testing it.&nbsp; Otherwise, not mocking it includes execution of the actual unity bits alongside the SUT you are trying to isolate.</p>
<p>I ran into this same issue today as well.&nbsp; According to a few sources I've read, it seems this is actually an issue with the .Net framework itself, and is only being revealed through Castle.DynamicProxy code.&nbsp; It appears to me to be the same issue
 reported over 3 years ago (<a href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93389" rel="nofollow">https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93389</a>).</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_191663" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="194872">
    <td id="PostDetailsCell_194872" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post194872"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/bittondb">bittondb</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="5/27/2009 5:52:29 PM" LocalTimeTicks="1243471949">May 27, 2009 at 5:52 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_194872" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Has&#32;anyone&#32;found&#32;a&#32;work-around&#63;&#38;nbsp&#59;&#32;The&#32;tests&#32;that&#32;the&#32;Composite&#32;Application&#32;Guidance&#32;Quickstarts&#32;have&#32;actually&#32;instatiate&#32;a&#32;Unity&#32;Container.&#38;nbsp&#59;&#32;I&#39;m&#32;not&#32;fond&#32;of&#32;this&#32;because&#32;it&#32;adds&#32;more&#32;of&#32;my&#32;own&#32;code&#32;&#40;prone&#32;its&#32;own&#32;set&#32;of&#32;errors&#41;&#32;in&#32;my&#32;tests.">
        
<p>Has anyone found a work-around?&nbsp; The tests that the Composite Application Guidance Quickstarts have actually instatiate a Unity Container.&nbsp; I'm not fond of this because it adds more of my own code (prone its own set of errors) in my tests.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_194872" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="195538">
    <td id="PostDetailsCell_195538" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post195538"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mvalenty">mvalenty</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="5/29/2009 3:28:14 AM" LocalTimeTicks="1243592894">May 29, 2009 at 3:28 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_195538" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Why&#32;is&#58;&#32;mockUnityContainer.Setup&#40;mc&#32;&#61;&#38;gt&#59;&#32;mc.Resolve&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;AddressValidator&#38;quot&#59;&#41;&#41;.Returns&#40;mockValidator.Object&#41;&#59;&#32;better&#32;than&#58;&#32;realUnityContainer.RegisterInstance&#38;lt&#59;IValidate&#38;gt&#59;&#40;mockValidator.Object&#41;&#59;&#32;It&#39;s&#32;odd&#32;that&#32;you&#32;would&#32;want&#32;to&#32;mock&#32;the&#32;UnityContainer&#32;in&#32;the&#32;first&#32;place.&#32;It&#32;shouldn&#39;t&#32;be&#32;used&#32;directly&#32;by&#32;your&#32;application&#32;anyway,&#32;the&#32;container&#32;should&#32;just&#32;be&#32;used&#32;to&#32;wire&#32;up&#32;your&#32;application&#32;at&#32;runtime.">
        
<p>Why is:</p>
<p>mockUnityContainer.Setup(mc =&gt; mc.Resolve&lt;IValidate&gt;(&quot;AddressValidator&quot;)).Returns(mockValidator.Object);</p>
<p>better than:</p>
<p>realUnityContainer.RegisterInstance&lt;IValidate&gt;(mockValidator.Object);</p>
<p>It's odd that you would want to mock the UnityContainer in the first place. It shouldn't be used directly by your application anyway, the container should just be used to wire up your application at runtime.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_195538" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="195725">
    <td id="PostDetailsCell_195725" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post195725"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rauh_ryan">rauh_ryan</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="5/29/2009 3:43:23 PM" LocalTimeTicks="1243637003">May 29, 2009 at 3:43 PM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="5/29/2009 3:46:18 PM" LocalTimeTicks="1243637178">May 29, 2009 at 3:46 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_195725" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="The&#32;reason&#32;I&#32;would&#32;need&#32;to&#32;mock&#32;the&#32;unity&#32;container&#32;is&#32;because&#32;I&#32;haven&#39;t&#32;figured&#32;out&#32;how&#32;to&#32;easily&#32;configure&#32;unity&#32;to&#32;inject&#32;a&#32;specific&#32;type&#32;registered&#32;with&#32;a&#32;key.&#32;&#38;nbsp&#59;&#32;For&#32;example,&#32;say&#32;you&#32;want&#32;to&#32;set&#32;up&#32;validation&#32;that&#32;shares&#32;the&#32;same&#32;interface,&#32;but&#32;you&#32;want&#32;to&#32;use&#32;unity&#32;to&#32;instantiate&#32;it&#32;so&#32;it&#32;is&#32;easier&#32;to&#32;test.&#32;With&#32;unity&#32;you&#32;can&#32;register&#32;several&#32;types&#32;to&#32;the&#32;same&#32;interface&#32;with&#32;a&#32;key.&#32;ie&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IValidate,&#32;PersonValidator&#38;gt&#59;&#40;&#38;quot&#59;PersonValidator&#38;quot&#59;&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IValidate,&#32;OrderValidator&#38;gt&#59;&#40;&#38;quot&#59;OrderValidator&#38;quot&#59;&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IValidate,&#32;ProductValidator&#38;gt&#59;&#40;&#38;quot&#59;ProductValidator&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#32;You&#32;can&#39;t&#32;easily&#32;set&#32;up&#32;unity&#32;to&#32;constructor&#32;inject&#32;IValidate&#32;and&#32;get&#32;a&#32;specific&#32;validator.&#32;Like&#32;this&#58;&#32;&#38;nbsp&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;76&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;readonly&#32;IValidate&#32;_validate&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;77&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;SomeDomainService&#40;IValidate&#32;validate&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;78&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;79&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_validate&#32;&#61;&#32;validate&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;80&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#32;&#38;nbsp&#59;&#32;It&#32;doesn&#39;t&#32;know&#32;that&#32;you&#32;actually&#32;want,&#32;unityContainer.Resolve&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;PersonValidator&#38;quot&#59;&#41;&#59;&#32;The&#32;problem&#32;lies&#32;in&#32;that&#32;when&#32;you&#32;try&#32;to&#32;mock,&#32;IUnityContainer&#32;you&#32;get&#32;this&#32;exeption&#58;&#32;System.BadImageFormatException&#58;&#32;An&#32;attempt&#32;was&#32;made&#32;to&#32;load&#32;a&#32;program&#32;with&#32;an&#32;incorrect&#32;format.&#32;&#40;Exception&#32;from&#32;HRESULT&#58;&#32;0x8007000B&#41;.&#32;but&#32;it&#32;doesn&#39;t&#32;throw&#32;when&#32;you&#32;run&#32;it&#32;in&#32;debug&#32;mode...&#32;which&#32;is&#32;really&#32;strange.&#32;I&#32;agree&#32;that&#32;it&#32;is&#32;much&#32;better&#32;to&#32;load&#32;the&#32;entire&#32;object&#32;tree&#32;rather&#32;than&#32;using&#32;the&#32;container&#32;directly&#32;in&#32;your&#32;class.&#32;I&#32;would&#32;actually&#32;highly&#32;advise&#32;against&#32;doing&#32;this.&#32;IMO&#32;you&#32;should&#32;never&#32;inject&#32;IUnityContainer&#32;into&#32;a&#32;class&#32;unless&#32;you&#32;have&#32;a&#32;very&#32;good&#32;reason&#32;for&#32;doing&#32;so,&#32;such&#32;as&#32;wiring&#32;up&#32;you&#32;modules&#32;on&#32;initialization.&#32;If&#32;you&#32;must&#32;mock&#32;the&#32;behavior&#32;of&#32;unity&#32;or&#32;any&#32;IoC&#32;container&#32;for&#32;that&#32;matter&#32;I&#32;have&#32;found&#32;that&#32;using&#32;IServiceLocator&#32;is&#32;a&#32;much&#32;more&#32;elegant&#32;solution.&#32;Here&#32;is&#32;a&#32;quick&#32;example&#32;please&#32;excuse&#32;the&#32;code&#32;it&#32;simply&#32;demonstrates&#32;the&#32;ability&#32;to&#32;mock&#32;unity&#32;using&#32;Microsoft.Practices.ServiceLocation&#32;-&#32;IServiceLocator&#32;&#38;nbsp&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;1&#38;nbsp&#59;&#35;region&#32;using&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;2&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;3&#38;nbsp&#59;using&#32;System.Collections.Generic&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;4&#38;nbsp&#59;using&#32;System.Linq&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;5&#38;nbsp&#59;using&#32;Microsoft.Practices.ServiceLocation&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;6&#38;nbsp&#59;using&#32;Microsoft.VisualStudio.TestTools.UnitTesting&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;7&#38;nbsp&#59;using&#32;Moq&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;8&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;9&#38;nbsp&#59;&#35;endregion&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;10&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;11&#38;nbsp&#59;namespace&#32;MockUnity&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;12&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;13&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;14&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#47;&#32;Summary&#32;description&#32;for&#32;MockUnityFixture&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;15&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;16&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestClass&#93;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;17&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;MockUnityFixture&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;18&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;19&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Mock&#38;lt&#59;IDataService&#38;gt&#59;&#32;_mockDataService&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;20&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Mock&#38;lt&#59;IServiceLocator&#38;gt&#59;&#32;_mockServiceLocator&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;21&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;Mock&#38;lt&#59;IValidate&#38;gt&#59;&#32;_mockValidator&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;22&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;23&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestInitialize&#93;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;24&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;Setup&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;25&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;26&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_mockValidator&#32;&#61;&#32;new&#32;Mock&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;27&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_mockServiceLocator&#32;&#61;&#32;new&#32;Mock&#38;lt&#59;IServiceLocator&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;28&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_mockDataService&#32;&#61;&#32;new&#32;Mock&#38;lt&#59;IDataService&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;29&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;30&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_mockValidator.Setup&#40;mv&#32;&#61;&#38;gt&#59;&#32;mv.Validate&#40;&#38;quot&#59;Valid&#38;quot&#59;&#41;&#41;.Returns&#40;true&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;31&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;32&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_mockDataService.Setup&#40;md&#32;&#61;&#38;gt&#59;&#32;md.GetSomeData&#40;&#41;&#41;.Returns&#40;new&#91;&#93;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;33&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;34&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;quot&#59;Valid&#38;quot&#59;,&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;35&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;quot&#59;Valid&#38;quot&#59;,&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;36&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;quot&#59;InValid&#38;quot&#59;,&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;37&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;quot&#59;Valid&#38;quot&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;38&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;39&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_mockServiceLocator.Setup&#40;msl&#32;&#61;&#38;gt&#59;&#32;msl.GetInstance&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;SomeInstanceWithAKey&#38;quot&#59;&#41;&#41;.&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;40&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Returns&#40;_mockValidator.Object&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;41&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;42&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;43&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestMethod&#93;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;44&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;GetSomeValidDataOnlyReturnsValidData&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;45&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;46&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;someDomainService&#32;&#61;&#32;new&#32;SomeDomainService&#40;_mockServiceLocator.Object,&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;47&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;_mockDataService.Object&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;48&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;49&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;results&#32;&#61;&#32;someDomainService.GetSomeValidData&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;50&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;51&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.IsTrue&#40;results.Length&#32;&#61;&#61;&#32;3&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;52&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;foreach&#32;&#40;var&#32;result&#32;in&#32;results&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;53&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;54&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.IsTrue&#40;result&#32;&#61;&#61;&#32;&#38;quot&#59;Valid&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;55&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;56&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;57&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;58&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;59&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;interface&#32;IValidate&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;60&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;61&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;bool&#32;Validate&#38;lt&#59;T&#38;gt&#59;&#40;T&#32;entity&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;62&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;63&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;64&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;SomeDomainService&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;65&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;66&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;readonly&#32;IDataService&#32;_dataService&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;67&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;readonly&#32;IServiceLocator&#32;_serviceLocator&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;68&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;69&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;readonly&#32;IValidate&#32;_validate&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;70&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;71&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;SomeDomainService&#40;IServiceLocator&#32;serviceLocator,&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;72&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;IDataService&#32;dataService&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;73&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;74&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_serviceLocator&#32;&#61;&#32;serviceLocator&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;75&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_dataService&#32;&#61;&#32;dataService&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;76&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;77&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;78&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;SomeDomainService&#40;IValidate&#32;validate&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;79&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;80&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;_validate&#32;&#61;&#32;validate&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;81&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;82&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;83&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;string&#91;&#93;&#32;GetSomeValidData&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;84&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;85&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;validator&#32;&#61;&#32;_serviceLocator&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;86&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;.GetInstance&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;SomeInstanceWithAKey&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;87&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;88&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;IList&#38;lt&#59;string&#38;gt&#59;&#32;data&#32;&#61;&#32;new&#32;List&#38;lt&#59;string&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;89&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;90&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;foreach&#32;&#40;var&#32;result&#32;in&#32;_dataService.GetSomeData&#40;&#41;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;91&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;92&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;if&#32;&#40;validator.Validate&#40;result&#41;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;93&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;94&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;data.Add&#40;result&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;95&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;96&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;97&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;98&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;return&#32;data.ToArray&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;99&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;100&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;101&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;102&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;interface&#32;IDataService&#32;&#38;nbsp&#59;&#38;nbsp&#59;103&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;104&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;string&#91;&#93;&#32;GetSomeData&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;105&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;106&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;">
        
<p>The reason I would need to mock the unity container is because I haven't figured out how to easily configure unity to inject a specific type registered with a key.</p>
<p>&nbsp;</p>
<p>For example, say you want to set up validation that shares the same interface, but you want to use unity to instantiate it so it is easier to test. With unity you can register several types to the same interface with a key.</p>
<p>ie;</p>
<p>unityContainer.RegisterType&lt;IValidate, PersonValidator&gt;(&quot;PersonValidator&quot;);</p>
<p>unityContainer.RegisterType&lt;IValidate, OrderValidator&gt;(&quot;OrderValidator&quot;);</p>
<p>unityContainer.RegisterType&lt;IValidate, ProductValidator&gt;(&quot;ProductValidator&quot;);</p>
<p>&nbsp;</p>
<p>You can't easily set up unity to constructor inject IValidate and get a specific validator.</p>
<p>Like this:</p>
<p>&nbsp;</p>
<div style="background:#202020 none repeat scroll 0% 0%; font-family:Consolas; font-size:10pt; color:#fff5d5">
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;76</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#fa8072">readonly</span>
<span style="color:#2b91af">IValidate</span> _validate;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;77</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> SomeDomainService(<span style="color:#2b91af">IValidate</span> validate)</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;78</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;79</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _validate
<span style="color:silver">=</span> validate;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;80</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>It doesn't know that you actually want,</p>
<p>unityContainer.Resolve&lt;IValidate&gt;(&quot;PersonValidator&quot;);</p>
<p>The problem lies in that when you try to mock, IUnityContainer you get this exeption:</p>
<p>System.BadImageFormatException: An attempt was made to load a program with an incorrect format. (Exception from HRESULT: 0x8007000B).</p>
<p>but it doesn't throw when you run it in debug mode... which is really strange.</p>
<p>I agree that it is much better to load the entire object tree rather than using the container directly in your class. I would actually highly advise against doing this. IMO you should never inject IUnityContainer into a class unless you have a very good
 reason for doing so, such as wiring up you modules on initialization.</p>
<p>If you must mock the behavior of unity or any IoC container for that matter I have found that using IServiceLocator is a much more elegant solution. Here is a quick example please excuse the code it simply demonstrates the ability to mock unity using Microsoft.Practices.ServiceLocation
 - IServiceLocator</p>
<p>&nbsp;</p>
<div style="background:#202020 none repeat scroll 0% 0%; font-family:Consolas; font-size:10pt; color:#fff5d5">
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;1</span>&nbsp;<span style="color:#ff80ff">#region</span> using</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;2</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;3</span>&nbsp;<span style="color:#fa8072">using</span> System<span style="color:silver">.</span>Collections<span style="color:silver">.</span>Generic;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;4</span>&nbsp;<span style="color:#fa8072">using</span> System<span style="color:silver">.</span>Linq;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;5</span>&nbsp;<span style="color:#fa8072">using</span> Microsoft<span style="color:silver">.</span>Practices<span style="color:silver">.</span>ServiceLocation;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;6</span>&nbsp;<span style="color:#fa8072">using</span> Microsoft<span style="color:silver">.</span>VisualStudio<span style="color:silver">.</span>TestTools<span style="color:silver">.</span>UnitTesting;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;7</span>&nbsp;<span style="color:#fa8072">using</span> Moq;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;8</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;&nbsp;9</span>&nbsp;<span style="color:#ff80ff">#endregion</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;10</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;11</span>&nbsp;<span style="color:#fa8072">namespace</span> MockUnity</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;12</span>&nbsp;{</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;13</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#909090">///</span><span style="color:#ffff80"> </span><span style="color:#909090">&lt;summary&gt;</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;14</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#909090">///</span><span style="color:#ffff80"> Summary description for MockUnityFixture</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;15</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#909090">///</span><span style="color:#ffff80"> </span><span style="color:#909090">&lt;/summary&gt;</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;16</span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:#00d2d2">TestClass</span>]</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;17</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">class</span>
<span style="color:#00d2d2">MockUnityFixture</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;18</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;19</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#00d2d2">Mock</span><span style="color:silver">&lt;</span><span style="color:#2b91af">IDataService</span><span style="color:silver">&gt;</span> _mockDataService;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;20</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#00d2d2">Mock</span><span style="color:silver">&lt;</span><span style="color:#2b91af">IServiceLocator</span><span style="color:silver">&gt;</span> _mockServiceLocator;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;21</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#00d2d2">Mock</span><span style="color:silver">&lt;</span><span style="color:#2b91af">IValidate</span><span style="color:silver">&gt;</span> _mockValidator;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;22</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;23</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span style="color:#00d2d2">TestInitialize</span>]</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;24</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">void</span> Setup()</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;25</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;26</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mockValidator
<span style="color:silver">=</span> <span style="color:#fa8072">new</span> <span style="color:#00d2d2">
Mock</span><span style="color:silver">&lt;</span><span style="color:#2b91af">IValidate</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;27</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mockServiceLocator
<span style="color:silver">=</span> <span style="color:#fa8072">new</span> <span style="color:#00d2d2">
Mock</span><span style="color:silver">&lt;</span><span style="color:#2b91af">IServiceLocator</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;28</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mockDataService
<span style="color:silver">=</span> <span style="color:#fa8072">new</span> <span style="color:#00d2d2">
Mock</span><span style="color:silver">&lt;</span><span style="color:#2b91af">IDataService</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;29</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;30</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mockValidator<span style="color:silver">.</span>Setup(mv
<span style="color:silver">=&gt;</span> mv<span style="color:silver">.</span>Validate(<span style="color:#e1dc6f">&quot;Valid&quot;</span>))<span style="color:silver">.</span>Returns(<span style="color:#fa8072">true</span>);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;31</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;32</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mockDataService<span style="color:silver">.</span>Setup(md
<span style="color:silver">=&gt;</span> md<span style="color:silver">.</span>GetSomeData())<span style="color:silver">.</span>Returns(<span style="color:#fa8072">new</span>[]</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;33</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;34</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
<span style="color:#e1dc6f">&quot;Valid&quot;</span>,</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;35</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
<span style="color:#e1dc6f">&quot;Valid&quot;</span>,</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;36</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
<span style="color:#e1dc6f">&quot;InValid&quot;</span>,</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;37</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
<span style="color:#e1dc6f">&quot;Valid&quot;</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;38</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; });</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;39</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mockServiceLocator<span style="color:silver">.</span>Setup(msl
<span style="color:silver">=&gt;</span> msl<span style="color:silver">.</span>GetInstance<span style="color:silver">&lt;</span><span style="color:#2b91af">IValidate</span><span style="color:silver">&gt;</span>(<span style="color:#e1dc6f">&quot;SomeInstanceWithAKey&quot;</span>))<span style="color:silver">.</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;40</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Returns(_mockValidator<span style="color:silver">.</span>Object);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;41</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;42</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;43</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span style="color:#00d2d2">TestMethod</span>]</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;44</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">void</span> GetSomeValidDataOnlyReturnsValidData()</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;45</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;46</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">var</span> someDomainService <span style="color:silver">
=</span> <span style="color:#fa8072">new</span> <span style="color:#00d2d2">SomeDomainService</span>(_mockServiceLocator<span style="color:silver">.</span>Object,</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;47</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; _mockDataService<span style="color:silver">.</span>Object);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;48</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;49</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">var</span> results <span style="color:silver">=</span> someDomainService<span style="color:silver">.</span>GetSomeValidData();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;50</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;51</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#00d2d2">Assert</span><span style="color:silver">.</span>IsTrue(results<span style="color:silver">.</span>Length
<span style="color:silver">==</span> <span style="color:#87df71">3</span>);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;52</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">foreach</span> (<span style="color:#fa8072">var</span> result
<span style="color:#fa8072">in</span> results)</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;53</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;54</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#00d2d2">Assert</span><span style="color:silver">.</span>IsTrue(result
<span style="color:silver">==</span> <span style="color:#e1dc6f">&quot;Valid&quot;</span>);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;55</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;56</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;57</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;58</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;59</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">interface</span>
<span style="color:#2b91af">IValidate</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;60</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;61</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">bool</span> Validate<span style="color:silver">&lt;</span>T<span style="color:silver">&gt;</span>(T entity);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;62</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;63</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;64</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">class</span>
<span style="color:#00d2d2">SomeDomainService</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;65</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;66</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#fa8072">readonly</span>
<span style="color:#2b91af">IDataService</span> _dataService;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;67</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#fa8072">readonly</span>
<span style="color:#2b91af">IServiceLocator</span> _serviceLocator;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;68</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;69</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">private</span> <span style="color:#fa8072">readonly</span>
<span style="color:#2b91af">IValidate</span> _validate;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;70</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;71</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> SomeDomainService(<span style="color:#2b91af">IServiceLocator</span> serviceLocator,</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;72</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#2b91af">IDataService</span> dataService)</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;73</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;74</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _serviceLocator
<span style="color:silver">=</span> serviceLocator;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;75</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _dataService
<span style="color:silver">=</span> dataService;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;76</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;77</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;78</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> SomeDomainService(<span style="color:#2b91af">IValidate</span> validate)</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;79</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;80</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _validate
<span style="color:silver">=</span> validate;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;81</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;82</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;83</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">string</span>[] GetSomeValidData()</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;84</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;85</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">var</span> validator <span style="color:silver">=</span> _serviceLocator</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;86</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:silver">.</span>GetInstance<span style="color:silver">&lt;</span><span style="color:#2b91af">IValidate</span><span style="color:silver">&gt;</span>(<span style="color:#e1dc6f">&quot;SomeInstanceWithAKey&quot;</span>);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;87</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;88</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#2b91af">IList</span><span style="color:silver">&lt;</span><span style="color:#fa8072">string</span><span style="color:silver">&gt;</span> data
<span style="color:silver">=</span> <span style="color:#fa8072">new</span> <span style="color:#00d2d2">
List</span><span style="color:silver">&lt;</span><span style="color:#fa8072">string</span><span style="color:silver">&gt;</span>();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;89</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;90</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">foreach</span> (<span style="color:#fa8072">var</span> result
<span style="color:#fa8072">in</span> _dataService<span style="color:silver">.</span>GetSomeData())</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;91</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;92</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">if</span> (validator<span style="color:silver">.</span>Validate(result))</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;93</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;94</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; data<span style="color:silver">.</span>Add(result);</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;95</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;96</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;97</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;98</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">return</span> data<span style="color:silver">.</span>ToArray();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;&nbsp;99</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;100</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;101</span>&nbsp;</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;102</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">public</span> <span style="color:#fa8072">interface</span>
<span style="color:#2b91af">IDataService</span></p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;103</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;104</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<span style="color:#fa8072">string</span>[] GetSomeData();</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;105</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin:0px"><span style="background:#282828 none repeat scroll 0% 0%; color:#53c7ff">&nbsp;&nbsp;106</span>&nbsp;}</p>
</div>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_195725" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="195738">
    <td id="PostDetailsCell_195738" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post195738"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mvalenty">mvalenty</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="5/29/2009 4:12:18 PM" LocalTimeTicks="1243638738">May 29, 2009 at 4:12 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_195738" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="In&#32;my&#32;original&#32;post,&#32;I&#32;forgot&#32;to&#32;name&#32;the&#32;mock&#32;validator,&#32;it&#32;should&#32;have&#32;been&#58;&#32;realUnityContainer.RegisterInstance&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;AddressValidator&#38;quot&#59;,&#32;mockValidator.Object&#41;&#59;&#32;&#38;gt&#59;&#38;gt&#59;&#32;You&#32;can&#39;t&#32;easily&#32;set&#32;up&#32;unity&#32;to&#32;constructor&#32;inject&#32;IValidate&#32;and&#32;get&#32;a&#32;specific&#32;validator.&#32;This&#32;is&#32;what&#32;I&#32;do&#58;&#32;&#32;unityContainer.RegisterType&#38;lt&#59;IValidate,&#32;PersonValidator&#38;gt&#59;&#40;&#38;quot&#59;PersonValidator&#38;quot&#59;&#41;&#59;&#32;unityContainer.Configure&#38;lt&#59;InjectedMembers&#38;gt&#59;&#40;&#41;.ConfigureInjectionFor&#38;lt&#59;SomeDomainService&#38;gt&#59;&#40;&#32;&#38;nbsp&#59;&#38;nbsp&#59;new&#32;InjectionConstructor&#40;new&#32;ResolvedParameter&#38;lt&#59;IValidate&#38;gt&#59;&#40;&#38;quot&#59;PersonValidator&#38;quot&#59;&#41;&#41;&#41;&#59;&#32;&#32;Granted,&#32;it&#39;s&#32;not&#32;easy&#32;but&#32;that&#39;s&#32;the&#32;way&#32;I&#32;do&#32;it&#32;with&#32;Unity.&#32;&#38;gt&#59;&#38;gt&#59;&#32;I&#32;have&#32;found&#32;that&#32;using&#32;IServiceLocator&#32;is&#32;a&#32;much&#32;more&#32;elegant&#32;solution.&#32;I&#32;agree,&#32;I&#32;have&#32;used&#32;IServiceLocator&#32;for&#32;situations&#32;where&#32;I&#32;needed&#32;to&#32;use&#32;a&#32;the&#32;&#38;quot&#59;service&#32;locator&#38;quot&#59;&#32;pattern&#32;from&#32;within&#32;my&#32;app&#32;but&#32;wanted&#32;to&#32;avoid&#32;using&#32;Unity&#32;directly.">
        
<p>In my original post, I forgot to name the mock validator, it should have been:</p>
<p><code>realUnityContainer.RegisterInstance&lt;IValidate&gt;(<span style="background-color:yellow">&quot;AddressValidator&quot;</span>, mockValidator.Object);</code></p>
<p>&gt;&gt; You can't easily set up unity to constructor inject IValidate and get a specific validator.</p>
<p>This is what I do:</p>
<p><code>unityContainer.RegisterType&lt;IValidate, PersonValidator&gt;(&quot;PersonValidator&quot;);<br>
unityContainer.Configure&lt;InjectedMembers&gt;().ConfigureInjectionFor&lt;SomeDomainService&gt;(<br>
&nbsp;&nbsp;new InjectionConstructor(new ResolvedParameter&lt;IValidate&gt;(&quot;PersonValidator&quot;)));
</code></p>
<p>Granted, it's not easy but that's the way I do it with Unity.</p>
<p>&gt;&gt; I have found that using IServiceLocator is a much more elegant solution.</p>
<p>I agree, I have used IServiceLocator for situations where I needed to use a the &quot;service locator&quot; pattern from within my app but wanted to avoid using Unity directly.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_195738" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="196079">
    <td id="PostDetailsCell_196079" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post196079"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/bittondb">bittondb</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="5/31/2009 2:37:08 AM" LocalTimeTicks="1243762628">May 31, 2009 at 2:37 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_196079" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Why&#32;am&#32;I&#32;mocking&#32;the&#32;Unity&#32;container&#63;&#38;nbsp&#59;&#32;I&#39;m&#32;migrating&#32;the&#32;Composite&#32;Application&#32;Guidance&#32;framework&#32;quickstarts&#32;module&#32;fixture&#32;to&#32;make&#32;use&#32;of&#32;Rhino.&#38;nbsp&#59;&#32;The&#32;test&#32;fixture&#32;for&#32;the&#32;module&#32;itself&#32;checks&#32;to&#32;see&#32;if&#32;the&#32;module&#32;properly&#32;registers&#32;modules&#32;into&#32;the&#32;container.&#38;nbsp&#59;&#32;Frankly&#32;I&#32;think&#32;this&#32;is&#32;a&#32;major&#32;defect&#32;and&#32;if&#32;MS&#32;is&#32;unable&#47;unwilling&#32;to&#32;fix&#32;the&#32;Fx,&#32;then&#32;Unity&#32;should&#32;be&#32;made&#32;to&#32;work&#32;around&#32;the&#32;defect&#32;in&#32;the&#32;Fx.&#38;nbsp&#59;&#32;IMHO,&#32;or&#32;course.">
        
<p>Why am I mocking the Unity container?&nbsp; I'm migrating the Composite Application Guidance framework quickstarts module fixture to make use of Rhino.&nbsp; The test fixture for the module itself checks to see if the module properly registers modules into
 the container.&nbsp; Frankly I think this is a major defect and if MS is unable/unwilling to fix the Fx, then Unity should be made to work around the defect in the Fx.&nbsp; IMHO, or course.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_196079" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="196395">
    <td id="PostDetailsCell_196395" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post196395"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rauh_ryan">rauh_ryan</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="6/1/2009 1:35:57 PM" LocalTimeTicks="1243888557">Jun 1, 2009 at 1:35 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_196395" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#64;bittondb&#32;IServiceLocator&#32;is&#32;a&#32;great&#32;work&#32;around&#32;for&#32;mocking&#32;the&#32;Resolve&#32;functionality&#32;of&#32;Unity.&#32;&#38;gt&#59;&#38;gt&#59;&#32;The&#32;test&#32;fixture&#32;for&#32;the&#32;module&#32;itself&#32;checks&#32;to&#32;see&#32;if&#32;the&#32;module&#32;properly&#32;registers&#32;modules&#32;into&#32;the&#32;container.&#38;nbsp&#59;&#32;Frankly&#32;I&#32;think&#32;this&#32;is&#32;a&#32;major&#32;defect&#32;If&#32;you&#32;intent&#32;is&#32;to&#32;test&#32;if&#32;things&#32;are&#32;registered&#32;properly,&#32;I&#32;don&#39;t&#32;think&#32;it&#32;is&#32;a&#32;defect&#32;at&#32;all.&#32;Instantiating&#32;a&#32;new&#32;container&#32;is&#32;probably&#32;the&#32;best&#32;way&#32;to&#32;go&#32;about&#32;testing&#32;the&#32;container.">
        
<p>@bittondb</p>
<p>IServiceLocator is a great work around for mocking the Resolve functionality of Unity.</p>
<p>&gt;&gt; The test fixture for the module itself checks to see if the module properly registers modules into the container.&nbsp; Frankly I think this is a major defect</p>
<p>If you intent is to test if things are registered properly, I don't think it is a defect at all. Instantiating a new container is probably the best way to go about testing the container.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_196395" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="197500">
    <td id="PostDetailsCell_197500" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post197500"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mvalenty">mvalenty</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="6/4/2009 12:14:11 AM" LocalTimeTicks="1244099651">Jun 4, 2009 at 12:14 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_197500" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;wanted&#32;to&#32;throw&#32;out&#32;the&#32;idea&#32;of&#32;using&#32;a&#32;container&#32;extension&#32;as&#32;another&#32;approach&#32;to&#32;whatever&#32;problem&#32;you&#32;are&#32;trying&#32;to&#32;solve&#32;by&#32;mocking&#32;the&#32;container.&#32;For&#32;example,&#32;I&#32;had&#32;a&#32;situation&#32;where&#32;I&#32;wanted&#32;to&#32;make&#32;sure&#32;I&#32;was&#32;getting&#32;back&#32;the&#32;correct&#32;named&#32;instance&#32;so&#32;I&#32;did&#32;something&#32;like&#58;&#32;&#32;&#38;nbsp&#59;&#32;I&#32;wrote&#32;a&#32;detailed&#32;post&#32;on&#32;using&#32;an&#32;extension&#32;to&#32;accomplish&#32;this&#32;here&#58;&#32;http&#58;&#47;&#47;blog.agileatwork.com&#47;testing-unity-container-configuration&#47;&#32;&#32;&#32;&#91;Test&#93;&#32;public&#32;void&#32;Should_inject_named_instance_of_encryption_provider&#40;&#41;&#32;&#123;&#32;var&#32;service&#32;&#61;&#32;container.Resolve&#38;lt&#59;MyService&#38;gt&#59;&#40;&#41;&#59;&#32;AssertNamedInstanceWasResolved&#38;lt&#59;IEncryptionProvider&#38;gt&#59;&#40;&#38;quot&#59;MyEncryptionProvider&#38;quot&#59;&#41;&#59;&#32;&#125;">
        
<p>I wanted to throw out the idea of using a container extension as another approach to whatever problem you are trying to solve by mocking the container. For example, I had a situation where I wanted to make sure I was getting back the correct named instance
 so I did something like:</p>
<p><span style="word-spacing:0px; font:16px calibri; text-transform:none; color:#000000; text-indent:0px; white-space:normal; letter-spacing:normal; border-collapse:separate; text-align:left"></span></p>
<p>&nbsp;</p>
<p>I wrote a detailed post on using an extension to accomplish this here:</p>
<p><a href="http://blog.agileatwork.com/testing-unity-container-configuration/" rel="nofollow">http://blog.agileatwork.com/testing-unity-container-configuration/</a></p>
<p></p>
<pre style="overflow-y:hidden; font-size:8pt; overflow-x:auto; width:99%; color:black; font-family:'Courier New',Courier,monospace; background-color:#f4f4f4; word-wrap:normal; padding:2px">    [Test]
    <span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> Should_inject_named_instance_of_encryption_provider()
    {
        var service = container.Resolve&lt;MyService&gt;();

        AssertNamedInstanceWasResolved&lt;IEncryptionProvider&gt;(<span style="color:#006080">&quot;MyEncryptionProvider&quot;</span>);
    }</pre>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_197500" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="197670">
    <td id="PostDetailsCell_197670" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post197670"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/derekgreer">derekgreer</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="6/4/2009 11:12:33 AM" LocalTimeTicks="1244139153">Jun 4, 2009 at 11:12 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_197670" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#64;bittondb&#32;The&#32;interface&#32;for&#32;the&#32;Unity&#32;container&#32;shouldn&#39;t&#32;have&#32;to&#32;change&#32;to&#32;accommodate&#32;a&#32;bug&#32;in&#32;the&#32;CLR.&#38;nbsp&#59;&#32;If&#32;anything,&#32;the&#32;mocking&#32;containers&#32;should&#32;attempt&#32;to&#32;create&#32;workarounds&#32;for&#32;this&#32;sort&#32;of&#32;issue&#32;until&#32;it&#32;can&#32;be&#32;resolved&#32;in&#32;the&#32;BCL.&#32;&#64;rauh_ryan&#32;When&#32;testing&#32;whether&#32;a&#32;component&#32;is&#32;registering&#32;things&#32;properly&#32;with&#32;the&#32;container,&#32;this&#32;indeed&#32;seems&#32;the&#32;only&#32;way&#32;to&#32;do&#32;it.&#38;nbsp&#59;&#32;That&#32;said,&#32;what&#32;you&#32;really&#32;want&#32;to&#32;test&#32;is&#32;that&#32;your&#32;component&#32;is&#32;registering&#32;the&#32;appropriate&#32;types,&#32;not&#32;that&#32;the&#32;container&#32;is&#32;working&#32;properly.&#38;nbsp&#59;&#32;Additionally,&#32;there&#32;isn&#39;t&#32;a&#32;clean&#32;way&#32;to&#32;test&#32;whether&#32;types&#32;were&#32;actually&#32;registered&#32;without&#32;mocking&#32;the&#32;interface&#32;or&#32;without&#32;resolving&#32;the&#32;registered&#32;types.&#38;nbsp&#59;&#32;There&#32;is&#32;no&#32;reason&#32;you&#32;should&#32;have&#32;to&#32;instantiate&#32;a&#32;type&#32;in&#32;order&#32;to&#32;see&#32;if&#32;it&#32;was&#32;properly&#32;registered.&#38;nbsp&#59;&#32;There&#32;are&#32;workarounds&#32;for&#32;this&#32;as&#32;well.&#38;nbsp&#59;&#32;Overall,&#32;passing&#32;in&#32;real&#32;instances&#32;of&#32;dependencies&#32;to&#32;the&#32;component&#32;you&#32;are&#32;trying&#32;to&#32;test&#32;isn&#39;t&#32;ideal&#32;in&#32;any&#32;scenario&#32;I&#32;can&#32;think&#32;of.&#32;&#38;nbsp&#59;">
        
<p><span style="font-family:'Segoe UI','sans-serif'; color:black; font-size:10pt">@bittondb The interface for the Unity container shouldn't have to change to accommodate a bug in the CLR.&nbsp; If anything, the mocking containers should attempt to create workarounds
 for this sort of issue until it can be resolved in the BCL.</span></p>
<p><span style="font-family:'Segoe UI','sans-serif'; color:black; font-size:10pt">@rauh_ryan When testing whether a component is registering things properly with the container, this indeed seems the only way to do it.&nbsp; That said, what you really want to
 test is that your component is registering the appropriate types, not that the container is working properly.&nbsp; Additionally, there isn't a clean way to test whether types were actually registered without mocking the interface or without resolving the
 registered types.&nbsp; There is no reason you should have to instantiate a type in order to see if it was properly registered.&nbsp; There are workarounds for this as well.&nbsp; Overall, passing in real instances of dependencies to the component you are
 trying to test isn't ideal in any scenario I can think of.</span></p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_197670" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="198074">
    <td id="PostDetailsCell_198074" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post198074"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="6/5/2009 6:22:09 AM" LocalTimeTicks="1244208129">Jun 5, 2009 at 6:22 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_198074" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;am&#32;well&#32;aware&#32;of&#32;the&#32;lack&#32;of&#32;easily&#32;used&#32;container&#32;introspection&#32;in&#32;Unity.&#32;We&#39;ll&#32;be&#32;adding&#32;a&#32;bunch&#32;of&#32;&#38;quot&#59;IsRegistered&#38;quot&#59;&#32;type&#32;methods&#32;in&#32;Unity&#32;2.0&#32;to&#32;make&#32;testing&#32;if&#32;your&#32;components&#32;registered&#32;the&#32;right&#32;things&#32;a&#32;lot&#32;easier.&#32;I&#32;don&#39;t&#32;have&#32;a&#32;whole&#32;lot&#32;of&#32;interest&#32;in&#32;warping&#32;Unity&#39;s&#32;interface&#32;to&#32;work&#32;around&#32;this&#32;CLR&#32;bug&#32;when&#32;the&#32;actual&#32;affected&#32;code&#32;is&#32;the&#32;mocking&#32;frameworks,&#32;not&#32;Unity&#32;itself.&#32;Especially&#32;when,&#32;as&#32;mentioned&#32;above,&#32;if&#32;you&#39;re&#32;using&#32;DI&#32;correctly&#32;the&#32;actual&#32;container&#32;shouldn&#39;t&#32;be&#32;used&#32;anywhere&#32;except&#32;at&#32;the&#32;very&#32;beginning&#32;of&#32;your&#32;app.&#32;&#38;nbsp&#59;">
        
<p>I am well aware of the lack of easily used container introspection in Unity. We'll be adding a bunch of &quot;IsRegistered&quot; type methods in Unity 2.0 to make testing if your components registered the right things a lot easier.</p>
<p>I don't have a whole lot of interest in warping Unity's interface to work around this CLR bug when the actual affected code is the mocking frameworks, not Unity itself. Especially when, as mentioned above, if you're using DI correctly the actual container
 shouldn't be used anywhere except at the very beginning of your app.</p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_198074" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="198454">
    <td id="PostDetailsCell_198454" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post198454"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/bittondb">bittondb</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="6/6/2009 12:31:09 AM" LocalTimeTicks="1244273469">Jun 6, 2009 at 12:31 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_198454" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Remember&#32;something&#32;here,&#32;I&#39;m&#32;just&#32;porting&#32;the&#32;Quickstarts&#32;that&#32;MSwrote.&#32;I&#39;m&#32;not&#32;really&#32;interesting&#32;in&#32;debating&#32;whether&#32;the&#32;test&#32;itselfis&#32;correct.On&#32;Fri,&#32;Jun&#32;5,&#32;2009&#32;at&#32;2&#58;22&#32;AM,&#32;&#91;email&#32;removed&#93;&#32;wrote&#58;&#38;gt&#59;&#32;From&#58;&#32;ctavares&#38;gt&#59;&#38;gt&#59;&#32;I&#32;am&#32;well&#32;aware&#32;of&#32;the&#32;lack&#32;of&#32;easily&#32;used&#32;container&#32;introspection&#32;in&#32;Unity.&#38;gt&#59;&#32;We&#39;ll&#32;be&#32;adding&#32;a&#32;bunch&#32;of&#32;&#38;quot&#59;IsRegistered&#38;quot&#59;&#32;type&#32;methods&#32;in&#32;Unity&#32;2.0&#32;to&#32;make&#38;gt&#59;&#32;testing&#32;if&#32;your&#32;components&#32;registered&#32;the&#32;right&#32;things&#32;a&#32;lot&#32;easier.&#38;gt&#59;&#38;gt&#59;&#32;I&#32;don&#39;t&#32;have&#32;a&#32;whole&#32;lot&#32;of&#32;interest&#32;in&#32;warping&#32;Unity&#39;s&#32;interface&#32;to&#32;work&#38;gt&#59;&#32;around&#32;this&#32;CLR&#32;bug&#32;when&#32;the&#32;actual&#32;affected&#32;code&#32;is&#32;the&#32;mocking&#32;frameworks,&#38;gt&#59;&#32;not&#32;Unity&#32;itself.&#32;Especially&#32;when,&#32;as&#32;mentioned&#32;above,&#32;if&#32;you&#39;re&#32;using&#32;DI&#38;gt&#59;&#32;correctly&#32;the&#32;actual&#32;container&#32;shouldn&#39;t&#32;be&#32;used&#32;anywhere&#32;except&#32;at&#32;the&#32;very&#38;gt&#59;&#32;beginning&#32;of&#32;your&#32;app.&#38;gt&#59;&#38;gt&#59;&#38;gt&#59;&#38;gt&#59;&#32;Read&#32;the&#32;full&#32;discussion&#32;online.&#38;gt&#59;&#38;gt&#59;&#32;To&#32;add&#32;a&#32;post&#32;to&#32;this&#32;discussion,&#32;reply&#32;to&#32;this&#32;email&#38;gt&#59;&#32;&#40;&#91;email&#32;removed&#93;&#41;&#38;gt&#59;&#38;gt&#59;&#32;To&#32;start&#32;a&#32;new&#32;discussion&#32;for&#32;this&#32;project,&#32;email&#38;gt&#59;&#32;&#91;email&#32;removed&#93;&#38;gt&#59;&#38;gt&#59;&#32;You&#32;are&#32;receiving&#32;this&#32;email&#32;because&#32;you&#32;subscribed&#32;to&#32;this&#32;discussion&#32;on&#38;gt&#59;&#32;CodePlex.&#32;You&#32;can&#32;unsubscribe&#32;on&#32;codePlex.com.&#38;gt&#59;&#38;gt&#59;&#32;Please&#32;note&#58;&#32;Images&#32;and&#32;attachments&#32;will&#32;be&#32;removed&#32;from&#32;emails.&#32;Any&#32;posts&#38;gt&#59;&#32;to&#32;this&#32;discussion&#32;will&#32;also&#32;be&#32;available&#32;online&#32;at&#32;codeplex.com--&#32;---David&#32;B.&#32;BittonCode&#32;No&#32;Evil,&#32;LLCCode&#32;Made&#32;Fresh&#32;Daily.">
        Remember something here, I'm just porting the Quickstarts that MS<br>
wrote. I'm not really interesting in debating whether the test itself<br>
is correct.<br>
<br>
On Fri, Jun 5, 2009 at 2:22 AM, [email removed] wrote:<br>
&gt; From: ctavares<br>
&gt;<br>
&gt; I am well aware of the lack of easily used container introspection in Unity.<br>
&gt; We'll be adding a bunch of &quot;IsRegistered&quot; type methods in Unity 2.0 to make<br>
&gt; testing if your components registered the right things a lot easier.<br>
&gt;<br>
&gt; I don't have a whole lot of interest in warping Unity's interface to work<br>
&gt; around this CLR bug when the actual affected code is the mocking frameworks,<br>
&gt; not Unity itself. Especially when, as mentioned above, if you're using DI<br>
&gt; correctly the actual container shouldn't be used anywhere except at the very<br>
&gt; beginning of your app.<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; Read the full discussion online.<br>
&gt;<br>
&gt; To add a post to this discussion, reply to this email<br>
&gt; ([email removed])<br>
&gt;<br>
&gt; To start a new discussion for this project, email<br>
&gt; [email removed]<br>
&gt;<br>
&gt; You are receiving this email because you subscribed to this discussion on<br>
&gt; CodePlex. You can unsubscribe on codePlex.com.<br>
&gt;<br>
&gt; Please note: Images and attachments will be removed from emails. Any posts<br>
&gt; to this discussion will also be available online at codeplex.com<br>
<br>
<br>
<br>
-- <br>
<br>
---<br>
David B. Bitton<br>
Code No Evil, LLC<br>
<br>
Code Made Fresh Daily.
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_198454" class="Options" >
            
        </div>
        
    </td>
</tr>

</table>
    </div>

    
        <div class="StandardMarginTop">
            <a id="SignInToAddCommentLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f50341">
                Sign in to post message or set email notifications
            </a>
        </div>
    


    <div id="PostEditorContainer">
        <a name="editor"></a>
        <div id="Editor" style="display: none;">
            

<div class="MarkdownEditor" data-options-id="f54e359a-ef6a-4369-bf2a-16b2afcd07d3">
    <script class="options" defer="defer" id="f54e359a-ef6a-4369-bf2a-16b2afcd07d3" type="application/json">{"maxLength":10000,"styleSheetLocation":""}</script>

    <div class="MarkdownEditorControls">
        <a href="#" tabindex="-1" class="control md_help" title="Markdown Syntax Guide"></a>
        <div class="control md_divider"></div>
        <a href="#" tabindex="-1" class="control md_header" title="Insert Header (CTRL + H)"></a>
        <a href="#" tabindex="-1" class="control md_code" title="Insert Code (CTRL + K)"></a>
        <a href="#" tabindex="-1" class="control md_quote" title="Insert Quote (CTRL + Q)"></a>
        <a href="#" tabindex="-1" class="control md_img" title="Insert Img (CTRL + G)"></a>
        <a href="#" tabindex="-1" class="control md_link" title="Insert Link (CTRL + L)"></a>
        <a href="#" tabindex="-1" class="control md_ulist" title="Unordered List (CTRL + U)"></a>
        <a href="#" tabindex="-1" class="control md_olist" title="Ordered List (CTRL + O)"></a>
        <a href="#" tabindex="-1" class="control md_italics" title="Italic Text (CTRL + I)"></a>
        <a href="#" tabindex="-1" class="control md_bold" title="Bold Text (CTRL + B)"></a>
    </div>

    

<div class="tab_control">
    <!-- Generate the basic HTML for the tabs. -->
    
        <div id="Compose"
              class="tab selected"
              data-custom-header-id=""
              data-tab-contents-id="compose_contents_8384e5ad-a7b3-4bec-8d59-12986a4c52b4">
            Compose
        </div>
    
        <div id="Preview"
              class="tab "
              data-custom-header-id=""
              data-tab-contents-id="preview_contents_0d216af5-cdff-4955-8e60-449b46253ef3">
            Preview
        </div>
    
    <div class="clear"></div>
</div>


    <div id="compose_contents_8384e5ad-a7b3-4bec-8d59-12986a4c52b4" class="compose_tab_content">
        <textarea class=" MarkdownEditorDimensions" cols="20" id="MarkdownEditor" name="content" rows="2">
</textarea>
        <div class="ClearBoth"></div>

        <div class="markdownGuide" style="display: none">
            <table>
                <tr>
                    <td class="markdownGuideColumn">
                        <h1>Text Formatting</h1>
                        <div># Header 1</div>
                        <div>## Header 2</div>
                        <br />
                        <div>*italics* (or _italics_)</div>
                        <div>**bold** (or __bold__)</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Lists</h1>
                        <div>* Unordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp * SubItem</div>
                        <br />
                        <div>1. Ordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1. SubItem</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Quotes</h1>
                        <div>> Lorem ipsum</div>
                        <div>dolor sitamet </div>
                        <div>non. Lectus at</div>
                        <div>nam nunc...</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Code</h1>
                        <div>`Inline Code`</div>
                        <br />
                        <div>``` C#</div>
                        <div>if (foo==bar)</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbar++</div>
                        <div>```</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>References</h1>
                        <div>[Link Text](URL)</div>
                        <br />
                        <div>![Image](URL)</div>
                        <br />
                        <a class="Reference" target="_blank" href="http://codeplex.codeplex.com/wikipage?title=Markdown&referringTitle=Documentation">Markdown Reference</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="preview_contents_0d216af5-cdff-4955-8e60-449b46253ef3" class="preview_tab_content markDownOutput">
        
            <div></div>
        
    </div>
    <div class="clear"></div>
</div>

            
            <div class="row" id="recaptcha_row">
                
<script type="text/javascript">
    $(document).ready(function () {
        $('#recaptcha_reload').attr('src', '../assets/recaptcha_refresh.png');
        $('#recaptcha_switch_audio').attr('src', '../assets/recaptcha_audio.png');
        $('#recaptcha_switch_img').attr('src', '../assets/recaptcha_text.png');
        $('#recaptcha_whatsthis').attr('src', '../assets/recaptcha_help.png');
        $('#recaptcha_area tr:first').attr('height', '35');
    });
</script>

                <div class="clear"></div>
                <span id="ReCaptchaError"></span>
            </div>
            <div style="padding-top: 6px;">
                <input type="button" id="SaveButton" value="Save" class="ok" />
                <input type="button" id="CancelButton" value="Cancel" class="cancel" />
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div id="DeletePostPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Post <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this post? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="ClosePostCancel" value="Cancel" class="cancel" />
            <input type="button" id="ClosePostOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>
        
            <!-- Email notification / Subscription details -->
            
    </div>
</div>
    
<div id="DeleteThreadPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Thread <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this thread? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="CloseThreadCancel" value="Cancel" class="cancel" />
            <input type="button" id="CloseThreadOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(function () {

        $('#recaptcha_response_field')
            .bind('keypress', function (event) { return $submitKeyPressElement(this, event); });


        if ($('#DeleteThreadLink')) {
            $('#DeleteThreadLink').click(function () {
                OpenDialog('#DeleteThreadPanel', true, '41em');
            });
        }
        
        $('#DeleteThreadPanel #CloseThreadOk').click(function () {
            var url = 'http://unity.codeplex.com/discussions/50341';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (x) {
                    location.href = x.RedirectUrl;
                }
            });
        });
    });

    workItemMention = new codeplex.ui.WorkItemMention();
    workItemMention.addLinks(".discussionPost");
</script>


        
        
                
                <div class="clear"></div>
                
                <div id="footer">
                    <div class="row">
                        <hr />
                        <ul>
                            <li>Â© 2006-2017 Microsoft</li>
                            <li><a href="http://www.codeplex.com/site/help">Get Help</a></li>
                            <li><a href="/site/legal/privacy">Privacy Statement</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/terms">Terms of Use</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/conduct">Code of Conduct</a></li>
                            <li><a href="http://developermedia.com/" target="_blank">Advertise With Us</a></li>
                            <li>Version 2017.10.3.21062</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </body>

</html>