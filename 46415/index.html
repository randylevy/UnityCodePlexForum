

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="" prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile#">
    
    
    
    

    
    <head>
        <meta id="CompatabilityMode" http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../assets/StyleSheet.css" id="MasterCss" rel="stylesheet" type="text/css" />
        <link rel="SHORTCUT ICON" href="../assets/favicon.ico" />
        <title>patterns &#38; practices - Unity - Child container questions</title>
        
       
                    <script src="../assets/mscc-0.3.6.min.js"></script>
        
                    <link rel="stylesheet" type="text/css" href="../assets/mscc-0.3.6.min.css" />
        
            <script type="text/javascript">
                var msccHadCookieBannerAtPageStart = true;
            </script>
        

        <!--
        Third party scripts and code linked to or referenced from this website are licensed to you by the parties that own such code,
        not by Microsoft.  See ASP.NET Ajax CDN Terms of Use â€“ http://www.asp.net/ajaxlibrary/CDN.ashx.
        -->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.4.4.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.6/jquery-ui.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery.ui === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        
    <style type="text/css">.SideBar, .SideBarPadding{display:none;}.MainContent{width:auto;}.SiteContentTable{width:100%;}</style>
    <style id="ProjectStyles" type="text/css">
        .SiteHeader, .SiteHeaderLeft {
            height:45px !important;
            overflow:hidden;
        }
        .SiteContent 
        {
            padding: 0 0 1em 0;
            margin-top:0;
            min-height:225px;
            border-right: 1px solid lightgrey;
            border-left: 1px solid lightgrey;
            border-bottom: 1px solid lightgrey;
        }
        .IE table.MinWidthContent
        {
	        table-layout: auto !important;	
        }
    </style>
    
    
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">

    
    
    <meta id="WTProjectName" name="WT.pi" content="unity"/>
    

    <link rel="EditURI" type="application/rsd+xml" title="RSD" href='http://unity.codeplex.com/rsd' />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href='/wlwmanifest.xml' />
    
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity" url="http://unity.codeplex.com/project/feeds/rss"/>
    
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Discussions" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Issues" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Downloads" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Reviews" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity"/>
        
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Source&#32;code" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Wiki" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity"/>
    
        
    
        <meta content="summary" name="twitter:card" /><meta content="@CodePlex" name="twitter:site" /><meta content="http://unity.codeplex.com/discussions/46415?ProjectName=unity" name="twitter:url" /><meta content="patterns &amp;#38; practices - Unity" name="twitter:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" name="twitter:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" name="twitter:image" /><meta content="CodePlex" property="og:site_name" /><meta content="http://unity.codeplex.com/discussions/46415?ProjectName=unity" property="og:url" /><meta content="object" property="og:type" /><meta content="patterns &amp;#38; practices - Unity" property="og:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" property="og:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" property="og:image" />
        

    </head>
    
    <body>
         
            
        <script src="../assets/ScriptLoader.js" type="text/javascript"></script>
        <form id="aspnetForm" autocomplete="off" method="POST" enctype="multipart/form-data">
            <input name="__RequestVerificationToken" type="hidden" value="PWjtF4lDZ5slYu7bkHcDkGvzoArygFR-RAjFjg6Q-JI1-aXSmMrRyQEVU_L7ZlJqKuZ98PDO61-brkr-nQCqaTMlgbeGp8hF93en1shFA57yaMlcv1eFW1hvjmVq69nEUf2j9A2" /><input name="__RequestVerificationToken2" type="hidden" value="__RequestVerificationToken27160b6f5-e416-457a-9bbd-65cccc644746" />
            
            <div id="UpdateProgressPanel" class="loading_animation" style="display:none;">
                <div class="row">
                    <h2 class="anim_h2">
                        <span id="UpdateProgressText">Updating...</span>
                        <span id="animatedLoadingIconContainer">
                            <img id="animatedLoadingIcon" src="../assets/loading_animation.gif" class="anim_img"/>
                        </span>
                    </h2>
                </div>
            </div>
            
            <div style="display:none;">
                
                <img id="BlankImage" style="width:0;height:0;" src="../assets/blank.png" onload="self.logoImageLoaded=true;"/>

                <script language="javascript" type="text/javascript">
                    var date = new Date();
                    var timezoneOffset = date.getTimezoneOffset() / 60 * -1;
                    var timezoneOffsetCookie = getCookie("TimezoneOffset");
                    var firstTimeSetTimezoneCookie = false;

                    if (timezoneOffsetCookie == null || timezoneOffsetCookie != timezoneOffset) {
                        firstTimeSetTimezoneCookie = true;
                        document.cookie = "TimezoneOffset=" + timezoneOffset + '; domain=.codeplex.com;expires=Wed, 10 Oct 2018 05:27:16 UTC';
                    }
                </script>
            </div>
            
            
            <div id="banner">
                <div id="message"><strong>This is an archived copy of the original CodePlex Unity Discussion Forum.</strong> <a href="https://github.com/unitycontainer/">Unity is now on GitHub</a>
                    
                </div>
            </div>
            

            <div id="header">
                <div id="header_wrap" class="row">
                    <p id="logo"><a href="http://www.codeplex.com">Code<span class="semi">Plex</span></a><span id="tagline">Project Hosting for Open Source Software</span></p>
                    

<ul id="nav">

    <li><a href="/site/register/new" id="registerLink" class="ZoomFix">Register</a></li>
    <li ><a class="SignInLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f46415" id="signInLink">Sign In</a></li>
  
    <li class="last"><a class="rss_site_icon" href="http://www.codeplex.com/site/feeds/rss" type="application/rss+xml" rel="Alternate" title="CodePlex Site Activity"></a></li>
</ul>
                    <input id="searchsite" name="searchsite" maxlength="500" type="text" value="" /><span id="search_mag"><a id="submitSearch" name="submitSearch" class="magnify" title="Search" href="#"></a></span>
                    <script>
	$(document).ready(function() {
    var searchButton = $('#submitSearch'),
        searchBar = $('#searchsite');

    // Register our own handler for the search event while we wait for the SearchBox script to load.
    searchButton.bind('click.backupSearchBox', doProjectSearch);
    searchBar.bind('keypress.backupSearchBox', function(e) { if ($keyCode(e) === 13) { doProjectSearch(); return false; } });

    function cleanupSearchEvents() {
        // If the SearchBox was loaded, unregister our handlers.
        if (epx_loaded) {
            searchButton.unbind('.backupSearchBox');
            searchBar.unbind('.backupSearchBox');
        }
    }

    $loadScript('https://i4.services.social.microsoft.com/search/Widgets/SearchBox.jss?appid=1000&scopeid=1&boxId=searchsite&btnId=submitSearch&watermark=Search%20all%20projects&overrideWatermark=true&searchLocation=https%3A%2F%2Fwww.codeplex.com%2Fsite%2Fsearch&allowEmptySearch=true&focusOnInit=False&minimumTermLength=3', cleanupSearchEvents);
})
function doProjectSearch() {
    
    var url = 'https://www.codeplex.com/site/search';

    //If search term is not same as watermark
    if($('#searchsite').val() != 'Search all projects')    
    {        
        url = url + '?query=' + encodeURIComponent($('#searchsite').val());
    }

    
    var callback = '';
    if (callback.length > 0 && eval('typeof ' + callback) != 'undefined')
        url += eval(callback + '()');

    window.location.href = url;
    return false;
}
</script>
                </div>
            </div>
            
            <div id="wrap">
                
    <div id="sub_heading" class="row">
        
        <div id="ProjectHeader">
            <div id="project_title_row" class="row">
                <div id="project_logo">
                    
<a id="AffiliateLink" href="http://msdn.microsoft.com/practices">
    <img id="AffiliateImage" src="../assets/pnp_logo.png" title="patterns&#32;&#38;&#32;practices" />
</a>

    
    <h1 class="text_only"><a href="http://unity.codeplex.com/" id="ProjectTitle1"><div>patterns &#38; practices - Unity</div></a></h1>

                </div>
            </div>
        </div>
        
        <div id="ProjectDetailsDiv">
            
        </div>
		<div class="clear"></div>
        

<ul id="page_box_links">
	<li id="homeTabCell" style="width: 63px;"><a id="homeTab" href="http://unity.codeplex.com/" class="box_home">home</a><div></div></li>
    
	<li id="sourceTabCell" style="width:113px;"><a id="sourceTab" href="http://unity.codeplex.com/SourceControl/latest" class="box_source">source code</a><div></div></li>
    
	<li id="releasesTabCell" style="width:105px;"><a id="releasesTab" href="http://unity.codeplex.com/releases" class="box_downloads">downloads</a><div></div></li>
    
    <li id="documentationTabCell" style="width:143px;"><a id="documentationTab" href="http://unity.codeplex.com/documentation" class="box_documentation">documentation</a><div></div></li>
    
	<li id="discussionTabCell" style="width:112px;"><a id="discussionTab" href="../index.html" class="discussions_active">discussions</a><div></div></li>
    
	<li id="workItemsTabCell" style="width:70px;"><a id="workItemsTab" href="http://unity.codeplex.com/workitem/list/basic" class="box_issue">issues</a><div></div></li>
    
	<li id="peopleTabCell" style="width:70px;"><a id="peopleTab" href="http://unity.codeplex.com/team/view" class="box_people">people</a><div></div></li>
	<li id="licenseTabCell" style="width:70px;"><a id="licenseTab" href="http://unity.codeplex.com/license" class="box_license">license</a><div></div></li>
    
    <span class="stretch"></span>
</ul>

<script type="text/javascript">
    $(document).ready(function () {
        $('#page_box_links').applyLastClassToList();
    });
</script>
		    <div class="clear"></div>
            
     <td>
       

<div>
    
    <div id="actionBar" class="action_bar">
        <ul id="actionBar_ul" class="actionBar_sublinks subtab_right" style="vertical-align: middle;">

            

                <li id="li_actionbar_creatediscussion" data-action-id="actionbar_creatediscussion" data-action-type="Navigate" class="actionBar_sublinks" data-options-id="6465aa9e-beee-49b1-aa13-ad8c9050f5ad">
                
                    <script class="options" defer="defer" id="6465aa9e-beee-49b1-aa13-ad8c9050f5ad" type="application/json">{"navigate-url":"http://unity.codeplex.com/discussions/create"}</script> 
                    
                    <div class="actionBar_custom_content"></div>

                    <a href="#" id="actionbar_creatediscussion" title="Start a New Thread" class="action_bar_item_link">
                        <img id="img_actionbar_creatediscussion" class="action_bar_item_image" src="../assets/actionbar_newitem.png" style="vertical-align: middle" />
                        New Thread
                    </a>

                </li>

            

                <li id="li_actionbar_subscribe" data-action-id="actionbar_subscribe" data-action-type="PopUp" class="actionBar_sublinks" data-options-id="2f1cb6aa-0d3d-4cf0-8a99-9caac7997694">
                
                    <script class="options" defer="defer" id="2f1cb6aa-0d3d-4cf0-8a99-9caac7997694" type="application/json">{}</script> 
                    
                    <div class="actionBar_custom_content">

<div id="rssHoverDiv" class="HoverPanel LeftHoverWidth" style="display: none">
        <ul id="3_FeedsPanel" class="RssFeedsPanel">
            <li>
                <a id="ProjectRssLink" href="http://unity.codeplex.com/project/feeds/rss" class="ArrowSmall NoUnderline">All Project Updates</a>
            </li>
            
            <li>
                <a id="DiscussionRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity" class="ArrowSmall NoUnderline">Discussions</a>
            </li>
            
            <li>
                <a id="IssueTrackerRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity" class="ArrowSmall NoUnderline">Issue Tracker</a>
            </li>
            
            <li>
                <a id="ReleasesRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity" class="ArrowSmall NoUnderline">Downloads</a>
            </li>
            <li>
                <a id="ReviewsRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity" class="ArrowSmall NoUnderline">Reviews</a>
            </li>
            
            <li>
                <a id="SourceControlRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity" class="ArrowSmall NoUnderline">Source Code</a>
            </li>
            <li>
                <a id="WikiRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity" class="ArrowSmall NoUnderline">Wiki &amp; Documentation</a>
            </li>
        </ul>
</div></div>

                    <a href="#" id="actionbar_subscribe" title="Subscribe to project updates in RSS feeds." class="action_bar_item_link">
                        <img id="img_actionbar_subscribe" class="action_bar_item_image" src="../assets/actionbar_subscribe.png" style="vertical-align: middle" />
                        Subscribe
                    </a>

                </li>

            
        </ul>
    </div>
</div>
     </td>

        

    </div>
    
    
<div class="Threads">
    <div class="ViewThread">
        
        
        
            <h1 class="page_title WordWrapBreakWord">
                Child container questions
            </h1>

            <!-- Private Discussion header -->
            

            <!-- Posts List Header: Topics and Wiki Link -->
            <table class="PostsListHeader">
                <tr>
                    <td>
                     
                    </td>
                    <td>
                        <div class="WikiLink">
                            <span title="Paste this into a wiki page to link to this discussion">
                                Wiki Link: [discussion:46415]
                            </span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- The list of posts -->
            

<div id="discussionsPostList" data-options-id="454441cc-d019-48f7-ad52-25646d56596c">
    <script class="options" defer="defer" id="454441cc-d019-48f7-ad52-25646d56596c" type="application/json">{"threadUrl":"http://unity.codeplex.com/discussions/46415","showEditor":false,"checkImageUrl":"../assets/check_answer.png"}</script>

    <div class="Posts" style="margin-top: 10px;">
    

<table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 0px; table-layout:fixed">
    

<tr id="PostPanel" class="Post" d:forid="155024">
    <td id="PostDetailsCell_155024" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155024"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/6/2009 11:04:16 AM" LocalTimeTicks="1233947056">Feb 6, 2009 at 11:04 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155024" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;have&#32;an&#32;&#38;quot&#59;object&#32;space&#38;quot&#59;&#32;&#40;which&#32;is&#32;like&#32;a&#32;unit&#32;of&#32;work&#32;&#43;&#32;local&#32;caching&#41;.&#38;nbsp&#59;&#32;So&#32;far&#32;I&#32;have&#32;been&#32;creating&#32;interfaces&#32;like&#32;this&#32;&#32;public&#32;interface&#32;IPersonRepository&#32;&#123;&#32;&#38;nbsp&#59;&#32;Person&#32;GetByID&#40;IMyObjectSpace&#32;objectSpace,&#32;int&#32;id&#41;&#59;&#32;&#125;&#32;&#32;It&#32;is&#32;essential&#32;that&#32;the&#32;object&#32;space&#32;it&#32;passed&#32;in&#32;whenever&#32;domain&#32;objects&#32;are&#32;worked&#32;with&#32;otherwise&#32;I&#32;lose&#32;my&#32;&#38;quot&#59;context&#38;quot&#59;.&#38;nbsp&#59;&#32;What&#32;has&#32;dawned&#32;on&#32;me&#32;though&#32;is&#32;that&#32;I&#32;could&#32;create&#32;a&#32;child&#32;container&#32;that&#32;has&#32;the&#32;instance&#32;of&#32;IMyObjectSpace&#32;registered&#32;in&#32;it&#32;instead.&#38;nbsp&#59;&#32;But&#32;this&#32;leads&#32;me&#32;to&#32;the&#32;following&#32;question&#58;&#32;&#32;If&#32;IPersonRepository&#32;is&#32;registered&#32;in&#32;the&#32;main&#32;container,&#32;when&#32;I&#32;request&#32;it&#32;in&#32;my&#32;child&#32;container&#32;it&#32;will&#32;retrieve&#32;it&#32;from&#32;the&#32;parent&#32;container&#32;wont&#32;it&#63;&#38;nbsp&#59;&#32;So&#32;when&#32;PersonRepositoryImpl&#32;is&#32;created,&#32;expecting&#32;IMyObjectSpace&#32;it&#32;will&#32;try&#32;to&#32;resolve&#32;it&#32;in&#32;the&#32;parent&#32;container&#32;and&#32;not&#32;the&#32;child&#32;container&#32;that&#32;initiated&#32;the&#32;request.&#38;nbsp&#59;&#32;Is&#32;there&#32;any&#32;way&#32;I&#32;can&#32;control&#32;this&#63;&#32;&#32;&#32;Pete&#32;">
        I have an &quot;object space&quot; (which is like a unit of work &#43; local caching).&nbsp; So far I have been creating interfaces like this<br>
<br>
public interface IPersonRepository<br>
{<br>
&nbsp; Person GetByID(IMyObjectSpace objectSpace, int id);<br>
}<br>
<br>
It is essential that the object space it passed in whenever domain objects are worked with otherwise I lose my &quot;context&quot;.&nbsp; What has dawned on me though is that I could create a child container that has the instance of IMyObjectSpace registered
 in it instead.&nbsp; But this leads me to the following question:<br>
<br>
If IPersonRepository is registered in the main container, when I request it in my child container it will retrieve it from the parent container wont it?&nbsp; So when PersonRepositoryImpl is created, expecting IMyObjectSpace it will try to resolve it in the
 parent container and not the child container that initiated the request.&nbsp; Is there any way I can control this?<br>
<br>
<br>
Pete 
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155024" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="155159">
    <td id="PostDetailsCell_155159" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155159"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/6/2009 6:07:00 PM" LocalTimeTicks="1233972420">Feb 6, 2009 at 6:07 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155159" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="The&#32;answer&#32;depends&#32;on&#32;what&#32;you&#32;mean&#32;by&#32;&#38;quot&#59;registered&#32;int&#32;the&#32;main&#32;container.&#38;quot&#59;&#32;The&#32;real&#32;issue&#32;is&#32;the&#32;lifetime&#32;manager&#32;being&#32;used&#32;and&#32;which&#32;container&#32;it&#39;s&#32;configured&#32;in&#59;&#32;the&#32;injection&#32;configuration&#32;doesn&#39;t&#32;affect&#32;this.&#32;&#32;If&#32;IPersonRepository&#32;is&#32;registered&#32;with&#32;the&#32;ContainerControlledLifetimeManager&#32;in&#32;the&#32;parent&#32;container,&#32;and&#32;then&#32;you&#32;resolve&#32;it&#32;through&#32;the&#32;child&#32;container,&#32;then&#32;it&#39;ll&#32;end&#32;up&#32;storing&#32;that&#32;child&#39;s&#32;instance&#32;in&#32;the&#32;parent&#32;container,&#32;and&#32;result&#32;in&#32;the&#32;issue&#32;you&#39;re&#32;worrying&#32;about.&#32;&#32;If&#32;IPersonRepository&#32;is&#32;registered&#32;with&#32;the&#32;ContainerControlledLifetimeManager&#32;in&#32;the&#32;child&#32;container,&#32;and&#32;then&#32;you&#32;resolve&#32;through&#32;the&#32;child&#32;container,&#32;that&#32;instance&#32;will&#32;be&#32;stored&#32;in&#32;the&#32;child&#32;container,&#32;not&#32;in&#32;the&#32;parent.&#32;Future&#32;resolves&#32;through&#32;the&#32;child&#32;container&#32;will&#32;get&#32;the&#32;proper&#32;instance.&#32;&#32;If&#32;IPersonRepository&#32;is&#32;transient&#32;&#40;the&#32;default&#41;&#32;then&#32;a&#32;new&#32;one&#32;will&#32;be&#32;built&#32;every&#32;time&#32;and&#32;you&#39;ll&#32;be&#32;fine.&#32;&#32;So,&#32;the&#32;thing&#32;to&#32;remember&#32;is&#32;if&#32;you&#39;re&#32;using&#32;child&#32;containers,&#32;don&#39;t&#32;set&#32;lifetimes&#32;in&#32;the&#32;parent&#32;container,&#32;only&#32;set&#32;it&#32;in&#32;the&#32;children&#32;&#40;unless&#32;it&#39;s&#32;something&#32;you&#32;definately&#32;want&#32;shared&#32;across&#32;all&#32;the&#32;child&#32;containers&#41;.&#32;&#32;Hope&#32;this&#32;helps,&#32;&#32;-Chris&#32;&#32;">
        The answer depends on what you mean by &quot;registered int the main container.&quot; The real issue is the lifetime manager being used and which container it's configured in; the injection configuration doesn't affect this.<br>
<br>
If IPersonRepository is registered with the ContainerControlledLifetimeManager in the parent container, and then you resolve it through the child container, then it'll end up storing that child's instance in the parent container, and result in the issue you're
 worrying about.<br>
<br>
If IPersonRepository is registered with the ContainerControlledLifetimeManager in the child container, and then you resolve through the child container, that instance will be stored in the child container, not in the parent. Future resolves through the child
 container will get the proper instance.<br>
<br>
If IPersonRepository is transient (the default) then a new one will be built every time and you'll be fine.<br>
<br>
So, the thing to remember is if you're using child containers, don't set lifetimes in the parent container, only set it in the children (unless it's something you definately want shared across all the child containers).<br>
<br>
Hope this helps,<br>
<br>
-Chris<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155159" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="155221">
    <td id="PostDetailsCell_155221" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155221"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/6/2009 9:40:14 PM" LocalTimeTicks="1233985214">Feb 6, 2009 at 9:40 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155221" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;Let&#39;s&#32;say&#32;I&#32;register&#32;IPersonRepository&#32;in&#32;the&#32;main&#32;container&#32;using&#32;a&#32;transient&#32;lifetime,&#32;to&#32;ensure&#32;that&#32;the&#32;&#38;quot&#59;object&#32;space&#38;quot&#59;&#32;is&#32;injected&#32;each&#32;time&#32;I&#32;request&#32;it.&#38;nbsp&#59;&#32;Now&#32;I&#32;create&#32;a&#32;child&#32;container&#32;and&#32;in&#32;that&#32;container&#32;I&#32;register&#32;an&#32;instance&#32;&#40;my&#32;object&#32;space&#41;.&#38;nbsp&#59;&#32;If&#32;I&#32;ask&#32;my&#32;child&#32;container&#32;for&#32;IPersonRepository&#32;which&#32;of&#32;the&#32;following&#32;will&#32;happen&#63;&#32;&#32;A&#58;&#32;Child&#32;container&#32;doesn&#39;t&#32;have&#32;IPersonRepository&#32;so&#32;asks&#32;its&#32;parent&#32;container.&#38;nbsp&#59;&#32;Parent&#32;container&#32;sees&#32;it&#32;is&#32;transient&#32;and&#32;creates&#32;an&#32;instance.&#38;nbsp&#59;&#32;Sees&#32;it&#32;needs&#32;ObjectSpace&#32;as&#32;a&#32;constructor&#32;parameter&#32;but&#32;cannot&#32;find&#32;it&#32;because&#32;there&#32;isn&#39;t&#32;one&#32;in&#32;the&#32;parent&#32;container.&#32;B&#58;&#32;As&#32;above,&#32;but&#32;when&#32;it&#32;needs&#32;to&#32;resolve&#32;other&#32;dependencies&#32;it&#32;starts&#32;at&#32;the&#32;child&#32;container&#32;again&#32;and&#32;finds&#32;the&#32;ObjecSpace&#32;&#32;I&#39;m&#32;just&#32;trying&#32;to&#32;understand&#32;how&#32;it&#32;works.&#32;&#32;Thanks&#32;">
        Hi Chris<br>
<br>
Let's say I register IPersonRepository in the main container using a transient lifetime, to ensure that the &quot;object space&quot; is injected each time I request it.&nbsp; Now I create a child container and in that container I register an instance (my object
 space).&nbsp; If I ask my child container for IPersonRepository which of the following will happen?<br>
<br>
A: Child container doesn't have IPersonRepository so asks its parent container.&nbsp; Parent container sees it is transient and creates an instance.&nbsp; Sees it needs ObjectSpace as a constructor parameter but cannot find it because there isn't one in the
 parent container.<br>
B: As above, but when it needs to resolve other dependencies it starts at the child container again and finds the ObjecSpace<br>
<br>
I'm just trying to understand how it works.<br>
<br>
Thanks<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155221" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="155223">
    <td id="PostDetailsCell_155223" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155223"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/6/2009 9:49:31 PM" LocalTimeTicks="1233985771">Feb 6, 2009 at 9:49 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155223" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;think&#32;this&#32;simple&#32;code&#32;demonstrates&#32;my&#32;answer&#58;&#32;&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Text&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;&#32;namespace&#32;ConsoleApplication24&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;class&#32;Program&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;static&#32;void&#32;Main&#40;string&#91;&#93;&#32;args&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;UnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPersonRepository,&#32;PersonRepository&#38;gt&#59;&#40;new&#32;TransientLifetimeManager&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;childContainer&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;childContainer.RegisterInstance&#38;lt&#59;ObjectSpace&#38;gt&#59;&#40;new&#32;ObjectSpace&#32;&#123;&#32;Name&#32;&#61;&#32;&#38;quot&#59;Hello&#38;quot&#59;&#32;&#125;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;repository&#32;&#61;&#32;childContainer.Resolve&#38;lt&#59;IPersonRepository&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;repository.ObjectSpaceName&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.ReadLine&#40;&#41;&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;interface&#32;IPersonRepository&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;string&#32;ObjectSpaceName&#32;&#123;&#32;get&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;PersonRepository&#32;&#58;&#32;IPersonRepository&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;readonly&#32;ObjectSpace&#32;ObjectSpace&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;PersonRepository&#40;ObjectSpace&#32;objectSpace&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;ObjectSpace&#32;&#61;&#32;objectSpace&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;string&#32;ObjectSpaceName&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;get&#32;&#123;&#32;return&#32;ObjectSpace.Name&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;ObjectSpace&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;string&#32;Name&#32;&#123;&#32;get&#59;&#32;set&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#125;&#32;&#32;&#32;It&#32;shows&#32;that&#32;the&#32;PersonRepository&#32;&#42;IS&#42;&#32;fixed&#32;up&#32;with&#32;references&#32;from&#32;the&#32;child&#32;repository,&#32;so&#32;that&#39;s&#32;a&#32;good&#32;thing.&#38;nbsp&#59;&#32;So&#32;what&#32;I&#32;need&#32;to&#32;know&#32;now&#32;is&#32;what&#32;is&#32;a&#32;good&#32;way&#32;to&#32;manage&#32;child&#32;container&#32;life&#32;times&#63;&#38;nbsp&#59;&#32;Are&#32;they&#32;automatically&#32;collected&#32;when&#32;I&#32;no&#32;longer&#32;hold&#32;a&#32;reference&#32;to&#32;them,&#32;or&#32;does&#32;the&#32;parent&#32;container&#32;hold&#32;a&#32;reference&#32;to&#32;them&#32;and&#32;keep&#32;them&#32;alive&#63;&#32;&#32;&#32;Thanks&#32;&#58;-&#41;&#32;&#32;">
        I think this simple code demonstrates my answer:<br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.Text;<br>
using Microsoft.Practices.Unity;<br>
<br>
namespace ConsoleApplication24<br>
{<br>
&nbsp;&nbsp; &nbsp;class Program<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;static void Main(string[] args)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;UnityContainer container = new UnityContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;container.RegisterType&lt;IPersonRepository, PersonRepository&gt;(new TransientLifetimeManager());<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var childContainer = container.CreateChildContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;childContainer.RegisterInstance&lt;ObjectSpace&gt;(new ObjectSpace { Name = &quot;Hello&quot; });<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var repository = childContainer.Resolve&lt;IPersonRepository&gt;();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(repository.ObjectSpaceName);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.ReadLine();<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public interface IPersonRepository<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;string ObjectSpaceName { get; }<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class PersonRepository : IPersonRepository<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;readonly ObjectSpace ObjectSpace;<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public PersonRepository(ObjectSpace objectSpace)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ObjectSpace = objectSpace;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public string ObjectSpaceName<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;get { return ObjectSpace.Name; }<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class ObjectSpace<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public string Name { get; set; }<br>
&nbsp;&nbsp; &nbsp;}<br>
}<br>
<br>
<br>
It shows that the PersonRepository *IS* fixed up with references from the child repository, so that's a good thing.&nbsp; So what I need to know now is what is a good way to manage child container life times?&nbsp; Are they automatically collected when I no
 longer hold a reference to them, or does the parent container hold a reference to them and keep them alive?<br>
<br>
<br>
Thanks :-)<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155223" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="155234">
    <td id="PostDetailsCell_155234" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155234"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/6/2009 10:29:14 PM" LocalTimeTicks="1233988154">Feb 6, 2009 at 10:29 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155234" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Ahh,&#32;I&#32;see&#32;the&#32;conceptual&#32;gap.&#32;We&#39;ll&#32;need&#32;to&#32;see&#32;if&#32;we&#32;can&#32;improve&#32;the&#32;docs&#32;around&#32;this.&#32;&#32;A&#32;child&#32;container&#32;doesn&#39;t&#32;&#38;quot&#59;ask&#32;it&#39;s&#32;parent&#38;quot&#59;&#32;to&#32;resolve&#32;something.&#32;Instead,&#32;there&#39;s&#32;kind&#32;of&#32;a&#32;merge&#32;of&#32;the&#32;strategies&#32;and&#32;policies&#32;under&#32;the&#32;hood.&#32;Child&#32;policies&#32;can&#32;override&#32;what&#39;s&#32;in&#32;the&#32;parent,&#32;but&#32;there&#39;s&#32;no&#32;explicit&#32;call&#32;up&#32;the&#32;parent&#32;chain.&#32;It&#32;makes&#32;perfect&#32;sense&#32;if&#32;you&#32;know&#32;the&#32;internals,&#32;but&#32;you&#32;really&#32;shouldn&#39;t&#32;have&#32;to&#32;know&#32;the&#32;internals&#32;to&#32;use&#32;the&#32;container.&#32;Anyway,&#32;I&#32;can&#32;see&#32;from&#32;your&#32;code&#32;above&#32;you&#39;ve&#32;already&#32;gotten&#32;the&#32;right&#32;answer.&#32;&#32;As&#32;far&#32;as&#32;lifetime&#32;goes,&#32;parent&#32;containers&#32;do&#32;NOT&#32;hold&#32;a&#32;reference&#32;to&#32;children.&#32;You&#32;are&#32;free&#32;to&#32;manage&#32;their&#32;lifetime&#32;however&#32;you&#32;want&#59;&#32;by&#32;default&#32;it&#39;s&#32;handled&#32;just&#32;like&#32;any&#32;other&#32;.NET&#32;object.&#32;Children&#32;do&#32;hold&#32;a&#32;reference&#32;to&#32;their&#32;parent&#32;container&#32;&#40;obviously&#41;.&#32;&#32;I&#32;would&#32;strongly&#32;recommend&#32;you&#32;call&#32;Dispose&#32;on&#32;the&#32;child&#32;container&#32;when&#32;you&#39;re&#32;done&#32;with&#32;it,&#32;as&#32;that&#32;will&#32;also&#32;dispose&#32;any&#32;ContainerControlledLifetime&#32;objects&#32;in&#32;that&#32;container&#32;as&#32;well.&#32;&#32;">
        Ahh, I see the conceptual gap. We'll need to see if we can improve the docs around this.<br>
<br>
A child container doesn't &quot;ask it's parent&quot; to resolve something. Instead, there's kind of a merge of the strategies and policies under the hood. Child policies can override what's in the parent, but there's no explicit call up the parent chain. It
 makes perfect sense if you know the internals, but you really shouldn't have to know the internals to use the container. Anyway, I can see from your code above you've already gotten the right answer.<br>
<br>
As far as lifetime goes, parent containers do NOT hold a reference to children. You are free to manage their lifetime however you want; by default it's handled just like any other .NET object. Children do hold a reference to their parent container (obviously).<br>
<br>
I would strongly recommend you call Dispose on the child container when you're done with it, as that will also dispose any ContainerControlledLifetime objects in that container as well.<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155234" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="155275">
    <td id="PostDetailsCell_155275" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155275"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/7/2009 8:07:19 AM" LocalTimeTicks="1234022839">Feb 7, 2009 at 8:07 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155275" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;Thanks&#32;for&#32;the&#32;info&#33;&#38;nbsp&#59;&#32;Your&#32;description&#32;&#43;&#32;what&#32;I&#32;observe&#32;though&#32;confuses&#32;me&#32;slightly.&#38;nbsp&#59;&#32;If&#32;creating&#32;a&#32;child&#32;container&#32;merges&#32;the&#32;definitions&#32;down...&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;UnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPersonRepository,&#32;PersonRepository&#38;gt&#59;&#40;new&#32;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;DoChildContainer&#40;container,&#32;&#38;quot&#59;Hello&#32;1&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;DoChildContainer&#40;container,&#32;&#38;quot&#59;Hello&#32;2&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.ReadLine&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;private&#32;static&#32;void&#32;DoChildContainer&#40;UnityContainer&#32;container,&#32;string&#32;name&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;childContainer&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;childContainer.RegisterInstance&#38;lt&#59;ObjectSpace&#38;gt&#59;&#40;new&#32;ObjectSpace&#32;&#123;&#32;Name&#32;&#61;&#32;name&#32;&#125;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;repository&#32;&#61;&#32;childContainer.Resolve&#38;lt&#59;IPersonRepository&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;repository.ObjectSpaceName&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;From&#32;your&#32;description&#32;the&#32;first&#32;time&#32;I&#32;call&#32;DoChildContainer&#32;I&#32;would&#32;expect&#32;the&#32;registration&#32;of&#32;IPersonRepository&#32;to&#32;be&#32;passed&#32;down&#32;to&#32;the&#32;child,&#32;then&#32;I&#32;would&#32;expect&#32;resolving&#32;it&#32;would&#32;pass&#32;in&#32;the&#32;object&#32;space&#32;that&#32;I&#32;registered&#32;in&#32;the&#32;child&#32;container&#32;&#40;which&#32;it&#32;does&#41;.&#38;nbsp&#59;&#32;But&#32;if&#32;the&#32;child&#32;container&#32;isn&#39;t&#32;touching&#32;the&#32;parent&#32;container&#32;why&#32;is&#32;it&#32;that&#32;the&#32;2nd&#32;call&#32;to&#32;DoChildContainer&#32;doesn&#39;t&#32;create&#32;a&#32;new&#32;instance&#32;of&#32;IPersonRepository,&#32;instead&#32;it&#32;returns&#32;the&#32;first&#32;one&#32;that&#32;was&#32;created&#63;&#38;nbsp&#59;&#32;I&#32;would&#32;have&#32;expected&#32;the&#32;definition&#32;to&#32;be&#32;passed&#32;down,&#32;but&#32;for&#32;the&#32;instance&#32;to&#32;only&#32;exist&#32;in&#32;the&#32;child&#32;container&#32;and&#32;not&#32;get&#32;shared&#32;with&#32;the&#32;2nd&#32;child&#32;container&#32;instance.&#32;&#32;That&#39;s&#32;the&#32;kind&#32;of&#32;behaviour&#32;I&#32;am&#32;trying&#32;to&#32;achieve&#32;anyway,&#32;so&#32;that&#32;I&#32;can&#32;create&#32;container&#32;controlled&#32;lifetimes&#32;for&#32;services&#32;in&#32;child&#32;containers&#32;without&#32;them&#32;interfering&#32;with&#32;each&#32;other&#32;and&#32;without&#32;having&#32;to&#32;register&#32;their&#32;types&#32;in&#32;the&#32;child&#32;container&#32;directly.&#32;&#32;&#32;Pete&#32;">
        Hi Chris<br>
<br>
Thanks for the info!&nbsp; Your description &#43; what I observe though confuses me slightly.&nbsp; If creating a child container merges the definitions down...<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; UnityContainer container = new UnityContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;container.RegisterType&lt;IPersonRepository, PersonRepository&gt;(<strong>new ContainerControlledLifetimeManager()</strong>);<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;DoChildContainer(container, &quot;Hello 1&quot;);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;DoChildContainer(container, &quot;Hello 2&quot;);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.ReadLine();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;private static void DoChildContainer(UnityContainer container, string name)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var childContainer = container.CreateChildContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;childContainer.RegisterInstance&lt;ObjectSpace&gt;(new ObjectSpace { Name = name });<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var repository = childContainer.Resolve&lt;IPersonRepository&gt;();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(repository.ObjectSpaceName);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
From your description the first time I call DoChildContainer I would expect the registration of IPersonRepository to be passed down to the child, then I would expect resolving it would pass in the object space that I registered in the child container (which
 it does).&nbsp; But if the child container isn't touching the parent container why is it that the 2nd call to DoChildContainer doesn't create a new instance of IPersonRepository, instead it returns the first one that was created?&nbsp; I would have expected
 the definition to be passed down, but for the instance to only exist in the child container and not get shared with the 2nd child container instance.<br>
<br>
That's the kind of behaviour I am trying to achieve anyway, so that I can create container controlled lifetimes for services in child containers without them interfering with each other and without having to register their types in the child container directly.<br>
<br>
<br>
Pete<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155275" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="155959">
    <td id="PostDetailsCell_155959" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post155959"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/9/2009 8:04:36 PM" LocalTimeTicks="1234238676">Feb 9, 2009 at 8:04 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_155959" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;think&#32;it&#39;s&#32;time&#32;to&#32;actually&#32;dive&#32;into&#32;the&#32;internals.&#32;This&#32;should&#32;clear&#32;things&#32;up&#32;&#40;I&#32;hope&#41;.&#32;&#32;All&#32;of&#32;the&#32;internal&#32;configuration&#32;of&#32;a&#32;container&#32;is&#32;stored&#32;in&#32;a&#32;data&#32;structure&#32;called&#32;a&#32;PolicyList.&#32;The&#32;PolicyList&#32;stores&#32;policy&#32;object.&#32;A&#32;policy&#32;object&#32;is&#32;something&#32;like&#32;an&#32;IBuildKeyMappingPolicy,&#32;which&#32;maps&#32;one&#32;type&#47;name&#32;pair&#32;to&#32;another,&#32;or&#32;an&#32;IConstructorSelectorPolicy,&#32;which&#32;determines&#32;which&#32;constructor&#32;to&#32;call,&#32;or,&#32;most&#32;importantly&#32;for&#32;this&#32;discussion,&#32;the&#32;ILifetimePolicy,&#32;which&#32;is&#32;implemented&#32;by&#32;the&#32;lifetime&#32;manager&#32;classes.&#32;&#32;PolicyList&#32;has&#32;a&#32;parent&#32;chain.&#32;When&#32;you&#32;request&#32;a&#32;particular&#32;policy&#32;for&#32;a&#32;particular&#32;type&#47;name&#32;pair,&#32;if&#32;it&#39;s&#32;not&#32;found&#32;in&#32;the&#32;current&#32;PolicyList,&#32;it&#39;ll&#32;ask&#32;the&#32;parent&#32;PolicyList.&#32;If&#32;the&#32;parent&#32;doesn&#39;t&#32;have&#32;it,&#32;it&#39;ll&#32;ask&#32;the&#32;grandparent,&#32;etc.&#32;Each&#32;container&#32;has&#32;it&#39;s&#32;own&#32;PolicyList,&#32;and&#32;child&#32;containers&#32;have&#32;a&#32;PolicyList&#32;that&#32;points&#32;to&#32;the&#32;parent&#39;s&#32;PolicyList&#32;as&#32;a&#32;parent.&#32;&#32;Now&#32;here&#39;s&#32;the&#32;thing&#32;-&#32;when&#32;adding&#32;a&#32;policy,&#32;it&#32;gets&#32;written&#32;into&#32;the&#32;local&#32;PolicyList&#32;only.&#32;&#32;So,&#32;let&#39;s&#32;walk&#32;through&#32;two&#32;scenarios.&#32;The&#32;first&#58;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;IUnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#32;...&#32;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;childContainer&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;childContainer.RegisterType&#38;lt&#59;Foo&#38;gt&#59;&#40;new&#32;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;childContainer.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#32;&#32;Here,&#32;by&#32;calling&#32;RegisterType&#38;lt&#59;Foo&#38;gt&#59;,&#32;we&#39;ve&#32;added&#32;a&#32;ILifetimePolicy&#32;to&#32;the&#32;child&#39;s&#32;PolicyList,&#32;but&#32;not&#32;the&#32;parents.&#32;When&#32;you&#32;resolve&#32;from&#32;the&#32;child&#32;container,&#32;it&#32;looks&#32;for&#32;ILifetimePolicy,&#32;finds&#32;it&#32;in&#32;the&#32;local&#32;PolicyList,&#32;and&#32;proceeds&#32;to&#32;operate&#32;as&#32;expected.&#32;If&#32;you&#32;had&#32;instead&#32;done&#32;container.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;,&#32;it&#32;would&#32;look&#32;in&#32;the&#32;parent&#32;PolicyList&#32;only&#32;&#40;we&#32;never&#32;look&#32;into&#32;child&#32;PolicyLists&#41;,&#32;not&#32;find&#32;one,&#32;and&#32;use&#32;the&#32;default&#32;transient&#32;object&#32;behavior.&#32;&#32;So,&#32;let&#39;s&#32;change&#32;the&#32;scenario&#58;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;IUnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#32;...&#32;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;childContainer&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;container.RegisterType&#38;lt&#59;Foo&#38;gt&#59;&#40;new&#32;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#32;&#47;&#47;&#32;&#38;lt&#59;--&#32;parent&#32;container&#32;now,&#32;not&#32;child&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;childContainer.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#32;&#32;So&#32;what&#32;happen&#32;here&#63;&#32;When&#32;resolving&#32;in&#32;the&#32;child&#32;container,&#32;it&#32;goes&#32;looking&#32;for&#32;ILifetimePolicy.&#32;It&#32;doesn&#39;t&#32;find&#32;it&#32;in&#32;the&#32;child&#32;PolicyList,&#32;so&#32;it&#32;goes&#32;looking&#32;in&#32;the&#32;parent&#39;s,&#32;and&#32;does&#32;find&#32;it&#32;there.&#32;&#32;Now,&#32;what&#32;happens&#32;next&#32;is&#32;that&#32;the&#32;object&#32;gets&#32;built,&#32;and&#32;then&#32;it&#32;gets&#32;stored&#32;in&#32;the&#32;LifetimeManager&#32;for&#32;later&#32;retrieval.&#32;But&#32;remember,&#32;that&#32;LifetimeManager&#32;is&#32;in&#32;the&#32;parent&#33;&#32;We&#39;re&#32;not&#32;creating&#32;a&#32;new&#32;lifetime&#32;manager&#32;in&#32;the&#32;child,&#32;we&#39;re&#32;simply&#32;using&#32;the&#32;one&#32;that&#32;was&#32;already&#32;found&#32;-&#32;in&#32;the&#32;parent.&#32;&#32;So&#32;it&#39;s&#32;not&#32;that&#32;configuration&#32;is&#32;&#38;quot&#59;passed&#32;down&#38;quot&#59;&#32;from&#32;parent&#32;to&#32;child,&#32;it&#39;s&#32;that&#32;the&#32;child&#32;goes&#32;looking&#32;locally&#32;first,&#32;and&#32;on&#32;not&#32;finding&#32;something&#32;looks&#32;again&#32;in&#32;the&#32;parent.&#32;&#32;Does&#32;that&#32;help&#63;&#32;&#32;-Chris&#32;&#32;&#32;">
        I think it's time to actually dive into the internals. This should clear things up (I hope).<br>
<br>
All of the internal configuration of a container is stored in a data structure called a PolicyList. The PolicyList stores policy object. A policy object is something like an IBuildKeyMappingPolicy, which maps one type/name pair to another, or an IConstructorSelectorPolicy,
 which determines which constructor to call, or, most importantly for this discussion, the ILifetimePolicy, which is implemented by the lifetime manager classes.<br>
<br>
PolicyList has a parent chain. When you request a particular policy for a particular type/name pair, if it's not found in the current PolicyList, it'll ask the parent PolicyList. If the parent doesn't have it, it'll ask the grandparent, etc. Each container
 has it's own PolicyList, and child containers have a PolicyList that points to the parent's PolicyList as a parent.<br>
<br>
Now here's the thing - when adding a policy, it gets written into the local PolicyList
<em>only</em>.<br>
<br>
So, let's walk through two scenarios. The first:<br>
<br>
&nbsp;&nbsp;&nbsp; IUnityContainer container = new UnityContainer() ... ;<br>
&nbsp;&nbsp;&nbsp; var childContainer = container.CreateChildContainer();<br>
&nbsp;&nbsp;&nbsp; childContainer.RegisterType&lt;Foo&gt;(new ContainerControlledLifetimeManager());<br>
&nbsp;&nbsp;&nbsp; childContainer.Resolve&lt;Foo&gt;();<br>
<br>
Here, by calling RegisterType&lt;Foo&gt;, we've added a ILifetimePolicy to the child's PolicyList, but not the parents. When you resolve from the child container, it looks for ILifetimePolicy, finds it in the local PolicyList, and proceeds to operate as expected.
 If you had instead done container.Resolve&lt;Foo&gt;(), it would look in the parent PolicyList only (we never look into child PolicyLists), not find one, and use the default transient object behavior.<br>
<br>
So, let's change the scenario:<br>
<br>
&nbsp;&nbsp;&nbsp; IUnityContainer container = new UnityContainer() ... ;<br>
&nbsp;&nbsp;&nbsp; var childContainer = container.CreateChildContainer();<br>
&nbsp;&nbsp;&nbsp; container.RegisterType&lt;Foo&gt;(new ContainerControlledLifetimeManager()); // &lt;-- parent container now, not child<br>
&nbsp;&nbsp;&nbsp; childContainer.Resolve&lt;Foo&gt;();<br>
<br>
So what happen here? When resolving in the child container, it goes looking for ILifetimePolicy. It doesn't find it in the child PolicyList, so it goes looking in the parent's, and does find it there.<br>
<br>
Now, what happens next is that the object gets built, and then it gets stored in the LifetimeManager for later retrieval. But remember, that LifetimeManager is in the parent! We're not creating a new lifetime manager in the child, we're simply using the one
 that was already found - in the parent.<br>
<br>
So it's not that configuration is &quot;passed down&quot; from parent to child, it's that the child goes looking locally first, and on not finding something looks again in the parent.<br>
<br>
Does that help?<br>
<br>
-Chris <br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_155959" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="156002">
    <td id="PostDetailsCell_156002" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post156002"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/9/2009 9:13:38 PM" LocalTimeTicks="1234242818">Feb 9, 2009 at 9:13 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_156002" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="So&#32;the&#32;child&#32;does&#32;go&#32;to&#32;the&#32;parent&#32;to&#32;resolve&#32;the&#32;instance&#32;for&#32;it&#32;then&#63;&#38;nbsp&#59;&#32;This&#32;means&#32;that&#32;I&#32;would&#32;have&#32;to&#32;register&#32;the&#32;IPersonRepository&#32;using&#32;a&#32;transient&#32;lifetime&#32;manager&#32;then&#63;&#32;&#32;I&#32;wonder,&#32;is&#32;there&#32;a&#32;way&#32;I&#32;could&#32;get&#32;the&#32;child&#32;container&#32;to&#32;look&#32;in&#32;the&#32;parent&#32;for&#32;the&#32;policy&#32;but&#32;have&#32;the&#32;child&#32;create&#32;the&#32;instance&#63;&#38;nbsp&#59;&#32;In&#32;the&#32;example&#32;of&#32;PersonRepository&#32;I&#32;would&#32;want&#32;to&#32;register&#32;it&#32;in&#32;the&#32;parent&#32;container&#32;for&#32;convenience,&#32;but&#32;only&#32;create&#32;instances&#32;in&#32;child&#32;containers&#32;where&#32;there&#32;is&#32;an&#32;ObjectSpace&#32;registered.&#38;nbsp&#59;&#32;Can&#32;this&#32;be&#32;done&#63;&#38;nbsp&#59;&#32;Otherwise&#32;I&#39;d&#32;have&#32;to&#32;make&#32;PersonRepository&#32;transient,&#32;and&#32;if&#32;there&#32;are&#32;a&#32;lot&#32;of&#32;dependencies&#32;required&#32;&#40;all&#32;requiring&#32;ObjectSpace&#41;&#32;then&#32;there&#32;is&#32;going&#32;to&#32;be&#32;a&#32;lot&#32;of&#32;object&#32;creation&#32;going&#32;on&#32;each&#32;time&#32;I&#32;need&#32;to&#32;resolve&#32;a&#32;service.&#32;&#32;Finally,&#32;is&#32;there&#32;a&#32;commonly&#32;used&#32;pattern&#32;for&#32;creating&#47;disposing&#32;child&#32;containers&#63;&#38;nbsp&#59;&#32;I&#32;would&#32;expect&#32;to&#32;do&#32;something&#32;like&#32;&#32;using&#32;&#40;var&#32;childContainer&#32;&#61;&#32;UnityContainer.CreateChildContainer&#41;&#32;&#123;&#32;&#38;nbsp&#59;&#32;childContainer.RegisterInstance&#38;lt&#59;IUnityContainer&#38;gt&#59;&#40;childContainer&#41;&#59;&#32;&#38;nbsp&#59;&#32;AppLayerDoSomeStuff&#40;childContainer&#41;&#59;&#32;&#125;&#32;&#32;Thanks&#32;for&#32;your&#32;help,&#32;I&#32;appreciate&#32;it&#33;&#32;">
        So the child does go to the parent to resolve the instance for it then?&nbsp; This means that I would have to register the IPersonRepository using a transient lifetime manager then?<br>
<br>
I wonder, is there a way I could get the child container to look in the parent for the policy but have the child create the instance?&nbsp; In the example of PersonRepository I would want to register it in the parent container for convenience, but only create
 instances in child containers where there is an ObjectSpace registered.&nbsp; Can this be done?&nbsp; Otherwise I'd have to make PersonRepository transient, and if there are a lot of dependencies required (all requiring ObjectSpace) then there is going to
 be a lot of object creation going on each time I need to resolve a service.<br>
<br>
Finally, is there a commonly used pattern for creating/disposing child containers?&nbsp; I would expect to do something like<br>
<br>
using (var childContainer = UnityContainer.CreateChildContainer)<br>
{<br>
&nbsp; childContainer.RegisterInstance&lt;IUnityContainer&gt;(childContainer);<br>
&nbsp; AppLayerDoSomeStuff(childContainer);<br>
}<br>
<br>
Thanks for your help, I appreciate it!<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_156002" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="156036">
    <td id="PostDetailsCell_156036" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post156036"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/9/2009 10:45:54 PM" LocalTimeTicks="1234248354">Feb 9, 2009 at 10:45 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_156036" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="The&#32;logic&#32;for&#32;resolving&#32;executes&#32;in&#32;the&#32;child&#32;container.&#32;That&#32;logic&#32;looks&#32;up&#32;a&#32;variety&#32;of&#32;policies&#32;along&#32;the&#32;way.&#32;Some&#32;of&#32;those&#32;policies&#32;will&#32;come&#32;from&#32;the&#32;child,&#32;other&#32;will&#32;look&#32;up&#32;to&#32;the&#32;parent,&#32;depending&#32;on&#32;how&#32;the&#32;child&#32;container&#32;is&#32;configured.&#32;In&#32;your&#32;case&#32;of&#32;PersonRepository,&#32;by&#32;&#38;quot&#59;register&#32;it&#32;in&#32;the&#32;parent&#32;container&#32;for&#32;convenience&#38;quot&#59;,&#32;do&#32;you&#32;mean&#32;set&#32;up&#32;the&#32;injection&#32;properties&#63;&#32;That&#32;is,&#32;what&#32;constructor&#32;to&#32;call,&#32;which&#32;properties&#32;to&#32;set,&#32;etc&#63;&#32;If&#32;so,&#32;yes,&#32;you&#32;can&#32;do&#32;that&#32;and&#32;then&#32;resolve&#32;through&#32;the&#32;child&#32;containers.&#32;The&#32;one&#32;thing&#32;you&#32;can&#39;t&#32;do&#32;is&#32;set&#32;the&#32;lifetime&#32;manager&#32;in&#32;the&#32;parent&#32;-&#32;you&#32;must&#32;configure&#32;that&#32;in&#32;each&#32;child&#32;or&#32;you&#32;get&#32;the&#32;issue&#32;of&#32;the&#32;child&#39;s&#32;resolved&#32;value&#32;ending&#32;up&#32;in&#32;the&#32;parent&#32;as&#32;discussed&#32;above.&#32;You&#32;can&#32;call&#32;RegisterType&#32;multiple&#32;times,&#32;BTW.&#32;The&#32;lifetime&#32;manager&#32;and&#32;injection&#32;configuration&#32;set&#32;different&#32;policies,&#32;so&#32;they&#32;can&#32;be&#32;set&#32;through&#32;separate&#32;calls.&#32;So&#32;what&#32;I&#39;d&#32;do&#32;is&#32;configure&#32;injection&#32;in&#32;the&#32;parent,&#32;lifetime&#32;in&#32;the&#32;child,&#32;and&#32;it&#39;ll&#32;all&#32;just&#32;work&#32;the&#32;way&#32;you&#32;want.&#32;As&#32;for&#32;your&#32;proposed&#32;pattern,&#32;never&#32;register&#32;a&#32;container&#32;with&#32;itself.&#32;It&#39;s&#32;already&#32;done&#32;for&#32;you&#32;&#40;new&#32;in&#32;Unity&#32;1.2&#41;&#32;so&#32;you&#32;don&#39;t&#32;gain&#32;anything,&#32;and&#32;you&#39;ll&#32;get&#32;a&#32;stack&#32;overflow&#32;at&#32;dispose&#32;time.&#32;Just&#32;add&#32;a&#32;dependency&#32;on&#32;IUnityContainer&#32;in&#32;your&#32;objects&#32;and&#32;it&#39;ll&#32;just&#32;work.&#32;">
        
<p>The logic for resolving executes in the child container. That logic looks up a variety of policies along the way. Some of those policies will come from the child, other will look up to the parent, depending on how the child container is configured.</p>
<p>In your case of PersonRepository, by &quot;register it in the parent container for convenience&quot;, do you mean set up the injection properties? That is, what constructor to call, which properties to set, etc? If so, yes, you can do that and then resolve
 through the child containers. The one thing you can't do is set the lifetime manager in the parent - you must configure that in each child or you get the issue of the child's resolved value ending up in the parent as discussed above. You can call RegisterType
 multiple times, BTW. The lifetime manager and injection configuration set different policies, so they can be set through separate calls.</p>
<p>So what I'd do is configure injection in the parent, lifetime in the child, and it'll all just work the way you want.</p>
<p>As for your proposed pattern, never register a container with itself. It's already done for you (new in Unity 1.2) so you don't gain anything, and you'll get a stack overflow at dispose time. Just add a dependency on IUnityContainer in your objects and it'll
 just work.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_156036" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="156162">
    <td id="PostDetailsCell_156162" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post156162"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/10/2009 8:57:09 AM" LocalTimeTicks="1234285029">Feb 10, 2009 at 8:57 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_156162" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;Thanks&#32;for&#32;the&#32;tip&#32;regarding&#32;self&#32;registration.&#38;nbsp&#59;&#32;As&#32;for&#32;registering&#32;the&#32;services.&#38;nbsp&#59;&#32;The&#32;way&#32;our&#32;app&#32;is&#32;set&#32;up&#32;is&#32;to&#32;dynamically&#32;load&#32;all&#32;assemblies&#32;in&#32;a&#32;specified&#32;folder,&#32;look&#32;for&#32;classes&#32;that&#32;implement&#32;IModule,&#32;and&#32;then&#32;create&#32;an&#32;instance&#32;of&#32;that&#32;module&#32;and&#32;get&#32;it&#32;to&#32;register&#32;its&#32;services.&#32;&#32;&#123;&#32;&#38;nbsp&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IPersonRepository,&#32;PersonRepository&#38;gt&#59;&#40;new&#32;ContainerControllerLifetimeManager&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#32;etc&#32;&#125;&#32;&#32;We&#32;do&#32;not&#32;have&#32;any&#32;injection&#32;properties&#32;etc,&#32;just&#32;mapping&#32;interfaces&#32;to&#32;implementers.&#38;nbsp&#59;&#32;But&#32;because&#32;this&#32;app&#32;is&#32;written&#32;in&#32;a&#32;modular&#32;way&#32;it&#32;means&#32;that&#32;the&#32;child&#32;container&#32;wont&#32;know&#32;all&#32;of&#32;the&#32;services&#32;implemented&#32;by&#32;the&#32;parent&#32;container,&#32;and&#32;the&#32;ones&#32;it&#32;is&#32;aware&#32;of&#32;it&#32;wont&#32;know&#32;which&#32;classes&#32;implement&#32;the&#32;interface.&#32;&#32;Now,&#32;I&#32;could&#32;create&#32;some&#32;code&#32;which&#32;creates&#32;the&#32;child&#32;container&#32;and&#32;sets&#32;the&#32;lifetime&#32;manager&#32;for&#32;certain&#32;services&#32;etc,&#32;but&#32;the&#32;problem&#32;with&#32;this&#32;is&#32;that&#32;it&#32;creates&#32;2&#32;places&#32;to&#32;update&#32;whenever&#32;a&#32;new&#32;service&#32;is&#32;created.&#38;nbsp&#59;&#32;First&#32;the&#32;new&#32;service&#32;has&#32;to&#32;be&#32;registered&#32;in&#32;its&#32;relevant&#32;module,&#32;and&#32;then&#32;the&#32;code&#32;that&#32;creates&#32;the&#32;child&#32;container&#32;&#43;&#32;registers&#32;the&#32;lifetime&#32;managers&#32;needs&#32;to&#32;be&#32;updated&#32;for&#32;this&#32;new&#32;service&#32;too.&#38;nbsp&#59;&#32;Having&#32;a&#32;requirement&#32;to&#32;have&#32;a&#32;service&#32;registered&#32;in&#32;two&#32;places&#32;is&#32;going&#32;to&#32;lead&#32;to&#32;problems,&#32;some&#32;people&#32;are&#32;going&#32;to&#32;forget&#32;to&#32;do&#32;it&#32;&#40;myself&#32;included&#32;I&#32;suspect&#41;.&#32;&#32;I&#32;tried&#32;registering&#32;the&#32;type&#32;with&#32;the&#32;parent&#32;container&#32;without&#32;specifying&#32;the&#32;lifetime,&#32;but&#32;this&#32;results&#32;in&#32;a&#32;transient&#32;registration&#32;which&#32;I&#32;would&#32;like&#32;to&#32;avoid.&#32;&#32;What&#32;I&#32;think&#32;I&#32;need&#32;is&#32;01&#58;&#32;Register&#32;the&#32;type&#47;implementer&#32;in&#32;the&#32;parent&#32;container&#32;-&#32;must&#32;be&#32;this&#32;way&#32;due&#32;to&#32;the&#32;module&#32;discovery&#32;which&#32;happens&#32;via&#32;reflection&#32;in&#32;Application_Start&#32;in&#32;Global.asax&#32;02&#58;&#32;For&#32;certain&#32;services&#32;that&#32;I&#32;identify&#32;some&#32;how&#32;in&#32;the&#32;registration&#32;the&#32;instance&#32;should&#32;be&#32;registered&#32;in&#32;the&#32;container&#32;resolving&#32;it&#32;and&#32;not&#32;the&#32;container&#32;registering&#32;it.&#38;nbsp&#59;&#32;So&#32;that&#32;when&#32;a&#32;service&#32;requires&#32;an&#32;ObjectSpace&#32;for&#32;example,&#32;which&#32;is&#32;only&#32;registered&#32;in&#32;the&#32;child&#32;container,&#32;that&#32;service&#32;implementer&#39;s&#32;instance&#32;will&#32;exist&#32;in&#32;the&#32;child&#32;container&#32;so&#32;as&#32;not&#32;to&#32;conflict&#32;with&#32;any&#32;other&#32;child&#32;containers&#32;that&#32;require&#32;the&#32;same&#32;service&#32;but&#32;using&#32;a&#32;different&#32;ObjectSpace.&#32;&#32;I&#32;am&#32;starting&#32;to&#32;suspect&#32;this&#32;is&#32;currently&#32;not&#32;possible&#63;&#38;nbsp&#59;&#32;If&#32;it&#32;is&#32;then&#32;I&#39;d&#32;love&#32;to&#32;know&#32;how,&#32;if&#32;it&#32;isn&#39;t&#32;then&#32;maybe&#32;I&#32;could&#32;work&#32;out&#32;my&#32;own&#32;lifetime&#32;manager&#32;implementation&#32;but&#32;for&#32;this&#32;I&#39;d&#32;need&#32;a&#32;reference&#32;to&#32;the&#32;container&#32;that&#32;called&#32;Resolve&#32;when&#32;GetValue&#32;is&#32;called.&#38;nbsp&#59;&#32;Would&#32;either&#32;scenario&#32;be&#32;possible&#63;&#32;&#32;Thanks&#32;&#32;Pete&#32;">
        Hi Chris<br>
<br>
Thanks for the tip regarding self registration.&nbsp; As for registering the services.&nbsp; The way our app is set up is to dynamically load all assemblies in a specified folder, look for classes that implement IModule, and then create an instance of that
 module and get it to register its services.<br>
<br>
{<br>
&nbsp; unityContainer.RegisterType&lt;IPersonRepository, PersonRepository&gt;(new ContainerControllerLifetimeManager());<br>
&nbsp; etc<br>
}<br>
<br>
We do not have any injection properties etc, just mapping interfaces to implementers.&nbsp; But because this app is written in a modular way it means that the child container wont know all of the services implemented by the parent container, and the ones it
 is aware of it wont know which classes implement the interface.<br>
<br>
Now, I could create some code which creates the child container and sets the lifetime manager for certain services etc, but the problem with this is that it creates 2 places to update whenever a new service is created.&nbsp; First the new service has to be
 registered in its relevant module, and then the code that creates the child container &#43; registers the lifetime managers needs to be updated for this new service too.&nbsp; Having a requirement to have a service registered in two places is going to lead to
 problems, some people are going to forget to do it (myself included I suspect).<br>
<br>
I tried registering the type with the parent container without specifying the lifetime, but this results in a transient registration which I would like to avoid.<br>
<br>
What I think I need is<br>
01: Register the type/implementer in the parent container - must be this way due to the module discovery which happens via reflection in Application_Start in Global.asax<br>
02: For certain services that I identify some how in the registration the instance should be registered in the container resolving it and not the container registering it.&nbsp; So that when a service requires an ObjectSpace for example, which is only registered
 in the child container, that service implementer's instance will exist in the child container so as not to conflict with any other child containers that require the same service but using a different ObjectSpace.<br>
<br>
I am starting to suspect this is currently not possible?&nbsp; If it is then I'd love to know how, if it isn't then maybe I could work out my own lifetime manager implementation but for this I'd need a reference to the container that called Resolve when GetValue
 is called.&nbsp; Would either scenario be possible?<br>
<br>
Thanks<br>
<br>
Pete<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_156162" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="156225">
    <td id="PostDetailsCell_156225" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post156225"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/10/2009 1:36:05 PM" LocalTimeTicks="1234301765">Feb 10, 2009 at 1:36 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_156225" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;posted&#32;my&#32;post&#32;at&#32;9&#58;57.&#38;nbsp&#59;&#32;My&#32;current&#32;view&#32;of&#32;this&#32;forum&#32;shows&#32;no&#32;response.&#38;nbsp&#59;&#32;The&#32;RSS&#32;feed&#32;shows&#32;you&#32;replied&#32;at&#32;11&#58;31&#32;&#40;that&#32;was&#32;quick&#33;&#41;,&#32;but&#32;unfortunately&#32;the&#32;RSS&#32;feed&#32;shows&#32;an&#32;incomplete&#32;message.&#32;&#32;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#32;I&#32;think&#32;this&#32;simple&#32;code&#32;demonstrates&#32;my&#32;answer&#58;&#32;&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Text&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;&#32;namespace&#32;ConsoleApplication24&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;class&#32;Program&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;static&#32;void&#32;Main&#40;string&#91;&#93;&#32;args&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;UnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPersonRepository,&#32;PersonRepository&#38;gt&#59;&#40;new&#32;TransientLifetimeManager&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;childContainer&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;childContainer.RegisterInstance&#38;lt&#59;ObjectSpace&#38;gt&#59;&#40;new&#32;ObjectSpace&#32;&#123;&#32;Name&#32;&#61;&#32;&#38;quot&#59;Hello&#38;quot&#59;&#32;&#125;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;repository&#32;&#61;&#32;childContainer.Resolve&#38;lt&#59;IPersonRepository&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;repository.ObjectSpaceName&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.ReadLine&#40;&#41;&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;interface&#32;IPersonRepository&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;string&#32;ObjectSpaceName&#32;&#123;&#32;get&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;PersonRepository&#32;&#58;&#32;IPersonRepository&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;readonly&#32;ObjectSpace&#32;ObjectSpace&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;PersonRepository&#40;ObjectSpace&#32;objectSpace&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;amp&#59;&#32;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#32;&#32;Which&#32;obviously&#32;doesn&#39;t&#32;demonstrate&#32;your&#32;answer&#32;&#58;-&#41;&#32;&#32;Would&#32;you&#32;mind&#32;reposting&#32;please&#63;&#32;&#32;&#32;">
        I posted my post at 9:57.&nbsp; My current view of this forum shows no response.&nbsp; The RSS feed shows you replied at 11:31 (that was quick!), but unfortunately the RSS feed shows an incomplete message.<br>
<br>
========<br>
I think this simple code demonstrates my answer:<br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.Text;<br>
using Microsoft.Practices.Unity;<br>
<br>
namespace ConsoleApplication24<br>
{<br>
&nbsp;&nbsp; &nbsp;class Program<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;static void Main(string[] args)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;UnityContainer container = new UnityContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;container.RegisterType&lt;IPersonRepository, PersonRepository&gt;(new TransientLifetimeManager());<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var childContainer = container.CreateChildContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;childContainer.RegisterInstance&lt;ObjectSpace&gt;(new ObjectSpace { Name = &quot;Hello&quot; });<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var repository = childContainer.Resolve&lt;IPersonRepository&gt;();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(repository.ObjectSpaceName);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.ReadLine();<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public interface IPersonRepository<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;string ObjectSpaceName { get; }<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class PersonRepository : IPersonRepository<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;readonly ObjectSpace ObjectSpace;<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public PersonRepository(ObjectSpace objectSpace)<br>
&nbsp;&nbsp; &nbsp;&amp;<br>
========<br>
<br>
Which obviously doesn't demonstrate your answer :-)<br>
<br>
Would you mind reposting please? <br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_156225" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="157327">
    <td id="PostDetailsCell_157327" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post157327"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/13/2009 8:00:58 AM" LocalTimeTicks="1234540858">Feb 13, 2009 at 8:00 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_157327" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Chris&#63;&#32;&#32;I&#39;m&#32;dying&#32;to&#32;see&#32;your&#32;whole&#32;post&#32;&#58;-&#41;&#38;nbsp&#59;&#32;Or&#32;isn&#39;t&#32;what&#32;I&#32;want&#32;possible&#63;&#32;&#32;&#32;Thanks&#32;&#32;Pete&#32;">
        Chris?<br>
<br>
I'm dying to see your whole post :-)&nbsp; Or isn't what I want possible?<br>
<br>
<br>
Thanks<br>
<br>
Pete 
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_157327" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="157494">
    <td id="PostDetailsCell_157494" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post157494"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/13/2009 4:54:41 PM" LocalTimeTicks="1234572881">Feb 13, 2009 at 4:54 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_157494" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="My&#32;post&#32;is&#32;fine&#32;on&#32;the&#32;actual&#32;forum.&#32;Apparently&#32;it&#39;s&#32;just&#32;your&#32;copy&#32;of&#32;the&#32;feed&#32;that&#39;s&#32;screwed&#32;up.&#32;I&#39;d&#32;rather&#32;not&#32;pollute&#32;the&#32;forum&#32;with&#32;reposts&#32;-&#32;can&#39;t&#32;you&#32;just&#32;read&#32;it&#32;directly&#32;from&#32;the&#32;web&#32;instead&#32;of&#32;in&#32;your&#32;RSS&#32;reader&#63;&#32;&#32;">
        My post is fine on the actual forum. Apparently it's just your copy of the feed that's screwed up. I'd rather not pollute the forum with reposts - can't you just read it directly from the web instead of in your RSS reader?<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_157494" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="157524">
    <td id="PostDetailsCell_157524" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post157524"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/13/2009 6:50:50 PM" LocalTimeTicks="1234579850">Feb 13, 2009 at 6:50 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_157524" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;Ah,&#32;my&#32;mistake.&#38;nbsp&#59;&#32;I&#32;thought&#32;it&#32;was&#32;your&#32;post&#32;that&#32;messed&#32;up.&#38;nbsp&#59;&#32;I&#32;couldn&#39;t&#32;see&#32;it&#32;on&#32;the&#32;forum&#32;because&#32;I&#32;was&#32;only&#32;looking&#32;at&#32;posts&#32;in&#32;yellow.&#38;nbsp&#59;&#32;It&#32;was&#32;in&#32;fact&#32;my&#32;own&#32;post&#32;that&#32;messed&#32;up.&#32;&#32;My&#32;problem&#32;is&#32;that&#32;when&#32;creating&#32;the&#32;child&#32;container&#32;there&#32;is&#32;no&#32;way&#32;to&#32;know&#32;which&#32;services&#32;to&#32;create&#32;a&#32;new&#32;lifetime&#32;manager&#32;for.&#38;nbsp&#59;&#32;The&#32;app&#32;uses&#32;Microsoft.Practices.Composite.Modularity.ModuleManager&#32;to&#32;dynamically&#32;discover&#32;modules&#32;and&#32;get&#32;them&#32;to&#32;register&#32;their&#32;service&#32;implementers.&#38;nbsp&#59;&#32;Having&#32;the&#32;container&#32;know&#32;explicitly&#32;about&#32;these&#32;services&#32;would&#32;break&#32;the&#32;modularity,&#32;so&#32;I&#32;can&#39;t&#32;re-register&#32;services&#32;explicitly&#32;when&#32;a&#32;child&#32;container&#32;is&#32;created.&#32;&#32;The&#32;behaviour&#32;I&#32;really&#32;need&#32;is&#32;for&#32;the&#32;child&#32;container&#32;to&#32;check&#32;if&#32;there&#32;is&#32;an&#32;instance&#32;in&#32;the&#32;parent&#32;container,&#32;if&#32;there&#32;is&#32;then&#32;use&#32;that,&#32;otherwise&#32;create&#32;an&#32;manage&#32;an&#32;instance&#32;in&#32;the&#32;child&#32;container.&#38;nbsp&#59;&#32;This&#32;is&#32;because&#32;the&#32;child&#32;container&#32;will&#32;contain&#32;my&#32;ObjectSpace&#32;instance&#32;that&#32;these&#32;services&#32;require,&#32;and&#32;I&#32;really&#32;don&#39;t&#32;want&#32;to&#32;make&#32;these&#32;services&#32;transient&#32;because&#32;when&#32;there&#32;is&#32;a&#32;lot&#32;of&#32;dependencies&#32;I&#32;don&#39;t&#32;want&#32;to&#32;suffer&#32;the&#32;CPU&#32;penalty&#32;for&#32;having&#32;to&#32;create&#32;them&#32;every&#32;time.&#32;&#32;What&#32;about&#32;creating&#32;a&#32;child&#32;container&#32;and&#32;having&#32;it&#32;copy&#32;policies&#32;from&#32;the&#32;parent&#32;container&#63;&#38;nbsp&#59;&#32;Or&#32;what&#32;about&#32;if&#32;I&#32;created&#32;a&#32;special&#32;lifetime&#32;manager&#32;that&#32;the&#32;child&#32;container&#32;looked&#32;for&#32;an&#32;reregistered&#32;as&#32;controller&#32;lifetime&#32;managed&#63;&#38;nbsp&#59;&#32;I&#32;am&#32;clutching&#32;at&#32;straws&#32;&#58;-&#41;&#32;&#32;What&#32;I&#32;think&#32;would&#32;be&#32;the&#32;most&#32;logical&#32;implementation&#32;would&#32;be&#32;if&#32;I&#32;could&#32;register&#32;an&#32;instance&#32;and&#32;identify&#32;it&#32;as&#32;a&#32;child-only&#32;item,&#32;so&#32;any&#32;service&#32;that&#32;is&#32;resolved&#32;which&#32;requires&#32;this&#32;instance&#32;would&#32;be&#32;created&#32;in&#32;the&#32;same&#32;container&#32;as&#32;the&#32;instance&#32;it&#32;depends&#32;upon&#32;despite&#32;the&#32;fact&#32;that&#32;the&#32;service&#32;type&#32;is&#32;initially&#32;registered&#32;in&#32;the&#32;parent&#32;container&#32;&#40;which&#32;in&#32;this&#32;case&#32;is&#32;unavoidable&#41;.&#32;&#32;Any&#32;help&#32;you&#32;can&#32;offer&#32;would&#32;be&#32;greatly&#32;appreciated.&#38;nbsp&#59;&#32;I&#32;would&#32;really&#32;like&#32;to&#32;get&#32;rid&#32;of&#32;the&#32;ObjectSpace&#32;parameter&#32;which&#32;is&#32;present&#32;as&#32;the&#32;first&#32;parameter&#32;of&#32;80&#37;&#32;of&#32;my&#32;services&#39;&#32;methods.&#32;&#32;&#32;Thanks&#32;&#32;&#32;Pete&#32;">
        Hi Chris<br>
<br>
Ah, my mistake.&nbsp; I thought it was your post that messed up.&nbsp; I couldn't see it on the forum because I was only looking at posts in yellow.&nbsp; It was in fact my own post that messed up.<br>
<br>
My problem is that when creating the child container there is no way to know which services to create a new lifetime manager for.&nbsp; The app uses Microsoft.Practices.Composite.Modularity.ModuleManager to dynamically discover modules and get them to register
 their service implementers.&nbsp; Having the container know explicitly about these services would break the modularity, so I can't re-register services explicitly when a child container is created.<br>
<br>
The behaviour I really need is for the child container to check if there is an instance in the parent container, if there is then use that, otherwise create an manage an instance in the child container.&nbsp; This is because the child container will contain
 my ObjectSpace instance that these services require, and I really don't want to make these services transient because when there is a lot of dependencies I don't want to suffer the CPU penalty for having to create them every time.<br>
<br>
What about creating a child container and having it copy policies from the parent container?&nbsp; Or what about if I created a special lifetime manager that the child container looked for an reregistered as controller lifetime managed?&nbsp; I am clutching
 at straws :-)<br>
<br>
What I think would be the most logical implementation would be if I could register an instance and identify it as a child-only item, so any service that is resolved which requires this instance would be created in the same container as the instance it depends
 upon despite the fact that the service type is initially registered in the parent container (which in this case is unavoidable).<br>
<br>
Any help you can offer would be greatly appreciated.&nbsp; I would really like to get rid of the ObjectSpace parameter which is present as the first parameter of 80% of my services' methods.<br>
<br>
<br>
Thanks<br>
<br>
<br>
Pete<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_157524" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="157580">
    <td id="PostDetailsCell_157580" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post157580"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/13/2009 10:04:22 PM" LocalTimeTicks="1234591462">Feb 13, 2009 at 10:04 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_157580" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Ok,&#32;I&#32;see&#32;where&#32;you&#39;re&#32;going&#32;now.&#32;It&#39;s&#32;not&#32;an&#32;unreasonable&#32;scenario.&#32;A&#32;single&#32;custom&#32;lifetime&#32;manager&#32;wouldn&#39;t&#32;do&#32;it,&#32;unfortunately,&#32;since&#32;the&#32;lifetime&#32;manager&#32;strategy&#32;doesn&#39;t&#32;care&#32;about&#32;which&#32;container&#32;it&#32;gets&#32;it&#32;from.&#32;So&#32;you&#39;d&#32;need&#32;a&#32;custom&#32;extension&#32;to&#32;stick&#32;the&#32;new&#32;lifetime&#32;strategy&#32;in&#32;at&#32;buildup&#32;time.&#32;&#32;I&#32;can&#32;think&#32;of&#32;a&#32;couple&#32;ways&#32;to&#32;do&#32;this,&#32;but&#32;I&#32;need&#32;to&#32;stew&#32;on&#32;it&#32;a&#32;little&#32;more&#32;before&#32;proposing&#32;an&#32;approach.&#32;&#32;-Chris&#32;&#32;">
        Ok, I see where you're going now. It's not an unreasonable scenario. A single custom lifetime manager wouldn't do it, unfortunately, since the lifetime manager strategy doesn't care about which container it gets it from. So you'd need a custom extension
 to stick the new lifetime strategy in at buildup time.<br>
<br>
I can think of a couple ways to do this, but I need to stew on it a little more before proposing an approach.<br>
<br>
-Chris<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_157580" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="157646">
    <td id="PostDetailsCell_157646" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post157646"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/14/2009 7:59:16 AM" LocalTimeTicks="1234627156">Feb 14, 2009 at 7:59 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_157646" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Thanks&#32;Chris&#32;for&#32;spending&#32;your&#32;brain&#32;power&#32;on&#32;this,&#32;I&#32;really&#32;appreciate&#32;it&#32;very&#32;much&#33;&#32;">
        Thanks Chris for spending your brain power on this, I really appreciate it very much!<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_157646" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="159309">
    <td id="PostDetailsCell_159309" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post159309"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/19/2009 8:37:02 AM" LocalTimeTicks="1235061422">Feb 19, 2009 at 8:37 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_159309" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;I&#32;was&#32;wondering&#32;if&#32;you&#39;d&#32;had&#32;any&#32;thoughts&#32;on&#32;this&#63;&#38;nbsp&#59;&#32;Is&#32;it&#32;looking&#32;difficult&#32;&#47;&#32;impossible&#63;&#32;&#32;&#32;Pete&#32;">
        Hi Chris<br>
<br>
I was wondering if you'd had any thoughts on this?&nbsp; Is it looking difficult / impossible?<br>
<br>
<br>
Pete<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_159309" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="160376">
    <td id="PostDetailsCell_160376" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post160376"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/21/2009 4:55:24 AM" LocalTimeTicks="1235220924">Feb 21, 2009 at 4:55 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_160376" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="It&#39;s&#32;looking&#32;doable,&#32;but&#32;my&#32;entire&#32;family&#32;&#40;including&#32;myself&#41;&#32;has&#32;come&#32;down&#32;with&#32;a&#32;cold&#32;so&#32;I&#39;m&#32;not&#32;thinking&#32;very&#32;clearly&#32;right&#32;now.&#32;&#32;">
        It's looking doable, but my entire family (including myself) has come down with a cold so I'm not thinking very clearly right now.<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_160376" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="160403">
    <td id="PostDetailsCell_160403" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post160403"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="2/21/2009 10:05:33 AM" LocalTimeTicks="1235239533">Feb 21, 2009 at 10:05 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_160403" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;Yuck&#33;&#38;nbsp&#59;&#32;I&#32;hope&#32;you&#32;guys&#32;all&#32;get&#32;better&#32;soon.&#38;nbsp&#59;&#32;One&#32;of&#32;the&#32;problems&#32;with&#32;having&#32;kids&#32;is&#32;that&#32;they&#32;are&#32;always&#32;bringing&#32;stuff&#32;home&#32;from&#32;school&#32;you&#32;don&#39;t&#32;want&#32;&#58;-&#41;&#32;&#32;I&#39;m&#32;glad&#32;it&#39;s&#32;looking&#32;doable&#32;though.&#38;nbsp&#59;&#32;I&#39;m&#32;more&#32;in&#32;a&#32;state&#32;of&#32;keenness&#32;than&#32;urgency.&#32;&#32;&#32;Thanks&#32;&#32;&#32;Pete&#32;&#32;">
        Hi Chris<br>
<br>
Yuck!&nbsp; I hope you guys all get better soon.&nbsp; One of the problems with having kids is that they are always bringing stuff home from school you don't want :-)<br>
<br>
I'm glad it's looking doable though.&nbsp; I'm more in a state of keenness than urgency.<br>
<br>
<br>
Thanks<br>
<br>
<br>
Pete<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_160403" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="170139">
    <td id="PostDetailsCell_170139" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post170139"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/20/2009 10:06:36 AM" LocalTimeTicks="1237568796">Mar 20, 2009 at 10:06 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_170139" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;I&#32;trust&#32;you&#32;are&#32;all&#32;recovered&#32;now&#63;&#38;nbsp&#59;&#32;Actually&#32;my&#32;family&#32;all&#32;have&#32;colds&#32;now&#32;&#58;-&#41;&#32;&#32;I&#39;m&#32;hoping&#32;you&#32;could&#32;share&#32;your&#32;idea&#32;on&#32;how&#32;to&#32;make&#32;this&#32;work&#63;&#32;&#32;&#32;Thanks&#32;&#32;Pete&#32;">
        Hi Chris<br>
<br>
I trust you are all recovered now?&nbsp; Actually my family all have colds now :-)<br>
<br>
I'm hoping you could share your idea on how to make this work?<br>
<br>
<br>
Thanks<br>
<br>
Pete<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_170139" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="171090">
    <td id="PostDetailsCell_171090" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post171090"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/23/2009 11:26:18 PM" LocalTimeTicks="1237875978">Mar 23, 2009 at 11:26 PM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="3/26/2009 9:41:55 PM" LocalTimeTicks="1238128915">Mar 26, 2009 at 9:41 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_171090" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Pete,&#32;&#32;I&#32;finally&#32;stole&#32;an&#32;hour&#32;to&#32;implement&#32;this.&#32;The&#32;intent&#32;was&#32;to&#32;implement&#32;a&#32;lifetime&#32;manager&#32;that&#32;give&#32;a&#32;&#38;quot&#59;container&#32;controlled&#32;per&#32;child&#32;container&#38;quot&#59;&#32;lifetime.&#32;I&#32;ended&#32;up&#32;calling&#32;it&#32;&#38;quot&#59;Hierarchical&#32;Lifetime&#38;quot&#59;&#32;-&#32;stole&#32;the&#32;name&#32;from&#32;Daniel&#32;Cazzulino.&#32;&#32;There&#32;are&#32;three&#32;parts.&#32;Unfortunately&#32;you&#32;can&#39;t&#32;implement&#32;this&#32;solely&#32;within&#32;the&#32;lifetime&#32;manager&#32;itself&#32;because&#32;the&#32;required&#32;information&#32;isn&#39;t&#32;available&#32;through&#32;the&#32;lifetime&#32;manager&#32;interfaces.&#32;So,&#32;we&#32;start&#32;with&#32;the&#32;HierarchicalLifetimeManager&#32;itself&#58;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;HierarchicalLifetimeManager&#32;&#58;&#32;ContainerControlledLifetimeManager&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;There&#39;s&#32;no&#32;actual&#32;special&#32;logic&#32;needed&#32;here,&#32;but&#32;we&#32;need&#32;a&#32;separate&#32;type&#32;to&#32;have&#32;something&#32;to&#32;look&#32;for.&#32;Next&#32;up,&#32;we&#32;need&#32;an&#32;ObjectBuilder&#32;builder&#32;strategy.&#32;Its&#32;job&#32;is&#32;to&#32;look&#32;for&#32;a&#32;hierarchical&#32;lifetime,&#32;and&#32;then&#32;determine&#32;if&#32;it&#39;s&#32;local&#32;or&#32;from&#32;a&#32;parent.&#32;If&#32;it&#39;s&#32;from&#32;the&#32;parent,&#32;add&#32;a&#32;new&#32;hierarchical&#32;lifetime&#32;manager&#32;to&#32;the&#32;current&#32;container.&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;HierarchicalLifetimeStrategy&#32;&#58;&#32;BuilderStrategy&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;override&#32;void&#32;PreBuildUp&#40;IBuilderContext&#32;context&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;activeLifetime&#32;&#61;&#32;context.PersistentPolicies.Get&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;context.BuildKey&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;if&#32;&#40;activeLifetime&#32;is&#32;HierarchicalLifetimeManager&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#32;did&#32;this&#32;come&#32;from&#32;the&#32;local&#32;container&#32;or&#32;the&#32;parent&#63;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;localLifetime&#32;&#61;&#32;context.PersistentPolicies.Get&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;context.BuildKey,&#32;true&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;if&#32;&#40;localLifetime&#32;&#61;&#61;&#32;null&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#32;came&#32;from&#32;parent,&#32;add&#32;a&#32;ContainerControlledLifetime&#32;here&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;context.PersistentPolicies.Set&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;new&#32;HierarchicalLifetimeManager&#40;&#41;,&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;context.BuildKey&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;And&#32;finally,&#32;a&#32;container&#32;extension&#32;to&#32;install&#32;the&#32;strategy&#58;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;HierarchicalLifetimeExtension&#32;&#58;&#32;UnityContainerExtension&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;protected&#32;override&#32;void&#32;Initialize&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#47;&#47;&#32;Add&#32;to&#32;type&#32;mapping&#32;stage&#32;so&#32;that&#32;it&#32;runs&#32;before&#32;the&#32;lifetime&#32;stage&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Context.Strategies.AddNew&#38;lt&#59;HierarchicalLifetimeStrategy&#38;gt&#59;&#40;UnityBuildStage.TypeMapping&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;Using&#32;this&#32;is&#32;pretty&#32;straightforward.&#32;Add&#32;the&#32;extension&#32;to&#32;the&#32;parent&#32;container&#32;-&#32;child&#32;containers&#32;will&#32;inherit&#32;the&#32;strategy&#32;so&#32;you&#32;don&#39;t&#32;need&#32;to&#32;do&#32;anything&#32;to&#32;them.&#32;Then&#32;set&#32;the&#32;HierarchicalLifetimeManager&#32;at&#32;the&#32;appropriate&#32;spots,&#32;and&#32;that&#39;s&#32;it.&#32;Some&#32;sample&#32;test&#32;code&#58;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestClass&#93;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;class&#32;WhenUsingHierarchicalLifetimeWithChildContainers&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;IUnityContainer&#32;child1&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;IUnityContainer&#32;child2&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;private&#32;IUnityContainer&#32;parentContainer&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestInitialize&#93;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;Setup&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;parentContainer&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;.AddNewExtension&#38;lt&#59;HierarchicalLifetimeExtension&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;child1&#32;&#61;&#32;parentContainer.CreateChildContainer&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;child2&#32;&#61;&#32;parentContainer.CreateChildContainer&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;parentContainer.RegisterType&#38;lt&#59;Foo&#38;gt&#59;&#40;new&#32;HierarchicalLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestMethod&#93;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;ThenResolvingInParentActsLikeContainerControlledLifetime&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;foo1&#32;&#61;&#32;parentContainer.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;foo2&#32;&#61;&#32;parentContainer.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.AreSame&#40;foo1,&#32;foo2&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestMethod&#93;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;ThenParentAndChildResolveDifferentInstances&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;parentFoo&#32;&#61;&#32;parentContainer.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;childFoo&#32;&#61;&#32;child1.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.AreNotSame&#40;parentFoo,&#32;childFoo&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestMethod&#93;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;ThenChildResolvesTheSameInstance&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;foo1&#32;&#61;&#32;child1.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;foo2&#32;&#61;&#32;child1.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.AreSame&#40;foo1,&#32;foo2&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#91;TestMethod&#93;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;public&#32;void&#32;ThenSiblingContainersResolveDifferentInstances&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;foo1&#32;&#61;&#32;child1.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;foo2&#32;&#61;&#32;child2.Resolve&#38;lt&#59;Foo&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;Assert.AreNotSame&#40;foo1,&#32;foo2&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#125;&#32;">
        Pete,<br>
<br>
I finally stole an hour to implement this. The intent was to implement a lifetime manager that give a &quot;container controlled per child container&quot; lifetime. I ended up calling it &quot;Hierarchical Lifetime&quot; - stole the name from Daniel Cazzulino.<br>
<br>
There are three parts. Unfortunately you can't implement this solely within the lifetime manager itself because the required information isn't available through the lifetime manager interfaces. So, we start with the HierarchicalLifetimeManager itself:<br>
<pre>&nbsp;&nbsp;&nbsp; public class HierarchicalLifetimeManager : ContainerControlledLifetimeManager<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp; }</pre>
There's no actual special logic needed here, but we need a separate type to have something to look for. Next up, we need an ObjectBuilder builder strategy. Its job is to look for a hierarchical lifetime, and then determine if it's local or from a parent. If
 it's from the parent, add a new hierarchical lifetime manager to the current container.<br>
<br>
<pre>&nbsp;&nbsp;&nbsp; public class HierarchicalLifetimeStrategy : BuilderStrategy<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override void PreBuildUp(IBuilderContext context)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var activeLifetime = context.PersistentPolicies.Get&lt;ILifetimePolicy&gt;(context.BuildKey);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (activeLifetime is HierarchicalLifetimeManager)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // did this come from the local container or the parent?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var localLifetime = context.PersistentPolicies.Get&lt;ILifetimePolicy&gt;(context.BuildKey, true);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (localLifetime == null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // came from parent, add a ContainerControlledLifetime here<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.PersistentPolicies.Set&lt;ILifetimePolicy&gt;(new HierarchicalLifetimeManager(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.BuildKey);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }</pre>
And finally, a container extension to install the strategy:<br>
<br>
<pre>&nbsp;&nbsp;&nbsp; public class HierarchicalLifetimeExtension : UnityContainerExtension<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void Initialize()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Add to type mapping stage so that it runs before the lifetime stage<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Context.Strategies.AddNew&lt;HierarchicalLifetimeStrategy&gt;(UnityBuildStage.TypeMapping);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }</pre>
Using this is pretty straightforward. Add the extension to the parent container - child containers will inherit the strategy so you don't need to do anything to them. Then set the HierarchicalLifetimeManager at the appropriate spots, and that's it. Some sample
 test code:<br>
<br>
<pre>&nbsp;&nbsp;&nbsp; [TestClass]<br>&nbsp;&nbsp;&nbsp; public class WhenUsingHierarchicalLifetimeWithChildContainers<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private IUnityContainer child1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private IUnityContainer child2;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private IUnityContainer parentContainer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [TestInitialize]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void Setup()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parentContainer = new UnityContainer()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .AddNewExtension&lt;HierarchicalLifetimeExtension&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child1 = parentContainer.CreateChildContainer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; child2 = parentContainer.CreateChildContainer();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parentContainer.RegisterType&lt;Foo&gt;(new HierarchicalLifetimeManager());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [TestMethod]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void ThenResolvingInParentActsLikeContainerControlledLifetime()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var foo1 = parentContainer.Resolve&lt;Foo&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var foo2 = parentContainer.Resolve&lt;Foo&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.AreSame(foo1, foo2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [TestMethod]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void ThenParentAndChildResolveDifferentInstances()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var parentFoo = parentContainer.Resolve&lt;Foo&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var childFoo = child1.Resolve&lt;Foo&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.AreNotSame(parentFoo, childFoo);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [TestMethod]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void ThenChildResolvesTheSameInstance()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var foo1 = child1.Resolve&lt;Foo&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var foo2 = child1.Resolve&lt;Foo&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.AreSame(foo1, foo2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [TestMethod]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void ThenSiblingContainersResolveDifferentInstances()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var foo1 = child1.Resolve&lt;Foo&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var foo2 = child2.Resolve&lt;Foo&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Assert.AreNotSame(foo1, foo2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br><br></pre>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_171090" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="171233">
    <td id="PostDetailsCell_171233" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post171233"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/24/2009 9:25:24 AM" LocalTimeTicks="1237911924">Mar 24, 2009 at 9:25 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_171233" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Hi&#32;Chris&#32;&#32;Works&#32;brilliantly,&#32;thanks&#32;so&#32;much&#33;&#32;&#32;Pete&#32;&#32;&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Linq&#59;&#32;using&#32;System.Text&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;&#32;namespace&#32;ConsoleApplication44&#32;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;class&#32;Program&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;static&#32;void&#32;Main&#40;string&#91;&#93;&#32;args&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;IUnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;container.AddNewExtension&#38;lt&#59;HierarchicalLifetimeExtension&#38;gt&#59;&#40;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;ICustomerRepository,&#32;CustomerRepository&#38;gt&#59;&#40;new&#32;HierarchicalLifetimeManager&#40;&#41;&#41;&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;using&#32;&#40;IUnityContainer&#32;session1Container&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session1Container.RegisterInstance&#38;lt&#59;ISession&#38;gt&#59;&#40;new&#32;Session&#40;&#41;,&#32;new&#32;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session1Container.Resolve&#38;lt&#59;SomeBusinessProcess&#38;gt&#59;&#40;&#41;.Execute&#40;1&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session1Container.Resolve&#38;lt&#59;SomeBusinessProcess&#38;gt&#59;&#40;&#41;.Execute&#40;1&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;&#38;quot&#59;&#61;&#61;&#61;&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;using&#32;&#40;IUnityContainer&#32;session2Container&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session2Container.RegisterInstance&#38;lt&#59;ISession&#38;gt&#59;&#40;new&#32;Session&#40;&#41;,&#32;new&#32;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session2Container.Resolve&#38;lt&#59;SomeBusinessProcess&#38;gt&#59;&#40;&#41;.Execute&#40;2&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session2Container.Resolve&#38;lt&#59;SomeBusinessProcess&#38;gt&#59;&#40;&#41;.Execute&#40;2&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;&#38;quot&#59;&#61;&#61;&#61;&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;using&#32;&#40;IUnityContainer&#32;session3Container&#32;&#61;&#32;container.CreateChildContainer&#40;&#41;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;try&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;session3Container.Resolve&#38;lt&#59;SomeBusinessProcess&#38;gt&#59;&#40;&#41;.Execute&#40;3&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;catch&#32;&#40;ResolutionFailedException&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;&#38;quot&#59;Session3&#32;container&#32;correctly&#32;detected&#32;no&#32;session&#32;is&#32;available&#38;quot&#59;&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.ReadLine&#40;&#41;&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;SomeBusinessProcess&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;ICustomerRepository&#32;CustomerRepository&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;SomeBusinessProcess&#40;ICustomerRepository&#32;customerRepository&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;CustomerRepository&#32;&#61;&#32;customerRepository&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;void&#32;Execute&#40;int&#32;customerID&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;&#38;quot&#59;Fetching&#32;customer&#32;&#123;0&#125;&#38;quot&#59;,&#32;customerID&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;var&#32;customer&#32;&#61;&#32;CustomerRepository.GetByID&#40;customerID&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;&#38;quot&#59;Got&#32;customer&#32;&#123;0&#125;&#38;quot&#59;,&#32;customer.ID&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;interface&#32;ISession&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;int&#32;ID&#32;&#123;&#32;get&#59;&#32;set&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;Session&#32;&#58;&#32;ISession&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;static&#32;int&#32;NextID&#32;&#61;&#32;1&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;int&#32;ID&#32;&#123;&#32;get&#59;&#32;set&#59;&#32;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;Session&#40;&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;ID&#32;&#61;&#32;NextID&#43;&#43;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;interface&#32;ICustomerRepository&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Customer&#32;GetByID&#40;int&#32;id&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;CustomerRepository&#32;&#58;&#32;ICustomerRepository&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;static&#32;int&#32;NextID&#32;&#61;&#32;1&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;ISession&#32;Session&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;readonly&#32;int&#32;ID&#59;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;CustomerRepository&#40;ISession&#32;session&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Session&#32;&#61;&#32;session&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;ID&#32;&#61;&#32;NextID&#43;&#43;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;Customer&#32;GetByID&#40;int&#32;id&#41;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;Console.WriteLine&#40;&#38;quot&#59;Repository&#32;&#123;0&#125;&#32;is&#32;using&#32;session&#32;&#123;1&#125;&#32;to&#32;get&#32;customer&#32;&#123;2&#125;&#38;quot&#59;,&#32;ID,&#32;Session.ID,&#32;id&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;return&#32;new&#32;Customer&#32;&#123;&#32;ID&#32;&#61;&#32;id&#32;&#125;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;class&#32;Customer&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#123;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;public&#32;int&#32;ID&#32;&#123;&#32;get&#59;&#32;set&#59;&#32;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#125;&#32;&#125;&#32;&#32;OUTPUT&#32;Fetching&#32;customer&#32;1&#32;Repository&#32;1&#32;is&#32;using&#32;session&#32;1&#32;to&#32;get&#32;customer&#32;1&#32;Got&#32;customer&#32;1&#32;Fetching&#32;customer&#32;1&#32;Repository&#32;1&#32;is&#32;using&#32;session&#32;1&#32;to&#32;get&#32;customer&#32;1&#32;Got&#32;customer&#32;1&#32;&#61;&#61;&#61;&#32;Fetching&#32;customer&#32;2&#32;Repository&#32;2&#32;is&#32;using&#32;session&#32;2&#32;to&#32;get&#32;customer&#32;2&#32;Got&#32;customer&#32;2&#32;Fetching&#32;customer&#32;2&#32;Repository&#32;2&#32;is&#32;using&#32;session&#32;2&#32;to&#32;get&#32;customer&#32;2&#32;Got&#32;customer&#32;2&#32;&#61;&#61;&#61;&#32;Session3&#32;container&#32;correctly&#32;detected&#32;no&#32;session&#32;is&#32;available&#32;&#32;">
        Hi Chris<br>
<br>
Works brilliantly, thanks so much!<br>
<br>
Pete<br>
<br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.Linq;<br>
using System.Text;<br>
using Microsoft.Practices.Unity;<br>
<br>
namespace ConsoleApplication44<br>
{<br>
&nbsp;&nbsp; &nbsp;class Program<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;static void Main(string[] args)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;IUnityContainer container = new UnityContainer();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;container.AddNewExtension&lt;HierarchicalLifetimeExtension&gt;();<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;container.RegisterType&lt;ICustomerRepository, CustomerRepository&gt;(new HierarchicalLifetimeManager());<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;using (IUnityContainer session1Container = container.CreateChildContainer())<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session1Container.RegisterInstance&lt;ISession&gt;(new Session(), new ContainerControlledLifetimeManager());<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session1Container.Resolve&lt;SomeBusinessProcess&gt;().Execute(1);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session1Container.Resolve&lt;SomeBusinessProcess&gt;().Execute(1);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(&quot;===&quot;);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;using (IUnityContainer session2Container = container.CreateChildContainer())<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session2Container.RegisterInstance&lt;ISession&gt;(new Session(), new ContainerControlledLifetimeManager());<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session2Container.Resolve&lt;SomeBusinessProcess&gt;().Execute(2);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session2Container.Resolve&lt;SomeBusinessProcess&gt;().Execute(2);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(&quot;===&quot;);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;using (IUnityContainer session3Container = container.CreateChildContainer())<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;try<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;session3Container.Resolve&lt;SomeBusinessProcess&gt;().Execute(3);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;catch (ResolutionFailedException)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(&quot;Session3 container correctly detected no session is available&quot;);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.ReadLine();<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class SomeBusinessProcess<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ICustomerRepository CustomerRepository;<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public SomeBusinessProcess(ICustomerRepository customerRepository)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;CustomerRepository = customerRepository;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public void Execute(int customerID)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(&quot;Fetching customer {0}&quot;, customerID);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;var customer = CustomerRepository.GetByID(customerID);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(&quot;Got customer {0}&quot;, customer.ID);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public interface ISession<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;int ID { get; set; }<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class Session : ISession<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;static int NextID = 1;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public int ID { get; set; }<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public Session()<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ID = NextID&#43;&#43;;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public interface ICustomerRepository<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Customer GetByID(int id);<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class CustomerRepository : ICustomerRepository<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;static int NextID = 1;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ISession Session;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;readonly int ID;<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public CustomerRepository(ISession session)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Session = session;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ID = NextID&#43;&#43;;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public Customer GetByID(int id)<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Console.WriteLine(&quot;Repository {0} is using session {1} to get customer {2}&quot;, ID, Session.ID, id);<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return new Customer { ID = id };<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;}<br>
<br>
&nbsp;&nbsp; &nbsp;public class Customer<br>
&nbsp;&nbsp; &nbsp;{<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;public int ID { get; set; }<br>
&nbsp;&nbsp; &nbsp;}<br>
}<br>
<br>
OUTPUT<br>
Fetching customer 1<br>
Repository 1 is using session 1 to get customer 1<br>
Got customer 1<br>
Fetching customer 1<br>
Repository 1 is using session 1 to get customer 1<br>
Got customer 1<br>
===<br>
Fetching customer 2<br>
Repository 2 is using session 2 to get customer 2<br>
Got customer 2<br>
Fetching customer 2<br>
Repository 2 is using session 2 to get customer 2<br>
Got customer 2<br>
===<br>
Session3 container correctly detected no session is available<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_171233" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="171241">
    <td id="PostDetailsCell_171241" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post171241"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/24/2009 9:45:56 AM" LocalTimeTicks="1237913156">Mar 24, 2009 at 9:45 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_171241" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="PS&#58;&#32;I&#32;really&#32;think&#32;this&#32;should&#32;be&#32;a&#32;standard&#32;part&#32;of&#32;the&#32;toolset,&#32;it&#39;s&#32;very&#32;useful&#33;&#32;">
        PS: I really think this should be a standard part of the toolset, it's very useful!<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_171241" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="171410">
    <td id="PostDetailsCell_171410" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post171410"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/24/2009 5:55:27 PM" LocalTimeTicks="1237942527">Mar 24, 2009 at 5:55 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_171410" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="It&#39;s&#32;certainly&#32;a&#32;candidate&#32;for&#32;including&#32;in&#32;V2.&#32;&#32;I&#32;would&#32;like&#32;to&#32;request&#32;that&#32;you&#32;do&#32;a&#32;thorough&#32;test&#32;pass&#32;on&#32;this&#32;code&#32;before&#32;deploying&#32;it.&#32;It&#32;hasn&#39;t&#32;been&#32;through&#32;any&#32;QA&#32;on&#32;our&#32;end&#59;&#32;I&#32;just&#32;threw&#32;it&#32;together&#32;in&#32;an&#32;hour.&#32;I&#39;m&#32;pretty&#32;sure&#32;it&#32;works,&#32;but&#32;there&#32;may&#32;be&#32;lingering&#32;nastiness&#32;in&#32;there&#32;I&#32;missed.&#32;&#32;On&#32;a&#32;completely&#32;different&#32;note,&#32;you&#32;don&#39;t&#32;need&#32;to&#32;specify&#32;ContainerControlledLifetimeManager&#32;when&#32;using&#32;container.RegisterInstance&#32;-&#32;that&#39;s&#32;the&#32;default.&#32;&#32;">
        It's certainly a candidate for including in V2.<br>
<br>
I would like to request that you do a thorough test pass on this code before deploying it. It hasn't been through any QA on our end; I just threw it together in an hour. I'm pretty sure it works, but there may be lingering nastiness in there I missed.<br>
<br>
On a completely different note, you don't need to specify ContainerControlledLifetimeManager when using container.RegisterInstance - that's the default.<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_171410" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="171418">
    <td id="PostDetailsCell_171418" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post171418"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/24/2009 6:04:45 PM" LocalTimeTicks="1237943085">Mar 24, 2009 at 6:04 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_171418" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="It&#32;seems&#32;to&#32;work&#32;just&#32;fine&#32;for&#32;what&#32;I&#32;need&#32;it&#32;to&#32;do.&#38;nbsp&#59;&#32;There&#32;are&#32;a&#32;few&#32;other&#32;things&#32;I&#32;think&#32;I&#32;might&#32;need&#32;to&#32;work&#32;out&#32;before&#32;I&#32;continue,&#32;but&#32;things&#32;are&#32;looking&#32;good&#32;&#58;-&#41;&#32;&#32;As&#32;for&#32;ContainerControlledLifetimeManager,&#32;I&#32;like&#32;to&#32;be&#32;explicit&#32;&#58;-&#41;&#32;">
        It seems to work just fine for what I need it to do.&nbsp; There are a few other things I think I might need to work out before I continue, but things are looking good :-)<br>
<br>
As for ContainerControlledLifetimeManager, I like to be explicit :-)<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_171418" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="218866">
    <td id="PostDetailsCell_218866" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post218866"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/hwiechers">hwiechers</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/3/2009 5:11:09 PM" LocalTimeTicks="1249344669">Aug 3, 2009 at 5:11 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_218866" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;var&#32;parent&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;.AddNewExtension&#38;lt&#59;HierarchicalLifetimeExtension&#38;gt&#59;&#40;&#41;&#59;var&#32;child&#32;&#61;&#32;parent.CreateChildContainer&#40;&#41;&#59;var&#32;parent.RegisterType&#38;lt&#59;DisposableFoo&#38;gt&#59;&#40;new&#32;HierarchicalLifetimeManager&#40;&#41;&#41;&#59;var&#32;foo&#32;&#61;&#32;child.Resolve&#38;lt&#59;DisposableFoo&#38;gt&#59;&#40;&#41;&#59;child.Dispose&#40;&#41;&#59;Debug.Assert&#40;foo.IsDisposed&#41;&#59;&#32;&#32;I&#32;expected&#32;the&#32;assert&#32;on&#32;the&#32;last&#32;line&#32;to&#32;pass&#32;as&#32;foo&#32;is&#32;scoped&#32;to&#32;the&#32;child&#32;container&#32;but&#32;it&#32;doesn&#39;t.Is&#32;this&#32;a&#32;bug&#32;in&#32;HierarchicalLifetimeManager&#32;or&#32;am&#32;I&#32;misunderstanding&#32;this&#32;thing&#63;&#32;Also&#32;will&#32;HierarchicalLifetimeManager&#32;be&#32;in&#32;V2&#63;&#32;It&#32;would&#32;be&#32;useful&#32;to&#32;me.&#32;&#38;nbsp&#59;">
        
<div style="color:Black; background-color:White">
<pre><span style="color:Blue">var</span> parent = <span style="color:Blue">new</span> UnityContainer().AddNewExtension&lt;HierarchicalLifetimeExtension&gt;();<br><span style="color:Blue">var</span> child = parent.CreateChildContainer();<br><span style="color:Blue">var</span> parent.RegisterType&lt;DisposableFoo&gt;(<span style="color:Blue">new</span> HierarchicalLifetimeManager());<br><br><span style="color:Blue">var</span> foo = child.Resolve&lt;DisposableFoo&gt;();<br>child.Dispose();<br>Debug.Assert(foo.IsDisposed);<br></pre>
</div>
<p>I expected the assert on the last line to pass as foo is scoped to the child container but it doesn't.<br>
Is this a bug in HierarchicalLifetimeManager or am I misunderstanding this thing?</p>
<p>Also will HierarchicalLifetimeManager be in V2? It would be useful to me.</p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_218866" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="221415">
    <td id="PostDetailsCell_221415" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post221415"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/jnykiel">jnykiel</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/10/2009 7:31:32 AM" LocalTimeTicks="1249914692">Aug 10, 2009 at 7:31 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_221415" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="hwiechers,&#32;I&#32;stumbled&#32;upon&#32;the&#32;same&#32;problem&#32;and&#32;solved&#32;it&#32;like&#32;this&#58;&#32;&#32;&#32;public&#32;interface&#32;IHierarchicalLifetime&#32;&#123;&#32;&#125;&#32;public&#32;class&#32;HierarchicalLifetimeManager&#32;&#58;&#32;ContainerControlledLifetimeManager,&#32;IHierarchicalLifetime&#32;&#123;&#32;&#125;&#32;public&#32;class&#32;HierarchicalLifetimeStrategy&#32;&#58;&#32;BuilderStrategy&#32;&#123;&#32;public&#32;override&#32;void&#32;PreBuildUp&#40;IBuilderContext&#32;context&#41;&#32;&#123;&#32;ILifetimePolicy&#32;activeLifetime&#32;&#61;&#32;context.PersistentPolicies.Get&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;context.BuildKey&#41;&#59;&#32;if&#32;&#40;activeLifetime&#32;is&#32;IHierarchicalLifetime&#41;&#32;&#123;&#32;&#47;&#47;&#32;did&#32;this&#32;come&#32;from&#32;the&#32;local&#32;container&#32;or&#32;the&#32;parent&#63;&#32;&#32;ILifetimePolicy&#32;localLifetime&#32;&#61;&#32;context.PersistentPolicies.Get&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;context.BuildKey,&#32;true&#41;&#59;&#32;if&#32;&#40;localLifetime&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;localLifetime&#32;&#61;&#32;&#40;ILifetimePolicy&#41;Activator.CreateInstance&#40;activeLifetime.GetType&#40;&#41;&#41;&#59;&#32;context.PersistentPolicies.Set&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;localLifetime,&#32;context.BuildKey&#41;&#59;&#32;context.Lifetime.Add&#40;localLifetime&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#125;&#32;public&#32;class&#32;HierarchicalLifetimeExtension&#32;&#58;&#32;UnityContainerExtension&#32;&#123;&#32;protected&#32;override&#32;void&#32;Initialize&#40;&#41;&#32;&#123;&#32;&#47;&#47;&#32;Add&#32;to&#32;type&#32;mapping&#32;stage&#32;so&#32;that&#32;it&#32;runs&#32;before&#32;the&#32;lifetime&#32;stage&#32;&#32;Context.Strategies.AddNew&#38;lt&#59;HierarchicalLifetimeStrategy&#38;gt&#59;&#40;UnityBuildStage.TypeMapping&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;">
        
<p>hwiechers, I stumbled upon the same problem and solved it like this:</p>
<div style="color:Black; background-color:White">
<pre>    <span style="color:Blue">public</span> <span style="color:Blue">interface</span><span style="color:MediumTurquoise"> IHierarchicalLifetime
    </span>{
    }

    <span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeManager : ContainerControlledLifetimeManager, IHierarchicalLifetime
    </span>{
    }

    <span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeStrategy : BuilderStrategy
    </span>{
        <span style="color:Blue">public</span> <span style="color:Blue">override</span> <span style="color:Blue">void</span> PreBuildUp(IBuilderContext context)
        {
            ILifetimePolicy activeLifetime = context.PersistentPolicies.Get&lt;ILifetimePolicy&gt;(context.BuildKey);
            <span style="color:Blue">if</span> (activeLifetime <span style="color:Blue">is</span> IHierarchicalLifetime)
            {
                <span style="color:Green">// did this come from the local container or the parent?                </span>
                ILifetimePolicy localLifetime = context.PersistentPolicies.Get&lt;ILifetimePolicy&gt;(context.BuildKey, <span style="color:Blue">true</span>);
                <span style="color:Blue">if</span> (localLifetime == <span style="color:Blue">null</span>)
                {
                    localLifetime = (ILifetimePolicy)Activator.CreateInstance(activeLifetime.GetType());
                    context.PersistentPolicies.Set&lt;ILifetimePolicy&gt;(localLifetime, context.BuildKey);
                    context.Lifetime.Add(localLifetime);
                }
            }
        }
    }

    <span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeExtension : UnityContainerExtension
    </span>{
        <span style="color:Blue">protected</span> <span style="color:Blue">override</span> <span style="color:Blue">void</span> Initialize()
        {
            <span style="color:Green">// Add to type mapping stage so that it runs before the lifetime stage            </span>
            Context.Strategies.AddNew&lt;HierarchicalLifetimeStrategy&gt;(UnityBuildStage.TypeMapping);
        }
    }
</pre>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_221415" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="222040">
    <td id="PostDetailsCell_222040" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post222040"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/jaxoson">jaxoson</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/11/2009 2:56:13 PM" LocalTimeTicks="1250027773">Aug 11, 2009 at 2:56 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_222040" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="jnykiel&#32;wrote&#58;&#32;hwiechers,&#32;I&#32;stumbled&#32;upon&#32;the&#32;same&#32;problem&#32;and&#32;solved&#32;it&#32;like&#32;this&#58;&#32;&#32;&#32;public&#32;interface&#32;IHierarchicalLifetime&#32;&#123;&#32;&#125;&#32;public&#32;class&#32;HierarchicalLifetimeManager&#32;&#58;&#32;ContainerControlledLifetimeManager,&#32;IHierarchicalLifetime&#32;&#123;&#32;&#125;&#32;public&#32;class&#32;HierarchicalLifetimeStrategy&#32;&#58;&#32;BuilderStrategy&#32;&#123;&#32;public&#32;override&#32;void&#32;PreBuildUp&#40;IBuilderContext&#32;context&#41;&#32;&#123;&#32;ILifetimePolicy&#32;activeLifetime&#32;&#61;&#32;context.PersistentPolicies.Get&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;context.BuildKey&#41;&#59;&#32;if&#32;&#40;activeLifetime&#32;is&#32;IHierarchicalLifetime&#41;&#32;&#123;&#32;&#47;&#47;&#32;did&#32;this&#32;come&#32;from&#32;the&#32;local&#32;container&#32;or&#32;the&#32;parent&#63;&#32;&#32;ILifetimePolicy&#32;localLifetime&#32;&#61;&#32;context.PersistentPolicies.Get&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;context.BuildKey,&#32;true&#41;&#59;&#32;if&#32;&#40;localLifetime&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;localLifetime&#32;&#61;&#32;&#40;ILifetimePolicy&#41;Activator.CreateInstance&#40;activeLifetime.GetType&#40;&#41;&#41;&#59;&#32;context.PersistentPolicies.Set&#38;lt&#59;ILifetimePolicy&#38;gt&#59;&#40;localLifetime,&#32;context.BuildKey&#41;&#59;&#32;context.Lifetime.Add&#40;localLifetime&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#125;&#32;public&#32;class&#32;HierarchicalLifetimeExtension&#32;&#58;&#32;UnityContainerExtension&#32;&#123;&#32;protected&#32;override&#32;void&#32;Initialize&#40;&#41;&#32;&#123;&#32;&#47;&#47;&#32;Add&#32;to&#32;type&#32;mapping&#32;stage&#32;so&#32;that&#32;it&#32;runs&#32;before&#32;the&#32;lifetime&#32;stage&#32;&#32;Context.Strategies.AddNew&#38;lt&#59;HierarchicalLifetimeStrategy&#38;gt&#59;&#40;UnityBuildStage.TypeMapping&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;&#32;&#32;&#38;nbsp&#59;&#32;Looking&#32;at&#32;your&#32;use&#32;of&#32;IHierarchicalLifetime&#32;made&#32;me&#32;think&#32;we&#32;could&#32;make&#32;a&#32;generic&#32;version&#32;that&#32;allows&#32;us&#32;to&#32;give&#32;hierarchical&#32;capability&#32;to&#32;any&#32;existing&#32;lifetime&#32;manager.&#32;By&#32;changing&#32;HierarchicalLifetimeManager&#32;to&#32;the&#32;following,&#32;I&#32;think&#32;it&#32;can&#32;do&#32;just&#32;that&#58;&#32;&#32;public&#32;class&#32;HierarchicalLifetimeManager&#38;lt&#59;t&#38;gt&#59;&#32;&#58;&#32;LifetimeManager,&#32;IHierarchicalLifetime&#32;where&#32;t&#32;&#58;&#32;LifetimeManager,&#32;new&#40;&#41;&#32;&#123;&#32;private&#32;LifetimeManager&#32;_innerManager&#59;&#32;public&#32;HierarchicalLifetimeManager&#40;&#41;&#32;&#123;&#32;_innerManager&#32;&#61;&#32;new&#32;t&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#32;return&#32;_innerManager.GetValue&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#32;_innerManager.RemoveValue&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#32;_innerManager.SetValue&#40;newValue&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;">
        
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
<strong>jnykiel wrote:</strong><br>
<p>hwiechers, I stumbled upon the same problem and solved it like this:</p>
<div style="color:Black; background-color:White">
<pre>    <span style="color:Blue">public</span> <span style="color:Blue">interface</span><span style="color:MediumTurquoise"> IHierarchicalLifetime
    </span>{
    }

    <span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeManager : ContainerControlledLifetimeManager, IHierarchicalLifetime
    </span>{
    }

    <span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeStrategy : BuilderStrategy
    </span>{
        <span style="color:Blue">public</span> <span style="color:Blue">override</span> <span style="color:Blue">void</span> PreBuildUp(IBuilderContext context)
        {
            ILifetimePolicy activeLifetime = context.PersistentPolicies.Get&lt;ILifetimePolicy&gt;(context.BuildKey);
            <span style="color:Blue">if</span> (activeLifetime <span style="color:Blue">is</span> IHierarchicalLifetime)
            {
                <span style="color:Green">// did this come from the local container or the parent?                </span>
                ILifetimePolicy localLifetime = context.PersistentPolicies.Get&lt;ILifetimePolicy&gt;(context.BuildKey, <span style="color:Blue">true</span>);
                <span style="color:Blue">if</span> (localLifetime == <span style="color:Blue">null</span>)
                {
                    localLifetime = (ILifetimePolicy)Activator.CreateInstance(activeLifetime.GetType());
                    context.PersistentPolicies.Set&lt;ILifetimePolicy&gt;(localLifetime, context.BuildKey);
                    context.Lifetime.Add(localLifetime);
                }
            }
        }
    }

    <span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeExtension : UnityContainerExtension
    </span>{
        <span style="color:Blue">protected</span> <span style="color:Blue">override</span> <span style="color:Blue">void</span> Initialize()
        {
            <span style="color:Green">// Add to type mapping stage so that it runs before the lifetime stage            </span>
            Context.Strategies.AddNew&lt;HierarchicalLifetimeStrategy&gt;(UnityBuildStage.TypeMapping);
        }
    }
</pre>
</div>
</blockquote>
<p>&nbsp;</p>
<p>Looking at your use of IHierarchicalLifetime made me think we could make a generic version that allows us to give hierarchical capability to any existing lifetime manager.</p>
<p>By changing HierarchicalLifetimeManager to the following, I think it can do just that:</p>
<div style="color:Black; background-color:White">
<pre><span style="color:Blue">public</span> <span style="color:Blue">class</span><span style="color:MediumTurquoise"> HierarchicalLifetimeManager&lt;t&gt; : LifetimeManager, IHierarchicalLifetime
    where t : LifetimeManager, new()
</span>{
    <span style="color:Blue">private</span> LifetimeManager _innerManager;

    <span style="color:Blue">public</span> HierarchicalLifetimeManager()
    {
        _innerManager = <span style="color:Blue">new</span> t();
    }

    <span style="color:Blue">public</span> <span style="color:Blue">override</span> <span style="color:Blue">object</span> GetValue()
    {
        <span style="color:Blue">return</span> _innerManager.GetValue();
    }

    <span style="color:Blue">public</span> <span style="color:Blue">override</span> <span style="color:Blue">void</span> RemoveValue()
    {
        _innerManager.RemoveValue();
    }

    <span style="color:Blue">public</span> <span style="color:Blue">override</span> <span style="color:Blue">void</span> SetValue(<span style="color:Blue">object</span> newValue)
    {
        _innerManager.SetValue(newValue);
    }
}
</pre>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_222040" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="222059">
    <td id="PostDetailsCell_222059" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post222059"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/jnykiel">jnykiel</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/11/2009 3:46:55 PM" LocalTimeTicks="1250030815">Aug 11, 2009 at 3:46 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_222059" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="jaxoson,&#32;the&#32;decorator&#32;approach&#32;is&#32;not&#32;that&#32;simple,&#32;because&#32;lifetime&#32;managers&#32;are&#32;treated&#32;differently&#32;depending&#32;on&#32;whether&#32;they&#32;implement&#32;IDisposable.&#32;You&#39;d&#32;need&#32;two&#32;generic&#32;hierarchical&#32;lifetime&#32;classes&#32;-&#32;one&#32;that&#32;implements&#32;IDisposable&#32;&#40;delegating&#32;it&#38;nbsp&#59;to&#32;the&#32;_innerManager&#41;&#38;nbsp&#59;in&#32;addition&#32;to&#38;nbsp&#59;one&#32;that&#32;doesn&#39;t,&#32;which&#32;you&#32;posted.&#32;If&#32;you&#32;decorate&#32;a&#32;disposable&#32;lifetime&#32;manager&#32;with&#32;the&#32;class&#32;you&#32;posted,&#32;the&#32;objects&#32;it&#32;manages&#32;won&#39;t&#32;get&#32;disposed.">
        
<p>jaxoson, the decorator approach is not that simple, because lifetime managers are treated differently depending on whether they implement IDisposable. You'd need two generic hierarchical lifetime classes - one that implements IDisposable (delegating it&nbsp;to
 the _innerManager)&nbsp;in addition to&nbsp;one that doesn't, which you posted. If you decorate a disposable lifetime manager with the class you posted, the objects it manages won't get disposed.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_222059" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="222793">
    <td id="PostDetailsCell_222793" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post222793"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/jaxoson">jaxoson</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/13/2009 3:13:28 AM" LocalTimeTicks="1250158408">Aug 13, 2009 at 3:13 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="8/13/2009 3:22:30 AM" LocalTimeTicks="1250158950">Aug 13, 2009 at 3:22 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_222793" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Thanks&#32;for&#32;the&#32;info&#32;jnykiel.&#38;nbsp&#59;Other&#32;than&#32;any&#32;performance&#32;hit&#32;of&#32;treating&#32;a&#32;non-disposable&#32;lifetime&#32;manager&#32;as&#32;disposable,&#32;are&#32;there&#32;any&#32;issues&#32;with&#32;just&#32;implementing&#32;IDisposable,&#32;and&#32;checking&#32;to&#32;see&#32;if&#32;the&#32;inner&#32;manager&#32;also&#32;implements&#32;it&#32;during&#38;nbsp&#59;the&#32;disposal&#63;&#32;In&#32;other&#32;words,&#32;doing&#32;something&#32;like&#32;the&#32;following&#58;&#32;&#32;public&#32;void&#32;Dispose&#40;&#41;&#32;&#123;&#32;var&#32;disposableManager&#32;&#61;&#32;_innerManager&#32;as&#32;IDisposable&#59;&#32;if&#32;&#40;disposableManager&#32;&#33;&#61;&#32;null&#41;&#32;disposableManager.Dispose&#40;&#41;&#59;&#32;&#125;&#32;&#32;&#32;">
        
<p>Thanks for the info jnykiel.&nbsp;Other than any performance hit of treating a non-disposable lifetime manager as disposable, are there any issues with just implementing IDisposable, and checking to see if the inner manager also implements it during&nbsp;the
 disposal? In other words, doing something like the following:</p>
<div style="color:Black; background-color:White">
<pre><div style="color:Black; background-color:White"><pre><span style="color:Blue">public</span> <span style="color:Blue">void</span> Dispose()
{
    <span style="color:Blue">var</span> disposableManager = _innerManager <span style="color:Blue">as</span> IDisposable;

    <span style="color:Blue">if</span> (disposableManager != <span style="color:Blue">null</span>)            
        disposableManager.Dispose();                       
}</pre>
</div>
</pre>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_222793" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="484660">
    <td id="PostDetailsCell_484660" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post484660"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rvukovic">rvukovic</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/25/2010 1:59:00 PM" LocalTimeTicks="1282769940">Aug 25, 2010 at 1:59 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_484660" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="I&#32;see&#32;that&#32;we&#32;now&#32;have&#32;HierarchicalLifetimeManager&#32;in&#32;Unity&#32;2.0.&#32;Can&#32;this&#32;somehow&#32;be&#32;used&#32;for&#32;the&#32;Per&#32;Request&#32;creating&#32;of&#32;Entity&#32;Framework&#39;s&#32;context&#32;or&#32;I&#32;am&#32;missing&#32;the&#32;point&#32;&#63;&#32;Or&#32;we&#32;should&#32;use&#32;custom&#32;lifetime&#32;manages&#32;for&#32;the&#32;per&#32;request&#32;lifetime&#63;">
        
<p>I see that we now have HierarchicalLifetimeManager in Unity 2.0.</p>
<p>Can this somehow be used for the Per Request creating of Entity Framework's context or I am missing the point ?</p>
<p>Or we should use custom lifetime manages for the per request lifetime?</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_484660" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="484675">
    <td id="PostDetailsCell_484675" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post484675"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/25/2010 2:26:57 PM" LocalTimeTicks="1282771617">Aug 25, 2010 at 2:26 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_484675" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="rvukovic&#32;wrote&#58;&#32;I&#32;see&#32;that&#32;we&#32;now&#32;have&#32;HierarchicalLifetimeManager&#32;in&#32;Unity&#32;2.0.&#32;Can&#32;this&#32;somehow&#32;be&#32;used&#32;for&#32;the&#32;Per&#32;Request&#32;creating&#32;of&#32;Entity&#32;Framework&#39;s&#32;context&#32;or&#32;I&#32;am&#32;missing&#32;the&#32;point&#32;&#63;&#32;Or&#32;we&#32;should&#32;use&#32;custom&#32;lifetime&#32;manages&#32;for&#32;the&#32;per&#32;request&#32;lifetime&#63;&#32;&#32;The&#32;purpose&#32;of&#32;this&#32;lifetime&#32;manager&#32;was&#32;so&#32;that&#32;you&#32;can&#32;register&#32;your&#32;IUnitOfWork&#32;etc&#32;in&#32;the&#32;main&#32;container&#32;using&#32;HierarchicalLifetimeManager.&#32;&#38;nbsp&#59;Then&#32;for&#32;each&#32;request&#32;you&#32;create&#32;a&#32;child&#32;container,&#32;when&#32;something&#32;within&#32;that&#32;child&#32;container&#32;needs&#32;IUnitOfWork&#32;for&#32;the&#32;first&#32;time&#32;it&#32;will&#32;create&#32;it&#32;in&#32;the&#32;child&#32;container,&#32;every&#32;subsequent&#32;request&#32;will&#32;return&#32;the&#32;same&#32;instance.&#32;&#38;nbsp&#59;This&#32;way&#32;you&#32;get&#32;the&#32;same&#32;behaviour&#32;as&#32;if&#32;you&#32;had&#32;registered&#32;IUnitOfWork&#32;as&#32;a&#32;ContainerControlledLifetimeManager&#32;in&#32;the&#32;child&#32;container,&#32;but&#32;in&#32;fact&#32;you&#32;registered&#32;it&#32;in&#32;the&#32;parent&#32;container.&#32;&#38;nbsp&#59;&#32;Does&#32;that&#32;help&#63;&#32;&#38;nbsp&#59;">
        
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
<strong>rvukovic wrote:</strong><br>
<p>I see that we now have HierarchicalLifetimeManager in Unity 2.0.</p>
<p>Can this somehow be used for the Per Request creating of Entity Framework's context or I am missing the point ?</p>
<p>Or we should use custom lifetime manages for the per request lifetime?</p>
</blockquote>
<p>The purpose of this lifetime manager was so that you can register your IUnitOfWork etc in the main container using HierarchicalLifetimeManager. &nbsp;Then for each request you create a child container, when something within that child container needs IUnitOfWork
 for the first time it will create it in the child container, every subsequent request will return the same instance. &nbsp;This way you get the same behaviour as if you had registered IUnitOfWork as a ContainerControlledLifetimeManager in the child container,
 but in fact you registered it in the parent container.</p>
<p>&nbsp;</p>
<p>Does that help?</p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_484675" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="484683">
    <td id="PostDetailsCell_484683" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post484683"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/rvukovic">rvukovic</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/25/2010 2:44:53 PM" LocalTimeTicks="1282772693">Aug 25, 2010 at 2:44 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_484683" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="mrpmorris&#32;wrote&#58;&#32;The&#32;purpose&#32;of&#32;this&#32;lifetime&#32;manager&#32;was&#32;so&#32;that&#32;you&#32;can&#32;register&#32;your&#32;IUnitOfWork&#32;etc&#32;in&#32;the&#32;main&#32;container&#32;using&#32;HierarchicalLifetimeManager.&#32;&#38;nbsp&#59;Then&#32;for&#32;each&#32;request&#32;you&#32;create&#32;a&#32;child&#32;container,&#32;when&#32;something&#32;within&#32;that&#32;child&#32;container&#32;needs&#32;IUnitOfWork&#32;for&#32;the&#32;first&#32;time&#32;it&#32;will&#32;create&#32;it&#32;in&#32;the&#32;child&#32;container,&#32;every&#32;subsequent&#32;request&#32;will&#32;return&#32;the&#32;same&#32;instance.&#32;&#38;nbsp&#59;This&#32;way&#32;you&#32;get&#32;the&#32;same&#32;behaviour&#32;as&#32;if&#32;you&#32;had&#32;registered&#32;IUnitOfWork&#32;as&#32;a&#32;ContainerControlledLifetimeManager&#32;in&#32;the&#32;child&#32;container,&#32;but&#32;in&#32;fact&#32;you&#32;registered&#32;it&#32;in&#32;the&#32;parent&#32;container.&#32;So&#32;I&#32;understood&#32;correctly&#32;the&#32;intention&#32;but&#32;I&#32;just&#32;can&#32;not&#32;band&#32;my&#32;mind&#32;from&#32;the&#32;example&#32;to&#32;the&#32;concrete&#32;usage.&#38;nbsp&#59;&#32;Parent&#32;&#38;lt&#59;-&#38;gt&#59;&#32;child&#32;relation&#32;is&#32;confusing&#32;me,&#32;which&#32;one&#32;should&#32;I&#32;use.&#32;Lets&#32;say&#32;I&#32;am&#32;using&#32;MVC&#32;2&#32;and&#32;I&#32;register&#58;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;container.RegisterType&#38;lt&#59;&#32;....&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;var&#32;controllerFactory&#32;&#61;&#32;new&#32;UnityControllerFactory&#40;container&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#32;ControllerBuilder.Current.SetControllerFactory&#40;controllerFactory&#41;&#59;&#32;I&#32;should&#32;then&#32;in&#32;the&#32;HttpApplication&#32;BeginRequest&#32;create&#32;Child&#32;controller&#32;with&#32;the&#32;Context&#47;Session&#32;and&#32;then&#32;kill&#32;Child&#32;container&#32;at&#32;the&#32;EndRequest&#63;&#32;I&#32;will&#32;try&#32;and&#32;see&#32;if&#32;this&#32;is&#32;working.&#32;&#38;nbsp&#59;&#32;">
        
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
<strong>mrpmorris wrote:</strong></blockquote>
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
The purpose of this lifetime manager was so that you can register your IUnitOfWork etc in the main container using HierarchicalLifetimeManager. &nbsp;Then for each request you create a child container, when something within that child container needs IUnitOfWork
 for the first time it will create it in the child container, every subsequent request will return the same instance. &nbsp;This way you get the same behaviour as if you had registered IUnitOfWork as a ContainerControlledLifetimeManager in the child container,
 but in fact you registered it in the parent container.</blockquote>
<p>So I understood correctly the intention but I just can not band my mind from the example to the concrete usage.&nbsp; Parent &lt;-&gt; child relation is confusing me, which one should I use.</p>
<p>Lets say I am using MVC 2 and I register:</p>
<p>&nbsp;&nbsp;&nbsp; container.RegisterType&lt; ....<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
<br>
&nbsp;&nbsp;&nbsp; var controllerFactory = new UnityControllerFactory(container);<br>
&nbsp;&nbsp;&nbsp; ControllerBuilder.Current.SetControllerFactory(controllerFactory);</p>
<p>I should then in the HttpApplication BeginRequest create Child controller with the Context/Session and then kill Child container at the EndRequest? I will try and see if this is working.</p>
<p>&nbsp;</p>
<pre style="font-family:consolas"><span style="color:#ff8000"><br></span></pre>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_484683" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="484686">
    <td id="PostDetailsCell_484686" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post484686"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/mrpmorris">mrpmorris</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="8/25/2010 2:50:26 PM" LocalTimeTicks="1282773026">Aug 25, 2010 at 2:50 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_484686" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="Have&#32;a&#32;single&#32;container&#32;which&#32;is&#32;there&#32;for&#32;2&#32;purposes&#32;&#38;nbsp&#59;&#32;1&#58;&#32;To&#32;register&#32;everything&#32;that&#32;will&#32;exist&#32;in&#32;the&#32;child&#32;containers.&#32;2&#58;&#32;The&#32;contain&#32;services&#32;which&#32;should&#32;be&#32;shared&#32;across&#32;requests&#32;Every&#32;request&#32;should&#32;be&#32;done&#32;in&#32;a&#32;child&#32;container.&#32;&#38;nbsp&#59;If&#32;you&#32;are&#32;using&#32;ASP&#32;MVC&#32;&#40;which&#32;it&#32;looks&#32;like&#32;you&#32;are&#41;&#32;then&#32;I&#32;created&#32;an&#32;example&#32;http&#58;&#47;&#47;www.capableobjects.com&#47;apps&#47;InstantForum414&#47;Topic5354-4-1.aspx&#32;You&#39;ll&#32;need&#32;to&#32;download&#32;the&#32;object&#32;persistence&#32;framework&#32;ECO&#32;from&#32;http&#58;&#47;&#47;www.capableobjects.com&#32;to&#32;use&#32;it.&#32;&#38;nbsp&#59;The&#32;demo&#32;has&#32;less&#32;than&#32;13&#32;classes&#32;so&#32;you&#32;don&#39;t&#32;need&#32;a&#32;license.">
        
<p>Have a single container which is there for 2 purposes</p>
<p>&nbsp;</p>
<p>1: To register everything that will exist in the child containers.</p>
<p>2: The contain services which should be shared across requests</p>
<p>Every request should be done in a child container. &nbsp;If you are using ASP MVC (which it looks like you are) then I created an example</p>
<p>http://www.capableobjects.com/apps/InstantForum414/Topic5354-4-1.aspx</p>
<p>You'll need to download the object persistence framework ECO from http://www.capableobjects.com to use it. &nbsp;The demo has less than 13 classes so you don't need a license.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_484686" class="Options" >
            
        </div>
        
    </td>
</tr>

</table>
    </div>

    
        <div class="StandardMarginTop">
            <a id="SignInToAddCommentLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f46415">
                Sign in to post message or set email notifications
            </a>
        </div>
    


    <div id="PostEditorContainer">
        <a name="editor"></a>
        <div id="Editor" style="display: none;">
            

<div class="MarkdownEditor" data-options-id="d3e71463-9c5b-4192-8113-5cce525c2840">
    <script class="options" defer="defer" id="d3e71463-9c5b-4192-8113-5cce525c2840" type="application/json">{"maxLength":10000,"styleSheetLocation":""}</script>

    <div class="MarkdownEditorControls">
        <a href="#" tabindex="-1" class="control md_help" title="Markdown Syntax Guide"></a>
        <div class="control md_divider"></div>
        <a href="#" tabindex="-1" class="control md_header" title="Insert Header (CTRL + H)"></a>
        <a href="#" tabindex="-1" class="control md_code" title="Insert Code (CTRL + K)"></a>
        <a href="#" tabindex="-1" class="control md_quote" title="Insert Quote (CTRL + Q)"></a>
        <a href="#" tabindex="-1" class="control md_img" title="Insert Img (CTRL + G)"></a>
        <a href="#" tabindex="-1" class="control md_link" title="Insert Link (CTRL + L)"></a>
        <a href="#" tabindex="-1" class="control md_ulist" title="Unordered List (CTRL + U)"></a>
        <a href="#" tabindex="-1" class="control md_olist" title="Ordered List (CTRL + O)"></a>
        <a href="#" tabindex="-1" class="control md_italics" title="Italic Text (CTRL + I)"></a>
        <a href="#" tabindex="-1" class="control md_bold" title="Bold Text (CTRL + B)"></a>
    </div>

    

<div class="tab_control">
    <!-- Generate the basic HTML for the tabs. -->
    
        <div id="Compose"
              class="tab selected"
              data-custom-header-id=""
              data-tab-contents-id="compose_contents_d9eea839-6dc7-4f92-aa5b-ef8964f0cc1c">
            Compose
        </div>
    
        <div id="Preview"
              class="tab "
              data-custom-header-id=""
              data-tab-contents-id="preview_contents_d2be5a45-9553-4778-8161-b604761ec5e4">
            Preview
        </div>
    
    <div class="clear"></div>
</div>


    <div id="compose_contents_d9eea839-6dc7-4f92-aa5b-ef8964f0cc1c" class="compose_tab_content">
        <textarea class=" MarkdownEditorDimensions" cols="20" id="MarkdownEditor" name="content" rows="2">
</textarea>
        <div class="ClearBoth"></div>

        <div class="markdownGuide" style="display: none">
            <table>
                <tr>
                    <td class="markdownGuideColumn">
                        <h1>Text Formatting</h1>
                        <div># Header 1</div>
                        <div>## Header 2</div>
                        <br />
                        <div>*italics* (or _italics_)</div>
                        <div>**bold** (or __bold__)</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Lists</h1>
                        <div>* Unordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp * SubItem</div>
                        <br />
                        <div>1. Ordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1. SubItem</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Quotes</h1>
                        <div>> Lorem ipsum</div>
                        <div>dolor sitamet </div>
                        <div>non. Lectus at</div>
                        <div>nam nunc...</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Code</h1>
                        <div>`Inline Code`</div>
                        <br />
                        <div>``` C#</div>
                        <div>if (foo==bar)</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbar++</div>
                        <div>```</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>References</h1>
                        <div>[Link Text](URL)</div>
                        <br />
                        <div>![Image](URL)</div>
                        <br />
                        <a class="Reference" target="_blank" href="http://codeplex.codeplex.com/wikipage?title=Markdown&referringTitle=Documentation">Markdown Reference</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="preview_contents_d2be5a45-9553-4778-8161-b604761ec5e4" class="preview_tab_content markDownOutput">
        
            <div></div>
        
    </div>
    <div class="clear"></div>
</div>

            
            <div class="row" id="recaptcha_row">
                
<script type="text/javascript">
    $(document).ready(function () {
        $('#recaptcha_reload').attr('src', '../assets/recaptcha_refresh.png');
        $('#recaptcha_switch_audio').attr('src', '../assets/recaptcha_audio.png');
        $('#recaptcha_switch_img').attr('src', '../assets/recaptcha_text.png');
        $('#recaptcha_whatsthis').attr('src', '../assets/recaptcha_help.png');
        $('#recaptcha_area tr:first').attr('height', '35');
    });
</script>

                <div class="clear"></div>
                <span id="ReCaptchaError"></span>
            </div>
            <div style="padding-top: 6px;">
                <input type="button" id="SaveButton" value="Save" class="ok" />
                <input type="button" id="CancelButton" value="Cancel" class="cancel" />
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div id="DeletePostPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Post <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this post? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="ClosePostCancel" value="Cancel" class="cancel" />
            <input type="button" id="ClosePostOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>
        
            <!-- Email notification / Subscription details -->
            
    </div>
</div>
    
<div id="DeleteThreadPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Thread <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this thread? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="CloseThreadCancel" value="Cancel" class="cancel" />
            <input type="button" id="CloseThreadOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(function () {

        $('#recaptcha_response_field')
            .bind('keypress', function (event) { return $submitKeyPressElement(this, event); });


        if ($('#DeleteThreadLink')) {
            $('#DeleteThreadLink').click(function () {
                OpenDialog('#DeleteThreadPanel', true, '41em');
            });
        }
        
        $('#DeleteThreadPanel #CloseThreadOk').click(function () {
            var url = 'http://unity.codeplex.com/discussions/46415';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (x) {
                    location.href = x.RedirectUrl;
                }
            });
        });
    });

    workItemMention = new codeplex.ui.WorkItemMention();
    workItemMention.addLinks(".discussionPost");
</script>


        
        
                
                <div class="clear"></div>
                
                <div id="footer">
                    <div class="row">
                        <hr />
                        <ul>
                            <li>Â© 2006-2017 Microsoft</li>
                            <li><a href="http://www.codeplex.com/site/help">Get Help</a></li>
                            <li><a href="/site/legal/privacy">Privacy Statement</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/terms">Terms of Use</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/conduct">Code of Conduct</a></li>
                            <li><a href="http://developermedia.com/" target="_blank">Advertise With Us</a></li>
                            <li>Version 2017.10.3.21062</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </body>

</html>