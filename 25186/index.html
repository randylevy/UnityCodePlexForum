

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="" prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile#">
    
    
    
    

    
    <head>
        <meta id="CompatabilityMode" http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../assets/StyleSheet.css" id="MasterCss" rel="stylesheet" type="text/css" />
        <link rel="SHORTCUT ICON" href="../assets/favicon.ico" />
        <title>patterns &#38; practices - Unity - Unity with WCF services</title>
        
       
                    <script src="../assets/mscc-0.3.6.min.js"></script>
        
                    <link rel="stylesheet" type="text/css" href="../assets/mscc-0.3.6.min.css" />
        
            <script type="text/javascript">
                var msccHadCookieBannerAtPageStart = true;
            </script>
        

        <!--
        Third party scripts and code linked to or referenced from this website are licensed to you by the parties that own such code,
        not by Microsoft.  See ASP.NET Ajax CDN Terms of Use â€“ http://www.asp.net/ajaxlibrary/CDN.ashx.
        -->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.4.4.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.6/jquery-ui.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery.ui === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        
    <style type="text/css">.SideBar, .SideBarPadding{display:none;}.MainContent{width:auto;}.SiteContentTable{width:100%;}</style>
    <style id="ProjectStyles" type="text/css">
        .SiteHeader, .SiteHeaderLeft {
            height:45px !important;
            overflow:hidden;
        }
        .SiteContent 
        {
            padding: 0 0 1em 0;
            margin-top:0;
            min-height:225px;
            border-right: 1px solid lightgrey;
            border-left: 1px solid lightgrey;
            border-bottom: 1px solid lightgrey;
        }
        .IE table.MinWidthContent
        {
	        table-layout: auto !important;	
        }
    </style>
    
    
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">

    
    
    <meta id="WTProjectName" name="WT.pi" content="unity"/>
    

    <link rel="EditURI" type="application/rsd+xml" title="RSD" href='http://unity.codeplex.com/rsd' />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href='/wlwmanifest.xml' />
    
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity" url="http://unity.codeplex.com/project/feeds/rss"/>
    
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Discussions" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Issues" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Downloads" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Reviews" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity"/>
        
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Source&#32;code" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Wiki" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity"/>
    
        
    
        <meta content="summary" name="twitter:card" /><meta content="@CodePlex" name="twitter:site" /><meta content="http://unity.codeplex.com/discussions/25186?ProjectName=unity" name="twitter:url" /><meta content="patterns &amp;#38; practices - Unity" name="twitter:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" name="twitter:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" name="twitter:image" /><meta content="CodePlex" property="og:site_name" /><meta content="http://unity.codeplex.com/discussions/25186?ProjectName=unity" property="og:url" /><meta content="object" property="og:type" /><meta content="patterns &amp;#38; practices - Unity" property="og:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" property="og:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" property="og:image" />
        

    </head>
    
    <body>
         
            
        <script src="../assets/ScriptLoader.js" type="text/javascript"></script>
        <form id="aspnetForm" autocomplete="off" method="POST" enctype="multipart/form-data">
            <input name="__RequestVerificationToken" type="hidden" value="fRO23BUrnQiAUmUdIAwIB8YDtKMrWcUsjqs3TkOTT-W9HXJUvj31rbWxhhYrBonip6Qbcklcl1hfzxVmYC56ZunajXEZgCalNr6yllOz7itH88V_WV5Jiq4QphnJo5vJy0incQ2" /><input name="__RequestVerificationToken2" type="hidden" value="__RequestVerificationToken20b3d1faa-1d6e-4efe-b5c2-e9eda2f9f12e" />
            
            <div id="UpdateProgressPanel" class="loading_animation" style="display:none;">
                <div class="row">
                    <h2 class="anim_h2">
                        <span id="UpdateProgressText">Updating...</span>
                        <span id="animatedLoadingIconContainer">
                            <img id="animatedLoadingIcon" src="../assets/loading_animation.gif" class="anim_img"/>
                        </span>
                    </h2>
                </div>
            </div>
            
            <div style="display:none;">
                
                <img id="BlankImage" style="width:0;height:0;" src="../assets/blank.png" onload="self.logoImageLoaded=true;"/>

                <script language="javascript" type="text/javascript">
                    var date = new Date();
                    var timezoneOffset = date.getTimezoneOffset() / 60 * -1;
                    var timezoneOffsetCookie = getCookie("TimezoneOffset");
                    var firstTimeSetTimezoneCookie = false;

                    if (timezoneOffsetCookie == null || timezoneOffsetCookie != timezoneOffset) {
                        firstTimeSetTimezoneCookie = true;
                        document.cookie = "TimezoneOffset=" + timezoneOffset + '; domain=.codeplex.com;expires=Wed, 10 Oct 2018 05:29:06 UTC';
                    }
                </script>
            </div>
            
            
            <div id="banner">
                <div id="message"><strong>This is an archived copy of the original CodePlex Unity Discussion Forum</strong><br />Unity is now on <a href="https://github.com/unitycontainer/">GitHub</a>
                    
                </div>
            </div>
            

            <div id="header">
                <div id="header_wrap" class="row">
                    <p id="logo"><a href="http://www.codeplex.com">Code<span class="semi">Plex</span></a><span id="tagline">Project Hosting for Open Source Software</span></p>
                    

<ul id="nav">

    <li><a href="/site/register/new" id="registerLink" class="ZoomFix">Register</a></li>
    <li ><a class="SignInLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f25186" id="signInLink">Sign In</a></li>
  
    <li class="last"><a class="rss_site_icon" href="http://www.codeplex.com/site/feeds/rss" type="application/rss+xml" rel="Alternate" title="CodePlex Site Activity"></a></li>
</ul>
                    <input id="searchsite" name="searchsite" maxlength="500" type="text" value="" /><span id="search_mag"><a id="submitSearch" name="submitSearch" class="magnify" title="Search" href="#"></a></span>
                    <script>
	$(document).ready(function() {
    var searchButton = $('#submitSearch'),
        searchBar = $('#searchsite');

    // Register our own handler for the search event while we wait for the SearchBox script to load.
    searchButton.bind('click.backupSearchBox', doProjectSearch);
    searchBar.bind('keypress.backupSearchBox', function(e) { if ($keyCode(e) === 13) { doProjectSearch(); return false; } });

    function cleanupSearchEvents() {
        // If the SearchBox was loaded, unregister our handlers.
        if (epx_loaded) {
            searchButton.unbind('.backupSearchBox');
            searchBar.unbind('.backupSearchBox');
        }
    }

    $loadScript('http://i4.services.social.microsoft.com/search/Widgets/SearchBox.jss?appid=1000&scopeid=1&boxId=searchsite&btnId=submitSearch&watermark=Search%20all%20projects&overrideWatermark=true&searchLocation=%2fsite%2fsearch&allowEmptySearch=true&focusOnInit=False&minimumTermLength=3', cleanupSearchEvents);
})
function doProjectSearch() {
    
    var url = '/site/search';

    //If search term is not same as watermark
    if($('#searchsite').val() != 'Search all projects')    
    {        
        url = url + '?query=' + encodeURIComponent($('#searchsite').val());
    }

    
    var callback = '';
    if (callback.length > 0 && eval('typeof ' + callback) != 'undefined')
        url += eval(callback + '()');

    window.location.href = url;
    return false;
}
</script>
                </div>
            </div>
            
            <div id="wrap">
                
    <div id="sub_heading" class="row">
        
        <div id="ProjectHeader">
            <div id="project_title_row" class="row">
                <div id="project_logo">
                    
<a id="AffiliateLink" href="http://msdn.microsoft.com/practices">
    <img id="AffiliateImage" src="../assets/pnp_logo.png" title="patterns&#32;&#38;&#32;practices" />
</a>

    
    <h1 class="text_only"><a href="http://unity.codeplex.com/" id="ProjectTitle1"><div>patterns &#38; practices - Unity</div></a></h1>

                </div>
            </div>
        </div>
        
        <div id="ProjectDetailsDiv">
            
        </div>
		<div class="clear"></div>
        

<ul id="page_box_links">
	<li id="homeTabCell" style="width: 63px;"><a id="homeTab" href="http://unity.codeplex.com/" class="box_home">home</a><div></div></li>
    
	<li id="sourceTabCell" style="width:113px;"><a id="sourceTab" href="http://unity.codeplex.com/SourceControl/latest" class="box_source">source code</a><div></div></li>
    
	<li id="releasesTabCell" style="width:105px;"><a id="releasesTab" href="http://unity.codeplex.com/releases" class="box_downloads">downloads</a><div></div></li>
    
    <li id="documentationTabCell" style="width:143px;"><a id="documentationTab" href="http://unity.codeplex.com/documentation" class="box_documentation">documentation</a><div></div></li>
    
	<li id="discussionTabCell" style="width:112px;"><a id="discussionTab" href="../index.html" class="discussions_active">discussions</a><div></div></li>
    
	<li id="workItemsTabCell" style="width:70px;"><a id="workItemsTab" href="http://unity.codeplex.com/workitem/list/basic" class="box_issue">issues</a><div></div></li>
    
	<li id="peopleTabCell" style="width:70px;"><a id="peopleTab" href="http://unity.codeplex.com/team/view" class="box_people">people</a><div></div></li>
	<li id="licenseTabCell" style="width:70px;"><a id="licenseTab" href="http://unity.codeplex.com/license" class="box_license">license</a><div></div></li>
    
    <span class="stretch"></span>
</ul>

<script type="text/javascript">
    $(document).ready(function () {
        $('#page_box_links').applyLastClassToList();
    });
</script>
		    <div class="clear"></div>
            
     <td>
       

<div>
    
    <div id="actionBar" class="action_bar">
        <ul id="actionBar_ul" class="actionBar_sublinks subtab_right" style="vertical-align: middle;">

            

                <li id="li_actionbar_creatediscussion" data-action-id="actionbar_creatediscussion" data-action-type="Navigate" class="actionBar_sublinks" data-options-id="1b1d5012-83f6-45a2-9ef2-f82aedd41f82">
                
                    <script class="options" defer="defer" id="1b1d5012-83f6-45a2-9ef2-f82aedd41f82" type="application/json">{"navigate-url":"http://unity.codeplex.com/discussions/create"}</script> 
                    
                    <div class="actionBar_custom_content"></div>

                    <a href="#" id="actionbar_creatediscussion" title="Start a New Thread" class="action_bar_item_link">
                        <img id="img_actionbar_creatediscussion" class="action_bar_item_image" src="../assets/actionbar_newitem.png" style="vertical-align: middle" />
                        New Thread
                    </a>

                </li>

            

                <li id="li_actionbar_subscribe" data-action-id="actionbar_subscribe" data-action-type="PopUp" class="actionBar_sublinks" data-options-id="4be0afed-0689-4a06-9aab-202de49e6598">
                
                    <script class="options" defer="defer" id="4be0afed-0689-4a06-9aab-202de49e6598" type="application/json">{}</script> 
                    
                    <div class="actionBar_custom_content">

<div id="rssHoverDiv" class="HoverPanel LeftHoverWidth" style="display: none">
        <ul id="3_FeedsPanel" class="RssFeedsPanel">
            <li>
                <a id="ProjectRssLink" href="http://unity.codeplex.com/project/feeds/rss" class="ArrowSmall NoUnderline">All Project Updates</a>
            </li>
            
            <li>
                <a id="DiscussionRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity" class="ArrowSmall NoUnderline">Discussions</a>
            </li>
            
            <li>
                <a id="IssueTrackerRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity" class="ArrowSmall NoUnderline">Issue Tracker</a>
            </li>
            
            <li>
                <a id="ReleasesRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity" class="ArrowSmall NoUnderline">Downloads</a>
            </li>
            <li>
                <a id="ReviewsRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity" class="ArrowSmall NoUnderline">Reviews</a>
            </li>
            
            <li>
                <a id="SourceControlRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity" class="ArrowSmall NoUnderline">Source Code</a>
            </li>
            <li>
                <a id="WikiRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity" class="ArrowSmall NoUnderline">Wiki &amp; Documentation</a>
            </li>
        </ul>
</div></div>

                    <a href="#" id="actionbar_subscribe" title="Subscribe to project updates in RSS feeds." class="action_bar_item_link">
                        <img id="img_actionbar_subscribe" class="action_bar_item_image" src="../assets/actionbar_subscribe.png" style="vertical-align: middle" />
                        Subscribe
                    </a>

                </li>

            
        </ul>
    </div>
</div>
     </td>

        

    </div>
    
    
<div class="Threads">
    <div class="ViewThread">
        
        
        
            <h1 class="page_title WordWrapBreakWord">
                Unity with WCF services
            </h1>

            <!-- Private Discussion header -->
            

            <!-- Posts List Header: Topics and Wiki Link -->
            <table class="PostsListHeader">
                <tr>
                    <td>
                     
                    </td>
                    <td>
                        <div class="WikiLink">
                            <span title="Paste this into a wiki page to link to this discussion">
                                Wiki Link: [discussion:25186]
                            </span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- The list of posts -->
            

<div id="discussionsPostList" data-options-id="39d31ded-8ad6-46bf-bbd7-7885919d6b8c">
    <script class="options" defer="defer" id="39d31ded-8ad6-46bf-bbd7-7885919d6b8c" type="application/json">{"threadUrl":"http://unity.codeplex.com/discussions/25186","showEditor":false,"checkImageUrl":"../assets/check_answer.png"}</script>

    <div class="Posts" style="margin-top: 10px;">
    

<table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 0px; table-layout:fixed">
    

<tr id="PostPanel" class="Post" d:forid="84453">
    <td id="PostDetailsCell_84453" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84453"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/Codeman1980">Codeman1980</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/2/2008 11:38:03 AM" LocalTimeTicks="1207161483">Apr 2, 2008 at 11:38 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84453" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Hi&#33;I&#32;plan&#32;to&#32;use&#32;Unity&#32;in&#32;combination&#32;with&#32;WCF&#32;services.&#32;Are&#32;there&#32;any&#32;guidance&#32;how&#32;to&#32;do&#32;this&#63;Currently&#32;I&#39;ve&#32;the&#32;following&#32;question&#58;&#42;&#41;&#32;Where&#32;should&#32;I&#32;instantiate&#32;and&#32;configure&#32;my&#32;UnityContainer&#32;&#40;inside&#32;my&#32;WCF&#32;service&#41;,&#32;so&#32;that&#32;the&#32;UnityContainer&#32;can&#32;be&#32;used&#32;between&#32;several&#32;WCF&#32;operations&#63;ThanksKlaus&#32;Aschenbrennerhttp&#58;&#47;&#47;www.csharp.athttp&#58;&#47;&#47;www.csharp.at&#47;blog&#32;">
        Hi!<br>
<br>
I plan to use Unity in combination with WCF services. Are there any guidance how to do this?<br>
Currently I've the following question:<br>
<br>
*) Where should I instantiate and configure my UnityContainer (inside my WCF service), so that the UnityContainer can be used between several WCF operations?<br>
<br>
Thanks<br>
<br>
Klaus Aschenbrenner<br>
http://www.csharp.at<br>
http://www.csharp.at/blog <br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84453" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84488">
    <td id="PostDetailsCell_84488" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84488"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/alexanderQX">alexanderQX</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/2/2008 2:17:48 PM" LocalTimeTicks="1207171068">Apr 2, 2008 at 2:17 PM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="4/2/2008 2:26:07 PM" LocalTimeTicks="1207171567">Apr 2, 2008 at 2:26 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84488" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Hey,&#32;if&#32;you&#32;want&#32;to&#32;use&#32;Unity&#32;container&#32;with&#32;WCF&#32;you&#32;may&#32;want&#32;to&#32;see&#32;previous&#32;discussion&#32;of&#32;this&#32;at&#32;Object&#32;creation&#32;and&#32;WCF.&#32;Please&#32;also&#32;note&#32;that&#32;&#40;depends&#32;on&#32;what&#32;you&#32;want&#32;to&#32;do&#32;with&#32;Unity&#47;WCF&#41;&#32;WCF&#32;itself&#32;has&#32;own&#32;behavior&#32;and&#32;extension&#32;model.&#32;Any&#32;code&#32;explorations&#32;would&#32;be&#32;great&#32;to&#32;be&#32;shared&#32;here&#32;as&#32;I&#32;may&#32;one&#32;day&#32;need&#32;to&#32;take&#32;a&#32;look&#32;of&#32;this&#32;more&#32;in&#32;deep.&#32;Regards,Alexander">
        Hey, <br>
<br>
if you want to use Unity container with WCF you may want to see previous discussion of this at
<a href="http://www.codeplex.com/unity/Thread/View.aspx?ThreadId=24825" rel="nofollow">Object creation and WCF</a>. Please also note that (depends on what you want to do with Unity/WCF) WCF itself has own behavior and extension model. Any code explorations would be great
 to be shared here as I may one day need to take a look of this more in deep. <br>
<br>
Regards,<br>
Alexander<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84488" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84645">
    <td id="PostDetailsCell_84645" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84645"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/pbolduc">pbolduc</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/3/2008 1:08:33 AM" LocalTimeTicks="1207210113">Apr 3, 2008 at 1:08 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="4/3/2008 3:47:42 AM" LocalTimeTicks="1207219662">Apr 3, 2008 at 3:47 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84645" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;think&#32;your&#32;question&#32;is&#32;slightly&#32;different&#32;that&#32;the&#32;other&#32;referenced&#32;post.I&#32;would&#32;create&#32;a&#32;singleton&#32;object&#32;that&#32;is&#32;your&#32;container,&#32;something&#32;like&#58;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;static&#32;class&#32;Container&#32;&#123;&#32;&#35;region&#32;Fields&#32;private&#32;static&#32;readonly&#32;object&#32;syncRoot&#32;&#61;&#32;new&#32;object&#40;&#41;&#59;&#32;private&#32;static&#32;volatile&#32;IUnityContainer&#32;instance&#59;&#32;&#35;endregion&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Gets&#32;the&#32;current&#32;&#38;lt&#59;see&#32;cref&#61;&#34;UnityContainer&#34;&#47;&#38;gt&#59;&#32;instance.&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;value&#38;gt&#59;The&#32;current.&#38;lt&#59;&#47;value&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;remarks&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Implements&#32;the&#32;singleton&#32;pattern&#32;as&#32;described&#32;in&#32;&#47;&#47;&#47;&#32;http&#58;&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;library&#47;ms998558.aspx&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;remarks&#38;gt&#59;&#32;public&#32;static&#32;IUnityContainer&#32;Instance&#32;&#123;&#32;get&#32;&#123;&#32;if&#32;&#40;instance&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;lock&#32;&#40;syncRoot&#41;&#32;&#123;&#32;if&#32;&#40;instance&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;instance&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;UnityConfigurationSection&#32;section&#32;&#61;&#32;&#40;UnityConfigurationSection&#41;ConfigurationManager.GetSection&#40;&#34;unity&#34;&#41;&#59;&#32;if&#32;&#40;section&#32;&#33;&#61;&#32;null&#41;&#32;section.Containers.Default.GetConfigCommand&#40;&#41;.Configure&#40;instance&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;return&#32;instance&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;PhilWhere&#32;should&#32;I&#32;instantiate&#32;and&#32;configure&#32;my&#32;UnityContainer&#32;&#40;inside&#32;my&#32;WCF&#32;service&#41;,&#32;so&#32;that&#32;the&#32;UnityContainer&#32;can&#32;be&#32;used&#32;between&#32;several&#32;WCF&#32;operations&#63;">
        I think your question is slightly different that the other referenced post.<br>
<br>
I would create a singleton object that is your container, something like:<br>
<pre style="background-color:#ECECEC; border:dashed .1em #3E62A6; font-family:Consolas,Courier New,Courier,Monospace; font-size:1em; margin-top:0; padding:.5em; height:auto; overflow:auto; overflow-x:auto; overflow-y:auto">
    /// &lt;summary&gt;
    /// 
    /// &lt;/summary&gt;
    public static class Container
    {
        #region Fields
        private static readonly object syncRoot = new object();
        private static volatile IUnityContainer instance;
        #endregion
 
        /// &lt;summary&gt;
        /// Gets the current &lt;see cref=&quot;UnityContainer&quot;/&gt; instance.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The current.&lt;/value&gt;
        /// &lt;remarks&gt;
        /// Implements the singleton pattern as described in 
        /// http://msdn2.microsoft.com/en-us/library/ms998558.aspx
        /// &lt;/remarks&gt;
        public static IUnityContainer Instance
        {
            get
            {
                if (instance == null)
                {
                    lock (syncRoot)
                    {
                        if (instance == null)
                        {
                            instance = new UnityContainer();
                            UnityConfigurationSection section 
                                = (UnityConfigurationSection)ConfigurationManager.GetSection(&quot;unity&quot;);
                            if (section != null)
                                section.Containers.Default.GetConfigCommand().Configure(instance);
                        }
                    }
                }
                return instance;
            }
        }
    }
</pre>
<br>
Phil<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<ul>
<li>Where should I instantiate and configure my UnityContainer (inside my WCF service), so that the UnityContainer can be used between several WCF operations?</li></ul>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84645" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84666">
    <td id="PostDetailsCell_84666" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84666"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/pbolduc">pbolduc</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/3/2008 4:26:17 AM" LocalTimeTicks="1207221977">Apr 3, 2008 at 4:26 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="4/3/2008 4:52:16 AM" LocalTimeTicks="1207223536">Apr 3, 2008 at 4:52 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84666" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="The&#32;Prism&#32;project&#32;uses&#32;a&#32;Bootstrapper&#32;class,&#32;see&#32;http&#58;&#47;&#47;www.codeplex.com&#47;prism&#47;SourceControl&#47;FileView.aspx&#63;itemId&#61;121405&#38;amp&#59;changeSetId&#61;6267.In&#32;the&#32;article,&#32;Hosting&#32;and&#32;Consuming&#32;WCF&#32;Serviceshttp&#58;&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;library&#47;bb332338.aspx,&#32;the&#32;section&#32;Accessing&#32;ServiceHost&#32;in&#32;IIS&#32;talks&#32;of&#32;how&#32;to&#32;use&#32;a&#32;CustomServiceHostFactory&#32;to&#32;control&#32;startup&#32;and&#32;shutdown&#32;code.Where&#32;should&#32;I&#32;instantiate&#32;and&#32;configure&#32;my&#32;UnityContainer&#32;&#40;inside&#32;my&#32;WCF&#32;service&#41;,&#32;so&#32;that&#32;the&#32;UnityContainer&#32;can&#32;be&#32;used&#32;between&#32;several&#32;WCF&#32;operations&#63;">
        <br>
The Prism project uses a Bootstrapper class, see <a href="http://www.codeplex.com/prism/SourceControl/FileView.aspx?itemId=121405&changeSetId=6267" rel="nofollow">
http://www.codeplex.com/prism/SourceControl/FileView.aspx?itemId=121405&amp;changeSetId=6267<span style="font-family:Consolas,Courier New,Courier,Monospace"></span></a>.<br>
<br>
In the article, <b>Hosting and Consuming WCF Services</b><br>
<a href="http://msdn2.microsoft.com/en-us/library/bb332338.aspx" rel="nofollow">http://msdn2.microsoft.com/en-us/library/bb332338.aspx<span style="font-family:Consolas,Courier New,Courier,Monospace"></span></a>, the section
<b>Accessing ServiceHost in IIS</b> talks of how to use a CustomServiceHostFactory to control startup and shutdown code.<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<ul>
<li>Where should I instantiate and configure my UnityContainer (inside my WCF service), so that the UnityContainer can be used between several WCF operations?</li></ul>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84666" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84732">
    <td id="PostDetailsCell_84732" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84732"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/alexanderQX">alexanderQX</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/3/2008 12:18:57 PM" LocalTimeTicks="1207250337">Apr 3, 2008 at 12:18 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84732" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;don&#8217;t&#32;think&#32;anyone&#32;has&#32;done&#32;this&#32;yet,&#32;so&#32;feel&#32;free&#32;to&#32;try.&#32;To&#32;give&#32;you&#32;a&#32;way&#32;forward&#32;I&#32;would&#32;use&#32;the&#32;same&#32;approach&#32;that&#32;is&#32;discussed&#32;in&#32;MSDN&#32;magazine&#32;article&#58;&#32;PIAB&#32;and&#32;WCF&#32;-Integrating&#32;the&#32;Policy&#32;Injection&#32;Application&#32;Block&#32;with&#32;WCF&#32;Services.&#32;http&#58;&#47;&#47;msdn2.microsoft.com&#47;en-us&#47;magazine&#47;cc136759.aspxYou&#32;need&#32;to&#32;extend&#32;your&#32;WCF&#32;IEndpointBehavior&#32;and&#32;IContractBehavior&#32;in&#32;order&#32;to&#32;use&#32;unity&#32;in&#32;WCF.&#32;Please&#32;note,&#32;Unity&#32;is&#32;just&#32;an&#32;extension&#32;to&#32;PIAB&#32;or&#32;vice&#32;verse&#32;depends&#32;on&#32;the&#32;viewer,&#32;so&#32;don&#8217;t&#32;get&#32;confused&#32;of&#32;the&#32;article&#8217;s&#32;PIAB&#32;focus.Regards,Alexander">
        I donâ€™t think anyone has done this yet, so feel free to try. To give you a way forward I would use the same approach that is discussed in MSDN magazine article: PIAB and WCF -Integrating the Policy Injection Application Block with WCF Services.
<a href="http://msdn2.microsoft.com/en-us/magazine/cc136759.aspx" rel="nofollow">http://msdn2.microsoft.com/en-us/magazine/cc136759.aspx<span style="font-family:Consolas,Courier New,Courier,Monospace"></span></a><br>
<br>
You need to extend your WCF IEndpointBehavior and IContractBehavior in order to use unity in WCF. Please note, Unity is just an extension to PIAB or vice verse depends on the viewer, so donâ€™t get confused of the articleâ€™s PIAB focus.<br>
<br>
<br>
Regards,<br>
Alexander<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84732" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84767">
    <td id="PostDetailsCell_84767" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84767"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/pbolduc">pbolduc</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/3/2008 2:51:48 PM" LocalTimeTicks="1207259508">Apr 3, 2008 at 2:51 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84767" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Klaus,&#32;my&#32;posts&#32;assume&#32;you&#32;want&#32;to&#32;build&#32;dependant&#32;objects&#32;only&#32;within&#32;your&#32;service.&#32;Alexander&#39;s&#32;post&#32;link&#32;to&#32;samples&#32;that&#32;allow&#32;you&#32;to&#32;use&#32;Unity&#32;to&#32;create&#32;your&#32;serivce&#32;contract&#32;type.&#32;I&#32;think&#32;this&#32;second&#32;option&#32;would&#32;a&#32;cleaner&#32;implementation,&#32;however&#32;it&#32;may&#32;be&#32;a&#32;little&#32;more&#32;work.&#32;Good&#32;Luck,&#32;let&#32;us&#32;&#40;and&#32;all&#32;other&#32;discussion&#32;forum&#32;users&#41;&#32;know&#32;how&#32;it&#32;goes.">
        Klaus, my posts assume you want to build dependant objects only within your service. Alexander's post link to samples that allow you to use Unity to create your serivce contract type. I think this second option would a cleaner implementation, however it
 may be a little more work. Good Luck, let us (and all other discussion forum users) know how it goes.<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84767" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84800">
    <td id="PostDetailsCell_84800" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84800"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/kblooie">kblooie</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/3/2008 4:15:17 PM" LocalTimeTicks="1207264517">Apr 3, 2008 at 4:15 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84800" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;followed&#32;Oren&#32;Dennison&#39;s&#32;Post&#32;to&#32;hookup&#32;Unity&#32;w&#47;&#32;WCF.&#32;It&#39;s&#32;working&#32;for&#32;me.&#32;Sorry&#32;for&#32;lack&#32;of&#32;commenting&#58;Postur&#58;lhttp&#58;&#47;&#47;orand.blogspot.com&#47;2006&#47;10&#47;wcf-service-dependency-injection.htmlusing&#32;System&#59;using&#32;System.Collections.Generic&#59;using&#32;System.ServiceModel.Configuration&#59;using&#32;System.Text&#59;namespace&#32;AMG.WCF.Unity&#123;&#32;public&#32;class&#32;UnityBehaviorExtensionElement&#32;&#58;&#32;BehaviorExtensionElement&#32;&#123;&#32;protected&#32;override&#32;object&#32;CreateBehavior&#40;&#41;&#32;&#123;&#32;return&#32;new&#32;UnityServiceBehavior&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;Type&#32;BehaviorType&#32;&#123;&#32;get&#32;&#123;&#32;return&#32;typeof&#40;UnityServiceBehavior&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#125;using&#32;System&#59;using&#32;System.Collections.Generic&#59;using&#32;System.Collections.ObjectModel&#59;using&#32;System.ServiceModel&#59;using&#32;System.ServiceModel.Channels&#59;using&#32;System.ServiceModel.Description&#59;using&#32;System.ServiceModel.Dispatcher&#59;using&#32;System.Text&#59;namespace&#32;AMG.WCF.Unity&#123;&#32;public&#32;class&#32;UnityServiceBehavior&#32;&#58;&#32;IServiceBehavior&#32;&#123;&#32;public&#32;void&#32;ApplyDispatchBehavior&#40;ServiceDescription&#32;serviceDescription,&#32;ServiceHostBase&#32;serviceHostBase&#41;&#32;&#123;&#32;foreach&#32;&#40;ChannelDispatcherBase&#32;cdb&#32;in&#32;serviceHostBase.ChannelDispatchers&#41;&#32;&#123;&#32;ChannelDispatcher&#32;cd&#32;&#61;&#32;cdb&#32;as&#32;ChannelDispatcher&#59;&#32;if&#32;&#40;cd&#32;&#33;&#61;&#32;null&#41;&#32;&#123;&#32;foreach&#32;&#40;EndpointDispatcher&#32;ed&#32;in&#32;cd.Endpoints&#41;&#32;&#123;&#32;ed.DispatchRuntime.InstanceProvider&#32;&#61;&#32;new&#32;UnityInstanceProvider&#40;serviceDescription.ServiceType&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#125;&#32;public&#32;void&#32;AddBindingParameters&#40;ServiceDescription&#32;serviceDescription,&#32;ServiceHostBase&#32;serviceHostBase,&#32;Collection&#38;lt&#59;ServiceEndpoint&#38;gt&#59;&#32;endpoints,&#32;BindingParameterCollection&#32;bindingParameters&#41;&#32;&#123;&#32;&#125;&#32;public&#32;void&#32;Validate&#40;ServiceDescription&#32;serviceDescription,&#32;ServiceHostBase&#32;serviceHostBase&#41;&#32;&#123;&#32;&#125;&#32;&#125;&#125;using&#32;System&#59;using&#32;System.Collections.Generic&#59;using&#32;System.Globalization&#59;using&#32;System.ServiceModel&#59;using&#32;System.ServiceModel.Channels&#59;using&#32;System.ServiceModel.Dispatcher&#59;using&#32;System.Text&#59;using&#32;AMG.Unity&#59;using&#32;Microsoft.Practices.Unity&#59;namespace&#32;AMG.WCF.Unity&#123;&#32;public&#32;class&#32;UnityInstanceProvider&#32;&#58;&#32;IInstanceProvider&#32;&#123;&#32;&#35;region&#32;Private&#32;Fields&#32;private&#32;readonly&#32;Type&#32;_serviceType&#59;&#32;private&#32;static&#32;IUnityContainer&#32;_container&#59;&#32;&#32;private&#32;static&#32;readonly&#32;object&#32;_lockObject&#32;&#61;&#32;new&#32;object&#40;&#41;&#59;&#32;&#35;endregion&#32;&#35;region&#32;Properties&#32;protected&#32;static&#32;IUnityContainer&#32;Container&#32;&#123;&#32;get&#32;&#123;&#32;if&#32;&#40;_container&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;lock&#32;&#40;_lockObject&#41;&#32;&#123;&#32;_container&#32;&#61;&#32;CreateContainer&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;return&#32;_container&#59;&#32;&#125;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;Constructors&#32;public&#32;UnityInstanceProvider&#40;Type&#32;serviceType&#41;&#32;&#123;&#32;_serviceType&#32;&#61;&#32;serviceType&#59;&#32;&#125;&#32;&#32;&#35;endregion&#32;&#35;region&#32;IInstanceProvider&#32;Members&#32;public&#32;object&#32;GetInstance&#40;InstanceContext&#32;instanceContext&#41;&#32;&#123;&#32;return&#32;GetInstance&#40;instanceContext,&#32;null&#41;&#59;&#32;&#125;&#32;public&#32;object&#32;GetInstance&#40;InstanceContext&#32;instanceContext,&#32;Message&#32;message&#41;&#32;&#123;&#32;return&#32;Container.Resolve&#40;_serviceType&#41;&#59;&#32;&#125;&#32;public&#32;void&#32;ReleaseInstance&#40;InstanceContext&#32;instanceContext,&#32;object&#32;instance&#41;&#32;&#123;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;Private&#32;Methods&#32;private&#32;static&#32;IUnityContainer&#32;CreateContainer&#40;&#41;&#32;&#123;&#32;IUnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;IUnityConfigurator&#32;configurator&#32;&#61;&#32;new&#32;WebConfigUnityConfigurator&#40;&#41;&#59;&#32;configurator.Configure&#40;container&#41;&#59;&#32;return&#32;container&#59;&#32;&#125;&#32;&#32;&#35;endregion&#32;&#125;&#125;using&#32;System&#59;using&#32;System.Collections.Generic&#59;using&#32;System.Text&#59;using&#32;Microsoft.Practices.Unity&#59;namespace&#32;AMG.Unity&#123;&#32;public&#32;interface&#32;IUnityConfigurator&#32;&#123;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Configures&#32;a&#32;unity&#32;container&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;void&#32;Configure&#40;IUnityContainer&#32;container&#41;&#59;&#32;&#125;&#125;using&#32;System&#59;using&#32;System.Configuration&#59;using&#32;System.IO&#59;using&#32;System.Web.Configuration&#59;using&#32;Microsoft.Practices.Unity&#59;using&#32;Microsoft.Practices.Unity.Configuration&#59;namespace&#32;AMG.Unity&#123;&#32;public&#32;class&#32;WebConfigUnityConfigurator&#32;&#58;&#32;IUnityConfigurator&#32;&#123;&#32;&#35;region&#32;Private&#32;Fields&#32;private&#32;readonly&#32;string&#32;_baseDirectory&#59;&#32;&#32;&#35;endregion&#32;&#35;region&#32;Constructors&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Initializes&#32;a&#32;new&#32;instance&#32;of&#32;&#38;lt&#59;see&#32;cref&#61;&#34;WebConfigUnityConfigurator&#34;&#47;&#38;gt&#59;.&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;WebConfigUnityConfigurator&#40;&#41;&#32;&#58;&#32;this&#40;String.Empty&#41;&#32;&#123;&#32;&#125;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Initializes&#32;a&#32;new&#32;instance&#32;of&#32;&#38;lt&#59;see&#32;cref&#61;&#34;WebConfigUnityConfigurator&#34;&#47;&#38;gt&#59;.&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;param&#32;name&#61;&#34;baseDirectory&#34;&#38;gt&#59;The&#32;directory&#32;from&#32;which&#32;to&#32;start&#32;searching&#32;for&#32;the&#32;&#32;&#47;&#47;&#47;&#32;configuration&#32;files.&#38;lt&#59;&#47;param&#38;gt&#59;&#32;public&#32;WebConfigUnityConfigurator&#40;string&#32;baseDirectory&#41;&#32;&#123;&#32;_baseDirectory&#32;&#61;&#32;Path.Combine&#40;AppDomain.CurrentDomain.BaseDirectory,&#32;baseDirectory&#41;&#59;&#32;&#125;&#32;&#32;&#35;endregion&#32;&#35;region&#32;IUnityConfigurator&#32;Members&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Configures&#32;a&#32;unity&#32;container&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;void&#32;Configure&#40;IUnityContainer&#32;container&#41;&#32;&#123;&#32;Configure&#40;container,&#32;_baseDirectory&#41;&#59;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;Private&#32;Methods&#32;private&#32;static&#32;void&#32;Configure&#40;IUnityContainer&#32;container,&#32;string&#32;rootDirectory&#41;&#32;&#123;&#32;foreach&#32;&#40;string&#32;fileName&#32;in&#32;Directory.GetFiles&#40;rootDirectory,&#32;&#34;Web.Config&#34;,&#32;SearchOption.TopDirectoryOnly&#41;&#41;&#32;&#123;&#32;Configuration&#32;configuration&#32;&#61;&#32;GetConfiguration&#40;Path.Combine&#40;rootDirectory,&#32;fileName&#41;&#41;&#59;&#32;ConfigurationSection&#32;section&#32;&#61;&#32;configuration.GetSection&#40;&#34;unity&#34;&#41;&#59;&#32;UnityConfigurationSection&#32;localSection&#32;&#61;&#32;section&#32;as&#32;UnityConfigurationSection&#59;&#32;if&#32;&#40;localSection&#32;&#33;&#61;&#32;null&#41;&#32;&#123;&#32;foreach&#32;&#40;UnityContainerElement&#32;element&#32;in&#32;localSection.Containers&#41;&#32;&#123;&#32;element.Configure&#40;container&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;foreach&#32;&#40;string&#32;childDirectory&#32;in&#32;Directory.GetDirectories&#40;rootDirectory&#41;&#41;&#32;&#123;&#32;Configure&#40;container,&#32;childDirectory&#41;&#59;&#32;&#125;&#32;&#125;&#32;private&#32;static&#32;Configuration&#32;GetConfiguration&#40;string&#32;configFilePath&#41;&#32;&#123;&#32;Configuration&#32;configuration&#59;&#32;System.Web.HttpContext&#32;context&#32;&#61;&#32;System.Web.HttpContext.Current&#59;&#32;if&#32;&#40;context&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;configuration&#32;&#61;&#32;GetConfigurationForCustomFile&#40;configFilePath&#41;&#59;&#32;&#125;&#32;else&#32;&#123;&#32;configuration&#32;&#61;&#32;WebConfigurationManager.OpenWebConfiguration&#40;context.Request.ApplicationPath&#32;&#43;&#32;&#34;&#47;&#34;&#32;&#43;&#32;configFilePath.Replace&#40;context.Request.PhysicalApplicationPath,&#32;&#34;&#34;&#41;&#41;&#59;&#32;&#125;&#32;return&#32;configuration&#59;&#32;&#125;&#32;private&#32;static&#32;Configuration&#32;GetConfigurationForCustomFile&#40;string&#32;fileName&#41;&#32;&#123;&#32;ExeConfigurationFileMap&#32;fileMap&#32;&#61;&#32;new&#32;ExeConfigurationFileMap&#40;&#41;&#59;&#32;fileMap.ExeConfigFilename&#32;&#61;&#32;fileName&#59;&#32;File.SetAttributes&#40;fileMap.ExeConfigFilename,&#32;FileAttributes.Normal&#41;&#59;&#32;return&#32;ConfigurationManager.OpenMappedExeConfiguration&#40;fileMap,&#32;ConfigurationUserLevel.None&#41;&#59;&#32;&#125;&#32;&#32;&#35;endregion&#32;&#125;&#125;&#38;lt&#59;&#33;--WCF&#32;Configuration--&#38;gt&#59;&#38;lt&#59;extensions&#38;gt&#59;&#32;&#38;lt&#59;behaviorExtensions&#38;gt&#59;&#32;&#38;lt&#59;&#33;--&#32;unityBehavior&#32;extension&#32;for&#32;dependency&#32;injection&#32;with&#32;Unity&#32;using&#32;custom&#32;WCF&#32;InstanceProvider&#32;--&#38;gt&#59;&#32;&#38;lt&#59;add&#32;name&#61;&#34;unityBehavior&#34;&#32;type&#61;&#34;AMG.WCF.Unity.UnityBehaviorExtensionElement,&#32;AMG.WCF.Unity,&#32;Version&#61;1.0.0.0,&#32;Culture&#61;neutral,&#32;PublicKeyToken&#61;null&#34;&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;&#47;behaviorExtensions&#38;gt&#59;&#38;lt&#59;&#47;extensions&#38;gt&#59;&#38;lt&#59;behaviors&#38;gt&#59;&#32;&#38;lt&#59;serviceBehaviors&#38;gt&#59;&#32;&#38;lt&#59;behavior&#32;name&#61;&#34;MyServiceBehavior&#34;&#38;gt&#59;&#32;&#38;lt&#59;serviceDebug&#32;includeExceptionDetailInFaults&#61;&#34;false&#34;&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;serviceMetadata&#32;httpGetEnabled&#61;&#34;true&#34;&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;unityBehavior&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;&#47;behavior&#38;gt&#59;&#32;&#38;lt&#59;&#47;serviceBehaviors&#38;gt&#59;&#38;lt&#59;&#47;behaviors&#38;gt&#59;">
        I followed Oren Dennison's Post to hookup Unity w/ WCF. It's working for me. Sorry for lack of commenting:<br>
<br>
Post<br>
<a href="http://www.codeplex.com/unity/Wiki/View.aspx?title=ur%3alhttp%3a%2f%2forand.blogspot.com%2f2006%2f10%2fwcf-service-dependency-injection.html" rel="nofollow">ur:lhttp://orand.blogspot.com/2006/10/wcf-service-dependency-injection.html</a><br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.ServiceModel.Configuration;<br>
using System.Text;<br>
<br>
namespace AMG.WCF.Unity<br>
{<br>
public class UnityBehaviorExtensionElement : BehaviorExtensionElement<br>
{<br>
protected override object CreateBehavior()<br>
{<br>
return new UnityServiceBehavior();<br>
}<br>
<br>
public override Type BehaviorType<br>
{<br>
get { return typeof(UnityServiceBehavior); }<br>
}<br>
}<br>
}<br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.Collections.ObjectModel;<br>
using System.ServiceModel;<br>
using System.ServiceModel.Channels;<br>
using System.ServiceModel.Description;<br>
using System.ServiceModel.Dispatcher;<br>
using System.Text;<br>
<br>
namespace AMG.WCF.Unity<br>
{<br>
public class UnityServiceBehavior : IServiceBehavior<br>
{<br>
public void ApplyDispatchBehavior(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase)<br>
{<br>
foreach (ChannelDispatcherBase cdb in serviceHostBase.ChannelDispatchers)<br>
{<br>
ChannelDispatcher cd = cdb as ChannelDispatcher;<br>
<br>
if (cd != null)<br>
{<br>
foreach (EndpointDispatcher ed in cd.Endpoints)<br>
{<br>
ed.DispatchRuntime.InstanceProvider =<br>
new UnityInstanceProvider(serviceDescription.ServiceType);<br>
}<br>
}<br>
}<br>
}<br>
<br>
public void AddBindingParameters(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase,<br>
Collection&lt;ServiceEndpoint&gt; endpoints, BindingParameterCollection bindingParameters) { }<br>
<br>
public void Validate(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase) { }<br>
}<br>
}<br>
<br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.Globalization;<br>
using System.ServiceModel;<br>
using System.ServiceModel.Channels;<br>
using System.ServiceModel.Dispatcher;<br>
using System.Text;<br>
using AMG.Unity;<br>
using Microsoft.Practices.Unity;<br>
<br>
namespace AMG.WCF.Unity<br>
{<br>
public class UnityInstanceProvider : IInstanceProvider<br>
{<br>
#region Private Fields<br>
<br>
private readonly Type _serviceType;<br>
<br>
private static IUnityContainer _container; <br>
private static readonly object _lockObject = new object();<br>
<br>
#endregion<br>
<br>
#region Properties<br>
<br>
protected static IUnityContainer Container<br>
{<br>
get<br>
{<br>
if (_container == null)<br>
{<br>
lock (_lockObject)<br>
{<br>
_container = CreateContainer();<br>
}<br>
}<br>
<br>
return _container;<br>
}<br>
}<br>
<br>
#endregion<br>
<br>
#region Constructors<br>
<br>
public UnityInstanceProvider(Type serviceType)<br>
{<br>
_serviceType = serviceType;<br>
} <br>
<br>
#endregion<br>
<br>
#region IInstanceProvider Members<br>
<br>
public object GetInstance(InstanceContext instanceContext)<br>
{<br>
return GetInstance(instanceContext, null);<br>
}<br>
<br>
public object GetInstance(InstanceContext instanceContext, Message message)<br>
{<br>
return Container.Resolve(_serviceType);<br>
}<br>
<br>
public void ReleaseInstance(InstanceContext instanceContext, object instance) { }<br>
<br>
#endregion<br>
<br>
#region Private Methods<br>
<br>
private static IUnityContainer CreateContainer()<br>
{<br>
IUnityContainer container = new UnityContainer();<br>
<br>
IUnityConfigurator configurator = new WebConfigUnityConfigurator();<br>
<br>
configurator.Configure(container);<br>
<br>
return container;<br>
} <br>
<br>
#endregion<br>
}<br>
}<br>
<br>
using System;<br>
using System.Collections.Generic;<br>
using System.Text;<br>
using Microsoft.Practices.Unity;<br>
<br>
namespace AMG.Unity<br>
{<br>
public interface IUnityConfigurator<br>
{<br>
/// &lt;summary&gt;<br>
/// Configures a unity container<br>
/// &lt;/summary&gt;<br>
void Configure(IUnityContainer container);<br>
}<br>
}<br>
<br>
using System;<br>
using System.Configuration;<br>
using System.IO;<br>
using System.Web.Configuration;<br>
using Microsoft.Practices.Unity;<br>
using Microsoft.Practices.Unity.Configuration;<br>
<br>
namespace AMG.Unity<br>
{<br>
public class WebConfigUnityConfigurator : IUnityConfigurator<br>
{<br>
#region Private Fields<br>
<br>
private readonly string _baseDirectory; <br>
<br>
#endregion<br>
<br>
#region Constructors<br>
<br>
/// &lt;summary&gt;<br>
/// Initializes a new instance of &lt;see cref=&quot;WebConfigUnityConfigurator&quot;/&gt;.<br>
/// &lt;/summary&gt;<br>
public WebConfigUnityConfigurator()<br>
: this(String.Empty)<br>
{<br>
}<br>
<br>
/// &lt;summary&gt;<br>
/// Initializes a new instance of &lt;see cref=&quot;WebConfigUnityConfigurator&quot;/&gt;.<br>
/// &lt;/summary&gt;<br>
/// &lt;param name=&quot;baseDirectory&quot;&gt;The directory from which to start searching for the
<br>
/// configuration files.&lt;/param&gt;<br>
public WebConfigUnityConfigurator(string baseDirectory)<br>
{<br>
_baseDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, baseDirectory);<br>
} <br>
<br>
#endregion<br>
<br>
#region IUnityConfigurator Members<br>
<br>
/// &lt;summary&gt;<br>
/// Configures a unity container<br>
/// &lt;/summary&gt;<br>
public void Configure(IUnityContainer container)<br>
{<br>
Configure(container, _baseDirectory);<br>
}<br>
<br>
#endregion<br>
<br>
#region Private Methods<br>
<br>
private static void Configure(IUnityContainer container, string rootDirectory)<br>
{<br>
foreach (string fileName in Directory.GetFiles(rootDirectory, &quot;Web.Config&quot;, SearchOption.TopDirectoryOnly))<br>
{<br>
Configuration configuration = GetConfiguration(Path.Combine(rootDirectory, fileName));<br>
<br>
ConfigurationSection section = configuration.GetSection(&quot;unity&quot;);<br>
<br>
UnityConfigurationSection localSection = section as UnityConfigurationSection;<br>
<br>
if (localSection != null)<br>
{<br>
foreach (UnityContainerElement element in localSection.Containers)<br>
{<br>
element.Configure(container);<br>
}<br>
}<br>
}<br>
foreach (string childDirectory in Directory.GetDirectories(rootDirectory))<br>
{<br>
Configure(container, childDirectory);<br>
}<br>
}<br>
<br>
private static Configuration GetConfiguration(string configFilePath)<br>
{<br>
Configuration configuration;<br>
<br>
System.Web.HttpContext context = System.Web.HttpContext.Current;<br>
<br>
if (context == null)<br>
{<br>
configuration = GetConfigurationForCustomFile(configFilePath);<br>
}<br>
else<br>
{<br>
configuration = WebConfigurationManager.OpenWebConfiguration(context.Request.ApplicationPath &#43; &quot;/&quot; &#43; configFilePath.Replace(context.Request.PhysicalApplicationPath, &quot;&quot;));<br>
}<br>
return configuration;<br>
}<br>
<br>
private static Configuration GetConfigurationForCustomFile(string fileName)<br>
{<br>
ExeConfigurationFileMap fileMap = new ExeConfigurationFileMap();<br>
fileMap.ExeConfigFilename = fileName;<br>
File.SetAttributes(fileMap.ExeConfigFilename, FileAttributes.Normal);<br>
return ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);<br>
} <br>
<br>
#endregion<br>
}<br>
}<br>
<br>
&lt;!--WCF Configuration--&gt;<br>
&lt;extensions&gt;<br>
&lt;behaviorExtensions&gt;<br>
&lt;!-- unityBehavior extension<br>
for dependency injection with Unity using<br>
custom WCF InstanceProvider<br>
--&gt;<br>
&lt;add name=&quot;unityBehavior&quot;<br>
type=&quot;AMG.WCF.Unity.UnityBehaviorExtensionElement, AMG.WCF.Unity, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot; /&gt;<br>
&lt;/behaviorExtensions&gt;<br>
&lt;/extensions&gt;<br>
&lt;behaviors&gt;<br>
&lt;serviceBehaviors&gt;<br>
&lt;behavior name=&quot;MyServiceBehavior&quot;&gt;<br>
&lt;serviceDebug includeExceptionDetailInFaults=&quot;false&quot; /&gt;<br>
&lt;serviceMetadata httpGetEnabled=&quot;true&quot; /&gt;<br>
&lt;unityBehavior /&gt;<br>
&lt;/behavior&gt;<br>
&lt;/serviceBehaviors&gt;<br>
&lt;/behaviors&gt;<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84800" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="84801">
    <td id="PostDetailsCell_84801" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post84801"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/pbolduc">pbolduc</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/3/2008 4:16:53 PM" LocalTimeTicks="1207264613">Apr 3, 2008 at 4:16 PM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="4/3/2008 4:17:32 PM" LocalTimeTicks="1207264652">Apr 3, 2008 at 4:17 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_84801" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Wrapping&#32;your&#32;code&#32;in&#32;double&#32;braces&#32;&#123;&#123;&#32;&#125;&#125;&#32;will&#32;retain&#32;the&#32;formatting&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.ServiceModel.Configuration&#59;&#32;using&#32;System.Text&#59;&#32;namespace&#32;AMG.WCF.Unity&#32;&#123;&#32;public&#32;class&#32;UnityBehaviorExtensionElement&#32;&#58;&#32;BehaviorExtensionElement&#32;&#123;&#32;protected&#32;override&#32;object&#32;CreateBehavior&#40;&#41;&#32;&#123;&#32;return&#32;new&#32;UnityServiceBehavior&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;Type&#32;BehaviorType&#32;&#123;&#32;get&#32;&#123;&#32;return&#32;typeof&#40;UnityServiceBehavior&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#125;&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Collections.ObjectModel&#59;&#32;using&#32;System.ServiceModel&#59;&#32;using&#32;System.ServiceModel.Channels&#59;&#32;using&#32;System.ServiceModel.Description&#59;&#32;using&#32;System.ServiceModel.Dispatcher&#59;&#32;using&#32;System.Text&#59;&#32;namespace&#32;AMG.WCF.Unity&#32;&#123;&#32;public&#32;class&#32;UnityServiceBehavior&#32;&#58;&#32;IServiceBehavior&#32;&#123;&#32;public&#32;void&#32;ApplyDispatchBehavior&#40;ServiceDescription&#32;serviceDescription,&#32;ServiceHostBase&#32;serviceHostBase&#41;&#32;&#123;&#32;foreach&#32;&#40;ChannelDispatcherBase&#32;cdb&#32;in&#32;serviceHostBase.ChannelDispatchers&#41;&#32;&#123;&#32;ChannelDispatcher&#32;cd&#32;&#61;&#32;cdb&#32;as&#32;ChannelDispatcher&#59;&#32;if&#32;&#40;cd&#32;&#33;&#61;&#32;null&#41;&#32;&#123;&#32;foreach&#32;&#40;EndpointDispatcher&#32;ed&#32;in&#32;cd.Endpoints&#41;&#32;&#123;&#32;ed.DispatchRuntime.InstanceProvider&#32;&#61;&#32;new&#32;UnityInstanceProvider&#40;serviceDescription.ServiceType&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#125;&#32;public&#32;void&#32;AddBindingParameters&#40;ServiceDescription&#32;serviceDescription,&#32;ServiceHostBase&#32;serviceHostBase,&#32;Collection&#38;lt&#59;ServiceEndpoint&#38;gt&#59;&#32;endpoints,&#32;BindingParameterCollection&#32;bindingParameters&#41;&#32;&#123;&#32;&#125;&#32;public&#32;void&#32;Validate&#40;ServiceDescription&#32;serviceDescription,&#32;ServiceHostBase&#32;serviceHostBase&#41;&#32;&#123;&#32;&#125;&#32;&#125;&#32;&#125;&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Globalization&#59;&#32;using&#32;System.ServiceModel&#59;&#32;using&#32;System.ServiceModel.Channels&#59;&#32;using&#32;System.ServiceModel.Dispatcher&#59;&#32;using&#32;System.Text&#59;&#32;using&#32;AMG.Unity&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;namespace&#32;AMG.WCF.Unity&#32;&#123;&#32;public&#32;class&#32;UnityInstanceProvider&#32;&#58;&#32;IInstanceProvider&#32;&#123;&#32;&#35;region&#32;Private&#32;Fields&#32;private&#32;readonly&#32;Type&#32;_serviceType&#59;&#32;private&#32;static&#32;IUnityContainer&#32;_container&#59;&#32;private&#32;static&#32;readonly&#32;object&#32;_lockObject&#32;&#61;&#32;new&#32;object&#40;&#41;&#59;&#32;&#35;endregion&#32;&#35;region&#32;Properties&#32;protected&#32;static&#32;IUnityContainer&#32;Container&#32;&#123;&#32;get&#32;&#123;&#32;if&#32;&#40;_container&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;lock&#32;&#40;_lockObject&#41;&#32;&#123;&#32;_container&#32;&#61;&#32;CreateContainer&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;return&#32;_container&#59;&#32;&#125;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;Constructors&#32;public&#32;UnityInstanceProvider&#40;Type&#32;serviceType&#41;&#32;&#123;&#32;_serviceType&#32;&#61;&#32;serviceType&#59;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;IInstanceProvider&#32;Members&#32;public&#32;object&#32;GetInstance&#40;InstanceContext&#32;instanceContext&#41;&#32;&#123;&#32;return&#32;GetInstance&#40;instanceContext,&#32;null&#41;&#59;&#32;&#125;&#32;public&#32;object&#32;GetInstance&#40;InstanceContext&#32;instanceContext,&#32;Message&#32;message&#41;&#32;&#123;&#32;return&#32;Container.Resolve&#40;_serviceType&#41;&#59;&#32;&#125;&#32;public&#32;void&#32;ReleaseInstance&#40;InstanceContext&#32;instanceContext,&#32;object&#32;instance&#41;&#32;&#123;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;Private&#32;Methods&#32;private&#32;static&#32;IUnityContainer&#32;CreateContainer&#40;&#41;&#32;&#123;&#32;IUnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;IUnityConfigurator&#32;configurator&#32;&#61;&#32;new&#32;WebConfigUnityConfigurator&#40;&#41;&#59;&#32;configurator.Configure&#40;container&#41;&#59;&#32;return&#32;container&#59;&#32;&#125;&#32;&#35;endregion&#32;&#125;&#32;&#125;&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Text&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;namespace&#32;AMG.Unity&#32;&#123;&#32;public&#32;interface&#32;IUnityConfigurator&#32;&#123;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Configures&#32;a&#32;unity&#32;container&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;void&#32;Configure&#40;IUnityContainer&#32;container&#41;&#59;&#32;&#125;&#32;&#125;&#32;using&#32;System&#59;&#32;using&#32;System.Configuration&#59;&#32;using&#32;System.IO&#59;&#32;using&#32;System.Web.Configuration&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;using&#32;Microsoft.Practices.Unity.Configuration&#59;&#32;namespace&#32;AMG.Unity&#32;&#123;&#32;public&#32;class&#32;WebConfigUnityConfigurator&#32;&#58;&#32;IUnityConfigurator&#32;&#123;&#32;&#35;region&#32;Private&#32;Fields&#32;private&#32;readonly&#32;string&#32;_baseDirectory&#59;&#32;&#35;endregion&#32;&#35;region&#32;Constructors&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Initializes&#32;a&#32;new&#32;instance&#32;of&#32;&#38;lt&#59;see&#32;cref&#61;&#34;WebConfigUnityConfigurator&#34;&#47;&#38;gt&#59;.&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;WebConfigUnityConfigurator&#40;&#41;&#32;&#58;&#32;this&#40;String.Empty&#41;&#32;&#123;&#32;&#125;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Initializes&#32;a&#32;new&#32;instance&#32;of&#32;&#38;lt&#59;see&#32;cref&#61;&#34;WebConfigUnityConfigurator&#34;&#47;&#38;gt&#59;.&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;param&#32;name&#61;&#34;baseDirectory&#34;&#38;gt&#59;The&#32;directory&#32;from&#32;which&#32;to&#32;start&#32;searching&#32;for&#32;the&#32;&#47;&#47;&#47;&#32;configuration&#32;files.&#38;lt&#59;&#47;param&#38;gt&#59;&#32;public&#32;WebConfigUnityConfigurator&#40;string&#32;baseDirectory&#41;&#32;&#123;&#32;_baseDirectory&#32;&#61;&#32;Path.Combine&#40;AppDomain.CurrentDomain.BaseDirectory,&#32;baseDirectory&#41;&#59;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;IUnityConfigurator&#32;Members&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;Configures&#32;a&#32;unity&#32;container&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;void&#32;Configure&#40;IUnityContainer&#32;container&#41;&#32;&#123;&#32;Configure&#40;container,&#32;_baseDirectory&#41;&#59;&#32;&#125;&#32;&#35;endregion&#32;&#35;region&#32;Private&#32;Methods&#32;private&#32;static&#32;void&#32;Configure&#40;IUnityContainer&#32;container,&#32;string&#32;rootDirectory&#41;&#32;&#123;&#32;foreach&#32;&#40;string&#32;fileName&#32;in&#32;Directory.GetFiles&#40;rootDirectory,&#32;&#34;Web.Config&#34;,&#32;SearchOption.TopDirectoryOnly&#41;&#41;&#32;&#123;&#32;Configuration&#32;configuration&#32;&#61;&#32;GetConfiguration&#40;Path.Combine&#40;rootDirectory,&#32;fileName&#41;&#41;&#59;&#32;ConfigurationSection&#32;section&#32;&#61;&#32;configuration.GetSection&#40;&#34;unity&#34;&#41;&#59;&#32;UnityConfigurationSection&#32;localSection&#32;&#61;&#32;section&#32;as&#32;UnityConfigurationSection&#59;&#32;if&#32;&#40;localSection&#32;&#33;&#61;&#32;null&#41;&#32;&#123;&#32;foreach&#32;&#40;UnityContainerElement&#32;element&#32;in&#32;localSection.Containers&#41;&#32;&#123;&#32;element.Configure&#40;container&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;foreach&#32;&#40;string&#32;childDirectory&#32;in&#32;Directory.GetDirectories&#40;rootDirectory&#41;&#41;&#32;&#123;&#32;Configure&#40;container,&#32;childDirectory&#41;&#59;&#32;&#125;&#32;&#125;&#32;private&#32;static&#32;Configuration&#32;GetConfiguration&#40;string&#32;configFilePath&#41;&#32;&#123;&#32;Configuration&#32;configuration&#59;&#32;System.Web.HttpContext&#32;context&#32;&#61;&#32;System.Web.HttpContext.Current&#59;&#32;if&#32;&#40;context&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;configuration&#32;&#61;&#32;GetConfigurationForCustomFile&#40;configFilePath&#41;&#59;&#32;&#125;&#32;else&#32;&#123;&#32;configuration&#32;&#61;&#32;WebConfigurationManager.OpenWebConfiguration&#40;context.Request.ApplicationPath&#32;&#43;&#32;&#34;&#47;&#34;&#32;&#43;&#32;configFilePath.Replace&#40;context.Request.PhysicalApplicationPath,&#32;&#34;&#34;&#41;&#41;&#59;&#32;&#125;&#32;return&#32;configuration&#59;&#32;&#125;&#32;private&#32;static&#32;Configuration&#32;GetConfigurationForCustomFile&#40;string&#32;fileName&#41;&#32;&#123;&#32;ExeConfigurationFileMap&#32;fileMap&#32;&#61;&#32;new&#32;ExeConfigurationFileMap&#40;&#41;&#59;&#32;fileMap.ExeConfigFilename&#32;&#61;&#32;fileName&#59;&#32;File.SetAttributes&#40;fileMap.ExeConfigFilename,&#32;FileAttributes.Normal&#41;&#59;&#32;return&#32;ConfigurationManager.OpenMappedExeConfiguration&#40;fileMap,&#32;ConfigurationUserLevel.None&#41;&#59;&#32;&#125;&#32;&#35;endregion&#32;&#125;&#32;&#125;&#32;&#38;lt&#59;&#33;--WCF&#32;Configuration--&#38;gt&#59;&#32;&#38;lt&#59;extensions&#38;gt&#59;&#32;&#38;lt&#59;behaviorExtensions&#38;gt&#59;&#32;&#38;lt&#59;&#33;--&#32;unityBehavior&#32;extension&#32;for&#32;dependency&#32;injection&#32;with&#32;Unity&#32;using&#32;custom&#32;WCF&#32;InstanceProvider&#32;--&#38;gt&#59;&#32;&#38;lt&#59;add&#32;name&#61;&#34;unityBehavior&#34;&#32;type&#61;&#34;AMG.WCF.Unity.UnityBehaviorExtensionElement,&#32;AMG.WCF.Unity,&#32;Version&#61;1.0.0.0,&#32;Culture&#61;neutral,&#32;PublicKeyToken&#61;null&#34;&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;&#47;behaviorExtensions&#38;gt&#59;&#32;&#38;lt&#59;&#47;extensions&#38;gt&#59;&#32;&#38;lt&#59;behaviors&#38;gt&#59;&#32;&#38;lt&#59;serviceBehaviors&#38;gt&#59;&#32;&#38;lt&#59;behavior&#32;name&#61;&#34;MyServiceBehavior&#34;&#38;gt&#59;&#32;&#38;lt&#59;serviceDebug&#32;includeExceptionDetailInFaults&#61;&#34;false&#34;&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;serviceMetadata&#32;httpGetEnabled&#61;&#34;true&#34;&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;unityBehavior&#32;&#47;&#38;gt&#59;&#32;&#38;lt&#59;&#47;behavior&#38;gt&#59;&#32;&#38;lt&#59;&#47;serviceBehaviors&#38;gt&#59;&#32;&#38;lt&#59;&#47;behaviors&#38;gt&#59;&#32;">
        Wrapping your code in double braces {{ }} will retain the formatting<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
<pre style="background-color:#ECECEC; border:dashed .1em #3E62A6; font-family:Consolas,Courier New,Courier,Monospace; font-size:1em; margin-top:0; padding:.5em; height:auto; overflow:auto; overflow-x:auto; overflow-y:auto">
using System;
using System.Collections.Generic;
using System.ServiceModel.Configuration;
using System.Text;
 
namespace AMG.WCF.Unity
{
    public class UnityBehaviorExtensionElement : BehaviorExtensionElement
    {
        protected override object CreateBehavior()
        {
            return new UnityServiceBehavior();
        }
 
        public override Type BehaviorType
        {
            get { return typeof(UnityServiceBehavior); }
        }
    }
}
 
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;
using System.ServiceModel.Dispatcher;
using System.Text;
 
namespace AMG.WCF.Unity
{
    public class UnityServiceBehavior : IServiceBehavior
    {
        public void ApplyDispatchBehavior(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase)
        {
            foreach (ChannelDispatcherBase cdb in serviceHostBase.ChannelDispatchers)
            {
                ChannelDispatcher cd = cdb as ChannelDispatcher;
 
                if (cd != null)
                {
                    foreach (EndpointDispatcher ed in cd.Endpoints)
                    {
                        ed.DispatchRuntime.InstanceProvider =
                            new UnityInstanceProvider(serviceDescription.ServiceType);
                    }
                }
            }
        }
 
        public void AddBindingParameters(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase,
                Collection&lt;ServiceEndpoint&gt; endpoints, BindingParameterCollection bindingParameters) { }
 
        public void Validate(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase) { }
    }
}
 
 
using System;
using System.Collections.Generic;
using System.Globalization;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Dispatcher;
using System.Text;
using AMG.Unity;
using Microsoft.Practices.Unity;
 
namespace AMG.WCF.Unity
{
    public class UnityInstanceProvider : IInstanceProvider
    {
        #region Private Fields
 
        private readonly Type _serviceType;
 
        private static IUnityContainer _container; 
        private static readonly object _lockObject = new object();
 
        #endregion
 
        #region Properties
 
        protected static IUnityContainer Container
        {
            get
            {
                if (_container == null)
                {
                    lock (_lockObject)
                    {
                        _container = CreateContainer();
                    }
                }
 
                return _container;
            }
        }
 
        #endregion
 
        #region Constructors
 
        public UnityInstanceProvider(Type serviceType)
        {
            _serviceType = serviceType;
        } 
 
        #endregion
 
        #region IInstanceProvider Members
 
        public object GetInstance(InstanceContext instanceContext)
        {
            return GetInstance(instanceContext, null);
        }
 
        public object GetInstance(InstanceContext instanceContext, Message message)
        {
            return Container.Resolve(_serviceType);
        }
 
        public void ReleaseInstance(InstanceContext instanceContext, object instance) { }
 
        #endregion
 
        #region Private Methods
 
        private static IUnityContainer CreateContainer()
        {
            IUnityContainer container = new UnityContainer();
 
            IUnityConfigurator configurator = new WebConfigUnityConfigurator();
 
            configurator.Configure(container);
 
            return container;
        } 
 
        #endregion
    }
}
 
using System;
using System.Collections.Generic;
using System.Text;
using Microsoft.Practices.Unity;
 
namespace AMG.Unity
{
    public interface IUnityConfigurator
    {
        /// &lt;summary&gt;
        /// Configures a unity container
        /// &lt;/summary&gt;
        void Configure(IUnityContainer container);
    }
}
 
using System;
using System.Configuration;
using System.IO;
using System.Web.Configuration;
using Microsoft.Practices.Unity;
using Microsoft.Practices.Unity.Configuration;
 
namespace AMG.Unity
{
    public class WebConfigUnityConfigurator : IUnityConfigurator
    {
        #region Private Fields
 
        private readonly string _baseDirectory; 
 
        #endregion
 
        #region Constructors
 
        /// &lt;summary&gt;
        /// Initializes a new instance of &lt;see cref=&quot;WebConfigUnityConfigurator&quot;/&gt;.
        /// &lt;/summary&gt;
        public WebConfigUnityConfigurator()
            : this(String.Empty)
        {
        }
 
        /// &lt;summary&gt;
        /// Initializes a new instance of &lt;see cref=&quot;WebConfigUnityConfigurator&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;baseDirectory&quot;&gt;The directory from which to start searching for the 
        /// configuration files.&lt;/param&gt;
        public WebConfigUnityConfigurator(string baseDirectory)
        {
            _baseDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, baseDirectory);
        } 
 
        #endregion
 
        #region IUnityConfigurator Members
 
        /// &lt;summary&gt;
        /// Configures a unity container
        /// &lt;/summary&gt;
        public void Configure(IUnityContainer container)
        {
            Configure(container, _baseDirectory);
        }
 
        #endregion
 
        #region Private Methods
 
        private static void Configure(IUnityContainer container, string rootDirectory)
        {
            foreach (string fileName in Directory.GetFiles(rootDirectory, &quot;Web.Config&quot;, SearchOption.TopDirectoryOnly))
            {
                Configuration configuration = GetConfiguration(Path.Combine(rootDirectory, fileName));
 
                ConfigurationSection section = configuration.GetSection(&quot;unity&quot;);
 
                UnityConfigurationSection localSection = section as UnityConfigurationSection;
 
                if (localSection != null)
                {
                    foreach (UnityContainerElement element in localSection.Containers)
                    {
                        element.Configure(container);
                    }
                }
            }
            foreach (string childDirectory in Directory.GetDirectories(rootDirectory))
            {
                Configure(container, childDirectory);
            }
        }
 
        private static Configuration GetConfiguration(string configFilePath)
        {
            Configuration configuration;
 
            System.Web.HttpContext context = System.Web.HttpContext.Current;
 
            if (context == null)
            {
                configuration = GetConfigurationForCustomFile(configFilePath);
            }
            else
            {
                configuration = WebConfigurationManager.OpenWebConfiguration(context.Request.ApplicationPath &#43; &quot;/&quot; &#43; configFilePath.Replace(context.Request.PhysicalApplicationPath, &quot;&quot;));
            }
            return configuration;
        }
 
        private static Configuration GetConfigurationForCustomFile(string fileName)
        {
            ExeConfigurationFileMap fileMap = new ExeConfigurationFileMap();
            fileMap.ExeConfigFilename = fileName;
            File.SetAttributes(fileMap.ExeConfigFilename, FileAttributes.Normal);
            return ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);
        } 
 
        #endregion
    }
}
 
&lt;!--WCF Configuration--&gt;
&lt;extensions&gt;
  &lt;behaviorExtensions&gt;
    &lt;!-- unityBehavior extension
             for dependency injection with Unity using
             custom WCF InstanceProvider
        --&gt;
    &lt;add name=&quot;unityBehavior&quot;
         type=&quot;AMG.WCF.Unity.UnityBehaviorExtensionElement, AMG.WCF.Unity, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot; /&gt;
  &lt;/behaviorExtensions&gt;
&lt;/extensions&gt;
&lt;behaviors&gt;
  &lt;serviceBehaviors&gt;
    &lt;behavior name=&quot;MyServiceBehavior&quot;&gt;
      &lt;serviceDebug includeExceptionDetailInFaults=&quot;false&quot; /&gt;
      &lt;serviceMetadata httpGetEnabled=&quot;true&quot; /&gt;
      &lt;unityBehavior /&gt;
    &lt;/behavior&gt;
  &lt;/serviceBehaviors&gt;
&lt;/behaviors&gt;
</pre>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_84801" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="85391">
    <td id="PostDetailsCell_85391" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post85391"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/kikok">kikok</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/7/2008 4:02:03 PM" LocalTimeTicks="1207609323">Apr 7, 2008 at 4:02 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_85391" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;If&#32;i&#32;remember&#32;quite&#32;well,&#32;a&#32;lot&#32;of&#32;people&#32;and&#32;myself&#32;included&#32;asked&#32;Ayende&#32;to&#32;implement&#32;an&#32;external&#32;integration&#32;from&#32;Windsor&#32;to&#32;WCF.&#32;The&#32;WCF&#32;Facility&#32;was&#32;born.&#32;Lately&#32;i&#39;ve&#32;looked&#32;at&#32;what&#32;it&#32;became&#32;thanks&#32;to&#32;the&#32;amazing&#32;job&#32;Craig&#32;Neuwirt&#32;did&#32;with&#32;Ayende&#39;s&#32;initial&#32;implementation.&#32;You&#32;will&#32;find&#32;the&#32;details&#32;of&#32;this&#32;beast&#32;there&#58;http&#58;&#47;&#47;groups.google.com&#47;group&#47;castle-project-devel&#47;browse_thread&#47;thread&#47;4435ad57f89e61a5&#63;hl&#61;enI&#39;m&#32;currently&#32;looking&#32;at&#32;the&#32;implementation&#32;in&#32;order&#32;to&#32;see&#32;if&#32;i&#32;could&#32;port&#32;it&#32;to&#32;Unity&#32;or&#32;at&#32;least&#32;be&#32;inspired&#32;by&#32;the&#32;ideas&#32;beneath&#32;it.&#32;The&#32;only&#32;limitation&#32;i&#32;see&#32;right&#32;now&#32;is&#32;due&#32;to&#32;the&#32;missing&#32;interception&#32;mechanism&#32;in&#32;Unity.&#32;I&#32;hope&#32;the&#32;p&#38;amp&#59;p&#32;team&#32;will&#32;take&#32;the&#32;opportunity&#32;they&#32;have&#32;to&#32;rethink&#32;the&#32;PIAB&#32;&#43;&#32;Unity&#32;Interactions&#32;or&#32;merge&#32;&#58;p&#32;">
        If i remember quite well, a lot of people and myself included asked Ayende to implement an external integration from Windsor to WCF. The WCF Facility was born. Lately i've looked at what it became thanks to the amazing job Craig Neuwirt did with Ayende's
 initial implementation. You will find the details of this beast there:<br>
<a href="http://groups.google.com/group/castle-project-devel/browse_thread/thread/4435ad57f89e61a5?hl=en" rel="nofollow">http://groups.google.com/group/castle-project-devel/browse_thread/thread/4435ad57f89e61a5?hl=en<span style="font-family:Consolas,Courier New,Courier,Monospace"></span></a><br>
<br>
I'm currently looking at the implementation in order to see if i could port it to Unity or at least be inspired by the ideas beneath it. The only limitation i see right now is due to the missing interception mechanism in Unity. I hope the p&amp;p team will
 take the opportunity they have to rethink the PIAB &#43; Unity Interactions or merge :p
<br>
<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_85391" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="85461">
    <td id="PostDetailsCell_85461" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post85461"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/8/2008 12:28:08 AM" LocalTimeTicks="1207639688">Apr 8, 2008 at 12:28 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="4/8/2008 6:13:51 AM" LocalTimeTicks="1207660431">Apr 8, 2008 at 6:13 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_85461" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Prototyped&#32;the&#32;below&#32;solution&#32;for&#32;an&#32;issue&#32;similar&#32;to&#32;Klaus&#8217;&#32;which&#32;should&#32;guarantee&#32;that&#32;the&#32;unity&#32;container&#32;is&#32;created&#32;only&#32;once&#32;per&#32;AppDomain.&#32;It&#32;should&#32;also&#32;be&#32;possible&#32;to&#32;host&#32;the&#32;WCF&#32;application&#32;using&#32;Unity&#32;in&#32;IIS,&#32;WAS,&#32;Windows&#32;Service,&#32;BizTalk&#32;2006&#32;etc.&#32;Cheers,Tim&#32;Bajz.&#32;using&#32;System&#59;&#32;using&#32;System.Collections.Generic&#59;&#32;using&#32;System.Linq&#59;&#32;using&#32;System.Text&#59;&#32;using&#32;System.Configuration&#59;&#32;using&#32;Microsoft.Practices.Unity&#59;&#32;using&#32;Microsoft.Practices.Unity.StaticFactory&#59;&#32;using&#32;Microsoft.Practices.Unity.Configuration&#59;&#32;namespace&#32;Sample.Enterprise.Helpers&#32;&#123;&#32;public&#32;class&#32;UnityHelper&#32;&#123;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;static&#32;UnityContainer&#32;Container&#32;&#123;&#32;get&#32;&#123;&#32;return&#32;GetContainer&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;returns&#38;gt&#59;&#38;lt&#59;&#47;returns&#38;gt&#59;&#32;private&#32;static&#32;UnityContainer&#32;GetContainer&#40;&#41;&#32;&#123;&#32;AppDomain&#32;appDomain&#32;&#61;&#32;AppDomain.CurrentDomain&#59;&#32;UnityContainer&#32;container&#32;&#61;&#32;&#40;UnityContainer&#41;appDomain.GetData&#40;&#34;UnityContainer&#34;&#41;&#59;&#32;if&#32;&#40;container&#32;&#61;&#61;&#32;null&#41;&#32;&#123;&#32;Singleton&#32;singleton&#32;&#61;&#32;Singleton.Instance&#59;&#32;container&#32;&#61;&#32;&#40;UnityContainer&#41;appDomain.GetData&#40;&#34;UnityContainer&#34;&#41;&#59;&#32;&#125;&#32;return&#32;container&#59;&#32;&#125;&#32;private&#32;sealed&#32;class&#32;Singleton&#32;&#123;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;private&#32;Singleton&#40;&#41;&#32;&#123;&#32;AppDomain&#32;appDomain&#32;&#61;&#32;AppDomain.CurrentDomain&#59;&#32;UnityContainer&#32;container&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;UnityConfigurationSection&#32;section&#32;&#61;&#32;&#40;UnityConfigurationSection&#41;ConfigurationManager.GetSection&#40;&#34;unity&#34;&#41;&#59;&#32;section.Containers.Default.Configure&#40;container&#41;&#59;&#32;appDomain.SetData&#40;&#34;UnityContainer&#34;,&#32;container&#41;&#59;&#32;&#125;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;public&#32;static&#32;Singleton&#32;Instance&#32;&#123;&#32;get&#32;&#123;&#32;return&#32;InnerSingleton.instance&#59;&#32;&#125;&#32;&#125;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;private&#32;class&#32;InnerSingleton&#32;&#123;&#32;&#47;&#47;&#32;Explicit&#32;static&#32;constructor&#32;to&#32;tell&#32;C&#35;&#32;compiler&#32;not&#32;to&#32;mark&#32;type&#32;as&#32;beforefieldinit&#32;static&#32;InnerSingleton&#40;&#41;&#32;&#123;&#32;&#125;&#32;internal&#32;static&#32;readonly&#32;Singleton&#32;instance&#32;&#61;&#32;new&#32;Singleton&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#125;&#32;">
        Prototyped the below solution for an issue similar to Klausâ€™ which should guarantee that the unity container is created only once per AppDomain. It should also be possible to host the WCF application using Unity in IIS, WAS, Windows Service, BizTalk 2006
 etc. <br>
<br>
Cheers,<br>
Tim Bajz.<br>
<br>
<br>
<pre style="background-color:#ECECEC; border:dashed .1em #3E62A6; font-family:Consolas,Courier New,Courier,Monospace; font-size:1em; margin-top:0; padding:.5em; height:auto; overflow:auto; overflow-x:auto; overflow-y:auto">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Configuration;
 
using Microsoft.Practices.Unity;
using Microsoft.Practices.Unity.StaticFactory;
using Microsoft.Practices.Unity.Configuration;
 
namespace Sample.Enterprise.Helpers
{
    public class UnityHelper
    {
        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        public static UnityContainer Container
        {
            get { return GetContainer(); }
        }
 
        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private static UnityContainer GetContainer()
        {
            AppDomain appDomain = AppDomain.CurrentDomain;
            UnityContainer container = (UnityContainer)appDomain.GetData(&quot;UnityContainer&quot;);
 
            if (container == null)
            {
                Singleton singleton = Singleton.Instance;
                container = (UnityContainer)appDomain.GetData(&quot;UnityContainer&quot;);
            }
 
            return container;
        }
 
        private sealed class Singleton
        {
            /// &lt;summary&gt;
            /// 
            /// &lt;/summary&gt;
            private Singleton()
            {
                AppDomain appDomain = AppDomain.CurrentDomain;
                UnityContainer container = new UnityContainer();
 
                UnityConfigurationSection section = (UnityConfigurationSection)ConfigurationManager.GetSection(&quot;unity&quot;);
                section.Containers.Default.Configure(container);
              
                appDomain.SetData(&quot;UnityContainer&quot;, container);
            }
 
            /// &lt;summary&gt;
            /// 
            /// &lt;/summary&gt;
            public static Singleton Instance
            {
                get
                {
                    return InnerSingleton.instance;
                }
            }
 
            /// &lt;summary&gt;
            /// 
            /// &lt;/summary&gt;
            private class InnerSingleton
            {
                // Explicit static constructor to tell C# compiler not to mark type as beforefieldinit
                static InnerSingleton()
                { }
 
                internal static readonly Singleton instance = new Singleton();
            }
        }
    }
}
</pre>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_85461" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="86645">
    <td id="PostDetailsCell_86645" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post86645"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/EvilShrike">EvilShrike</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/14/2008 9:46:43 AM" LocalTimeTicks="1208191603">Apr 14, 2008 at 9:46 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_86645" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Hello,&#32;Tim.Could&#32;you&#32;comment&#32;a&#32;bit&#32;why&#32;have&#32;you&#32;used&#32;two&#32;nested&#32;classed&#32;&#40;Singleton&#32;and&#32;InnerSingleton&#41;&#32;&#63;">
        Hello, Tim.<br>
Could you comment a bit why have you used two nested classed (Singleton and InnerSingleton) ?<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_86645" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="87110">
    <td id="PostDetailsCell_87110" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post87110"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/16/2008 12:39:15 PM" LocalTimeTicks="1208374755">Apr 16, 2008 at 12:39 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_87110" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;This&#32;link&#32;should&#32;clarify&#58;&#32;http&#58;&#47;&#47;www.yoda.arachsys.com&#47;csharp&#47;singleton.htmlEvilShrike&#32;wrote&#58;Hello,&#32;Tim.Could&#32;you&#32;comment&#32;a&#32;bit&#32;why&#32;have&#32;you&#32;used&#32;two&#32;nested&#32;classed&#32;&#40;Singleton&#32;and&#32;InnerSingleton&#41;&#32;&#63;">
        This link should clarify: http://www.yoda.arachsys.com/csharp/singleton.html<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
EvilShrike wrote:<br>
Hello, Tim.<br>
Could you comment a bit why have you used two nested classed (Singleton and InnerSingleton) ?<br>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_87110" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="87348">
    <td id="PostDetailsCell_87348" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post87348"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/17/2008 1:10:12 PM" LocalTimeTicks="1208463012">Apr 17, 2008 at 1:10 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_87348" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;The&#32;link&#32;posted&#32;should&#32;hopefully&#32;clarify&#32;the&#32;various&#32;pros&#32;and&#32;cons.&#32;Hope&#32;that&#32;helps&#8230;&#123;quote&#125;&#32;windywinter&#32;wrote&#58;It&#39;s&#32;getting&#32;slightly&#32;off&#32;topic,&#32;but&#32;I&#32;couldn&#39;t&#32;resist&#32;to&#32;ask&#58;Your&#32;Singleton&#32;class&#32;is&#32;already&#32;nested&#32;class,&#32;usage&#32;of&#32;this&#32;class&#32;happens&#32;only&#32;from&#32;static&#32;Container&#32;property,&#32;so&#32;are&#32;you&#32;sure&#32;that&#32;such&#32;double&#47;triple&#32;checking&#32;is&#32;necessary&#63;TimBajz&#32;wrote&#58;This&#32;link&#32;should&#32;clarify&#58;&#32;http&#58;&#47;&#47;www.yoda.arachsys.com&#47;csharp&#47;singleton.html">
        The link posted should hopefully clarify the various pros and cons. <br>
Hope that helpsâ€¦<br>
<br>
{quote} <br>
windywinter wrote:<br>
It's getting slightly off topic, but I couldn't resist to ask:<br>
Your Singleton class is already nested class, usage of this class happens only from static Container property, so are you sure that such double/triple checking is necessary?<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
TimBajz wrote:<br>
This link should clarify: http://www.yoda.arachsys.com/csharp/singleton.html<br>
<br>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_87348" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="87497">
    <td id="PostDetailsCell_87497" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post87497"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/18/2008 7:00:12 AM" LocalTimeTicks="1208527212">Apr 18, 2008 at 7:00 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_87497" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Hi&#32;Wojciech,1.&#32;Original&#32;code&#32;runs&#32;inside&#32;BizTalk&#32;2006&#32;which&#32;has&#32;special&#32;lifetime&#32;requirements2.&#32;Do&#32;you&#32;believe&#32;a&#32;race&#32;condition&#32;can&#32;be&#32;produced&#63;&#32;Tim.&#123;quote&#125;&#32;windywinter&#32;wrote&#58;Could&#32;you&#32;answer&#32;on&#32;following&#32;questions&#63;1.&#32;Why&#32;you&#32;need&#32;something-like&#32;cross-app-domain&#32;singleton&#63;2.&#32;You&#32;are&#32;using&#32;thread-safe&#32;version&#32;of&#32;singleton,&#32;but&#32;are&#32;you&#32;sure&#32;that&#32;UnityHelper.GetContainer&#32;is&#32;thread&#32;safe&#32;it&#32;self&#63;Regards,Wojciech&#32;GebczykTimBajz&#32;wrote&#58;The&#32;link&#32;posted&#32;should&#32;hopefully&#32;clarify&#32;the&#32;various&#32;pros&#32;and&#32;cons.&#32;Hope&#32;that&#32;helps&#8230;windywinter&#32;wrote&#58;It&#39;s&#32;getting&#32;slightly&#32;off&#32;topic,&#32;but&#32;I&#32;couldn&#39;t&#32;resist&#32;to&#32;ask&#58;Your&#32;Singleton&#32;class&#32;is&#32;already&#32;nested&#32;class,&#32;usage&#32;of&#32;this&#32;class&#32;happens&#32;only&#32;from&#32;static&#32;Container&#32;property,&#32;so&#32;are&#32;you&#32;sure&#32;that&#32;such&#32;double&#47;triple&#32;checking&#32;is&#32;necessary&#63;TimBajz&#32;wrote&#58;This&#32;link&#32;should&#32;clarify&#58;&#32;http&#58;&#47;&#47;www.yoda.arachsys.com&#47;csharp&#47;singleton.html">
        Hi Wojciech,<br>
<br>
1. Original code runs inside BizTalk 2006 which has special lifetime requirements<br>
2. Do you believe a race condition can be produced? <br>
<br>
Tim.<br>
<br>
{quote} <br>
windywinter wrote:<br>
Could you answer on following questions?<br>
1. Why you need something-like cross-app-domain singleton?<br>
2. You are using thread-safe version of singleton, but are you sure that UnityHelper.GetContainer is thread safe it self?<br>
<br>
Regards,<br>
Wojciech Gebczyk<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
TimBajz wrote:<br>
The link posted should hopefully clarify the various pros and cons. <br>
Hope that helpsâ€¦<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
windywinter wrote:<br>
It's getting slightly off topic, but I couldn't resist to ask:<br>
Your Singleton class is already nested class, usage of this class happens only from static Container property, so are you sure that such double/triple checking is necessary?<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
TimBajz wrote:<br>
This link should clarify: http://www.yoda.arachsys.com/csharp/singleton.html<br>
<br>
<br>
</div>
<br>
</div>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_87497" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="87543">
    <td id="PostDetailsCell_87543" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post87543"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/18/2008 12:14:20 PM" LocalTimeTicks="1208546060">Apr 18, 2008 at 12:14 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_87543" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;In&#32;the&#32;BizTalk&#32;runtime&#32;objects&#32;can&#32;be&#32;dehydrated&#32;and&#32;hydrated.&#32;The&#32;following&#32;site&#32;has&#32;useful&#32;information&#58;&#32;http&#58;&#47;&#47;www.traceofthought.net&#32;which&#32;might&#32;help&#32;&#40;log4net&#32;blog&#32;posts&#32;in&#32;particular&#41;.&#32;What&#32;is&#32;your&#32;simpler&#32;preference&#32;for&#32;allowing&#32;the&#32;Unity&#32;container&#32;to&#32;be&#32;accessible&#63;Tim.&#123;quote&#125;&#32;windywinter&#32;wrote&#58;1.&#32;As&#32;I&#39;m&#32;not&#32;aware&#32;of&#32;those&#32;special&#32;cross-domain&#32;access&#32;of&#32;BizTalk&#32;Server&#32;-&#32;could&#32;you&#32;point&#32;me&#32;some&#32;documentation&#32;that&#32;requires&#32;such&#32;behavior&#63;I&#32;would&#32;be&#32;very&#32;thankful&#32;for&#32;any&#32;documentation&#32;that&#32;explains&#32;such&#32;needs.&#32;Unfortunately&#32;article&#32;that&#32;you&#32;have&#32;pointed&#32;me&#32;previously&#32;does&#32;not&#32;mention&#32;BizTalk&#32;&#34;quirks&#34;.Till&#32;now&#32;you&#32;have&#32;mentioned&#32;2&#32;reasons&#32;of&#32;using&#32;your&#32;snipped&#32;code&#58;A.&#32;&#34;guarantee&#32;that&#32;the&#32;unity&#32;container&#32;is&#32;created&#32;only&#32;once&#32;per&#32;AppDomain&#34;B.&#32;&#34;host&#32;the&#32;WCF&#32;application&#32;using&#32;Unity&#32;in&#32;IIS,&#32;WAS,&#32;Windows&#32;Service,&#32;BizTalk&#32;2006&#32;etc.&#32;&#34;If&#32;the&#32;only&#32;requirement&#32;would&#32;be&#32;A&#32;then&#32;much,&#32;much,&#32;much&#32;more&#32;simpler&#32;code&#32;will&#32;work&#32;fine&#32;without&#32;any&#32;problems.&#32;That&#39;s&#32;why&#32;I&#39;m&#32;asking&#32;about&#32;any&#32;clues&#32;why&#32;you&#32;need&#32;Get&#47;Set&#32;Data&#32;on&#32;AppDomain&#32;to&#32;achieve&#32;your&#32;goals&#63;I&#32;will&#32;read&#32;with&#32;pleasure&#32;why&#32;anyone&#32;of&#32;those&#32;cited&#32;by&#32;you&#32;hosting&#32;environments&#32;requires&#32;special&#32;treating.2.&#32;Right&#32;now&#32;I&#32;don&#39;t&#32;see&#32;any&#32;such&#32;problems.&#32;My&#32;mistake&#32;-&#32;yesterday&#32;I&#32;thought&#32;that&#32;there&#32;is&#32;one,&#32;but&#32;I&#32;was&#32;wrong.Wojciech&#32;GebczykTimBajz&#32;wrote&#58;Hi&#32;Wojciech,1.&#32;Original&#32;code&#32;runs&#32;inside&#32;BizTalk&#32;2006&#32;which&#32;has&#32;special&#32;lifetime&#32;requirements2.&#32;Do&#32;you&#32;believe&#32;a&#32;race&#32;condition&#32;can&#32;be&#32;produced&#63;&#32;Tim.">
        In the BizTalk runtime objects can be dehydrated and hydrated. The following site has useful information: http://www.traceofthought.net which might help (log4net blog posts in particular).
<br>
<br>
What is your simpler preference for allowing the Unity container to be accessible?<br>
<br>
Tim.<br>
<br>
{quote} <br>
windywinter wrote:<br>
1. As I'm not aware of those special cross-domain access of BizTalk Server - could you point me some documentation that requires such behavior?<br>
I would be very thankful for any documentation that explains such needs. Unfortunately article that you have pointed me previously does not mention BizTalk &quot;quirks&quot;.<br>
Till now you have mentioned 2 reasons of using your snipped code:<br>
A. &quot;guarantee that the unity container is created only once per AppDomain&quot;<br>
B. &quot;host the WCF application using Unity in IIS, WAS, Windows Service, BizTalk 2006 etc. &quot;<br>
If the only requirement would be A then much, much, much more simpler code will work fine without any problems. That's why I'm asking about any clues why you need Get/Set Data on AppDomain to achieve your goals?<br>
I will read with pleasure why anyone of those cited by you hosting environments requires special treating.<br>
<br>
2. Right now I don't see any such problems. My mistake - yesterday I thought that there is one, but I was wrong.<br>
<br>
<br>
Wojciech Gebczyk<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
TimBajz wrote:<br>
Hi Wojciech,<br>
<br>
1. Original code runs inside BizTalk 2006 which has special lifetime requirements<br>
2. Do you believe a race condition can be produced? <br>
<br>
Tim.<br>
<br>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_87543" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="87981">
    <td id="PostDetailsCell_87981" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post87981"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/21/2008 9:33:18 AM" LocalTimeTicks="1208795598">Apr 21, 2008 at 9:33 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_87981" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Wojciech,My&#32;example&#32;does&#32;not&#32;create&#32;one&#32;Unity&#32;container&#32;across&#32;AppDomains.Hope&#32;that&#32;helps.Tim.&#123;quote&#125;&#32;windywinter&#32;wrote&#58;Tim,1.&#32;I&#39;m&#32;looking&#32;in&#32;Google&#32;to&#32;find&#32;more&#32;info&#32;about&#32;&#40;de&#41;hydrating&#32;orchestration,&#32;because&#32;till&#32;now&#32;it&#32;seem&#32;that&#32;it&#32;describes&#32;process&#32;of&#32;&#40;de&#41;serialization&#32;of&#32;some&#32;running&#32;process&#32;state.So&#32;your&#32;possible&#32;intention&#32;would&#32;be&#32;to&#32;save&#32;some&#32;time&#32;on&#32;dehyrdating&#32;and&#32;after&#32;deserialization&#32;container&#32;shouldn&#39;t&#32;be&#32;reinitialized,&#32;but&#58;-&#32;UnityContainer&#32;is&#32;not&#32;binary&#32;serializable&#32;-&#32;example&#58;&#32;&#34;new&#32;BinaryFormatter&#40;&#41;.Serialize&#40;new&#32;MemoryStream&#40;&#41;,&#32;new&#32;UnityContainer&#40;&#41;&#41;&#34;-&#32;Use&#32;AppDomain&#39;s&#32;data&#32;&#34;hashtable&#34;&#32;to&#32;prevent&#32;serialization&#32;of&#32;static&#32;fields&#32;-&#32;but&#32;according&#32;to&#32;one&#32;blog&#32;text&#32;static&#32;fields&#32;are&#32;not&#32;serialzable&#32;in&#32;BizTalk&#32;during&#32;hydratingSo&#32;still&#32;I&#32;don&#39;t&#32;have&#32;any&#32;idea&#32;why&#32;Get&#47;Set&#32;Data&#32;is&#32;used&#32;in&#32;your&#32;example.2.&#32;Look&#32;at&#32;below&#32;code&#32;sample.&#32;In&#32;my&#32;opinion&#32;each&#32;domain&#32;will&#32;have&#32;separate&#32;singleton&#32;instances.&#32;&#40;Run&#32;code&#32;with&#32;defined&#32;CROSS_DOMAIN&#32;and&#32;without&#32;this&#32;conditional&#32;compilation&#32;label,&#32;to&#32;see&#32;differences&#41;&#32;&#35;define&#32;CROSS_DOMAIN&#32;using&#32;System&#59;&#32;namespace&#32;ConsoleApplication5&#32;&#123;&#32;static&#32;class&#32;Program&#32;&#123;&#32;static&#32;void&#32;Main&#40;string&#91;&#93;&#32;args&#41;&#32;&#123;&#32;&#35;if&#32;CROSS_DOMAIN&#32;var&#32;o&#32;&#61;&#32;new&#32;object&#91;32&#93;&#59;&#32;var&#32;i&#32;&#61;&#32;0&#59;&#32;var&#32;domain&#32;&#61;&#32;AppDomain.CreateDomain&#40;&#34;x&#34;&#41;&#59;&#32;o&#91;i&#43;&#43;&#93;&#32;&#61;&#32;RootClass.StringA&#59;&#32;o&#91;i&#43;&#43;&#93;&#32;&#61;&#32;RootClass.InstanceA&#59;&#32;domain.DoCallBack&#40;delegate&#32;&#123;&#32;Program.Test&#40;&#41;&#59;&#32;&#125;&#41;&#59;&#32;&#35;endif&#32;Test&#40;&#41;&#59;&#32;Console.ReadKey&#40;&#41;&#59;&#32;&#125;&#32;static&#32;void&#32;Test&#40;&#41;&#32;&#123;&#32;var&#32;o&#32;&#61;&#32;new&#32;object&#91;32&#93;&#59;&#32;var&#32;i&#32;&#61;&#32;0&#59;&#32;o&#91;i&#43;&#43;&#93;&#32;&#61;&#32;RootClass.StringA&#59;&#32;o&#91;i&#43;&#43;&#93;&#32;&#61;&#32;RootClass.InstanceA&#59;&#32;o&#91;i&#43;&#43;&#93;&#32;&#61;&#32;RootClass.StringB&#59;&#32;o&#91;i&#43;&#43;&#93;&#32;&#61;&#32;RootClass.InstanceB&#59;&#32;&#125;&#32;&#125;&#32;sealed&#32;class&#32;ClassA&#32;&#123;&#32;public&#32;ClassA&#40;&#41;&#32;&#123;&#32;Console.WriteLine&#40;&#34;&#123;0&#125;&#58;&#32;ClassA.ctor&#34;,&#32;AppDomain.CurrentDomain.Id&#41;&#59;&#32;&#125;&#32;&#125;&#32;sealed&#32;class&#32;ClassB&#32;&#123;&#32;public&#32;ClassB&#40;&#41;&#32;&#123;&#32;Console.WriteLine&#40;&#34;&#123;0&#125;&#58;&#32;ClassB.ctor&#34;,&#32;AppDomain.CurrentDomain.Id&#41;&#59;&#32;&#125;&#32;&#125;&#32;static&#32;class&#32;RootClass&#32;&#123;&#32;public&#32;static&#32;ClassA&#32;InstanceA&#32;&#123;&#32;get&#32;&#123;&#32;return&#32;InnerA.Instance&#59;&#32;&#125;&#32;&#125;&#32;public&#32;static&#32;ClassB&#32;InstanceB&#32;&#123;&#32;get&#32;&#123;&#32;return&#32;InnerB.Instance&#59;&#32;&#125;&#32;&#125;&#32;public&#32;static&#32;readonly&#32;string&#32;StringA&#32;&#61;&#32;&#34;aaa&#34;&#59;&#32;public&#32;static&#32;readonly&#32;string&#32;StringB&#32;&#61;&#32;&#34;bbb&#34;&#59;&#32;static&#32;class&#32;InnerA&#32;&#123;&#32;static&#32;InnerA&#40;&#41;&#32;&#123;&#125;&#32;public&#32;static&#32;readonly&#32;ClassA&#32;Instance&#32;&#61;&#32;new&#32;ClassA&#40;&#41;&#59;&#32;&#125;&#32;static&#32;class&#32;InnerB&#32;&#123;&#32;static&#32;InnerB&#40;&#41;&#32;&#123;&#125;&#32;public&#32;static&#32;readonly&#32;ClassB&#32;Instance&#32;&#61;&#32;new&#32;ClassB&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;3.&#32;Honestly&#32;I&#32;don&#39;t&#32;have&#32;much&#32;experience&#32;&#40;In&#32;fact&#32;I&#39;ve&#32;done&#32;very&#32;small&#32;task&#47;work&#32;in&#32;prev&#32;ver&#32;of&#32;BizTalk&#41;&#32;so&#32;probably&#32;I&#39;m&#32;missing&#32;something.4.&#32;And&#32;last&#32;question&#32;is&#32;for&#32;necessity&#32;of&#32;rather&#32;atrificial&#32;Singleton&#32;type&#32;with&#32;nested&#32;InnerSingeton&#32;types&#32;-&#32;in&#32;my&#32;opinion&#32;Singleton&#32;type&#32;can&#32;be&#32;removed&#32;and&#32;InnterSingleton&#32;moved&#32;to&#32;UnityHelper&#32;type.What&#32;do&#32;you&#32;think&#63;Wojciech&#32;GebczykTimBajz&#32;wrote&#58;In&#32;the&#32;BizTalk&#32;runtime&#32;objects&#32;can&#32;be&#32;dehydrated&#32;and&#32;hydrated.&#32;The&#32;following&#32;site&#32;has&#32;useful&#32;information&#58;&#32;http&#58;&#47;&#47;www.traceofthought.net&#32;which&#32;might&#32;help&#32;&#40;log4net&#32;blog&#32;posts&#32;in&#32;particular&#41;.&#32;What&#32;is&#32;your&#32;simpler&#32;preference&#32;for&#32;allowing&#32;the&#32;Unity&#32;container&#32;to&#32;be&#32;accessible&#63;Tim.">
        Wojciech,<br>
<br>
My example does not create one Unity container across AppDomains.<br>
Hope that helps.<br>
<br>
Tim.<br>
<br>
{quote} <br>
windywinter wrote:<br>
Tim,<br>
<br>
1. I'm looking in Google to find more info about (de)hydrating orchestration, because till now it seem that it describes process of (de)serialization of some running process state.<br>
So your possible intention would be to save some time on dehyrdating and after deserialization container shouldn't be reinitialized, but:<br>
- UnityContainer is not binary serializable - example: &quot;new BinaryFormatter().Serialize(new MemoryStream(), new UnityContainer())&quot;<br>
- Use AppDomain's data &quot;hashtable&quot; to prevent serialization of static fields - but according to one blog text static fields are not serialzable in BizTalk during hydrating<br>
So still I don't have any idea why Get/Set Data is used in your example.<br>
<br>
2. Look at below code sample. In my opinion each domain will have separate singleton instances. (Run code with defined CROSS_DOMAIN and without this conditional compilation label, to see differences)<br>
<br>
<pre style="background-color:#ECECEC; border:dashed .1em #3E62A6; font-family:Consolas,Courier New,Courier,Monospace; font-size:1em; margin-top:0; padding:.5em; height:auto; overflow:auto; overflow-x:auto; overflow-y:auto">
#define CROSS_DOMAIN
 
using System;
 
namespace ConsoleApplication5 {
    static class Program {
        static void Main(string[] args) {
#if CROSS_DOMAIN
            var o = new object[32];
            var i = 0;
 
            var domain = AppDomain.CreateDomain(&quot;x&quot;);
            o[i&#43;&#43;] = RootClass.StringA;
            o[i&#43;&#43;] = RootClass.InstanceA;
            domain.DoCallBack(delegate { Program.Test(); });
#endif
            Test();
 
            Console.ReadKey();
        }
        static void Test() {
            var o = new object[32];
            var i = 0;
 
            o[i&#43;&#43;] = RootClass.StringA;
            o[i&#43;&#43;] = RootClass.InstanceA;
            o[i&#43;&#43;] = RootClass.StringB;
            o[i&#43;&#43;] = RootClass.InstanceB;
        }
    }
 
    sealed class ClassA {
        public ClassA() { Console.WriteLine(&quot;{0}: ClassA.ctor&quot;, AppDomain.CurrentDomain.Id); }
    }
    sealed class ClassB {
        public ClassB() { Console.WriteLine(&quot;{0}: ClassB.ctor&quot;, AppDomain.CurrentDomain.Id); }
    }
    static class RootClass {
        public static ClassA InstanceA { get { return InnerA.Instance; } }
        public static ClassB InstanceB { get { return InnerB.Instance; } }
        public static readonly string StringA = &quot;aaa&quot;;
        public static readonly string StringB = &quot;bbb&quot;;
 
        static class InnerA {
            static InnerA() {}
            public static readonly ClassA Instance = new ClassA();
        }
        static class InnerB {
            static InnerB() {}
            public static readonly ClassB Instance = new ClassB();
        }
    }
}
</pre>
<br>
3. Honestly I don't have much experience (In fact I've done very small task/work in prev ver of BizTalk) so probably I'm missing something.<br>
4. And last question is for necessity of rather atrificial Singleton type with nested InnerSingeton types - in my opinion Singleton type can be removed and InnterSingleton moved to UnityHelper type.<br>
<br>
What do you think?<br>
<br>
Wojciech Gebczyk<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
TimBajz wrote:<br>
In the BizTalk runtime objects can be dehydrated and hydrated. The following site has useful information: http://www.traceofthought.net which might help (log4net blog posts in particular).
<br>
<br>
What is your simpler preference for allowing the Unity container to be accessible?<br>
<br>
Tim.<br>
<br>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_87981" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="88188">
    <td id="PostDetailsCell_88188" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post88188"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/22/2008 5:52:17 AM" LocalTimeTicks="1208868737">Apr 22, 2008 at 5:52 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_88188" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Hi&#32;Wojciech,The&#32;use&#32;of&#32;GetData&#32;and&#32;SetData&#32;are&#32;specifically&#32;to&#32;also&#32;allow&#32;Unity&#32;to&#32;be&#32;hosted&#32;inside&#32;BizTalk&#32;2006.&#32;The&#32;links&#32;I&#32;provided&#32;explain&#32;the&#32;reasoning.&#32;As&#32;for&#32;the&#32;use&#32;of&#32;the&#32;inner&#32;singleton&#32;it&#32;is&#32;optional&#32;however&#32;I&#32;believe&#32;the&#32;use&#32;of&#32;singletons&#32;is&#32;preferable&#32;over&#32;locking&#32;solutions&#32;mentioned&#32;elsewhere.Tim.windywinter&#32;wrote&#58;Tim,Then&#32;could&#32;you&#32;tell&#32;me&#32;on&#32;following&#32;questions&#58;1.&#32;Why&#32;you&#32;have&#32;used&#32;Get&#47;Set&#32;Data&#32;on&#32;AppDomain&#32;to&#32;achieve&#32;your&#32;solution&#32;instead&#32;on&#32;much&#32;more&#32;simpler&#32;code&#63;2.&#32;Why&#32;you&#32;propose&#32;to&#32;use&#32;nested&#32;type&#32;with&#32;nested&#32;type&#32;to&#32;implement&#32;singleton&#32;instead&#32;of&#32;one&#32;nested&#32;type&#32;and&#32;still&#32;it&#32;be&#32;lazy&#32;loading&#32;thread&#32;safe&#32;solution&#63;Probably&#32;from&#32;your&#32;perspective&#32;you&#32;have&#32;answered&#32;on&#32;my&#32;questions&#32;pointing&#32;to&#32;&#34;http&#58;&#47;&#47;www.yoda.arachsys.com&#47;csharp&#47;singleton.html&#34;&#32;article&#32;and&#32;BizTalk&#32;requirements.Could&#32;you&#32;make&#32;clear&#32;statement&#40;s&#41;&#32;that&#32;describe&#32;reasons&#32;of&#32;your&#32;solution.&#32;Or&#32;simply&#32;quote&#32;from&#32;cited&#32;article&#32;about&#32;singleton&#32;and&#32;BizTalk&#32;requirement&#32;those&#32;parts&#32;that&#32;directly&#32;unveils&#32;reasons&#32;of&#32;your&#32;code&#32;composition.Generally&#32;I&#32;don&#39;t&#32;understand&#32;your&#32;proposal&#32;as&#32;in&#32;my&#32;opinion&#32;is&#32;is&#32;heavily&#32;overcomplicated.&#32;I&#39;m&#32;sure&#32;that&#32;it&#32;is&#32;working,&#32;but&#32;this&#32;is&#32;not&#32;necessary&#32;simplest&#32;&#40;or&#32;one&#32;of&#32;the&#32;simplest&#41;&#32;ways&#32;to&#32;achieve&#32;this&#32;same&#32;effect&#32;with&#32;much&#32;less&#40;simplier&#41;&#32;code.But&#32;maybe&#32;I&#39;m&#32;wrong...Wojciech&#32;GebczykTimBajz&#32;wrote&#58;Wojciech,My&#32;example&#32;does&#32;not&#32;create&#32;one&#32;Unity&#32;container&#32;across&#32;AppDomains.Hope&#32;that&#32;helps.Tim.">
        Hi Wojciech,<br>
<br>
The use of GetData and SetData are specifically to also allow Unity to be hosted inside BizTalk 2006. The links I provided explain the reasoning. As for the use of the inner singleton it is optional however I believe the use of singletons is preferable over
 locking solutions mentioned elsewhere.<br>
<br>
Tim.<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
windywinter wrote:<br>
Tim,<br>
<br>
Then could you tell me on following questions:<br>
1. Why you have used Get/Set Data on AppDomain to achieve your solution instead on much more simpler code?<br>
2. Why you propose to use nested type with nested type to implement singleton instead of one nested type and still it be lazy loading thread safe solution?<br>
<br>
Probably from your perspective you have answered on my questions pointing to &quot;http://www.yoda.arachsys.com/csharp/singleton.html&quot; article and BizTalk requirements.<br>
Could you make clear statement(s) that describe reasons of your solution. Or simply quote from cited article about singleton and BizTalk requirement those parts that directly unveils reasons of your code composition.<br>
<br>
Generally I don't understand your proposal as in my opinion is is heavily overcomplicated. I'm sure that it is working, but this is not necessary simplest (or one of the simplest) ways to achieve this same effect with much less(simplier) code.<br>
<br>
But maybe I'm wrong...<br>
<br>
Wojciech Gebczyk<br>
<br>
<div style="border:dotted .1em #aaa; border-left:none; border-right:none; font-style:italic; margin:1em 0em 2.5em 3em; padding:.2em">
<br>
TimBajz wrote:<br>
Wojciech,<br>
<br>
My example does not create one Unity container across AppDomains.<br>
Hope that helps.<br>
<br>
Tim.<br>
<br>
</div>
<br>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_88188" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="88246">
    <td id="PostDetailsCell_88246" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post88246"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/TimBajz">TimBajz</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="4/22/2008 12:48:25 PM" LocalTimeTicks="1208893705">Apr 22, 2008 at 12:48 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_88246" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Wojciech,Are&#32;you&#32;in&#32;a&#32;position&#32;to&#32;test&#32;your&#32;much&#32;simpler&#32;non-mashup&#32;use&#32;of&#32;the&#32;Unity&#32;container&#32;within&#32;a&#32;BizTalk&#32;2006&#32;orchestration&#63;&#32;Through&#32;your&#32;persistence&#32;and&#32;interest&#32;we&#8217;ll&#32;either&#32;prove&#32;Get&#47;Set&#32;on&#32;AppDomains&#32;actually&#32;does&#32;something&#32;useful&#32;or&#32;you&#8217;ll&#32;enlighten&#32;me&#32;on&#32;how&#32;it&#32;can&#32;be&#32;done&#32;in&#32;a&#32;much&#32;simpler&#32;way&#32;and&#32;for&#32;it&#32;all&#32;to&#32;still&#32;work&#32;with&#32;the&#32;hosts&#32;mentioned&#32;&#58;-&#41;Tim.">
        Wojciech,<br>
<br>
Are you in a position to test your much simpler non-mashup use of the Unity container within a BizTalk 2006 orchestration? Through your persistence and interest weâ€™ll either prove Get/Set on AppDomains actually does something useful or youâ€™ll enlighten me on
 how it can be done in a much simpler way and for it all to still work with the hosts mentioned :-)<br>
<br>
Tim.<br>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_88246" class="Options" >
            
        </div>
        
    </td>
</tr>

</table>
    </div>

    
        <div class="StandardMarginTop">
            <a id="SignInToAddCommentLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f25186">
                Sign in to post message or set email notifications
            </a>
        </div>
    


    <div id="PostEditorContainer">
        <a name="editor"></a>
        <div id="Editor" style="display: none;">
            

<div class="MarkdownEditor" data-options-id="2d8b57e5-2f98-42db-86af-9ed4e6e02fb3">
    <script class="options" defer="defer" id="2d8b57e5-2f98-42db-86af-9ed4e6e02fb3" type="application/json">{"maxLength":10000,"styleSheetLocation":""}</script>

    <div class="MarkdownEditorControls">
        <a href="#" tabindex="-1" class="control md_help" title="Markdown Syntax Guide"></a>
        <div class="control md_divider"></div>
        <a href="#" tabindex="-1" class="control md_header" title="Insert Header (CTRL + H)"></a>
        <a href="#" tabindex="-1" class="control md_code" title="Insert Code (CTRL + K)"></a>
        <a href="#" tabindex="-1" class="control md_quote" title="Insert Quote (CTRL + Q)"></a>
        <a href="#" tabindex="-1" class="control md_img" title="Insert Img (CTRL + G)"></a>
        <a href="#" tabindex="-1" class="control md_link" title="Insert Link (CTRL + L)"></a>
        <a href="#" tabindex="-1" class="control md_ulist" title="Unordered List (CTRL + U)"></a>
        <a href="#" tabindex="-1" class="control md_olist" title="Ordered List (CTRL + O)"></a>
        <a href="#" tabindex="-1" class="control md_italics" title="Italic Text (CTRL + I)"></a>
        <a href="#" tabindex="-1" class="control md_bold" title="Bold Text (CTRL + B)"></a>
    </div>

    

<div class="tab_control">
    <!-- Generate the basic HTML for the tabs. -->
    
        <div id="Compose"
              class="tab selected"
              data-custom-header-id=""
              data-tab-contents-id="compose_contents_1ad1acc1-fc17-40a1-ad99-6de691c8a168">
            Compose
        </div>
    
        <div id="Preview"
              class="tab "
              data-custom-header-id=""
              data-tab-contents-id="preview_contents_c7aec673-a5ab-40d0-a037-900aadb18945">
            Preview
        </div>
    
    <div class="clear"></div>
</div>


    <div id="compose_contents_1ad1acc1-fc17-40a1-ad99-6de691c8a168" class="compose_tab_content">
        <textarea class=" MarkdownEditorDimensions" cols="20" id="MarkdownEditor" name="content" rows="2">
</textarea>
        <div class="ClearBoth"></div>

        <div class="markdownGuide" style="display: none">
            <table>
                <tr>
                    <td class="markdownGuideColumn">
                        <h1>Text Formatting</h1>
                        <div># Header 1</div>
                        <div>## Header 2</div>
                        <br />
                        <div>*italics* (or _italics_)</div>
                        <div>**bold** (or __bold__)</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Lists</h1>
                        <div>* Unordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp * SubItem</div>
                        <br />
                        <div>1. Ordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1. SubItem</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Quotes</h1>
                        <div>> Lorem ipsum</div>
                        <div>dolor sitamet </div>
                        <div>non. Lectus at</div>
                        <div>nam nunc...</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Code</h1>
                        <div>`Inline Code`</div>
                        <br />
                        <div>``` C#</div>
                        <div>if (foo==bar)</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbar++</div>
                        <div>```</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>References</h1>
                        <div>[Link Text](URL)</div>
                        <br />
                        <div>![Image](URL)</div>
                        <br />
                        <a class="Reference" target="_blank" href="http://codeplex.codeplex.com/wikipage?title=Markdown&referringTitle=Documentation">Markdown Reference</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="preview_contents_c7aec673-a5ab-40d0-a037-900aadb18945" class="preview_tab_content markDownOutput">
        
            <div></div>
        
    </div>
    <div class="clear"></div>
</div>

            
            <div class="row" id="recaptcha_row">
                
<script type="text/javascript">
    $(document).ready(function () {
        $('#recaptcha_reload').attr('src', '../assets/recaptcha_refresh.png');
        $('#recaptcha_switch_audio').attr('src', '../assets/recaptcha_audio.png');
        $('#recaptcha_switch_img').attr('src', '../assets/recaptcha_text.png');
        $('#recaptcha_whatsthis').attr('src', '../assets/recaptcha_help.png');
        $('#recaptcha_area tr:first').attr('height', '35');
    });
</script>

                <div class="clear"></div>
                <span id="ReCaptchaError"></span>
            </div>
            <div style="padding-top: 6px;">
                <input type="button" id="SaveButton" value="Save" class="ok" />
                <input type="button" id="CancelButton" value="Cancel" class="cancel" />
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div id="DeletePostPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Post <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this post? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="ClosePostCancel" value="Cancel" class="cancel" />
            <input type="button" id="ClosePostOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>
        
            <!-- Email notification / Subscription details -->
            
    </div>
</div>
    
<div id="DeleteThreadPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Thread <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this thread? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="CloseThreadCancel" value="Cancel" class="cancel" />
            <input type="button" id="CloseThreadOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(function () {

        $('#recaptcha_response_field')
            .bind('keypress', function (event) { return $submitKeyPressElement(this, event); });


        if ($('#DeleteThreadLink')) {
            $('#DeleteThreadLink').click(function () {
                OpenDialog('#DeleteThreadPanel', true, '41em');
            });
        }
        
        $('#DeleteThreadPanel #CloseThreadOk').click(function () {
            var url = 'http://unity.codeplex.com/discussions/25186';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (x) {
                    location.href = x.RedirectUrl;
                }
            });
        });
    });

    workItemMention = new codeplex.ui.WorkItemMention();
    workItemMention.addLinks(".discussionPost");
</script>


        
        
                
                <div class="clear"></div>
                
                <div id="footer">
                    <div class="row">
                        <hr />
                        <ul>
                            <li>Â© 2006-2017 Microsoft</li>
                            <li><a href="http://www.codeplex.com/site/help">Get Help</a></li>
                            <li><a href="/site/legal/privacy">Privacy Statement</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/terms">Terms of Use</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/conduct">Code of Conduct</a></li>
                            <li><a href="http://developermedia.com/" target="_blank">Advertise With Us</a></li>
                            <li>Version 2017.10.3.21062</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </body>

</html>