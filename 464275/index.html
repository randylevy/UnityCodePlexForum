

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="" prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile#">
    
    
    
    

    
    <head>
        <meta id="CompatabilityMode" http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../assets/StyleSheet.css" id="MasterCss" rel="stylesheet" type="text/css" />
        <link rel="SHORTCUT ICON" href="../assets/favicon.ico" />
        <title>patterns &#38; practices - Unity - Register Type to Handle Case When HttpContext.Current Doesn&#39;t Exist</title>
        
       
                    <script src="../assets/mscc-0.3.6.min.js"></script>
        
                    <link rel="stylesheet" type="text/css" href="../assets/mscc-0.3.6.min.css" />
        
            <script type="text/javascript">
                var msccHadCookieBannerAtPageStart = true;
            </script>
        

        <!--
        Third party scripts and code linked to or referenced from this website are licensed to you by the parties that own such code,
        not by Microsoft.  See ASP.NET Ajax CDN Terms of Use â€“ http://www.asp.net/ajaxlibrary/CDN.ashx.
        -->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.4.4.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.6/jquery-ui.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery.ui === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        
    <style type="text/css">.SideBar, .SideBarPadding{display:none;}.MainContent{width:auto;}.SiteContentTable{width:100%;}</style>
    <style id="ProjectStyles" type="text/css">
        .SiteHeader, .SiteHeaderLeft {
            height:45px !important;
            overflow:hidden;
        }
        .SiteContent 
        {
            padding: 0 0 1em 0;
            margin-top:0;
            min-height:225px;
            border-right: 1px solid lightgrey;
            border-left: 1px solid lightgrey;
            border-bottom: 1px solid lightgrey;
        }
        .IE table.MinWidthContent
        {
	        table-layout: auto !important;	
        }
    </style>
    
    
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">

    
    
    <meta id="WTProjectName" name="WT.pi" content="unity"/>
    

    <link rel="EditURI" type="application/rsd+xml" title="RSD" href='http://unity.codeplex.com/rsd' />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href='/wlwmanifest.xml' />
    
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity" url="http://unity.codeplex.com/project/feeds/rss"/>
    
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Discussions" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Issues" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Downloads" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Reviews" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity"/>
        
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Source&#32;code" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Wiki" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity"/>
    
        
    
        <meta content="summary" name="twitter:card" /><meta content="@CodePlex" name="twitter:site" /><meta content="http://unity.codeplex.com/discussions/464275?ProjectName=unity" name="twitter:url" /><meta content="patterns &amp;#38; practices - Unity" name="twitter:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" name="twitter:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" name="twitter:image" /><meta content="CodePlex" property="og:site_name" /><meta content="http://unity.codeplex.com/discussions/464275?ProjectName=unity" property="og:url" /><meta content="object" property="og:type" /><meta content="patterns &amp;#38; practices - Unity" property="og:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" property="og:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" property="og:image" />
        

    </head>
    
    <body>
         
            
        <script src="../assets/ScriptLoader.js" type="text/javascript"></script>
        <form id="aspnetForm" autocomplete="off" method="POST" enctype="multipart/form-data">
            <input name="__RequestVerificationToken" type="hidden" value="K_YJdQq1m-KPFxIK7PsDmqCRpj4gS2o7kUJMiJoayPyO9-75J1P_ygB17bWNjGE8_UKqojkQGlk8WZfgMwi6qy1SGvw6t64UDQn_4D2g850Ya8RKgmrY1UOekpiHTnsns4V_EQ2" /><input name="__RequestVerificationToken2" type="hidden" value="__RequestVerificationToken20bc25d6d-97e1-4b14-847b-7de7c48f1583" />
            
            <div id="UpdateProgressPanel" class="loading_animation" style="display:none;">
                <div class="row">
                    <h2 class="anim_h2">
                        <span id="UpdateProgressText">Updating...</span>
                        <span id="animatedLoadingIconContainer">
                            <img id="animatedLoadingIcon" src="../assets/loading_animation.gif" class="anim_img"/>
                        </span>
                    </h2>
                </div>
            </div>
            
            <div style="display:none;">
                
                <img id="BlankImage" style="width:0;height:0;" src="../assets/blank.png" onload="self.logoImageLoaded=true;"/>

                <script language="javascript" type="text/javascript">
                    var date = new Date();
                    var timezoneOffset = date.getTimezoneOffset() / 60 * -1;
                    var timezoneOffsetCookie = getCookie("TimezoneOffset");
                    var firstTimeSetTimezoneCookie = false;

                    if (timezoneOffsetCookie == null || timezoneOffsetCookie != timezoneOffset) {
                        firstTimeSetTimezoneCookie = true;
                        document.cookie = "TimezoneOffset=" + timezoneOffset + '; domain=.codeplex.com;expires=Wed, 10 Oct 2018 05:25:47 UTC';
                    }
                </script>
            </div>
            
            
            <div id="banner">
                <div id="message"><strong>This is an archived copy of the original CodePlex Unity Discussion Forum</strong><br />Unity is now on <a href="https://github.com/unitycontainer/">GitHub</a>
                    
                </div>
            </div>
            

            <div id="header">
                <div id="header_wrap" class="row">
                    <p id="logo"><a href="http://www.codeplex.com">Code<span class="semi">Plex</span></a><span id="tagline">Project Hosting for Open Source Software</span></p>
                    

<ul id="nav">

    <li><a href="/site/register/new" id="registerLink" class="ZoomFix">Register</a></li>
    <li ><a class="SignInLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f464275" id="signInLink">Sign In</a></li>
  
    <li class="last"><a class="rss_site_icon" href="http://www.codeplex.com/site/feeds/rss" type="application/rss+xml" rel="Alternate" title="CodePlex Site Activity"></a></li>
</ul>
                    <input id="searchsite" name="searchsite" maxlength="500" type="text" value="" /><span id="search_mag"><a id="submitSearch" name="submitSearch" class="magnify" title="Search" href="#"></a></span>
                    <script>
	$(document).ready(function() {
    var searchButton = $('#submitSearch'),
        searchBar = $('#searchsite');

    // Register our own handler for the search event while we wait for the SearchBox script to load.
    searchButton.bind('click.backupSearchBox', doProjectSearch);
    searchBar.bind('keypress.backupSearchBox', function(e) { if ($keyCode(e) === 13) { doProjectSearch(); return false; } });

    function cleanupSearchEvents() {
        // If the SearchBox was loaded, unregister our handlers.
        if (epx_loaded) {
            searchButton.unbind('.backupSearchBox');
            searchBar.unbind('.backupSearchBox');
        }
    }

    $loadScript('http://i4.services.social.microsoft.com/search/Widgets/SearchBox.jss?appid=1000&scopeid=1&boxId=searchsite&btnId=submitSearch&watermark=Search%20all%20projects&overrideWatermark=true&searchLocation=%2fsite%2fsearch&allowEmptySearch=true&focusOnInit=False&minimumTermLength=3', cleanupSearchEvents);
})
function doProjectSearch() {
    
    var url = '/site/search';

    //If search term is not same as watermark
    if($('#searchsite').val() != 'Search all projects')    
    {        
        url = url + '?query=' + encodeURIComponent($('#searchsite').val());
    }

    
    var callback = '';
    if (callback.length > 0 && eval('typeof ' + callback) != 'undefined')
        url += eval(callback + '()');

    window.location.href = url;
    return false;
}
</script>
                </div>
            </div>
            
            <div id="wrap">
                
    <div id="sub_heading" class="row">
        
        <div id="ProjectHeader">
            <div id="project_title_row" class="row">
                <div id="project_logo">
                    
<a id="AffiliateLink" href="http://msdn.microsoft.com/practices">
    <img id="AffiliateImage" src="../assets/pnp_logo.png" title="patterns&#32;&#38;&#32;practices" />
</a>

    
    <h1 class="text_only"><a href="http://unity.codeplex.com/" id="ProjectTitle1"><div>patterns &#38; practices - Unity</div></a></h1>

                </div>
            </div>
        </div>
        
        <div id="ProjectDetailsDiv">
            
        </div>
		<div class="clear"></div>
        

<ul id="page_box_links">
	<li id="homeTabCell" style="width: 63px;"><a id="homeTab" href="http://unity.codeplex.com/" class="box_home">home</a><div></div></li>
    
	<li id="sourceTabCell" style="width:113px;"><a id="sourceTab" href="http://unity.codeplex.com/SourceControl/latest" class="box_source">source code</a><div></div></li>
    
	<li id="releasesTabCell" style="width:105px;"><a id="releasesTab" href="http://unity.codeplex.com/releases" class="box_downloads">downloads</a><div></div></li>
    
    <li id="documentationTabCell" style="width:143px;"><a id="documentationTab" href="http://unity.codeplex.com/documentation" class="box_documentation">documentation</a><div></div></li>
    
	<li id="discussionTabCell" style="width:112px;"><a id="discussionTab" href="../index.html" class="discussions_active">discussions</a><div></div></li>
    
	<li id="workItemsTabCell" style="width:70px;"><a id="workItemsTab" href="http://unity.codeplex.com/workitem/list/basic" class="box_issue">issues</a><div></div></li>
    
	<li id="peopleTabCell" style="width:70px;"><a id="peopleTab" href="http://unity.codeplex.com/team/view" class="box_people">people</a><div></div></li>
	<li id="licenseTabCell" style="width:70px;"><a id="licenseTab" href="http://unity.codeplex.com/license" class="box_license">license</a><div></div></li>
    
    <span class="stretch"></span>
</ul>

<script type="text/javascript">
    $(document).ready(function () {
        $('#page_box_links').applyLastClassToList();
    });
</script>
		    <div class="clear"></div>
            
     <td>
       

<div>
    
    <div id="actionBar" class="action_bar">
        <ul id="actionBar_ul" class="actionBar_sublinks subtab_right" style="vertical-align: middle;">

            

                <li id="li_actionbar_creatediscussion" data-action-id="actionbar_creatediscussion" data-action-type="Navigate" class="actionBar_sublinks" data-options-id="f6bb4621-de8c-4e71-8fe5-f8155338acf6">
                
                    <script class="options" defer="defer" id="f6bb4621-de8c-4e71-8fe5-f8155338acf6" type="application/json">{"navigate-url":"http://unity.codeplex.com/discussions/create"}</script> 
                    
                    <div class="actionBar_custom_content"></div>

                    <a href="#" id="actionbar_creatediscussion" title="Start a New Thread" class="action_bar_item_link">
                        <img id="img_actionbar_creatediscussion" class="action_bar_item_image" src="../assets/actionbar_newitem.png" style="vertical-align: middle" />
                        New Thread
                    </a>

                </li>

            

                <li id="li_actionbar_subscribe" data-action-id="actionbar_subscribe" data-action-type="PopUp" class="actionBar_sublinks" data-options-id="1438f72b-a45d-44a5-9821-3ad44bc3647e">
                
                    <script class="options" defer="defer" id="1438f72b-a45d-44a5-9821-3ad44bc3647e" type="application/json">{}</script> 
                    
                    <div class="actionBar_custom_content">

<div id="rssHoverDiv" class="HoverPanel LeftHoverWidth" style="display: none">
        <ul id="3_FeedsPanel" class="RssFeedsPanel">
            <li>
                <a id="ProjectRssLink" href="http://unity.codeplex.com/project/feeds/rss" class="ArrowSmall NoUnderline">All Project Updates</a>
            </li>
            
            <li>
                <a id="DiscussionRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity" class="ArrowSmall NoUnderline">Discussions</a>
            </li>
            
            <li>
                <a id="IssueTrackerRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity" class="ArrowSmall NoUnderline">Issue Tracker</a>
            </li>
            
            <li>
                <a id="ReleasesRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity" class="ArrowSmall NoUnderline">Downloads</a>
            </li>
            <li>
                <a id="ReviewsRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity" class="ArrowSmall NoUnderline">Reviews</a>
            </li>
            
            <li>
                <a id="SourceControlRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity" class="ArrowSmall NoUnderline">Source Code</a>
            </li>
            <li>
                <a id="WikiRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity" class="ArrowSmall NoUnderline">Wiki &amp; Documentation</a>
            </li>
        </ul>
</div></div>

                    <a href="#" id="actionbar_subscribe" title="Subscribe to project updates in RSS feeds." class="action_bar_item_link">
                        <img id="img_actionbar_subscribe" class="action_bar_item_image" src="../assets/actionbar_subscribe.png" style="vertical-align: middle" />
                        Subscribe
                    </a>

                </li>

            
        </ul>
    </div>
</div>
     </td>

        

    </div>
    
    
<div class="Threads">
    <div class="ViewThread">
        
        
        
            <h1 class="page_title WordWrapBreakWord">
                Register Type to Handle Case When HttpContext.Current Doesn&#39;t Exist
            </h1>

            <!-- Private Discussion header -->
            

            <!-- Posts List Header: Topics and Wiki Link -->
            <table class="PostsListHeader">
                <tr>
                    <td>
                     
                    </td>
                    <td>
                        <div class="WikiLink">
                            <span title="Paste this into a wiki page to link to this discussion">
                                Wiki Link: [discussion:464275]
                            </span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- The list of posts -->
            

<div id="discussionsPostList" data-options-id="87bf4534-dc85-43ca-9436-d8760030bf68">
    <script class="options" defer="defer" id="87bf4534-dc85-43ca-9436-d8760030bf68" type="application/json">{"threadUrl":"http://unity.codeplex.com/discussions/464275","showEditor":false,"checkImageUrl":"../assets/check_answer.png"}</script>

    <div class="Posts" style="margin-top: 10px;">
    

<table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 0px; table-layout:fixed">
    

<tr id="PostPanel" class="Post" d:forid="1114232">
    <td id="PostDetailsCell_1114232" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post1114232"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nfplee">nfplee</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="10/30/2013 4:15:14 PM" LocalTimeTicks="1383174914">Oct 30, 2013 at 4:15 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_1114232" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post markDownOutput" 
        data-markdown="Hi,&#32;I&#32;have&#32;an&#32;ASP.NET&#32;MVC&#32;application&#32;and&#32;in&#32;my&#32;Application_Start&#32;event&#32;I&#32;have&#32;the&#32;following&#32;code&#58;&#13;&#10;&#13;&#10;&#96;&#96;&#96;&#13;&#10;container.RegisterType&#60;ISessionFactory&#62;&#40;new&#32;ContainerControlledLifetimeManager&#40;&#41;,&#32;new&#32;InjectionFactory&#40;c&#32;&#61;&#62;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;return&#32;BuildSessionFactory&#40;&#41;&#59;&#13;&#10;&#125;&#41;&#41;&#59;&#13;&#10;container.RegisterType&#60;ISession&#62;&#40;new&#32;PerRequestLifetimeManager&#60;ISession&#62;&#40;&#41;,&#32;new&#32;InjectionFactory&#40;c&#32;&#61;&#62;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;return&#32;c.Resolve&#60;ISessionFactory&#62;&#40;&#41;.OpenSession&#40;&#41;&#59;&#13;&#10;&#125;&#41;&#41;&#59;&#13;&#10;&#96;&#96;&#96;&#13;&#10;&#13;&#10;The&#32;session&#32;factory&#32;&#40;ISessionFactory&#41;&#32;lives&#32;for&#32;the&#32;length&#32;of&#32;the&#32;application.&#32;The&#32;session&#32;&#40;ISession&#41;&#32;lives&#32;for&#32;the&#32;length&#32;of&#32;the&#32;ASP.NET&#32;request.&#32;I&#32;also&#32;dispose&#32;the&#32;session&#32;in&#32;the&#32;Application_EndRequest&#32;event.&#32;This&#32;allows&#32;me&#32;to&#32;inject&#32;the&#32;ISession&#32;throughout&#32;my&#32;application&#32;and&#32;it&#32;works&#32;as&#32;expected.&#13;&#10;&#13;&#10;I&#39;m&#32;now&#32;trying&#32;to&#32;build&#32;task&#32;scheduling&#32;into&#32;my&#32;application.&#32;I&#32;have&#32;added&#32;the&#32;following&#32;code&#32;into&#32;the&#32;Application_Start&#32;event&#58;&#13;&#10;&#13;&#10;&#96;&#96;&#96;&#13;&#10;var&#32;timer&#32;&#61;&#32;new&#32;System.Timers.Timer&#40;5000&#41;&#59;&#13;&#10;timer.Elapsed&#32;&#43;&#61;&#32;&#40;sender,&#32;e&#41;&#32;&#61;&#62;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;var&#32;thread&#32;&#61;&#32;new&#32;Thread&#40;new&#32;ThreadStart&#40;&#40;&#41;&#32;&#61;&#62;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;session&#32;&#61;&#32;DependencyResolver.Current.GetService&#60;ISession&#62;&#40;&#41;&#59;&#13;&#10;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;...&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#41;&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;thread.Start&#40;&#41;&#59;&#13;&#10;&#125;&#59;&#13;&#10;timer.Enabled&#32;&#61;&#32;true&#59;&#13;&#10;&#96;&#96;&#96;&#13;&#10;&#13;&#10;This&#32;should&#32;run&#32;every&#32;5&#32;seconds.&#32;My&#32;issue&#32;arises&#32;when&#32;it&#32;tries&#32;to&#32;resolve&#32;the&#32;ISession&#32;as&#32;it&#32;tries&#32;to&#32;resolve&#32;it&#32;in&#32;a&#32;thread&#32;where&#32;HttpContext.Current&#32;is&#32;null&#32;and&#32;therefore&#32;an&#32;exception&#32;is&#32;thrown.&#32;I&#32;was&#32;wondering&#32;how&#32;I&#32;should&#32;register&#32;the&#32;session&#32;to&#32;handle&#32;this&#32;scenario.&#32;I&#39;d&#32;appreciate&#32;the&#32;help.&#13;&#10;&#13;&#10;Thanks&#13;&#10;&#13;&#10;Here&#39;s&#32;my&#32;PerRequestLifetimeManager&#32;class&#32;incase&#32;it&#32;helps&#58;&#13;&#10;&#13;&#10;&#96;&#96;&#96;&#13;&#10;public&#32;class&#32;PerRequestLifetimeManager&#60;T&#62;&#32;&#58;&#32;LifetimeManager,&#32;IDisposable&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;HttpContext.Current.Items&#91;typeof&#40;T&#41;.AssemblyQualifiedName&#93;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#13;&#10;&#13;&#10;&#32;&#32;&#32;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;HttpContext.Current.Items.Remove&#40;typeof&#40;T&#41;.AssemblyQualifiedName&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#13;&#10;&#13;&#10;&#32;&#32;&#32;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;HttpContext.Current.Items&#91;typeof&#40;T&#41;.AssemblyQualifiedName&#93;&#32;&#61;&#32;newValue&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#13;&#10;&#13;&#10;&#32;&#32;&#32;&#32;public&#32;void&#32;Dispose&#40;&#41;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;RemoveValue&#40;&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#13;&#10;&#125;&#13;&#10;&#96;&#96;&#96;">
        <div class="markDownOutput ">Hi, I have an ASP.NET MVC application and in my Application_Start event I have the following code:<br>
<pre><code>container.RegisterType&lt;ISessionFactory&gt;(new ContainerControlledLifetimeManager(), new InjectionFactory(c =&gt; {
    return BuildSessionFactory();
}));
container.RegisterType&lt;ISession&gt;(new PerRequestLifetimeManager&lt;ISession&gt;(), new InjectionFactory(c =&gt; {
    return c.Resolve&lt;ISessionFactory&gt;().OpenSession();
}));</code></pre>
The session factory (ISessionFactory) lives for the length of the application. The session (ISession) lives for the length of the ASP.NET request. I also dispose the session in the Application_EndRequest event. This allows me to inject the ISession throughout
 my application and it works as expected. <br>
<br>
I'm now trying to build task scheduling into my application. I have added the following code into the Application_Start event:<br>
<pre><code>var timer = new System.Timers.Timer(5000);
timer.Elapsed &#43;= (sender, e) =&gt; {
    var thread = new Thread(new ThreadStart(() =&gt; {
        var session = DependencyResolver.Current.GetService&lt;ISession&gt;();

        ...
    }));
    thread.Start();
};
timer.Enabled = true;</code></pre>
This should run every 5 seconds. My issue arises when it tries to resolve the ISession as it tries to resolve it in a thread where HttpContext.Current is null and therefore an exception is thrown. I was wondering how I should register the session to handle
 this scenario. I'd appreciate the help. <br>
<br>
Thanks <br>
<br>
Here's my PerRequestLifetimeManager class incase it helps:<br>
<pre><code>public class PerRequestLifetimeManager&lt;T&gt; : LifetimeManager, IDisposable {
    public override object GetValue() {
        return HttpContext.Current.Items[typeof(T).AssemblyQualifiedName];
    }

    public override void RemoveValue() {
        HttpContext.Current.Items.Remove(typeof(T).AssemblyQualifiedName);
    }

    public override void SetValue(object newValue) {
        HttpContext.Current.Items[typeof(T).AssemblyQualifiedName] = newValue;
    }

    public void Dispose() {
        RemoveValue();
    }
}</code></pre>
</div>
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_1114232" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="1114914">
    <td id="PostDetailsCell_1114914" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post1114914"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/randylevy">randylevy</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="10/31/2013 5:19:28 AM" LocalTimeTicks="1383221968">Oct 31, 2013 at 5:19 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="10/31/2013 5:41:54 AM" LocalTimeTicks="1383223314">Oct 31, 2013 at 5:41 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_1114914" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post markDownOutput" 
        data-markdown="That&#32;makes&#32;sense.&#32;&#32;The&#32;child&#32;thread&#32;won&#39;t&#32;have&#32;an&#32;HttpContext.&#32;&#32;Even&#32;if&#32;you&#32;pass&#32;in&#32;the&#32;HttpContext&#32;it&#32;could&#32;outlive&#32;the&#32;request&#32;lifetime&#32;and&#32;be&#32;&#34;Disposed&#34;&#32;or&#32;garbage&#32;collected.&#32;&#32;See&#32;&#91;Working&#32;With&#32;HttpContext.Current&#93;&#40;http&#58;&#47;&#47;odetocode.com&#47;articles&#47;112.aspx&#41;&#32;for&#32;a&#32;relatively&#32;short&#32;and&#32;readable&#32;post&#32;on&#32;the&#32;topic.&#10;&#10;Probably&#32;the&#32;best&#32;option&#32;&#40;if&#32;using&#32;threads&#41;&#32;would&#32;be&#32;to&#32;extract&#32;the&#32;information&#32;you&#32;need&#32;from&#32;the&#32;context,&#32;copy&#32;&#40;clone&#41;&#32;it&#32;and&#32;pass&#32;it&#32;to&#32;your&#32;thread&#32;or&#32;create&#32;your&#32;own&#32;session&#32;object&#40;s&#41;&#32;that&#32;are&#32;&#32;independent&#32;of&#32;the&#32;actual&#32;request.&#32;&#32;&#40;I&#39;m&#32;assuming&#32;here&#32;you&#32;want&#32;to&#32;do&#32;something&#32;with&#32;session&#32;on&#32;every&#32;request.&#41;&#10;&#10;Re-reading&#32;your&#32;question&#32;I&#39;m&#32;a&#32;bit&#32;confused&#32;about&#32;the&#32;intent.&#32;&#32;It&#32;looks&#32;like&#32;every&#32;5&#32;seconds&#32;you&#32;want&#32;to&#32;do&#32;something&#32;with&#32;a&#32;session&#63;&#32;&#32;What&#32;ISession&#32;are&#32;you&#32;trying&#32;to&#32;resolve&#63;&#32;Perhaps&#32;an&#32;HttpModule&#32;would&#32;better&#32;suit&#32;your&#32;needs&#32;if&#32;you&#32;are&#32;trying&#32;to&#32;do&#32;something&#32;with&#32;session&#32;on&#32;a&#32;per&#32;request&#32;basis&#63;&#32;The&#32;current&#32;code&#32;will&#32;result&#32;in&#32;timer.Elapsed&#32;being&#32;invoked&#32;on&#32;a&#32;thread&#32;pool&#32;thread&#32;with&#32;a&#32;null&#32;HttpContext.&#10;&#10;In&#32;my&#32;opinion&#32;if&#32;you&#32;are&#32;doing&#32;threading&#47;long&#32;running&#32;tasks&#32;within&#32;IIS&#32;then&#32;you&#32;should&#32;step&#32;back&#32;and&#32;take&#32;a&#32;look&#32;at&#32;what&#32;your&#32;needs&#32;are&#32;and&#32;see&#32;if&#32;there&#32;are&#32;other&#32;ways&#32;of&#32;addressing&#32;them&#32;&#40;e.g.&#32;separate&#32;service&#41;.&#32;&#32;&#10;&#10;&#126;&#126;&#10;Randy&#32;Levy&#10;&#91;entlib.support&#64;live.com&#93;&#40;mailto&#58;entlib.support&#64;live.com&#41;&#10;Enterprise&#32;Library&#32;support&#32;engineer&#10;&#91;Support&#32;How-to&#93;&#40;http&#58;&#47;&#47;entlib.codeplex.com&#47;wikipage&#63;title&#61;Support&#37;20How-to&#41;&#32;">
        <div class="markDownOutput ">That makes sense. The child thread won't have an HttpContext. Even if you pass in the HttpContext it could outlive the request lifetime and be &quot;Disposed&quot; or garbage collected. See
<a href="http://odetocode.com/articles/112.aspx"  rel="nofollow">Working With HttpContext.Current</a> for a relatively short and readable post on the topic.<br>
<br>
Probably the best option (if using threads) would be to extract the information you need from the context, copy (clone) it and pass it to your thread or create your own session object(s) that are independent of the actual request. (I'm assuming here you want
 to do something with session on every request.)<br>
<br>
Re-reading your question I'm a bit confused about the intent. It looks like every 5 seconds you want to do something with a session? What ISession are you trying to resolve? Perhaps an HttpModule would better suit your needs if you are trying to do something
 with session on a per request basis? The current code will result in timer.Elapsed being invoked on a thread pool thread with a null HttpContext.<br>
<br>
In my opinion if you are doing threading/long running tasks within IIS then you should step back and take a look at what your needs are and see if there are other ways of addressing them (e.g. separate service).<br>
<br>
~~<br>
Randy Levy<br>
<a href="mailto:entlib.support@live.com" rel="nofollow">&#x65;n&#x74;&#108;&#105;&#x62;&#46;&#115;&#x75;&#112;&#112;&#x6f;&#x72;&#x74;&#x40;&#x6c;&#x69;&#118;&#x65;&#x2e;c&#x6f;&#x6d;</a><br>
Enterprise Library support engineer<br>
<a href="http://entlib.codeplex.com/wikipage?title=Support%20How-to"  rel="nofollow">Support How-to</a>
<br>
</div>
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_1114914" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="1114943">
    <td id="PostDetailsCell_1114943" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post1114943"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nfplee">nfplee</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="10/31/2013 8:46:46 AM" LocalTimeTicks="1383234406">Oct 31, 2013 at 8:46 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="10/31/2013 3:12:37 PM" LocalTimeTicks="1383257557">Oct 31, 2013 at 3:12 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_1114943" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post markDownOutput" 
        data-markdown="Thanks&#32;for&#32;your&#32;response.&#32;I&#32;have&#32;a&#32;modular&#32;application&#32;and&#32;the&#32;goal&#32;is&#32;to&#32;add&#32;multiple&#32;services&#32;that&#32;implement&#32;an&#32;interface&#32;&#40;e.g.&#32;IScheduledTask&#41;&#32;and&#32;then&#32;execute&#32;the&#32;code&#32;at&#32;a&#32;particular&#32;time.&#32;The&#32;timer&#32;would&#32;run&#32;at&#32;intervals&#32;and&#32;detect&#32;which&#32;tasks&#32;to&#32;run.&#10;&#10;An&#32;example&#32;of&#32;a&#32;task&#32;is&#32;reminder&#32;users&#32;to&#32;pay&#32;for&#32;their&#32;member&#32;as&#32;I&#32;would&#32;like&#32;this&#32;automated.&#32;The&#32;session&#32;&#40;NHibernate&#41;&#32;is&#32;used&#32;to&#32;query&#32;the&#32;database&#32;for&#32;the&#32;user&#39;s.&#32;What&#32;I&#32;guess&#32;i&#39;m&#32;after&#32;is&#32;a&#32;way&#32;to&#32;store&#32;the&#32;session&#32;in&#32;a&#32;cache&#32;that&#32;exists&#32;for&#32;the&#32;length&#32;of&#32;the&#32;thread&#32;instead&#32;of&#32;using&#32;the&#32;HttpContext.Current.Items&#32;collection&#32;which&#32;exists&#32;for&#32;the&#32;length&#32;of&#32;the&#32;request&#32;when&#32;HttpContext.Current&#32;returns&#32;null.&#10;&#10;__EDIT__&#58;&#10;&#10;After&#32;further&#32;research.&#32;I&#32;have&#32;modified&#32;my&#32;PerRequestLifetimeManager&#58;&#10;&#10;&#96;&#96;&#96;&#10;public&#32;class&#32;PerRequestLifetimeManager&#60;T&#62;&#32;&#58;&#32;PerThreadLifetimeManager&#32;&#123;&#10;&#32;&#32;&#32;&#32;public&#32;PerRequestLifetimeManager&#40;&#41;&#32;&#58;&#32;base&#40;&#41;&#32;&#123;&#32;&#125;&#10;&#10;&#32;&#32;&#32;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;&#40;HttpContext.Current&#32;&#61;&#61;&#32;null&#41;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;base.GetValue&#40;&#41;&#59;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;&#32;HttpContext.Current.Items&#91;typeof&#40;T&#41;.AssemblyQualifiedName&#93;&#59;&#10;&#32;&#32;&#32;&#32;&#125;&#10;&#10;&#32;&#32;&#32;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;&#40;HttpContext.Current&#32;&#61;&#61;&#32;null&#41;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;base.RemoveValue&#40;&#41;&#59;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;HttpContext.Current.Items.Remove&#40;typeof&#40;T&#41;.AssemblyQualifiedName&#41;&#59;&#10;&#32;&#32;&#32;&#32;&#125;&#10;&#10;&#32;&#32;&#32;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;&#40;HttpContext.Current&#32;&#61;&#61;&#32;null&#41;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;base.SetValue&#40;newValue&#41;&#59;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;else&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;HttpContext.Current.Items&#91;typeof&#40;T&#41;.AssemblyQualifiedName&#93;&#32;&#61;&#32;newValue&#59;&#10;&#32;&#32;&#32;&#32;&#125;&#10;&#125;&#10;&#96;&#96;&#96;&#10;&#10;Notice&#32;how&#32;it&#32;inherits&#32;from&#32;PerThreadLifetimeManager.&#32;I&#32;hoped&#32;that&#32;once&#32;the&#32;task&#32;is&#32;finished&#32;it&#32;would&#32;release&#32;the&#32;session.&#32;However&#32;using&#32;the&#32;NHibernate&#32;profiler&#32;I&#32;can&#32;see&#32;that&#32;all&#32;the&#32;queries&#32;are&#32;executed&#32;against&#32;the&#32;same&#32;session.&#32;I&#39;m&#32;not&#32;quite&#32;sure&#32;why&#32;this&#32;happens&#32;but&#32;i&#39;d&#32;appreciate&#32;any&#32;advice.&#32;Thanks&#10;">
        <div class="markDownOutput ">Thanks for your response. I have a modular application and the goal is to add multiple services that implement an interface (e.g. IScheduledTask) and then execute the code at a particular time. The timer would run at intervals and detect which tasks to
 run.<br>
<br>
An example of a task is reminder users to pay for their member as I would like this automated. The session (NHibernate) is used to query the database for the user's. What I guess i'm after is a way to store the session in a cache that exists for the length
 of the thread instead of using the HttpContext.Current.Items collection which exists for the length of the request when HttpContext.Current returns null.<br>
<br>
<strong>EDIT</strong>:<br>
<br>
After further research. I have modified my PerRequestLifetimeManager:<br>
<pre><code>public class PerRequestLifetimeManager&lt;T&gt; : PerThreadLifetimeManager {
    public PerRequestLifetimeManager() : base() { }

    public override object GetValue() {
        if (HttpContext.Current == null)
            return base.GetValue();
        else
            return  HttpContext.Current.Items[typeof(T).AssemblyQualifiedName];
    }

    public override void RemoveValue() {
        if (HttpContext.Current == null)
            base.RemoveValue();
        else
            HttpContext.Current.Items.Remove(typeof(T).AssemblyQualifiedName);
    }

    public override void SetValue(object newValue) {
        if (HttpContext.Current == null)
            base.SetValue(newValue);
        else
            HttpContext.Current.Items[typeof(T).AssemblyQualifiedName] = newValue;
    }
}</code></pre>
Notice how it inherits from PerThreadLifetimeManager. I hoped that once the task is finished it would release the session. However using the NHibernate profiler I can see that all the queries are executed against the same session. I'm not quite sure why this
 happens but i'd appreciate any advice. Thanks<br>
</div>
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_1114943" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="1116398">
    <td id="PostDetailsCell_1116398" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post1116398"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/randylevy">randylevy</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="11/1/2013 3:21:06 AM" LocalTimeTicks="1383301266">Nov 1, 2013 at 3:21 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_1116398" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post markDownOutput" 
        data-markdown="Are&#32;you&#32;using&#32;Unity&#32;3&#63;&#32;&#32;Unity&#32;3&#32;has&#32;a&#32;PerRequestLifetimeManager&#32;that&#32;might&#32;suit&#32;your&#32;purposes&#32;&#40;for&#32;web&#32;requests&#41;.&#32;&#32;Note&#32;that&#32;PerThreadLifetimeManager&#39;s&#32;RemoveValue&#32;is&#32;not&#32;implemented&#32;and&#32;Unity&#32;actually&#32;does&#32;not&#32;ever&#32;call&#32;RemoveValue.&#32;&#32;See&#32;&#91;Writing&#32;Custom&#32;Lifetime&#32;Managers&#93;&#40;http&#58;&#47;&#47;www.tavaresstudios.com&#47;Blog&#47;post&#47;Writing-Custom-Lifetime-Managers.aspx&#41;&#32;for&#32;more&#32;information.&#32;&#32;At&#32;some&#32;point&#32;&#40;end&#32;of&#32;the&#32;thread&#39;s&#32;work&#63;&#41;&#32;I&#32;would&#32;think&#32;you&#32;would&#32;want&#32;to&#32;call&#32;Dispose.&#13;&#10;&#13;&#10;&#126;&#126;&#13;&#10;Randy&#32;Levy&#13;&#10;&#91;entlib.support&#64;live.com&#93;&#40;mailto&#58;entlib.support&#64;live.com&#41;&#13;&#10;Enterprise&#32;Library&#32;support&#32;engineer&#13;&#10;&#91;Support&#32;How-to&#93;&#40;http&#58;&#47;&#47;entlib.codeplex.com&#47;wikipage&#63;title&#61;Support&#37;20How-to&#41;&#32;&#13;&#10;">
        <div class="markDownOutput ">Are you using Unity 3? Unity 3 has a PerRequestLifetimeManager that might suit your purposes (for web requests). Note that PerThreadLifetimeManager's RemoveValue is not implemented and Unity actually does not ever call RemoveValue. See
<a href="http://www.tavaresstudios.com/Blog/post/Writing-Custom-Lifetime-Managers.aspx"  rel="nofollow">
Writing Custom Lifetime Managers</a> for more information. At some point (end of the thread's work?) I would think you would want to call Dispose.
<br>
<br>
~~ <br>
Randy Levy <br>
<a href="mailto:entlib.support@live.com" rel="nofollow">&#x65;n&#x74;&#108;&#105;&#x62;&#46;&#115;&#x75;&#112;&#112;&#x6f;&#x72;&#x74;&#x40;&#x6c;&#x69;&#118;&#x65;&#x2e;c&#x6f;&#x6d;</a>
<br>
Enterprise Library support engineer <br>
<a href="http://entlib.codeplex.com/wikipage?title=Support%20How-to"  rel="nofollow">Support How-to</a>
<br>
</div>
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_1116398" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="1116449">
    <td id="PostDetailsCell_1116449" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post1116449"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nfplee">nfplee</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="11/1/2013 9:50:28 AM" LocalTimeTicks="1383324628">Nov 1, 2013 at 9:50 AM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="11/5/2013 12:36:24 PM" LocalTimeTicks="1383683784">Nov 5, 2013 at 12:36 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_1116449" style="width: 100%; vertical-align: top;" 
        class="discussionAnswer discussionPost discussionListContent WordWrapBreakWord Post markDownOutput" 
        data-markdown="Yeah&#32;i&#39;m&#32;using&#32;Unity&#32;3.&#32;Thanks&#32;I&#32;wasn&#39;t&#32;aware&#32;this&#32;had&#32;been&#32;bundled&#32;into&#32;version&#32;3.&#10;&#10;I&#32;posted&#32;the&#32;question&#32;on&#32;stack&#32;overflow&#32;and&#32;someone&#32;helped&#32;me&#32;out.&#32;Here&#39;s&#32;a&#32;link&#32;in-case&#32;anyone&#32;is&#32;interested.&#10;&#10;http&#58;&#47;&#47;stackoverflow.com&#47;questions&#47;19693635&#47;dependency-injection-to-handle-case-when-httpcontext-current-doesnt-exist&#10;&#10;Thanks&#32;for&#32;your&#32;help.">
        <div class="markDownOutput ">Yeah i'm using Unity 3. Thanks I wasn't aware this had been bundled into version 3.<br>
<br>
I posted the question on stack overflow and someone helped me out. Here's a link in-case anyone is interested.<br>
<br>
<a href="http://stackoverflow.com/questions/19693635/dependency-injection-to-handle-case-when-httpcontext-current-doesnt-exist"  rel="nofollow">http://stackoverflow.com/questions/19693635/dependency-injection-to-handle-case-when-httpcontext-current-doesnt-exist</a><br>
<br>
Thanks for your help.<br>
</div>
        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post discussionAnswer">
        
        <span class="answerCheck" id="checkmark_1116449" title="Marked as answer by nfplee on 11/5/2013 at 5:36 AM">
            <img src="../assets/check_answer.png" alt="Marked as answer by nfplee on 11/5/2013 at 5:36 AM" />
        </span>
        
        <div id="Options_1116449" class="Options"  style="margin-top: -22px">
            
        </div>
        
    </td>
</tr>

</table>
    </div>

    
        <div class="StandardMarginTop">
            <a id="SignInToAddCommentLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f464275">
                Sign in to post message or set email notifications
            </a>
        </div>
    


    <div id="PostEditorContainer">
        <a name="editor"></a>
        <div id="Editor" style="display: none;">
            

<div class="MarkdownEditor" data-options-id="708a3a46-5b0c-4eef-bdb9-0946505eea39">
    <script class="options" defer="defer" id="708a3a46-5b0c-4eef-bdb9-0946505eea39" type="application/json">{"maxLength":10000,"styleSheetLocation":""}</script>

    <div class="MarkdownEditorControls">
        <a href="#" tabindex="-1" class="control md_help" title="Markdown Syntax Guide"></a>
        <div class="control md_divider"></div>
        <a href="#" tabindex="-1" class="control md_header" title="Insert Header (CTRL + H)"></a>
        <a href="#" tabindex="-1" class="control md_code" title="Insert Code (CTRL + K)"></a>
        <a href="#" tabindex="-1" class="control md_quote" title="Insert Quote (CTRL + Q)"></a>
        <a href="#" tabindex="-1" class="control md_img" title="Insert Img (CTRL + G)"></a>
        <a href="#" tabindex="-1" class="control md_link" title="Insert Link (CTRL + L)"></a>
        <a href="#" tabindex="-1" class="control md_ulist" title="Unordered List (CTRL + U)"></a>
        <a href="#" tabindex="-1" class="control md_olist" title="Ordered List (CTRL + O)"></a>
        <a href="#" tabindex="-1" class="control md_italics" title="Italic Text (CTRL + I)"></a>
        <a href="#" tabindex="-1" class="control md_bold" title="Bold Text (CTRL + B)"></a>
    </div>

    

<div class="tab_control">
    <!-- Generate the basic HTML for the tabs. -->
    
        <div id="Compose"
              class="tab selected"
              data-custom-header-id=""
              data-tab-contents-id="compose_contents_9fd846ec-86f1-4547-8b16-27e1e3a443ec">
            Compose
        </div>
    
        <div id="Preview"
              class="tab "
              data-custom-header-id=""
              data-tab-contents-id="preview_contents_ae63c7be-579e-4958-ac29-b2a5a2434f82">
            Preview
        </div>
    
    <div class="clear"></div>
</div>


    <div id="compose_contents_9fd846ec-86f1-4547-8b16-27e1e3a443ec" class="compose_tab_content">
        <textarea class=" MarkdownEditorDimensions" cols="20" id="MarkdownEditor" name="content" rows="2">
</textarea>
        <div class="ClearBoth"></div>

        <div class="markdownGuide" style="display: none">
            <table>
                <tr>
                    <td class="markdownGuideColumn">
                        <h1>Text Formatting</h1>
                        <div># Header 1</div>
                        <div>## Header 2</div>
                        <br />
                        <div>*italics* (or _italics_)</div>
                        <div>**bold** (or __bold__)</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Lists</h1>
                        <div>* Unordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp * SubItem</div>
                        <br />
                        <div>1. Ordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1. SubItem</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Quotes</h1>
                        <div>> Lorem ipsum</div>
                        <div>dolor sitamet </div>
                        <div>non. Lectus at</div>
                        <div>nam nunc...</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Code</h1>
                        <div>`Inline Code`</div>
                        <br />
                        <div>``` C#</div>
                        <div>if (foo==bar)</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbar++</div>
                        <div>```</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>References</h1>
                        <div>[Link Text](URL)</div>
                        <br />
                        <div>![Image](URL)</div>
                        <br />
                        <a class="Reference" target="_blank" href="http://codeplex.codeplex.com/wikipage?title=Markdown&referringTitle=Documentation">Markdown Reference</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="preview_contents_ae63c7be-579e-4958-ac29-b2a5a2434f82" class="preview_tab_content markDownOutput">
        
            <div></div>
        
    </div>
    <div class="clear"></div>
</div>

            
            <div class="row" id="recaptcha_row">
                
<script type="text/javascript">
    $(document).ready(function () {
        $('#recaptcha_reload').attr('src', '../assets/recaptcha_refresh.png');
        $('#recaptcha_switch_audio').attr('src', '../assets/recaptcha_audio.png');
        $('#recaptcha_switch_img').attr('src', '../assets/recaptcha_text.png');
        $('#recaptcha_whatsthis').attr('src', '../assets/recaptcha_help.png');
        $('#recaptcha_area tr:first').attr('height', '35');
    });
</script>

                <div class="clear"></div>
                <span id="ReCaptchaError"></span>
            </div>
            <div style="padding-top: 6px;">
                <input type="button" id="SaveButton" value="Save" class="ok" />
                <input type="button" id="CancelButton" value="Cancel" class="cancel" />
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div id="DeletePostPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Post <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this post? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="ClosePostCancel" value="Cancel" class="cancel" />
            <input type="button" id="ClosePostOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>
        
            <!-- Email notification / Subscription details -->
            
    </div>
</div>
    
<div id="DeleteThreadPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Thread <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this thread? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="CloseThreadCancel" value="Cancel" class="cancel" />
            <input type="button" id="CloseThreadOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(function () {

        $('#recaptcha_response_field')
            .bind('keypress', function (event) { return $submitKeyPressElement(this, event); });


        if ($('#DeleteThreadLink')) {
            $('#DeleteThreadLink').click(function () {
                OpenDialog('#DeleteThreadPanel', true, '41em');
            });
        }
        
        $('#DeleteThreadPanel #CloseThreadOk').click(function () {
            var url = 'http://unity.codeplex.com/discussions/464275';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (x) {
                    location.href = x.RedirectUrl;
                }
            });
        });
    });

    workItemMention = new codeplex.ui.WorkItemMention();
    workItemMention.addLinks(".discussionPost");
</script>


        
        
                
                <div class="clear"></div>
                
                <div id="footer">
                    <div class="row">
                        <hr />
                        <ul>
                            <li>Â© 2006-2017 Microsoft</li>
                            <li><a href="http://www.codeplex.com/site/help">Get Help</a></li>
                            <li><a href="/site/legal/privacy">Privacy Statement</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/terms">Terms of Use</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/conduct">Code of Conduct</a></li>
                            <li><a href="http://developermedia.com/" target="_blank">Advertise With Us</a></li>
                            <li>Version 2017.10.3.21062</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </body>

</html>