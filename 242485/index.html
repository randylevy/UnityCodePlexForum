

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="" prefix="og: http://ogp.me/ns# profile: http://ogp.me/ns/profile#">
    
    
    
    

    
    <head>
        <meta id="CompatabilityMode" http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../assets/StyleSheet.css" id="MasterCss" rel="stylesheet" type="text/css" />
        <link rel="SHORTCUT ICON" href="../assets/favicon.ico" />
        <title>patterns &#38; practices - Unity - How tell to Container Dispose Objects after a Request End - MVC 3.0</title>
        
       
                    <script src="../assets/mscc-0.3.6.min.js"></script>
        
                    <link rel="stylesheet" type="text/css" href="../assets/mscc-0.3.6.min.css" />
        
            <script type="text/javascript">
                var msccHadCookieBannerAtPageStart = true;
            </script>
        

        <!--
        Third party scripts and code linked to or referenced from this website are licensed to you by the parties that own such code,
        not by Microsoft.  See ASP.NET Ajax CDN Terms of Use â€“ http://www.asp.net/ajaxlibrary/CDN.ashx.
        -->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.4.4.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.6/jquery-ui.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            if (typeof jQuery.ui === 'undefined') {
                document.write(unescape("%3Cscript src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>

        
    <style type="text/css">.SideBar, .SideBarPadding{display:none;}.MainContent{width:auto;}.SiteContentTable{width:100%;}</style>
    <style id="ProjectStyles" type="text/css">
        .SiteHeader, .SiteHeaderLeft {
            height:45px !important;
            overflow:hidden;
        }
        .SiteContent 
        {
            padding: 0 0 1em 0;
            margin-top:0;
            min-height:225px;
            border-right: 1px solid lightgrey;
            border-left: 1px solid lightgrey;
            border-bottom: 1px solid lightgrey;
        }
        .IE table.MinWidthContent
        {
	        table-layout: auto !important;	
        }
    </style>
    
    
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">

    
    
    <meta id="WTProjectName" name="WT.pi" content="unity"/>
    

    <link rel="EditURI" type="application/rsd+xml" title="RSD" href='http://unity.codeplex.com/rsd' />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href='/wlwmanifest.xml' />
    
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity" url="http://unity.codeplex.com/project/feeds/rss"/>
    
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Discussions" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Issues" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity"/>
        
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Downloads" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Reviews" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity"/>
        
    
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Source&#32;code" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity"/>
        <link rel="alternate" type="application/rss+xml" title="patterns&#32;&#38;&#32;practices&#32;-&#32;Unity&#32;-&#32;Wiki" url="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity"/>
    
        
    
        <meta content="summary" name="twitter:card" /><meta content="@CodePlex" name="twitter:site" /><meta content="http://unity.codeplex.com/discussions/242485?ProjectName=unity" name="twitter:url" /><meta content="patterns &amp;#38; practices - Unity" name="twitter:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" name="twitter:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" name="twitter:image" /><meta content="CodePlex" property="og:site_name" /><meta content="http://unity.codeplex.com/discussions/242485?ProjectName=unity" property="og:url" /><meta content="object" property="og:type" /><meta content="patterns &amp;#38; practices - Unity" property="og:title" /><meta content="The Unity Application Block &amp;#40;Unity&amp;#41; is officially under new ownership.&amp;#13;&amp;#10;https&amp;#58;&amp;#47;&amp;#47;github.com&amp;#47;unitycontainer&amp;#47;unity" property="og:description" /><meta content="http://www.codeplex.com/Images/codeplex.png" property="og:image" />
        

    </head>
    
    <body>
         
            
        <script src="../assets/ScriptLoader.js" type="text/javascript"></script>
        <form id="aspnetForm" autocomplete="off" method="POST" enctype="multipart/form-data">
            <input name="__RequestVerificationToken" type="hidden" value="WtqE3k5josf6-Ha228AStuZ3yA9N8AIv4m6hT1DRX1MPXVDUhBPMPjVQ0CZh80IC8TXJ2BnLJ1Z42eRY_UG-WXIEPjJEWnrZtTx-833pTlWVDKJtB3Avy6-qVolfQPwTBX8Jcg2" /><input name="__RequestVerificationToken2" type="hidden" value="__RequestVerificationToken273455899-6861-4cad-9d15-6192d9566572" />
            
            <div id="UpdateProgressPanel" class="loading_animation" style="display:none;">
                <div class="row">
                    <h2 class="anim_h2">
                        <span id="UpdateProgressText">Updating...</span>
                        <span id="animatedLoadingIconContainer">
                            <img id="animatedLoadingIcon" src="../assets/loading_animation.gif" class="anim_img"/>
                        </span>
                    </h2>
                </div>
            </div>
            
            <div style="display:none;">
                
                <img id="BlankImage" style="width:0;height:0;" src="../assets/blank.png" onload="self.logoImageLoaded=true;"/>

                <script language="javascript" type="text/javascript">
                    var date = new Date();
                    var timezoneOffset = date.getTimezoneOffset() / 60 * -1;
                    var timezoneOffsetCookie = getCookie("TimezoneOffset");
                    var firstTimeSetTimezoneCookie = false;

                    if (timezoneOffsetCookie == null || timezoneOffsetCookie != timezoneOffset) {
                        firstTimeSetTimezoneCookie = true;
                        document.cookie = "TimezoneOffset=" + timezoneOffset + '; domain=.codeplex.com;expires=Wed, 10 Oct 2018 05:26:46 UTC';
                    }
                </script>
            </div>
            
            
            <div id="banner">
                <div id="message"><strong>This is an archived copy of the original CodePlex Unity Discussion Forum</strong><br />Unity is now on <a href="https://github.com/unitycontainer/">GitHub</a>
                    
                </div>
            </div>
            

            <div id="header">
                <div id="header_wrap" class="row">
                    <p id="logo"><a href="http://www.codeplex.com">Code<span class="semi">Plex</span></a><span id="tagline">Project Hosting for Open Source Software</span></p>
                    

<ul id="nav">

    <li><a href="/site/register/new" id="registerLink" class="ZoomFix">Register</a></li>
    <li ><a class="SignInLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f242485" id="signInLink">Sign In</a></li>
  
    <li class="last"><a class="rss_site_icon" href="http://www.codeplex.com/site/feeds/rss" type="application/rss+xml" rel="Alternate" title="CodePlex Site Activity"></a></li>
</ul>
                    <input id="searchsite" name="searchsite" maxlength="500" type="text" value="" /><span id="search_mag"><a id="submitSearch" name="submitSearch" class="magnify" title="Search" href="#"></a></span>
                    <script>
	$(document).ready(function() {
    var searchButton = $('#submitSearch'),
        searchBar = $('#searchsite');

    // Register our own handler for the search event while we wait for the SearchBox script to load.
    searchButton.bind('click.backupSearchBox', doProjectSearch);
    searchBar.bind('keypress.backupSearchBox', function(e) { if ($keyCode(e) === 13) { doProjectSearch(); return false; } });

    function cleanupSearchEvents() {
        // If the SearchBox was loaded, unregister our handlers.
        if (epx_loaded) {
            searchButton.unbind('.backupSearchBox');
            searchBar.unbind('.backupSearchBox');
        }
    }

    $loadScript('http://i4.services.social.microsoft.com/search/Widgets/SearchBox.jss?appid=1000&scopeid=1&boxId=searchsite&btnId=submitSearch&watermark=Search%20all%20projects&overrideWatermark=true&searchLocation=%2fsite%2fsearch&allowEmptySearch=true&focusOnInit=False&minimumTermLength=3', cleanupSearchEvents);
})
function doProjectSearch() {
    
    var url = '/site/search';

    //If search term is not same as watermark
    if($('#searchsite').val() != 'Search all projects')    
    {        
        url = url + '?query=' + encodeURIComponent($('#searchsite').val());
    }

    
    var callback = '';
    if (callback.length > 0 && eval('typeof ' + callback) != 'undefined')
        url += eval(callback + '()');

    window.location.href = url;
    return false;
}
</script>
                </div>
            </div>
            
            <div id="wrap">
                
    <div id="sub_heading" class="row">
        
        <div id="ProjectHeader">
            <div id="project_title_row" class="row">
                <div id="project_logo">
                    
<a id="AffiliateLink" href="http://msdn.microsoft.com/practices">
    <img id="AffiliateImage" src="../assets/pnp_logo.png" title="patterns&#32;&#38;&#32;practices" />
</a>

    
    <h1 class="text_only"><a href="http://unity.codeplex.com/" id="ProjectTitle1"><div>patterns &#38; practices - Unity</div></a></h1>

                </div>
            </div>
        </div>
        
        <div id="ProjectDetailsDiv">
            
        </div>
		<div class="clear"></div>
        

<ul id="page_box_links">
	<li id="homeTabCell" style="width: 63px;"><a id="homeTab" href="http://unity.codeplex.com/" class="box_home">home</a><div></div></li>
    
	<li id="sourceTabCell" style="width:113px;"><a id="sourceTab" href="http://unity.codeplex.com/SourceControl/latest" class="box_source">source code</a><div></div></li>
    
	<li id="releasesTabCell" style="width:105px;"><a id="releasesTab" href="http://unity.codeplex.com/releases" class="box_downloads">downloads</a><div></div></li>
    
    <li id="documentationTabCell" style="width:143px;"><a id="documentationTab" href="http://unity.codeplex.com/documentation" class="box_documentation">documentation</a><div></div></li>
    
	<li id="discussionTabCell" style="width:112px;"><a id="discussionTab" href="../index.html" class="discussions_active">discussions</a><div></div></li>
    
	<li id="workItemsTabCell" style="width:70px;"><a id="workItemsTab" href="http://unity.codeplex.com/workitem/list/basic" class="box_issue">issues</a><div></div></li>
    
	<li id="peopleTabCell" style="width:70px;"><a id="peopleTab" href="http://unity.codeplex.com/team/view" class="box_people">people</a><div></div></li>
	<li id="licenseTabCell" style="width:70px;"><a id="licenseTab" href="http://unity.codeplex.com/license" class="box_license">license</a><div></div></li>
    
    <span class="stretch"></span>
</ul>

<script type="text/javascript">
    $(document).ready(function () {
        $('#page_box_links').applyLastClassToList();
    });
</script>
		    <div class="clear"></div>
            
     <td>
       

<div>
    
    <div id="actionBar" class="action_bar">
        <ul id="actionBar_ul" class="actionBar_sublinks subtab_right" style="vertical-align: middle;">

            

                <li id="li_actionbar_creatediscussion" data-action-id="actionbar_creatediscussion" data-action-type="Navigate" class="actionBar_sublinks" data-options-id="f47df9b0-b83b-459a-ad62-5e55844e407e">
                
                    <script class="options" defer="defer" id="f47df9b0-b83b-459a-ad62-5e55844e407e" type="application/json">{"navigate-url":"http://unity.codeplex.com/discussions/create"}</script> 
                    
                    <div class="actionBar_custom_content"></div>

                    <a href="#" id="actionbar_creatediscussion" title="Start a New Thread" class="action_bar_item_link">
                        <img id="img_actionbar_creatediscussion" class="action_bar_item_image" src="../assets/actionbar_newitem.png" style="vertical-align: middle" />
                        New Thread
                    </a>

                </li>

            

                <li id="li_actionbar_subscribe" data-action-id="actionbar_subscribe" data-action-type="PopUp" class="actionBar_sublinks" data-options-id="1b150897-fd0a-4dd1-bc6e-599dfe538b50">
                
                    <script class="options" defer="defer" id="1b150897-fd0a-4dd1-bc6e-599dfe538b50" type="application/json">{}</script> 
                    
                    <div class="actionBar_custom_content">

<div id="rssHoverDiv" class="HoverPanel LeftHoverWidth" style="display: none">
        <ul id="3_FeedsPanel" class="RssFeedsPanel">
            <li>
                <a id="ProjectRssLink" href="http://unity.codeplex.com/project/feeds/rss" class="ArrowSmall NoUnderline">All Project Updates</a>
            </li>
            
            <li>
                <a id="DiscussionRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fforum%2funity" class="ArrowSmall NoUnderline">Discussions</a>
            </li>
            
            <li>
                <a id="IssueTrackerRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fworkitem%2funity" class="ArrowSmall NoUnderline">Issue Tracker</a>
            </li>
            
            <li>
                <a id="ReleasesRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2frelease%2funity" class="ArrowSmall NoUnderline">Downloads</a>
            </li>
            <li>
                <a id="ReviewsRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2freview%2funity" class="ArrowSmall NoUnderline">Reviews</a>
            </li>
            
            <li>
                <a id="SourceControlRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fsourcecontrol%2funity" class="ArrowSmall NoUnderline">Source Code</a>
            </li>
            <li>
                <a id="WikiRssLink" href="http://unity.codeplex.com/project/feeds/rss?ProjectRSSFeed=codeplex%3a%2f%2fwiki%2funity" class="ArrowSmall NoUnderline">Wiki &amp; Documentation</a>
            </li>
        </ul>
</div></div>

                    <a href="#" id="actionbar_subscribe" title="Subscribe to project updates in RSS feeds." class="action_bar_item_link">
                        <img id="img_actionbar_subscribe" class="action_bar_item_image" src="../assets/actionbar_subscribe.png" style="vertical-align: middle" />
                        Subscribe
                    </a>

                </li>

            
        </ul>
    </div>
</div>
     </td>

        

    </div>
    
    
<div class="Threads">
    <div class="ViewThread">
        
        
        
            <h1 class="page_title WordWrapBreakWord">
                How tell to Container Dispose Objects after a Request End - MVC 3.0
            </h1>

            <!-- Private Discussion header -->
            

            <!-- Posts List Header: Topics and Wiki Link -->
            <table class="PostsListHeader">
                <tr>
                    <td>
                     
                    </td>
                    <td>
                        <div class="WikiLink">
                            <span title="Paste this into a wiki page to link to this discussion">
                                Wiki Link: [discussion:242485]
                            </span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- The list of posts -->
            

<div id="discussionsPostList" data-options-id="8d0ea0c4-aee5-4566-8f65-9a9e0b9ad47f">
    <script class="options" defer="defer" id="8d0ea0c4-aee5-4566-8f65-9a9e0b9ad47f" type="application/json">{"threadUrl":"http://unity.codeplex.com/discussions/242485","showEditor":false,"checkImageUrl":"../assets/check_answer.png"}</script>

    <div class="Posts" style="margin-top: 10px;">
    

<table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 0px; table-layout:fixed">
    

<tr id="PostPanel" class="Post" d:forid="552239">
    <td id="PostDetailsCell_552239" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post552239"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/fujiy">fujiy</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/19/2011 10:45:49 PM" LocalTimeTicks="1295505949">Jan 19, 2011 at 10:45 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_552239" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;am&#32;using&#32;ASP.NET&#32;MVC&#32;3,&#32;and&#32;at&#32;Application_Start&#32;I&#32;do&#32;this&#58;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IUserRepository,&#38;nbsp&#59;UserRepository&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPostRepository,&#38;nbsp&#59;PostRepository&#38;gt&#59;&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;DependencyResolver.SetResolver&#40;new&#38;nbsp&#59;UnityDependencyResolver&#40;container&#41;&#41;&#59;But&#32;I&#32;need&#32;to&#32;create&#32;one&#32;repository&#32;by&#32;request,&#32;and&#32;guarantee&#32;that&#32;it&#32;is&#32;Disposed&#32;at&#32;Request&#32;End&#32;">
        
<p>I am using ASP.NET MVC 3, and at Application_Start I do this:</p>
<pre style="font-family:consolas">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IUserRepository</span>,&nbsp;<span style="color:#2b91af">UserRepository</span>&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IPostRepository</span>,&nbsp;<span style="color:#2b91af">PostRepository</span>&gt;();&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">DependencyResolver</span>.SetResolver(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">UnityDependencyResolver</span>(container));<br><br>But I need to create one repository by request, and guarantee that it is Disposed at Request End<br></pre>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_552239" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554554">
    <td id="PostDetailsCell_554554" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554554"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nomadixone">nomadixone</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 6:06:47 PM" LocalTimeTicks="1295921207">Jan 24, 2011 at 6:06 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554554" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;have&#32;implemented&#32;the&#32;example&#32;per&#32;web&#32;request&#32;as&#32;below,&#32;but&#32;it&#32;doesn&#39;t&#32;ever&#32;seem&#32;to&#32;actually&#32;call&#32;dispose....&#32;&#32;&#32;public&#32;class&#32;HttpContextLifetimeManager&#32;&#58;&#32;LifetimeManager,&#32;IDisposable&#32;&#123;&#32;const&#32;string&#32;ItemName&#32;&#61;&#32;&#38;quot&#59;HttpContextLifetimeManager&#38;quot&#59;&#59;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#32;return&#32;HttpContext.Current.Items&#91;ItemName&#93;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#32;HttpContext.Current.Items.Remove&#40;ItemName&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#32;HttpContext.Current.Items&#91;ItemName&#93;&#32;&#61;&#32;newValue&#59;&#32;&#125;&#32;public&#32;void&#32;Dispose&#40;&#41;&#32;&#123;&#32;RemoveValue&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;I&#32;use&#32;this&#32;lifetime&#32;manager&#32;when&#32;creating&#32;the&#32;dependencies,&#32;as&#32;so&#58;&#32;protected&#32;void&#32;RegisterTypes&#40;&#41;&#32;&#123;&#32;unityContainer.RegisterType&#38;lt&#59;IUnitOfWork,&#32;EFUnitOfWork&#38;gt&#59;&#40;new&#32;HttpContextLifetimeManager&#40;&#41;&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IRepository&#38;lt&#59;ShoppingCart&#38;gt&#59;,&#32;ShoppingCartRepository&#38;gt&#59;&#40;&#41;&#59;&#32;&#125;&#32;&#32;&#32;But&#32;dispose&#32;never&#32;gets&#32;called...Any&#32;ideas&#63;&#32;&#32;&#32;&#32;">
        
<p>I have implemented the example per web request as below, but it doesn't ever seem to actually call dispose....</p>
<div style="color:black; background-color:white">
<pre>    <span style="color:blue">public</span> <span style="color:blue">class</span> HttpContextLifetimeManager : LifetimeManager, IDisposable
    {
        <span style="color:blue">const</span> <span style="color:blue">string</span> ItemName = <span style="color:#a31515">&quot;HttpContextLifetimeManager&quot;</span>;


        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">object</span> GetValue()
        {
            <span style="color:blue">return</span> HttpContext.Current.Items[ItemName];
        }
        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> RemoveValue()
        {
            HttpContext.Current.Items.Remove(ItemName);
        }

        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> SetValue(<span style="color:blue">object</span> newValue)
        {
            HttpContext.Current.Items[ItemName] = newValue;
        }
        <span style="color:blue">public</span> <span style="color:blue">void</span> Dispose()
        {
            RemoveValue();
        }
    }
</pre>
<pre>I use this lifetime manager when creating the dependencies, as so:</pre>
<pre><div style="color:black; background-color:white"><pre><div style="color:black; background-color:white"><pre><span style="color:blue">protected</span> <span style="color:blue">void</span> RegisterTypes()
{
    unityContainer.RegisterType&lt;IUnitOfWork, EFUnitOfWork&gt;(<span style="color:blue">new</span> HttpContextLifetimeManager());
    unityContainer.RegisterType&lt;IRepository&lt;ShoppingCart&gt;, ShoppingCartRepository&gt;();
}
</pre>
</div>
But dispose never gets called...Any ideas?</pre>
</div>
</pre>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554554" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554557">
    <td id="PostDetailsCell_554557" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554557"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nomadixone">nomadixone</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 6:10:38 PM" LocalTimeTicks="1295921438">Jan 24, 2011 at 6:10 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554557" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;After&#32;some&#32;analysis&#32;of&#32;this,&#32;just&#32;because&#32;the&#32;lifetime&#32;manager&#32;implements&#32;IDisposable,&#32;there&#39;s&#32;nothing&#32;to&#32;say&#32;that&#32;Dispose&#40;&#41;&#32;actually&#32;gets&#32;called.&#38;nbsp&#59;&#32;I&#32;tried&#32;the&#32;below&#32;instead,&#32;but&#32;still&#32;no&#32;bones&#58;&#32;&#38;nbsp&#59;&#32;&#32;&#32;public&#32;class&#32;HttpContextDisposableLifetimeManager&#32;&#58;&#32;LifetimeManager,&#32;IDisposable&#32;&#123;&#32;const&#32;string&#32;ItemName&#32;&#61;&#32;&#38;quot&#59;HttpContextLifetimeManager&#38;quot&#59;&#59;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#32;return&#32;HttpContext.Current.Items&#91;ItemName&#93;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#32;Dispose&#40;&#41;&#59;&#32;HttpContext.Current.Items.Remove&#40;ItemName&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#32;HttpContext.Current.Items&#91;ItemName&#93;&#32;&#61;&#32;newValue&#59;&#32;&#125;&#32;public&#32;void&#32;Dispose&#40;&#41;&#32;&#123;&#32;var&#32;obj&#32;&#61;&#32;&#40;IDisposable&#41;GetValue&#40;&#41;&#59;&#32;obj.Dispose&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;&#32;">
        
<p>After some analysis of this, just because the lifetime manager implements IDisposable, there's nothing to say that Dispose() actually gets called.&nbsp; I tried the below instead, but still no bones:</p>
<p>&nbsp;</p>
<div style="color:black; background-color:white">
<pre>    <span style="color:blue">public</span> <span style="color:blue">class</span> HttpContextDisposableLifetimeManager : LifetimeManager, IDisposable
    {
        <span style="color:blue">const</span> <span style="color:blue">string</span> ItemName = <span style="color:#a31515">&quot;HttpContextLifetimeManager&quot;</span>;


        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">object</span> GetValue()
        {
            <span style="color:blue">return</span> HttpContext.Current.Items[ItemName];
        }
        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> RemoveValue()
        {
            Dispose();
            HttpContext.Current.Items.Remove(ItemName);
        }

        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> SetValue(<span style="color:blue">object</span> newValue)
        {
            HttpContext.Current.Items[ItemName] = newValue;
        }
        <span style="color:blue">public</span> <span style="color:blue">void</span> Dispose()
        {
            <span style="color:blue">var</span> obj = (IDisposable)GetValue();
            obj.Dispose();
        }
    }

</pre>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554557" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554583">
    <td id="PostDetailsCell_554583" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554583"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nomadixone">nomadixone</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 6:54:08 PM" LocalTimeTicks="1295924048">Jan 24, 2011 at 6:54 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554583" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;So&#32;what&#32;this&#32;code&#32;is&#32;doing&#32;is&#32;registering&#32;the&#32;instance&#32;names&#32;in&#32;the&#32;HttpContext,&#32;so&#32;that&#32;when&#32;the&#32;request&#32;is&#32;over,&#32;the&#32;collection&#32;is&#32;lost,&#32;and&#32;a&#32;new&#32;instance&#32;must&#32;be&#32;created.&#38;nbsp&#59;&#32;The&#32;problem&#32;is&#32;that&#32;when&#32;the&#32;context&#32;is&#32;over,&#32;it&#32;still&#32;doesn&#39;t&#32;call&#32;dispose.&#38;nbsp&#59;&#32;Simply&#32;implementing&#32;the&#32;interface&#32;isn&#39;t&#32;any&#32;good.&#32;The&#32;solution&#32;would&#32;be&#32;to&#32;create&#32;a&#32;method&#32;in&#32;the&#32;lifetime&#32;manager&#32;to&#32;track&#32;the&#32;HttpContext,&#32;and&#32;call&#32;dispose&#32;on&#32;it&#39;s&#32;registered&#32;instances&#32;when&#32;the&#32;HttpContext&#32;finishes.&#32;&#38;nbsp&#59;&#32;">
        
<p>So what this code is doing is registering the instance names in the HttpContext, so that when the request is over, the collection is lost, and a new instance must be created.&nbsp; The problem is that when the context is over, it still doesn't call dispose.&nbsp;
 Simply implementing the interface isn't any good.</p>
<p>The solution would be to create a method in the lifetime manager to track the HttpContext, and call dispose on it's registered instances when the HttpContext finishes.</p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554583" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554630">
    <td id="PostDetailsCell_554630" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554630"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 8:10:33 PM" LocalTimeTicks="1295928633">Jan 24, 2011 at 8:10 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554630" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;Or&#32;write&#32;some&#32;code&#32;in&#32;your&#32;Request_End&#32;handler&#32;to&#32;walk&#32;through&#32;the&#32;items&#32;in&#32;the&#32;context&#32;and&#32;call&#32;dispose&#32;on&#32;them.&#32;&#38;nbsp&#59;&#32;">
        
<p>Or write some code in your Request_End handler to walk through the items in the context and call dispose on them.</p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554630" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554681">
    <td id="PostDetailsCell_554681" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554681"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/fujiy">fujiy</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 9:33:51 PM" LocalTimeTicks="1295933631">Jan 24, 2011 at 9:33 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554681" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;&#32;ctavares&#32;wrote&#58;&#32;Or&#32;write&#32;some&#32;code&#32;in&#32;your&#32;Request_End&#32;handler&#32;to&#32;walk&#32;through&#32;the&#32;items&#32;in&#32;the&#32;context&#32;and&#32;call&#32;dispose&#32;on&#32;them.&#32;&#38;nbsp&#59;&#32;&#32;&#38;nbsp&#59;I&#32;try&#32;this,&#32;but&#32;dont&#32;work&#58;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;protected&#38;nbsp&#59;void&#38;nbsp&#59;Application_EndRequest&#40;object&#38;nbsp&#59;sender,&#38;nbsp&#59;EventArgs&#38;nbsp&#59;e&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;foreach&#38;nbsp&#59;&#40;IDisposable&#38;nbsp&#59;disposable&#38;nbsp&#59;in&#38;nbsp&#59;DependencyResolver.Current.GetServices&#38;lt&#59;IDisposable&#38;gt&#59;&#40;&#41;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;disposable.Dispose&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;And&#32;which&#32;nomadixone&#32;HttpContextLifetimeManager&#32;implementation&#32;is&#32;more&#32;correct&#63;Thx&#32;&#38;nbsp&#59;&#32;">
        
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
<strong>ctavares wrote:</strong><br>
<p>Or write some code in your Request_End handler to walk through the items in the context and call dispose on them.</p>
<p>&nbsp;</p>
</blockquote>
<p>&nbsp;I try this, but dont work:</p>
<p>&nbsp;</p>
<pre style="font-family:consolas">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">protected</span>&nbsp;<span style="color:blue">void</span>&nbsp;Application_EndRequest(<span style="color:blue">object</span>&nbsp;sender,&nbsp;<span style="color:#2b91af">EventArgs</span>&nbsp;e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">foreach</span>&nbsp;(<span style="color:#2b91af">IDisposable</span>&nbsp;disposable&nbsp;<span style="color:blue">in</span>&nbsp;<span style="color:#2b91af">DependencyResolver</span>.Current.GetServices&lt;<span style="color:#2b91af">IDisposable</span>&gt;())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposable.Dispose();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>And which nomadixone HttpContextLifetimeManager implementation is more correct?<br><br>Thx<br></pre>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554681" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554706">
    <td id="PostDetailsCell_554706" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554706"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/fujiy">fujiy</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 10:17:29 PM" LocalTimeTicks="1295936249">Jan 24, 2011 at 10:17 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554706" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;look&#32;this&#32;topic&#32;and&#32;try&#32;do&#32;adapt&#32;to&#32;ASP.NET&#32;MVC&#32;3.&#32;I&#32;dont&#32;know&#32;if&#32;is&#32;all&#32;correct.&#38;nbsp&#59;http&#58;&#47;&#47;unity.codeplex.com&#47;Thread&#47;View.aspx&#63;ThreadId&#61;38588&#32;And&#32;why&#32;dont&#32;work&#32;if&#32;I&#32;register&#32;types&#32;at&#32;parent&#32;container.&#32;I&#32;need&#32;always&#32;to&#32;register&#32;at&#32;child&#32;container,&#32;per&#32;request.&#32;In&#32;really&#32;if&#32;I&#32;need&#32;to&#32;register&#32;every&#32;time,&#32;I&#32;dont&#32;need&#32;a&#32;parent....&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;protected&#38;nbsp&#59;void&#38;nbsp&#59;Application_Start&#40;&#41;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;ConfigureUnity&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;private&#38;nbsp&#59;static&#38;nbsp&#59;void&#38;nbsp&#59;ConfigureUnity&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;var&#38;nbsp&#59;container&#38;nbsp&#59;&#61;&#38;nbsp&#59;new&#38;nbsp&#59;UnityContainer&#40;&#41;&#59;&#47;&#47;In&#32;really&#32;never&#32;used&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;DependencyResolver.SetResolver&#40;new&#38;nbsp&#59;UnityDependencyResolver&#40;container&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;protected&#38;nbsp&#59;void&#38;nbsp&#59;Application_EndRequest&#40;object&#38;nbsp&#59;sender,&#38;nbsp&#59;EventArgs&#38;nbsp&#59;e&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;using&#38;nbsp&#59;&#40;DependencyResolver.Current&#38;nbsp&#59;as&#38;nbsp&#59;IDisposable&#41;&#38;nbsp&#59;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;public&#38;nbsp&#59;class&#38;nbsp&#59;UnityDependencyResolver&#38;nbsp&#59;&#58;&#38;nbsp&#59;IDependencyResolver,&#38;nbsp&#59;IDisposable&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;private&#38;nbsp&#59;readonly&#38;nbsp&#59;IUnityContainer&#38;nbsp&#59;parentContainer&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;private&#38;nbsp&#59;IUnityContainer&#38;nbsp&#59;Container&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;get&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;IUnityContainer&#38;nbsp&#59;container&#38;nbsp&#59;&#61;&#38;nbsp&#59;HttpContext.Current.Items&#91;&#38;quot&#59;Container&#38;quot&#59;&#93;&#38;nbsp&#59;as&#38;nbsp&#59;IUnityContainer&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;if&#38;nbsp&#59;&#40;container&#38;nbsp&#59;&#61;&#61;&#38;nbsp&#59;null&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container&#38;nbsp&#59;&#61;&#38;nbsp&#59;parentContainer.CreateChildContainer&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;FujiyBlogDatabase,&#38;nbsp&#59;FujiyBlogDatabase&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IUnitOfWork,&#38;nbsp&#59;FujiyBlogDatabase&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IUserRepository,&#38;nbsp&#59;UserRepository&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPostRepository,&#38;nbsp&#59;PostRepository&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPostCommentRepository,&#38;nbsp&#59;PostCommentRepository&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;HttpContext.Current.Items&#91;&#38;quot&#59;Container&#38;quot&#59;&#93;&#38;nbsp&#59;&#61;&#38;nbsp&#59;container&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;container&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;UnityDependencyResolver&#40;IUnityContainer&#38;nbsp&#59;container&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;parentContainer&#38;nbsp&#59;&#61;&#38;nbsp&#59;container&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;object&#38;nbsp&#59;GetService&#40;Type&#38;nbsp&#59;serviceType&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;if&#38;nbsp&#59;&#40;&#40;serviceType.IsClass&#38;nbsp&#59;&#38;amp&#59;&#38;amp&#59;&#38;nbsp&#59;&#33;serviceType.IsAbstract&#41;&#38;nbsp&#59;&#124;&#124;&#38;nbsp&#59;Container.IsRegistered&#40;serviceType&#41;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;Container.Resolve&#40;serviceType&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;null&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;IEnumerable&#38;lt&#59;object&#38;gt&#59;&#38;nbsp&#59;GetServices&#40;Type&#38;nbsp&#59;serviceType&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;if&#38;nbsp&#59;&#40;&#40;serviceType.IsClass&#38;nbsp&#59;&#38;amp&#59;&#38;amp&#59;&#38;nbsp&#59;&#33;serviceType.IsAbstract&#41;&#38;nbsp&#59;&#124;&#124;&#38;nbsp&#59;Container.IsRegistered&#40;serviceType&#41;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;Container.ResolveAll&#40;serviceType&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;new&#38;nbsp&#59;object&#91;&#93;&#38;nbsp&#59;&#123;&#125;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;void&#38;nbsp&#59;Dispose&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;Container.Dispose&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#32;">
        
<p>I look this topic and try do adapt to ASP.NET MVC 3. I dont know if is all correct.&nbsp;http://unity.codeplex.com/Thread/View.aspx?ThreadId=38588</p>
<p>And why dont work if I register types at parent container. I need always to register at child container, per request. In really if I need to register every time, I dont need a parent....</p>
<pre style="font-family:consolas">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">protected</span>&nbsp;<span style="color:blue">void</span>&nbsp;Application_Start()<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConfigureUnity();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">private</span>&nbsp;<span style="color:blue">static</span>&nbsp;<span style="color:blue">void</span>&nbsp;ConfigureUnity()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">var</span>&nbsp;container&nbsp;=&nbsp;<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">UnityContainer</span>();//In really never used<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">DependencyResolver</span>.SetResolver(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">UnityDependencyResolver</span>(container));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">protected</span>&nbsp;<span style="color:blue">void</span>&nbsp;Application_EndRequest(<span style="color:blue">object</span>&nbsp;sender,&nbsp;<span style="color:#2b91af">EventArgs</span>&nbsp;e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">using</span>&nbsp;(<span style="color:#2b91af">DependencyResolver</span>.Current&nbsp;<span style="color:blue">as</span>&nbsp;<span style="color:#2b91af">IDisposable</span>)&nbsp;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br><pre style="font-family:consolas">&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:blue">class</span>&nbsp;<span style="color:#2b91af">UnityDependencyResolver</span>&nbsp;:&nbsp;<span style="color:#2b91af">IDependencyResolver</span>,&nbsp;<span style="color:#2b91af">IDisposable</span><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">private</span>&nbsp;<span style="color:blue">readonly</span>&nbsp;<span style="color:#2b91af">IUnityContainer</span>&nbsp;parentContainer;<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">private</span>&nbsp;<span style="color:#2b91af">IUnityContainer</span>&nbsp;Container<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">get</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">IUnityContainer</span>&nbsp;container&nbsp;=&nbsp;<span style="color:#2b91af">HttpContext</span>.Current.Items[<span style="color:#a31515">&quot;Container&quot;</span>]&nbsp;<span style="color:blue">as</span>&nbsp;<span style="color:#2b91af">IUnityContainer</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">if</span>&nbsp;(container&nbsp;==&nbsp;<span style="color:blue">null</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container&nbsp;=&nbsp;parentContainer.CreateChildContainer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">FujiyBlogDatabase</span>,&nbsp;<span style="color:#2b91af">FujiyBlogDatabase</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IUnitOfWork</span>,&nbsp;<span style="color:#2b91af">FujiyBlogDatabase</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IUserRepository</span>,&nbsp;<span style="color:#2b91af">UserRepository</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IPostRepository</span>,&nbsp;<span style="color:#2b91af">PostRepository</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IPostCommentRepository</span>,&nbsp;<span style="color:#2b91af">PostCommentRepository</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">HttpContext</span>.Current.Items[<span style="color:#a31515">&quot;Container&quot;</span>]&nbsp;=&nbsp;container;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;container;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;UnityDependencyResolver(<span style="color:#2b91af">IUnityContainer</span>&nbsp;container)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parentContainer&nbsp;=&nbsp;container;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:blue">object</span>&nbsp;GetService(<span style="color:#2b91af">Type</span>&nbsp;serviceType)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">if</span>&nbsp;((serviceType.IsClass&nbsp;&amp;&amp;&nbsp;!serviceType.IsAbstract)&nbsp;||&nbsp;Container.IsRegistered(serviceType))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;Container.Resolve(serviceType);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;<span style="color:blue">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:#2b91af">IEnumerable</span>&lt;<span style="color:blue">object</span>&gt;&nbsp;GetServices(<span style="color:#2b91af">Type</span>&nbsp;serviceType)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">if</span>&nbsp;((serviceType.IsClass&nbsp;&amp;&amp;&nbsp;!serviceType.IsAbstract)&nbsp;||&nbsp;Container.IsRegistered(serviceType))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;Container.ResolveAll(serviceType);<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;<span style="color:blue">new</span>&nbsp;<span style="color:blue">object</span>[]&nbsp;{};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:blue">void</span>&nbsp;Dispose()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Container.Dispose();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<br><br></pre>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554706" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554714">
    <td id="PostDetailsCell_554714" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554714"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nomadixone">nomadixone</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 10:33:09 PM" LocalTimeTicks="1295937189">Jan 24, 2011 at 10:33 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554714" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#39;m&#32;of&#32;the&#32;mind&#32;that&#32;my&#32;second&#32;implementation&#32;is&#32;more&#32;correct,&#32;but&#32;again,&#32;since&#32;the&#32;unity&#32;container&#32;is&#32;instantiated&#32;in&#32;application&#32;on&#32;start,&#32;it&#32;would&#32;have&#32;application&#32;scope,&#32;and&#32;would&#32;only&#32;explicitly&#32;remove&#32;the&#32;object&#32;from&#32;the&#32;lifetime&#32;manager&#32;on&#32;app&#32;shutdown,&#32;instead&#32;of&#32;when&#32;the&#32;request&#32;finishes.&#38;nbsp&#59;&#32;Also,&#32;simply&#32;looping&#32;through&#32;the&#32;dependency&#32;resolver&#32;will&#32;not&#32;yield&#32;the&#32;items&#32;that&#32;implement&#32;the&#32;IDisposable&#32;interface&#32;will&#32;not&#32;work,&#32;since&#32;you&#32;didn&#39;t&#32;register&#32;them&#32;this&#32;way&#32;and&#32;unity&#32;doesn&#39;t&#32;track&#32;things&#32;like&#32;that.&#38;nbsp&#59;&#32;The&#32;solution&#32;I&#32;came&#32;up&#32;with&#32;looks&#32;like&#32;the&#32;following,&#32;but&#32;still&#32;doesn&#39;t&#32;work&#58;&#32;&#38;nbsp&#59;&#32;&#32;&#32;public&#32;class&#32;HttpContextDisposableLifetimeManager&#32;&#58;&#32;LifetimeManager,&#32;IDisposable&#32;&#123;&#32;const&#32;string&#32;ItemName&#32;&#61;&#32;&#38;quot&#59;HttpContextLifetimeManager&#38;quot&#59;&#59;&#32;public&#32;void&#32;DisposingHandler&#40;object&#32;source,&#32;EventArgs&#32;e&#41;&#32;&#123;&#32;RemoveValue&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#32;return&#32;HttpContext.Current.Items&#91;ItemName&#93;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#32;Dispose&#40;&#41;&#59;&#32;HttpContext.Current.Items.Remove&#40;ItemName&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#32;HttpContext.Current.Items&#91;ItemName&#93;&#32;&#61;&#32;newValue&#59;&#32;&#125;&#32;public&#32;void&#32;Dispose&#40;&#41;&#32;&#123;&#32;var&#32;obj&#32;&#61;&#32;&#40;IDisposable&#41;GetValue&#40;&#41;&#59;&#32;obj.Dispose&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;from&#32;the&#32;globals&#32;file&#58;&#32;&#32;protected&#32;void&#32;RegisterTypes&#40;&#41;&#32;&#123;&#32;var&#32;ltm&#32;&#61;&#32;new&#32;HttpContextDisposableLifetimeManager&#40;&#41;&#59;&#32;this.EndRequest&#32;&#38;&#35;43&#59;&#61;&#32;new&#32;EventHandler&#40;ltm.DisposingHandler&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IUnitOfWork,&#32;EFUnitOfWork&#38;gt&#59;&#40;ltm&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IRepository&#38;lt&#59;UPGSysproPortal.BLL.Objects.ShoppingCart&#38;gt&#59;,&#32;ShoppingCartRepository&#38;gt&#59;&#40;&#41;&#59;&#32;&#125;&#32;&#32;But&#32;a&#32;breakpoint&#32;set&#32;on&#32;the&#32;dispose&#32;method&#32;never&#32;gets&#32;hit,&#32;nor&#32;does&#32;the&#32;remove&#32;method...&#32;&#32;&#32;&#32;&#32;&#32;&#32;">
        
<p>I'm of the mind that my second implementation is more correct, but again, since the unity container is instantiated in application on start, it would have application scope, and would only explicitly remove the object from the lifetime manager on app shutdown,
 instead of when the request finishes.&nbsp;</p>
<p>Also, simply looping through the dependency resolver will not yield the items that implement the IDisposable interface will not work, since you didn't register them this way and unity doesn't track things like that.&nbsp; The solution I came up with looks
 like the following, but still doesn't work:</p>
<p>&nbsp;</p>
<div style="color:black; background-color:white">
<pre>    <span style="color:blue">public</span> <span style="color:blue">class</span> HttpContextDisposableLifetimeManager : LifetimeManager, IDisposable
    {
        <span style="color:blue">const</span> <span style="color:blue">string</span> ItemName = <span style="color:#a31515">&quot;HttpContextLifetimeManager&quot;</span>;

        <span style="color:blue">public</span> <span style="color:blue">void</span> DisposingHandler(<span style="color:blue">object</span> source, EventArgs e)
        {
            RemoveValue();
        }

        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">object</span> GetValue()
        {
            <span style="color:blue">return</span> HttpContext.Current.Items[ItemName];
        }
        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> RemoveValue()
        {
            Dispose();
            HttpContext.Current.Items.Remove(ItemName);
        }

        <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> SetValue(<span style="color:blue">object</span> newValue)
        {
            HttpContext.Current.Items[ItemName] = newValue;
        }
        <span style="color:blue">public</span> <span style="color:blue">void</span> Dispose()
        {
            <span style="color:blue">var</span> obj = (IDisposable)GetValue();
            obj.Dispose();
        }
    }
</pre>
<pre>from the globals file:</pre>
<pre><pre><div style="color:black; background-color:white"><pre><div style="color:black; background-color:white"><pre>        <span style="color:blue">protected</span> <span style="color:blue">void</span> RegisterTypes()
        {
            <span style="color:blue">var</span> ltm = <span style="color:blue">new</span> HttpContextDisposableLifetimeManager();
            <span style="color:blue">this</span>.EndRequest &#43;= <span style="color:blue">new</span> EventHandler(ltm.DisposingHandler);
            unityContainer.RegisterType&lt;IUnitOfWork, EFUnitOfWork&gt;(ltm);
            unityContainer.RegisterType&lt;IRepository&lt;UPGSysproPortal.BLL.Objects.ShoppingCart&gt;, ShoppingCartRepository&gt;();
        }
</pre>
<pre>But a breakpoint set on the dispose method never gets hit, nor does the remove method...</pre>
</div>
</pre>
</div>
</pre>
</pre>
</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554714" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554716">
    <td id="PostDetailsCell_554716" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554716"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nomadixone">nomadixone</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 10:37:20 PM" LocalTimeTicks="1295937440">Jan 24, 2011 at 10:37 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554716" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;As&#32;for&#32;what&#32;I&#32;understand&#32;about&#32;the&#32;parent&#32;and&#32;child&#32;contexts&#32;is&#32;that&#32;you&#32;create&#32;the&#32;children&#32;so&#32;that&#32;you&#32;may&#32;dispose&#32;of&#32;them&#32;without&#32;disposing&#32;of&#32;the&#32;parent,&#32;which&#32;has&#32;a&#32;lifetime&#32;of&#32;the&#32;entire&#32;application&#32;scope.&#38;nbsp&#59;&#32;That&#32;way&#32;you&#32;can&#32;call&#32;dispose&#32;on&#32;the&#32;child&#32;container,&#32;and&#32;at&#32;that&#32;point&#32;you&#32;would&#32;expect&#32;to&#32;be&#32;able&#32;to&#32;iterate&#32;through&#32;all&#32;of&#32;the&#32;instances&#32;held&#32;by&#32;the&#32;child&#32;context&#32;that&#32;can&#32;be&#32;disposed,&#32;and&#32;dispose&#32;them.&#32;">
        
<p>As for what I understand about the parent and child contexts is that you create the children so that you may dispose of them without disposing of the parent, which has a lifetime of the entire application scope.&nbsp; That way you can call dispose on the
 child container, and at that point you would expect to be able to iterate through all of the instances held by the child context that can be disposed, and dispose them.</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554716" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554722">
    <td id="PostDetailsCell_554722" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554722"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/ctavares">ctavares</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/24/2011 10:54:17 PM" LocalTimeTicks="1295938457">Jan 24, 2011 at 10:54 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554722" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;&#32;fujiy&#32;wrote&#58;&#32;&#32;ctavares&#32;wrote&#58;&#32;Or&#32;write&#32;some&#32;code&#32;in&#32;your&#32;Request_End&#32;handler&#32;to&#32;walk&#32;through&#32;the&#32;items&#32;in&#32;the&#32;context&#32;and&#32;call&#32;dispose&#32;on&#32;them.&#32;&#38;nbsp&#59;&#32;&#32;&#38;nbsp&#59;I&#32;try&#32;this,&#32;but&#32;dont&#32;work&#58;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;protected&#38;nbsp&#59;void&#38;nbsp&#59;Application_EndRequest&#40;object&#38;nbsp&#59;sender,&#38;nbsp&#59;EventArgs&#38;nbsp&#59;e&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;foreach&#38;nbsp&#59;&#40;IDisposable&#38;nbsp&#59;disposable&#38;nbsp&#59;in&#38;nbsp&#59;DependencyResolver.Current.GetServices&#38;lt&#59;IDisposable&#38;gt&#59;&#40;&#41;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;disposable.Dispose&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;And&#32;which&#32;nomadixone&#32;HttpContextLifetimeManager&#32;implementation&#32;is&#32;more&#32;correct&#63;Thx&#32;&#38;nbsp&#59;&#32;&#32;You&#32;should&#32;be&#32;looping&#32;through&#32;HttpContext.Current.Items,&#32;not&#32;DependencyResolver.Current.GetServices.&#32;This&#32;will&#32;call&#32;dispose&#32;on&#32;anything&#32;in&#32;the&#32;context&#32;that&#39;s&#32;about&#32;to&#32;go&#32;away&#32;anyway.&#32;Doing&#32;what&#32;you&#39;re&#32;doing&#32;now&#32;isn&#39;t&#32;going&#32;to&#32;work&#32;at&#32;all&#32;-&#32;nothing&#39;s&#32;registered&#32;in&#32;the&#32;container&#32;as&#32;type&#32;IDisposable,&#32;so&#32;it&#39;ll&#32;return&#32;an&#32;empty&#32;collection.&#32;And&#32;even&#32;if&#32;it&#32;did,&#32;that&#32;would&#32;cause&#32;all&#32;sorts&#32;of&#32;stuff&#32;to&#32;break.&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;">
        
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
<strong>fujiy wrote:</strong><br>
<blockquote style="border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em">
<strong>ctavares wrote:</strong><br>
<p>Or write some code in your Request_End handler to walk through the items in the context and call dispose on them.</p>
<p>&nbsp;</p>
</blockquote>
<p>&nbsp;I try this, but dont work:</p>
<p>&nbsp;</p>
<pre style="font-family:consolas">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">protected</span>&nbsp;<span style="color:blue">void</span>&nbsp;Application_EndRequest(<span style="color:blue">object</span>&nbsp;sender,&nbsp;<span style="color:#2b91af">EventArgs</span>&nbsp;e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">foreach</span>&nbsp;(<span style="color:#2b91af">IDisposable</span>&nbsp;disposable&nbsp;<span style="color:blue">in</span>&nbsp;<span style="color:#2b91af">DependencyResolver</span>.Current.GetServices&lt;<span style="color:#2b91af">IDisposable</span>&gt;())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disposable.Dispose();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>And which nomadixone HttpContextLifetimeManager implementation is more correct?<br><br>Thx<br></pre>
<p>&nbsp;</p>
</blockquote>
<p>You should be looping through HttpContext.Current.Items, not DependencyResolver.Current.GetServices. This will call dispose on anything in the context that's about to go away anyway. Doing what you're doing now isn't going to work at all - nothing's registered
 in the container as type IDisposable, so it'll return an empty collection. And even if it did, that would cause all sorts of stuff to break.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554722" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="554753">
    <td id="PostDetailsCell_554753" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post554753"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/fujiy">fujiy</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/25/2011 1:17:09 AM" LocalTimeTicks="1295947029">Jan 25, 2011 at 1:17 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_554753" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;I&#32;did&#32;this,&#32;it&#38;acute&#59;s&#32;simple&#32;and&#32;work,&#32;disposing&#32;objects&#58;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;protected&#38;nbsp&#59;void&#38;nbsp&#59;Application_Start&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;DependencyResolver.SetResolver&#40;new&#38;nbsp&#59;UnityDependencyResolver&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;protected&#38;nbsp&#59;void&#38;nbsp&#59;Application_EndRequest&#40;object&#38;nbsp&#59;sender,&#38;nbsp&#59;EventArgs&#38;nbsp&#59;e&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;using&#38;nbsp&#59;&#40;DependencyResolver.Current&#38;nbsp&#59;as&#38;nbsp&#59;IDisposable&#41;&#38;nbsp&#59;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;class&#38;nbsp&#59;UnityDependencyResolver&#38;nbsp&#59;&#58;&#38;nbsp&#59;IDependencyResolver,&#38;nbsp&#59;IDisposable&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;private&#38;nbsp&#59;static&#38;nbsp&#59;IUnityContainer&#38;nbsp&#59;Container&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;get&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;IUnityContainer&#38;nbsp&#59;container&#38;nbsp&#59;&#61;&#38;nbsp&#59;HttpContext.Current.Items&#91;&#38;quot&#59;Container&#38;quot&#59;&#93;&#38;nbsp&#59;as&#38;nbsp&#59;IUnityContainer&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;if&#38;nbsp&#59;&#40;container&#38;nbsp&#59;&#61;&#61;&#38;nbsp&#59;null&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container&#38;nbsp&#59;&#61;&#38;nbsp&#59;new&#38;nbsp&#59;UnityContainer&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;FujiyBlogDatabase,&#38;nbsp&#59;FujiyBlogDatabase&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IUnitOfWork,&#38;nbsp&#59;FujiyBlogDatabase&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IUserRepository,&#38;nbsp&#59;UserRepository&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPostRepository,&#38;nbsp&#59;PostRepository&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;container.RegisterType&#38;lt&#59;IPostCommentRepository,&#38;nbsp&#59;PostCommentRepository&#38;gt&#59;&#40;new&#38;nbsp&#59;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;HttpContext.Current.Items&#91;&#38;quot&#59;Container&#38;quot&#59;&#93;&#38;nbsp&#59;&#61;&#38;nbsp&#59;container&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;container&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;object&#38;nbsp&#59;GetService&#40;Type&#38;nbsp&#59;serviceType&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;if&#38;nbsp&#59;&#40;&#40;serviceType.IsClass&#38;nbsp&#59;&#38;amp&#59;&#38;amp&#59;&#38;nbsp&#59;&#33;serviceType.IsAbstract&#41;&#38;nbsp&#59;&#124;&#124;&#38;nbsp&#59;Container.IsRegistered&#40;serviceType&#41;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;Container.Resolve&#40;serviceType&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;null&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;IEnumerable&#38;lt&#59;object&#38;gt&#59;&#38;nbsp&#59;GetServices&#40;Type&#38;nbsp&#59;serviceType&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;if&#38;nbsp&#59;&#40;&#40;serviceType.IsClass&#38;nbsp&#59;&#38;amp&#59;&#38;amp&#59;&#38;nbsp&#59;&#33;serviceType.IsAbstract&#41;&#38;nbsp&#59;&#124;&#124;&#38;nbsp&#59;Container.IsRegistered&#40;serviceType&#41;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;Container.ResolveAll&#40;serviceType&#41;&#59;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;return&#38;nbsp&#59;new&#38;nbsp&#59;object&#91;&#93;&#38;nbsp&#59;&#123;&#125;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;public&#38;nbsp&#59;void&#38;nbsp&#59;Dispose&#40;&#41;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#123;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;Container.Dispose&#40;&#41;&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#38;nbsp&#59;&#125;&#32;&#38;nbsp&#59;&#32;">
        
<p>I did this, it&acute;s simple and work, disposing objects:</p>
<p>&nbsp;</p>
<pre style="font-family:consolas"><span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected</span>&nbsp;<span style="color:blue">void</span>&nbsp;Application_Start()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#2b91af">DependencyResolver</span>.SetResolver(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">UnityDependencyResolver</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">protected</span>&nbsp;<span style="color:blue">void</span>&nbsp;Application_EndRequest(<span style="color:blue">object</span>&nbsp;sender,&nbsp;<span style="color:#2b91af">EventArgs</span>&nbsp;e)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">using</span>&nbsp;(<span style="color:#2b91af">DependencyResolver</span>.Current&nbsp;<span style="color:blue">as</span>&nbsp;<span style="color:#2b91af">IDisposable</span>)&nbsp;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>&nbsp;</p>
<pre style="font-family:consolas">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:blue">class</span>&nbsp;<span style="color:#2b91af">UnityDependencyResolver</span>&nbsp;:&nbsp;<span style="color:#2b91af">IDependencyResolver</span>,&nbsp;<span style="color:#2b91af">IDisposable</span><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">private</span>&nbsp;<span style="color:blue">static</span>&nbsp;<span style="color:#2b91af">IUnityContainer</span>&nbsp;Container<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">get</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">IUnityContainer</span>&nbsp;container&nbsp;=&nbsp;<span style="color:#2b91af">HttpContext</span>.Current.Items[<span style="color:#a31515">&quot;Container&quot;</span>]&nbsp;<span style="color:blue">as</span>&nbsp;<span style="color:#2b91af">IUnityContainer</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">if</span>&nbsp;(container&nbsp;==&nbsp;<span style="color:blue">null</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container&nbsp;=&nbsp;<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">UnityContainer</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">FujiyBlogDatabase</span>,&nbsp;<span style="color:#2b91af">FujiyBlogDatabase</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IUnitOfWork</span>,&nbsp;<span style="color:#2b91af">FujiyBlogDatabase</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IUserRepository</span>,&nbsp;<span style="color:#2b91af">UserRepository</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IPostRepository</span>,&nbsp;<span style="color:#2b91af">PostRepository</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.RegisterType&lt;<span style="color:#2b91af">IPostCommentRepository</span>,&nbsp;<span style="color:#2b91af">PostCommentRepository</span>&gt;(<span style="color:blue">new</span>&nbsp;<span style="color:#2b91af">ContainerControlledLifetimeManager</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">HttpContext</span>.Current.Items[<span style="color:#a31515">&quot;Container&quot;</span>]&nbsp;=&nbsp;container;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;container;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:blue">object</span>&nbsp;GetService(<span style="color:#2b91af">Type</span>&nbsp;serviceType)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">if</span>&nbsp;((serviceType.IsClass&nbsp;&amp;&amp;&nbsp;!serviceType.IsAbstract)&nbsp;||&nbsp;Container.IsRegistered(serviceType))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;Container.Resolve(serviceType);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;<span style="color:blue">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:#2b91af">IEnumerable</span>&lt;<span style="color:blue">object</span>&gt;&nbsp;GetServices(<span style="color:#2b91af">Type</span>&nbsp;serviceType)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">if</span>&nbsp;((serviceType.IsClass&nbsp;&amp;&amp;&nbsp;!serviceType.IsAbstract)&nbsp;||&nbsp;Container.IsRegistered(serviceType))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;Container.ResolveAll(serviceType);<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span>&nbsp;<span style="color:blue">new</span>&nbsp;<span style="color:blue">object</span>[]&nbsp;{};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">public</span>&nbsp;<span style="color:blue">void</span>&nbsp;Dispose()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Container.Dispose();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}</pre>
<p>&nbsp;</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_554753" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="555192">
    <td id="PostDetailsCell_555192" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post555192"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/nomadixone">nomadixone</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="1/25/2011 7:05:38 PM" LocalTimeTicks="1296011138">Jan 25, 2011 at 7:05 PM</span></div>
            
        </div>
    </td>
    <td id="PostContent_555192" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="&#32;My&#32;solution&#32;looks&#32;more&#32;like&#32;the&#32;following,&#32;and&#32;it&#32;does&#32;work,&#32;but&#32;it&#32;does&#32;seem&#32;a&#32;little&#32;hackish.&#38;nbsp&#59;&#32;I&#32;use&#32;my&#32;custom&#32;lifetime&#32;manager&#32;only&#32;to&#32;wrap&#32;my&#32;entity&#32;framework&#32;unit&#32;of&#32;work&#32;context&#32;wrapper,&#32;and&#32;the&#32;standard&#32;container&#32;controlled&#32;lifetime&#32;manager&#32;for&#32;the&#32;rest.&#38;nbsp&#59;&#32;My&#32;repositories&#32;are&#32;constructor&#32;injected&#32;with&#32;the&#32;unit&#32;of&#32;work,&#32;and&#32;it&#32;disposes&#32;nicely&#32;when&#32;the&#32;request&#32;completes.&#32;First&#32;snippet&#32;from&#32;the&#32;globals.asax.cs&#32;file,&#32;the&#32;second&#32;from&#32;my&#32;custom&#32;lifetime&#32;manager&#32;class&#32;&#32;public&#32;class&#32;MvcApplication&#32;&#58;&#32;HttpApplication&#32;&#123;&#32;private&#32;IUnityContainer&#32;unityContainer&#59;&#32;private&#32;HttpContextDisposableLifetimeManager&#32;ContextLifeTimeManager&#59;&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;summary&#38;gt&#59;&#32;&#47;&#47;&#47;&#32;The&#32;start&#32;method&#32;of&#32;the&#32;application.&#32;&#47;&#47;&#47;&#32;&#38;lt&#59;&#47;summary&#38;gt&#59;&#32;protected&#32;void&#32;Application_Start&#40;&#41;&#32;&#123;&#32;unityContainer&#32;&#61;&#32;new&#32;UnityContainer&#40;&#41;&#59;&#32;ContextLifeTimeManager&#32;&#61;&#32;new&#32;HttpContextDisposableLifetimeManager&#40;&#41;&#59;&#32;&#47;&#47;for&#32;some&#32;reason&#32;this&#32;event&#32;handler&#32;registration&#32;doesn&#39;t&#32;work,&#32;meaning&#32;we&#32;have&#32;to&#32;add&#32;code&#32;to&#32;&#47;&#47;Application_EndRequest&#32;as&#32;below...&#32;&#47;&#47;this.EndRequest&#32;&#38;&#35;43&#59;&#61;&#32;new&#32;EventHandler&#40;ContextLifeTimeManager.DisposingHandler&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IUnitOfWork,&#32;EFUnitOfWork&#38;gt&#59;&#40;ContextLifeTimeManager&#41;&#59;&#32;unityContainer.RegisterType&#38;lt&#59;IRepository&#38;lt&#59;ShoppingCart&#38;gt&#59;,&#32;ShoppingCartRepository&#38;gt&#59;&#40;new&#32;ContainerControlledLifetimeManager&#40;&#41;&#41;&#59;&#32;&#125;&#32;&#47;&#47;this&#32;seems&#32;hackish,&#32;but&#32;it&#32;works,&#32;so&#32;whatever...&#32;protected&#32;void&#32;Application_EndRequest&#40;Object&#32;sender,&#32;EventArgs&#32;e&#41;&#32;&#123;&#32;if&#32;&#40;ContextLifeTimeManager&#32;&#33;&#61;&#32;null&#41;&#32;&#123;&#32;ContextLifeTimeManager.RemoveValue&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#125;&#32;&#32;public&#32;class&#32;HttpContextDisposableLifetimeManager&#32;&#58;&#32;LifetimeManager,&#32;IDisposable&#32;&#123;&#32;&#47;&#47;since&#32;this&#32;is&#32;a&#32;constant&#32;string,&#32;you&#32;can&#32;only&#32;instantiate&#32;one&#32;of&#32;these&#32;const&#32;string&#32;ItemName&#32;&#61;&#32;&#38;quot&#59;HttpContextLifetimeManager&#38;quot&#59;&#59;&#32;public&#32;void&#32;DisposingHandler&#40;object&#32;source,&#32;EventArgs&#32;e&#41;&#32;&#123;&#32;RemoveValue&#40;&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;object&#32;GetValue&#40;&#41;&#32;&#123;&#32;return&#32;HttpContext.Current.Items&#91;ItemName&#93;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;RemoveValue&#40;&#41;&#32;&#123;&#32;Dispose&#40;&#41;&#59;&#32;HttpContext.Current.Items.Remove&#40;ItemName&#41;&#59;&#32;&#125;&#32;public&#32;override&#32;void&#32;SetValue&#40;object&#32;newValue&#41;&#32;&#123;&#32;HttpContext.Current.Items&#91;ItemName&#93;&#32;&#61;&#32;newValue&#59;&#32;&#125;&#32;public&#32;void&#32;Dispose&#40;&#41;&#32;&#123;&#32;var&#32;obj&#32;&#61;&#32;&#40;IDisposable&#41;GetValue&#40;&#41;&#59;&#32;obj.Dispose&#40;&#41;&#59;&#32;&#125;&#32;&#125;&#32;&#32;&#32;&#38;nbsp&#59;&#32;&#38;nbsp&#59;&#32;&#32;&#32;&#38;&#35;65279&#59;&#32;">
        
<p>My solution looks more like the following, and it does work, but it does seem a little hackish.&nbsp; I use my custom lifetime manager only to wrap my entity framework unit of work context wrapper, and the standard container controlled lifetime manager for
 the rest.&nbsp; My repositories are constructor injected with the unit of work, and it disposes nicely when the request completes.</p>
<p>First snippet from the globals.asax.cs file, the second from my custom lifetime manager class</p>
<div style="color:black; background-color:white">
<pre><span style="color:blue">public</span> <span style="color:blue">class</span> MvcApplication : HttpApplication
{
    <span style="color:blue">private</span> IUnityContainer unityContainer;
    <span style="color:blue">private</span> HttpContextDisposableLifetimeManager ContextLifeTimeManager;
    <span style="color:gray">///</span> <span style="color:gray">&lt;summary&gt;</span>
	<span style="color:gray">///</span><span style="color:green"> The start method of the application.</span>
	<span style="color:gray">///</span> <span style="color:gray">&lt;/summary&gt;</span>
	<span style="color:blue">protected</span> <span style="color:blue">void</span> Application_Start()
	{
        unityContainer = <span style="color:blue">new</span> UnityContainer();
        ContextLifeTimeManager = <span style="color:blue">new</span> HttpContextDisposableLifetimeManager();
        <span style="color:green">//for some reason this event handler registration doesn't work, meaning we have to add code to</span>
        <span style="color:green">//Application_EndRequest as below...</span>
        <span style="color:green">//this.EndRequest &#43;= new EventHandler(ContextLifeTimeManager.DisposingHandler);</span>
        unityContainer.RegisterType&lt;IUnitOfWork, EFUnitOfWork&gt;(ContextLifeTimeManager);
        unityContainer.RegisterType&lt;IRepository&lt;ShoppingCart&gt;, ShoppingCartRepository&gt;(<span style="color:blue">new</span> ContainerControlledLifetimeManager());
    }
    <span style="color:green">//this seems hackish, but it works, so whatever...</span>
    <span style="color:blue">protected</span> <span style="color:blue">void</span> Application_EndRequest(Object sender, EventArgs e)
    {
        <span style="color:blue">if</span> (ContextLifeTimeManager != <span style="color:blue">null</span>)
        {
            ContextLifeTimeManager.RemoveValue();
        }
    }
}
</pre>
<pre><div style="color:black; background-color:white"><pre><span style="color:blue">public</span> <span style="color:blue">class</span> HttpContextDisposableLifetimeManager : LifetimeManager, IDisposable
{
    <span style="color:green">//since this is a constant string, you can only instantiate one of these</span>
    <span style="color:blue">const</span> <span style="color:blue">string</span> ItemName = <span style="color:#a31515">&quot;HttpContextLifetimeManager&quot;</span>;

    <span style="color:blue">public</span> <span style="color:blue">void</span> DisposingHandler(<span style="color:blue">object</span> source, EventArgs e)
    {
        RemoveValue();
    }

    <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">object</span> GetValue()
    {
        <span style="color:blue">return</span> HttpContext.Current.Items[ItemName];
    }
    <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> RemoveValue()
    {
        Dispose();
        HttpContext.Current.Items.Remove(ItemName);
    }

    <span style="color:blue">public</span> <span style="color:blue">override</span> <span style="color:blue">void</span> SetValue(<span style="color:blue">object</span> newValue)
    {
        HttpContext.Current.Items[ItemName] = newValue;
    }
    <span style="color:blue">public</span> <span style="color:blue">void</span> Dispose()
    {
        <span style="color:blue">var</span> obj = (IDisposable)GetValue();
        obj.Dispose();
    }
}
</pre>
</div>
&nbsp;</pre>
<pre>&nbsp;</pre>
</div>
<div id="_mcePaste" style="width:1px; height:1px; overflow:hidden; top:0px; left:-10000px">
&#65279;</div>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_555192" class="Options" >
            
        </div>
        
    </td>
</tr>

        <tr><td colspan="3"><div class="PostSeparator"></div></td></tr>
        

<tr id="PostPanel" class="Post" d:forid="589418">
    <td id="PostDetailsCell_589418" style="vertical-align: top; border: solid #BBB 1px; border-bottom: none; border-left: none; border-top: none; width: 114px" class="Post">
        <div class="Details">
            <a name="post589418"></a>
            <div class="UserName" style="white-space: pre-wrap; word-wrap: break-word;"><a class="UserProfileLink" href="http://www.codeplex.com/site/users/view/devtrends">devtrends</a></div>
            <div class="UserRole"></div>
            <div style="white-space: normal" class="SubText"><span class="smartDate" title="3/31/2011 12:13:46 PM" LocalTimeTicks="1301598826">Mar 31, 2011 at 12:13 PM</span></div>
            
            <div style="white-space: normal" class="SubText" id="UpdatedDiv">Edited <span class="smartDate" title="4/1/2011 8:05:35 AM" LocalTimeTicks="1301670335">Apr 1, 2011 at 8:05 AM</span></div>
            
        </div>
    </td>
    <td id="PostContent_589418" style="width: 100%; vertical-align: top;" 
        class=" discussionPost discussionListContent WordWrapBreakWord Post " 
        data-markdown="You&#32;might&#32;like&#32;to&#32;try&#32;&#32;http&#58;&#47;&#47;unitymvc3.codeplex.com&#32;which&#32;takes&#32;care&#32;of&#32;all&#32;this&#32;for&#32;you&#32;in&#32;a&#32;simple&#32;and&#32;efficient&#32;manner.&#32;It&#32;is&#32;also&#32;available&#32;as&#32;a&#32;NuGet&#32;package&#32;&#40;Unity.Mvc3&#41;">
        
<p>You might like to try <a href="http://unitymvc3.codeplex.com/" target="_blank" rel="nofollow">
http://unitymvc3.codeplex.com</a> which takes care of all this for you in a simple and efficient manner. It is also available as a NuGet package (Unity.Mvc3)</p>

        
    </td>
    <td style="vertical-align: top; width: 134px;" class="Post ">
        
        <div id="Options_589418" class="Options" >
            
        </div>
        
    </td>
</tr>

</table>
    </div>

    
        <div class="StandardMarginTop">
            <a id="SignInToAddCommentLink" href="https://www.codeplex.com/site/login?RedirectUrl=http%3a%2f%2funity.codeplex.com%2fdiscussions%2f242485">
                Sign in to post message or set email notifications
            </a>
        </div>
    


    <div id="PostEditorContainer">
        <a name="editor"></a>
        <div id="Editor" style="display: none;">
            

<div class="MarkdownEditor" data-options-id="e0f20a01-6019-4686-94ee-c97de67f87aa">
    <script class="options" defer="defer" id="e0f20a01-6019-4686-94ee-c97de67f87aa" type="application/json">{"maxLength":10000,"styleSheetLocation":""}</script>

    <div class="MarkdownEditorControls">
        <a href="#" tabindex="-1" class="control md_help" title="Markdown Syntax Guide"></a>
        <div class="control md_divider"></div>
        <a href="#" tabindex="-1" class="control md_header" title="Insert Header (CTRL + H)"></a>
        <a href="#" tabindex="-1" class="control md_code" title="Insert Code (CTRL + K)"></a>
        <a href="#" tabindex="-1" class="control md_quote" title="Insert Quote (CTRL + Q)"></a>
        <a href="#" tabindex="-1" class="control md_img" title="Insert Img (CTRL + G)"></a>
        <a href="#" tabindex="-1" class="control md_link" title="Insert Link (CTRL + L)"></a>
        <a href="#" tabindex="-1" class="control md_ulist" title="Unordered List (CTRL + U)"></a>
        <a href="#" tabindex="-1" class="control md_olist" title="Ordered List (CTRL + O)"></a>
        <a href="#" tabindex="-1" class="control md_italics" title="Italic Text (CTRL + I)"></a>
        <a href="#" tabindex="-1" class="control md_bold" title="Bold Text (CTRL + B)"></a>
    </div>

    

<div class="tab_control">
    <!-- Generate the basic HTML for the tabs. -->
    
        <div id="Compose"
              class="tab selected"
              data-custom-header-id=""
              data-tab-contents-id="compose_contents_23b5a135-8fed-44f6-b71e-0e6e4d98c627">
            Compose
        </div>
    
        <div id="Preview"
              class="tab "
              data-custom-header-id=""
              data-tab-contents-id="preview_contents_41d1160e-95d6-41e6-ba7c-8e9623b08839">
            Preview
        </div>
    
    <div class="clear"></div>
</div>


    <div id="compose_contents_23b5a135-8fed-44f6-b71e-0e6e4d98c627" class="compose_tab_content">
        <textarea class=" MarkdownEditorDimensions" cols="20" id="MarkdownEditor" name="content" rows="2">
</textarea>
        <div class="ClearBoth"></div>

        <div class="markdownGuide" style="display: none">
            <table>
                <tr>
                    <td class="markdownGuideColumn">
                        <h1>Text Formatting</h1>
                        <div># Header 1</div>
                        <div>## Header 2</div>
                        <br />
                        <div>*italics* (or _italics_)</div>
                        <div>**bold** (or __bold__)</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Lists</h1>
                        <div>* Unordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp * SubItem</div>
                        <br />
                        <div>1. Ordered List</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1. SubItem</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Quotes</h1>
                        <div>> Lorem ipsum</div>
                        <div>dolor sitamet </div>
                        <div>non. Lectus at</div>
                        <div>nam nunc...</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>Code</h1>
                        <div>`Inline Code`</div>
                        <br />
                        <div>``` C#</div>
                        <div>if (foo==bar)</div>
                        <div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbar++</div>
                        <div>```</div>
                    </td>
                    <td class="markdownGuideColumn">
                        <h1>References</h1>
                        <div>[Link Text](URL)</div>
                        <br />
                        <div>![Image](URL)</div>
                        <br />
                        <a class="Reference" target="_blank" href="http://codeplex.codeplex.com/wikipage?title=Markdown&referringTitle=Documentation">Markdown Reference</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="preview_contents_41d1160e-95d6-41e6-ba7c-8e9623b08839" class="preview_tab_content markDownOutput">
        
            <div></div>
        
    </div>
    <div class="clear"></div>
</div>

            
            <div class="row" id="recaptcha_row">
                
<script type="text/javascript">
    $(document).ready(function () {
        $('#recaptcha_reload').attr('src', '../assets/recaptcha_refresh.png');
        $('#recaptcha_switch_audio').attr('src', '../assets/recaptcha_audio.png');
        $('#recaptcha_switch_img').attr('src', '../assets/recaptcha_text.png');
        $('#recaptcha_whatsthis').attr('src', '../assets/recaptcha_help.png');
        $('#recaptcha_area tr:first').attr('height', '35');
    });
</script>

                <div class="clear"></div>
                <span id="ReCaptchaError"></span>
            </div>
            <div style="padding-top: 6px;">
                <input type="button" id="SaveButton" value="Save" class="ok" />
                <input type="button" id="CancelButton" value="Cancel" class="cancel" />
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div id="DeletePostPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Post <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this post? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="ClosePostCancel" value="Cancel" class="cancel" />
            <input type="button" id="ClosePostOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>
        
            <!-- Email notification / Subscription details -->
            
    </div>
</div>
    
<div id="DeleteThreadPanel" class="modal" style="display:none">
    <div class="row">
        <h2>Delete Thread <a href="javascript:return false;" class="close">X</a></h2>
    </div>
    <div class="modal_info">
        <p>Are you sure you want to delete this thread? You will not be able to recover it later.</p>
        <p class="modal_buttons">
            <input type="button" id="CloseThreadCancel" value="Cancel" class="cancel" />
            <input type="button" id="CloseThreadOk" value="Delete" class="ok" />
        </p>
        <div class="ClearBoth"></div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(function () {

        $('#recaptcha_response_field')
            .bind('keypress', function (event) { return $submitKeyPressElement(this, event); });


        if ($('#DeleteThreadLink')) {
            $('#DeleteThreadLink').click(function () {
                OpenDialog('#DeleteThreadPanel', true, '41em');
            });
        }
        
        $('#DeleteThreadPanel #CloseThreadOk').click(function () {
            var url = 'http://unity.codeplex.com/discussions/242485';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (x) {
                    location.href = x.RedirectUrl;
                }
            });
        });
    });

    workItemMention = new codeplex.ui.WorkItemMention();
    workItemMention.addLinks(".discussionPost");
</script>


        
        
                
                <div class="clear"></div>
                
                <div id="footer">
                    <div class="row">
                        <hr />
                        <ul>
                            <li>Â© 2006-2017 Microsoft</li>
                            <li><a href="http://www.codeplex.com/site/help">Get Help</a></li>
                            <li><a href="/site/legal/privacy">Privacy Statement</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/terms">Terms of Use</a></li>
                            <li><a href="http://www.codeplex.com/site/legal/conduct">Code of Conduct</a></li>
                            <li><a href="http://developermedia.com/" target="_blank">Advertise With Us</a></li>
                            <li>Version 2017.10.3.21062</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </body>

</html>